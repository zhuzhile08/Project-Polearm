/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Cv=Object.create;var Ss=Object.defineProperty;var Lv=Object.getOwnPropertyDescriptor;var Tv=Object.getOwnPropertyNames;var Av=Object.getPrototypeOf,Pv=Object.prototype.hasOwnProperty;var Fv=(o,e,t)=>e in o?Ss(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var jl=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),Kl=(o,e)=>{for(var t in e)Ss(o,t,{get:e[t],enumerable:!0})},Sp=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Tv(e))!Pv.call(o,n)&&n!==t&&Ss(o,n,{get:()=>e[n],enumerable:!(r=Lv(e,n))||r.enumerable});return o};var _n=(o,e,t)=>(t=o!=null?Cv(Av(o)):{},Sp(e||!o||!o.__esModule?Ss(t,"default",{value:o,enumerable:!0}):t,o)),Ev=o=>Sp(Ss({},"__esModule",{value:!0}),o);var Ze=(o,e,t)=>(Fv(o,typeof e!="symbol"?e+"":e,t),t);var ks=jl((UA,Ip)=>{"use strict";function Rr(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function kp(o,e){for(var t="",r=0,n=-1,s=0,i,a=0;a<=o.length;++a){if(a<o.length)i=o.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,a):t=o.slice(n+1,a),r=a-n-1;n=a,s=0}else i===46&&s!==-1?++s:s=-1}return t}function Mv(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var Sn={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),Rr(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=kp(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Rr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=kp(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Rr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];Rr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Sn.normalize(e)},relative:function(e,t){if(Rr(e),Rr(t),e===t||(e=Sn.resolve(e),t=Sn.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var a=t.length,l=a-i,c=s<l?s:l,f=-1,u=0;u<=c;++u){if(u===c){if(l>c){if(t.charCodeAt(i+u)===47)return t.slice(i+u+1);if(u===0)return t.slice(i+u)}else s>c&&(e.charCodeAt(r+u)===47?f=u:u===0&&(f=0));break}var d=e.charCodeAt(r+u),m=t.charCodeAt(i+u);if(d!==m)break;d===47&&(f=u)}var p="";for(u=r+f+1;u<=n;++u)(u===n||e.charCodeAt(u)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+t.slice(i+f):(i+=f,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(Rr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!s){n=i;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Rr(e);var r=0,n=-1,s=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(c===47){if(!s){r=i+1;break}}else l===-1&&(s=!1,l=i+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(n=i):(a=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!s){r=i+1;break}}else n===-1&&(s=!1,n=i+1);return n===-1?"":e.slice(r,n)}},extname:function(e){Rr(e);for(var t=-1,r=0,n=-1,s=!0,i=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}n===-1&&(s=!1,n=a+1),l===46?t===-1?t=a:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||n===-1||i===0||i===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Mv("/",e)},parse:function(e){Rr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var i=-1,a=0,l=-1,c=!0,f=e.length-1,u=0;f>=s;--f){if(r=e.charCodeAt(f),r===47){if(!c){a=f+1;break}continue}l===-1&&(c=!1,l=f+1),r===46?i===-1?i=f:u!==1&&(u=1):i!==-1&&(u=-1)}return i===-1||l===-1||u===0||u===1&&i===l-1&&i===a+1?l!==-1&&(a===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&n?(t.name=e.slice(1,i),t.base=e.slice(1,l)):(t.name=e.slice(a,i),t.base=e.slice(a,l)),t.ext=e.slice(i,l)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Sn.posix=Sn;Ip.exports=Sn});var pf=jl((TF,ts)=>{var re=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},Ke=-1,Je=1,$e=0;re.Diff=function(o,e){return[o,e]};re.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new re.Diff($e,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,i=this.diff_commonPrefix(o,e),a=o.substring(0,i);o=o.substring(i),e=e.substring(i),i=this.diff_commonSuffix(o,e);var l=o.substring(o.length-i);o=o.substring(0,o.length-i),e=e.substring(0,e.length-i);var c=this.diff_compute_(o,e,s,n);return a&&c.unshift(new re.Diff($e,a)),l&&c.push(new re.Diff($e,l)),this.diff_cleanupMerge(c),c};re.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new re.Diff(Je,e)];if(!e)return[new re.Diff(Ke,o)];var s=o.length>e.length?o:e,i=o.length>e.length?e:o,a=s.indexOf(i);if(a!=-1)return n=[new re.Diff(Je,s.substring(0,a)),new re.Diff($e,i),new re.Diff(Je,s.substring(a+i.length))],o.length>e.length&&(n[0][0]=n[2][0]=Ke),n;if(i.length==1)return[new re.Diff(Ke,o),new re.Diff(Je,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],f=l[1],u=l[2],d=l[3],m=l[4],p=this.diff_main(c,u,t,r),x=this.diff_main(f,d,t,r);return p.concat([new re.Diff($e,m)],x)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};re.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new re.Diff($e,""));for(var i=0,a=0,l=0,c="",f="";i<s.length;){switch(s[i][0]){case Je:l++,f+=s[i][1];break;case Ke:a++,c+=s[i][1];break;case $e:if(a>=1&&l>=1){s.splice(i-a-l,a+l),i=i-a-l;for(var u=this.diff_main(c,f,!1,t),d=u.length-1;d>=0;d--)s.splice(i,0,u[d]);i=i+u.length}l=0,a=0,c="",f="";break}i++}return s.pop(),s};re.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),i=s,a=2*s,l=new Array(a),c=new Array(a),f=0;f<a;f++)l[f]=-1,c[f]=-1;l[i+1]=0,c[i+1]=0;for(var u=r-n,d=u%2!=0,m=0,p=0,x=0,g=0,_=0;_<s&&!(new Date().getTime()>t);_++){for(var C=-_+m;C<=_-p;C+=2){var L=i+C,F;C==-_||C!=_&&l[L-1]<l[L+1]?F=l[L+1]:F=l[L-1]+1;for(var P=F-C;F<r&&P<n&&o.charAt(F)==e.charAt(P);)F++,P++;if(l[L]=F,F>r)p+=2;else if(P>n)m+=2;else if(d){var $=i+u-C;if($>=0&&$<a&&c[$]!=-1){var I=r-c[$];if(F>=I)return this.diff_bisectSplit_(o,e,F,P,t)}}}for(var T=-_+x;T<=_-g;T+=2){var $=i+T,I;T==-_||T!=_&&c[$-1]<c[$+1]?I=c[$+1]:I=c[$-1]+1;for(var O=I-T;I<r&&O<n&&o.charAt(r-I-1)==e.charAt(n-O-1);)I++,O++;if(c[$]=I,I>r)g+=2;else if(O>n)x+=2;else if(!d){var L=i+u-T;if(L>=0&&L<a&&l[L]!=-1){var F=l[L],P=i+F-L;if(I=r-I,F>=I)return this.diff_bisectSplit_(o,e,F,P,t)}}}}return[new re.Diff(Ke,o),new re.Diff(Je,e)]};re.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),i=e.substring(0,r),a=o.substring(t),l=e.substring(r),c=this.diff_main(s,i,!1,n),f=this.diff_main(a,l,!1,n);return c.concat(f)};re.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",f=0,u=-1,d=t.length;u<l.length-1;){u=l.indexOf(`
`,f),u==-1&&(u=l.length-1);var m=l.substring(f,u+1);(r.hasOwnProperty?r.hasOwnProperty(m):r[m]!==void 0)?c+=String.fromCharCode(r[m]):(d==s&&(m=l.substring(f),u=l.length),c+=String.fromCharCode(d),r[m]=d,t[d++]=m),f=u+1}return c}var s=4e4,i=n(o);s=65535;var a=n(e);return{chars1:i,chars2:a,lineArray:t}};re.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};re.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};re.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};re.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,i=1;;){var a=o.substring(n-i),l=e.indexOf(a);if(l==-1)return s;i+=l,(l==0||o.substring(n-i)==e.substring(0,i))&&(s=i,i++)}};re.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(p,x,g){for(var _=p.substring(g,g+Math.floor(p.length/4)),C=-1,L="",F,P,$,I;(C=x.indexOf(_,C+1))!=-1;){var T=n.diff_commonPrefix(p.substring(g),x.substring(C)),O=n.diff_commonSuffix(p.substring(0,g),x.substring(0,C));L.length<O+T&&(L=x.substring(C-O,C)+x.substring(C,C+T),F=p.substring(0,g-O),P=p.substring(g+T),$=x.substring(0,C-O),I=x.substring(C+T))}return L.length*2>=p.length?[F,P,$,I,L]:null}var i=s(t,r,Math.ceil(t.length/4)),a=s(t,r,Math.ceil(t.length/2)),l;if(!i&&!a)return null;a?i?l=i[4].length>a[4].length?i:a:l=a:l=i;var c,f,u,d;o.length>e.length?(c=l[0],f=l[1],u=l[2],d=l[3]):(u=l[0],d=l[1],c=l[2],f=l[3]);var m=l[4];return[c,f,u,d,m]};re.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=0,a=0,l=0,c=0;s<o.length;)o[s][0]==$e?(t[r++]=s,i=l,a=c,l=0,c=0,n=o[s][1]):(o[s][0]==Je?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(i,a)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new re.Diff(Ke,n)),o[t[r-1]+1][0]=Je,r--,r--,s=r>0?t[r-1]:-1,i=0,a=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==Ke&&o[s][0]==Je){var f=o[s-1][1],u=o[s][1],d=this.diff_commonOverlap_(f,u),m=this.diff_commonOverlap_(u,f);d>=m?(d>=f.length/2||d>=u.length/2)&&(o.splice(s,0,new re.Diff($e,u.substring(0,d))),o[s-1][1]=f.substring(0,f.length-d),o[s+1][1]=u.substring(d),s++):(m>=f.length/2||m>=u.length/2)&&(o.splice(s,0,new re.Diff($e,f.substring(0,m))),o[s-1][0]=Je,o[s-1][1]=u.substring(0,u.length-m),o[s+1][0]=Ke,o[s+1][1]=f.substring(m),s++),s++}s++}};re.prototype.diff_cleanupSemanticLossless=function(o){function e(m,p){if(!m||!p)return 6;var x=m.charAt(m.length-1),g=p.charAt(0),_=x.match(re.nonAlphaNumericRegex_),C=g.match(re.nonAlphaNumericRegex_),L=_&&x.match(re.whitespaceRegex_),F=C&&g.match(re.whitespaceRegex_),P=L&&x.match(re.linebreakRegex_),$=F&&g.match(re.linebreakRegex_),I=P&&m.match(re.blanklineEndRegex_),T=$&&p.match(re.blanklineStartRegex_);return I||T?5:P||$?4:_&&!L&&F?3:L||F?2:_||C?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==$e&&o[t+1][0]==$e){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],i=this.diff_commonSuffix(r,n);if(i){var a=n.substring(n.length-i);r=r.substring(0,r.length-i),n=a+n.substring(0,n.length-i),s=a+s}for(var l=r,c=n,f=s,u=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,n)+e(n,s);d>=u&&(u=d,l=r,c=n,f=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,f?o[t+1][1]=f:(o.splice(t+1,1),t--))}t++}};re.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;re.whitespaceRegex_=/\s/;re.linebreakRegex_=/[\r\n]/;re.blanklineEndRegex_=/\n\r?\n$/;re.blanklineStartRegex_=/^\r?\n\r?\n/;re.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=!1,a=!1,l=!1,c=!1;s<o.length;)o[s][0]==$e?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,i=l,a=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==Ke?c=!0:l=!0,n&&(i&&a&&l&&c||n.length<this.Diff_EditCost/2&&i+a+l+c==3)&&(o.splice(t[r-1],0,new re.Diff(Ke,n)),o[t[r-1]+1][0]=Je,r--,n=null,i&&a?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};re.prototype.diff_cleanupMerge=function(o){o.push(new re.Diff($e,""));for(var e=0,t=0,r=0,n="",s="",i;e<o.length;)switch(o[e][0]){case Je:r++,s+=o[e][1],e++;break;case Ke:t++,n+=o[e][1],e++;break;case $e:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(s,n),i!==0&&(e-t-r>0&&o[e-t-r-1][0]==$e?o[e-t-r-1][1]+=s.substring(0,i):(o.splice(0,0,new re.Diff($e,s.substring(0,i))),e++),s=s.substring(i),n=n.substring(i)),i=this.diff_commonSuffix(s,n),i!==0&&(o[e][1]=s.substring(s.length-i)+o[e][1],s=s.substring(0,s.length-i),n=n.substring(0,n.length-i))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new re.Diff(Ke,n)),e++),s.length&&(o.splice(e,0,new re.Diff(Je,s)),e++),e++):e!==0&&o[e-1][0]==$e?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var a=!1;for(e=1;e<o.length-1;)o[e-1][0]==$e&&o[e+1][0]==$e&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),a=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),a=!0)),e++;a&&this.diff_cleanupMerge(o)};re.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,i;for(i=0;i<o.length&&(o[i][0]!==Je&&(t+=o[i][1].length),o[i][0]!==Ke&&(r+=o[i][1].length),!(t>e));i++)n=t,s=r;return o.length!=i&&o[i][0]===Ke?s:s+(e-n)};re.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,i=0;i<o.length;i++){var a=o[i][0],l=o[i][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(a){case Je:e[i]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case Ke:e[i]='<del style="background:#ffe6e6;">'+c+"</del>";break;case $e:e[i]="<span>"+c+"</span>";break}}return e.join("")};re.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==Je&&(e[t]=o[t][1]);return e.join("")};re.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==Ke&&(e[t]=o[t][1]);return e.join("")};re.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],i=o[n][1];switch(s){case Je:t+=i.length;break;case Ke:r+=i.length;break;case $e:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};re.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case Je:e[t]="+"+encodeURI(o[t][1]);break;case Ke:e[t]="-"+o[t][1].length;break;case $e:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};re.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),i=0;i<s.length;i++){var a=s[i].substring(1);switch(s[i].charAt(0)){case"+":try{t[r++]=new re.Diff(Je,decodeURI(a))}catch(f){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);var c=o.substring(n,n+=l);s[i].charAt(0)=="="?t[r++]=new re.Diff($e,c):t[r++]=new re.Diff(Ke,c);break;default:if(s[i])throw new Error("Invalid diff operation in diff_fromDelta: "+s[i])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};re.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};re.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(F,P){var $=F/e.length,I=Math.abs(t-P);return n.Match_Distance?$+I/n.Match_Distance:I?1:$}var i=this.Match_Threshold,a=o.indexOf(e,t);a!=-1&&(i=Math.min(s(0,a),i),a=o.lastIndexOf(e,t+e.length),a!=-1&&(i=Math.min(s(0,a),i)));var l=1<<e.length-1;a=-1;for(var c,f,u=e.length+o.length,d,m=0;m<e.length;m++){for(c=0,f=u;c<f;)s(m,t+f)<=i?c=f:u=f,f=Math.floor((u-c)/2+c);u=f;var p=Math.max(1,t-f+1),x=Math.min(t+f,o.length)+e.length,g=Array(x+2);g[x+1]=(1<<m)-1;for(var _=x;_>=p;_--){var C=r[o.charAt(_-1)];if(m===0?g[_]=(g[_+1]<<1|1)&C:g[_]=(g[_+1]<<1|1)&C|((d[_+1]|d[_])<<1|1)|d[_+1],g[_]&l){var L=s(m,_-1);if(L<=i)if(i=L,a=_-1,a>t)p=Math.max(1,2*t-a);else break}}if(s(m+1,t)>i)break;d=g}return a};re.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};re.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new re.Diff($e,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new re.Diff($e,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};re.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],i=new re.patch_obj,a=0,l=0,c=0,f=r,u=r,d=0;d<n.length;d++){var m=n[d][0],p=n[d][1];switch(!a&&m!==$e&&(i.start1=l,i.start2=c),m){case Je:i.diffs[a++]=n[d],i.length2+=p.length,u=u.substring(0,c)+p+u.substring(c);break;case Ke:i.length1+=p.length,i.diffs[a++]=n[d],u=u.substring(0,c)+u.substring(c+p.length);break;case $e:p.length<=2*this.Patch_Margin&&a&&n.length!=d+1?(i.diffs[a++]=n[d],i.length1+=p.length,i.length2+=p.length):p.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(i,f),s.push(i),i=new re.patch_obj,a=0,f=u,l=c);break}m!==Je&&(l+=p.length),m!==Ke&&(c+=p.length)}return a&&(this.patch_addContext_(i,f),s.push(i)),s};re.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new re.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new re.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};re.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var i=o[s].start2+r,a=this.diff_text1(o[s].diffs),l,c=-1;if(a.length>this.Match_MaxBits?(l=this.match_main(e,a.substring(0,this.Match_MaxBits),i),l!=-1&&(c=this.match_main(e,a.substring(a.length-this.Match_MaxBits),i+a.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,a,i),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-i;var f;if(c==-1?f=e.substring(l,l+a.length):f=e.substring(l,c+this.Match_MaxBits),a==f)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+a.length);else{var u=this.diff_main(a,f,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(u)/a.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(u);for(var d=0,m,p=0;p<o[s].diffs.length;p++){var x=o[s].diffs[p];x[0]!==$e&&(m=this.diff_xIndex(u,d)),x[0]===Je?e=e.substring(0,l+m)+x[1]+e.substring(l+m):x[0]===Ke&&(e=e.substring(0,l+m)+e.substring(l+this.diff_xIndex(u,d+x[1].length))),x[0]!==Ke&&(d+=x[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};re.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=$e)s.unshift(new re.Diff($e,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var i=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=$e)s.push(new re.Diff($e,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var i=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,i),n.length1+=i,n.length2+=i}return t};re.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,i="";r.diffs.length!==0;){var a=new re.patch_obj,l=!0;for(a.start1=n-i.length,a.start2=s-i.length,i!==""&&(a.length1=a.length2=i.length,a.diffs.push(new re.Diff($e,i)));r.diffs.length!==0&&a.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],f=r.diffs[0][1];c===Je?(a.length2+=f.length,s+=f.length,a.diffs.push(r.diffs.shift()),l=!1):c===Ke&&a.diffs.length==1&&a.diffs[0][0]==$e&&f.length>2*e?(a.length1+=f.length,n+=f.length,l=!1,a.diffs.push(new re.Diff(c,f)),r.diffs.shift()):(f=f.substring(0,e-a.length1-this.Patch_Margin),a.length1+=f.length,n+=f.length,c===$e?(a.length2+=f.length,s+=f.length):l=!1,a.diffs.push(new re.Diff(c,f)),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}i=this.diff_text2(a.diffs),i=i.substring(i.length-this.Patch_Margin);var u=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);u!==""&&(a.length1+=u.length,a.length2+=u.length,a.diffs.length!==0&&a.diffs[a.diffs.length-1][0]===$e?a.diffs[a.diffs.length-1][1]+=u:a.diffs.push(new re.Diff($e,u))),l||o.splice(++t,0,a)}}};re.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};re.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var i=new re.patch_obj;for(e.push(i),i.start1=parseInt(s[1],10),s[2]===""?(i.start1--,i.length1=1):s[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(s[2],10)),i.start2=parseInt(s[3],10),s[4]===""?(i.start2--,i.length2=1):s[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(s[4],10)),r++;r<t.length;){var a=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(a=="-")i.diffs.push(new re.Diff(Ke,l));else if(a=="+")i.diffs.push(new re.Diff(Je,l));else if(a==" ")i.diffs.push(new re.Diff($e,l));else{if(a=="@")break;if(a!=="")throw new Error('Invalid patch mode "'+a+'" in: '+l)}r++}}return e};re.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};re.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case Je:r="+";break;case Ke:r="-";break;case $e:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};ts.exports=re;ts.exports.diff_match_patch=re;ts.exports.DIFF_DELETE=Ke;ts.exports.DIFF_INSERT=Je;ts.exports.DIFF_EQUAL=$e});var ng=jl((hE,og)=>{var Zh=require("url").parse,pS=require("events"),mS=require("https"),hS=require("http"),gS=require("util"),yS=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],rg=[239,187,191],xS=58,bS=32,eg=10,vS=13,tg=1024*256,wS=/^(cookie|authorization)$/i;function _S(o){return rg.every(function(e,t){return o[t]===e})}function st(o,e){var t=st.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function i(g){t!==st.CLOSED&&(t=st.CONNECTING,p("error",new Zs("error",{message:g})),d&&(o=d,d=null,n=!1),setTimeout(function(){t!==st.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,m())},s.reconnectInterval))}var a,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,f="",u="",d=null;function m(){var g=Zh(o),_=g.protocol==="https:";if(g.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(g.headers["Last-Event-ID"]=l),r){var C=n?kS(r):r;for(var L in C){var F=C[L];F&&(g.headers[L]=F)}}g.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(g.createConnection=e.createConnection);var P=e&&e.proxy;if(P){var $=Zh(e.proxy);_=$.protocol==="https:",g.protocol=_?"https:":"http:",g.path=o,g.headers.Host=g.host,g.hostname=$.hostname,g.host=$.host,g.port=$.port}if(e&&e.https){for(var I in e.https)if(yS.indexOf(I)!==-1){var T=e.https[I];T!==void 0&&(g[I]=T)}}e&&e.withCredentials!==void 0&&(g.withCredentials=e.withCredentials),a=(_?mS:hS).request(g,function(O){if(s.connectionInProgress=!1,O.statusCode===500||O.statusCode===502||O.statusCode===503||O.statusCode===504){p("error",new Zs("error",{status:O.statusCode,message:O.statusMessage})),i();return}if(O.statusCode===301||O.statusCode===302||O.statusCode===307){var G=O.headers.location;if(!G){p("error",new Zs("error",{status:O.statusCode,message:O.statusMessage}));return}var J=new URL(o).origin,q=new URL(G).origin;n=J!==q,O.statusCode===307&&(d=o),o=G,process.nextTick(m);return}if(O.statusCode!==200)return p("error",new Zs("error",{status:O.statusCode,message:O.statusMessage})),s.close();t=st.OPEN,O.on("close",function(){O.removeAllListeners("close"),O.removeAllListeners("end"),i()}),O.on("end",function(){O.removeAllListeners("close"),O.removeAllListeners("end"),i()}),p("open",new Zs("open"));var E,H,ue=0,ye=-1,de=0,ee=0;O.on("data",function(Ie){E?(Ie.length>E.length-ee&&(de=E.length*2+Ie.length,de>tg&&(de=E.length+Ie.length+tg),H=Buffer.alloc(de),E.copy(H,0,0,ee),E=H),Ie.copy(E,ee),ee+=Ie.length):(E=Ie,_S(E)&&(E=E.slice(rg.length)),ee=E.length);for(var B=0,U=ee;B<U;){c&&(E[B]===eg&&++B,c=!1);for(var me=-1,Y=ye,ke,Re=ue;me<0&&Re<U;++Re)ke=E[Re],ke===xS?Y<0&&(Y=Re-B):ke===vS?(c=!0,me=Re-B):ke===eg&&(me=Re-B);if(me<0){ue=U-B,ye=Y;break}else ue=0,ye=-1;x(E,B,Y,me),B+=me+1}B===U?(E=void 0,ee=0):B>0&&(E=E.slice(B,ee),ee=E.length)})}),a.on("error",function(O){s.connectionInProgress=!1,i(O.message)}),a.setNoDelay&&a.setNoDelay(!0),a.end()}m();function p(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==st.CLOSED&&(t=st.CLOSED,a.abort&&a.abort(),a.xhr&&a.xhr.abort&&a.xhr.abort())};function x(g,_,C,L){if(L===0){if(f.length>0){var F=u||"message";p(F,new SS(F,{data:f.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),f=""}u=void 0}else if(C>0){var P=C<0,$=0,I=g.slice(_,_+(P?L:C)).toString();P?$=L:g[_+C+1]!==bS?$=C+1:$=C+2,_+=$;var T=L-$,O=g.slice(_,_+T).toString();if(I==="data")f+=O+`
`;else if(I==="event")u=O;else if(I==="id")l=O;else if(I==="retry"){var G=parseInt(O,10);Number.isNaN(G)||(s.reconnectInterval=G)}}}}og.exports=st;gS.inherits(st,pS.EventEmitter);st.prototype.constructor=st;["open","error","message"].forEach(function(o){Object.defineProperty(st.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(st,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(st,"OPEN",{enumerable:!0,value:1});Object.defineProperty(st,"CLOSED",{enumerable:!0,value:2});st.prototype.CONNECTING=0;st.prototype.OPEN=1;st.prototype.CLOSED=2;st.prototype.close=function(){this._close()};st.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};st.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};st.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Zs(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function SS(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function kS(o){var e={};for(var t in o)wS.test(t)||(e[t]=o[t]);return e}});var $A={};Kl($A,{default:()=>Ml});module.exports=Ev($A);var tt=require("obsidian"),vv=require("obsidian"),wv=_n(ks());var We=require("obsidian");var bt=()=>new Map,Si=o=>{let e=bt();return o.forEach((t,r)=>{e.set(r,t)}),e},Sr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Cp=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},Lp=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var $r=()=>new Set;var ki=o=>o[o.length-1];var Tp=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},kr=Array.from;var Jl=Array.isArray;var Ii=class{constructor(){this._observers=bt()}on(e,t){return Sr(this._observers,e,$r).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return kr((this._observers.get(e)||bt()).values()).forEach(r=>r(...t))}destroy(){this._observers=bt()}},kn=class{constructor(){this._observers=bt()}on(e,t){Sr(this._observers,e,$r).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return kr((this._observers.get(e)||bt()).values()).forEach(r=>r(...t))}destroy(){this._observers=bt()}};var qt=Math.floor;var In=Math.abs;var Cn=(o,e)=>o<e?o:e,Ir=(o,e)=>o>e?o:e,NA=Number.isNaN;var Ci=o=>o!==0?o<0:1/o<0;var Yl=Number.MAX_SAFE_INTEGER,HA=Number.MIN_SAFE_INTEGER,VA=1<<31;var Ap=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&qt(o)===o),qA=Number.isNaN,zA=Number.parseInt;var Dv=String.fromCharCode,WA=String.fromCodePoint,jA=Dv(65535),Rv=o=>o.toLowerCase(),$v=/^\s*/g,Ov=o=>o.replace($v,""),Uv=/([A-Z])/g,Xl=(o,e)=>Ov(o.replace(Uv,t=>`${e}${Rv(t)}`));var Bv=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},An=typeof TextEncoder!="undefined"?new TextEncoder:null,Nv=o=>An.encode(o),Fp=An?Nv:Bv;var Tn=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Tn&&Tn.decode(new Uint8Array).length===1&&(Tn=null);var Qo=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Xo=()=>new Qo;var Hv=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var Xt=o=>{let e=new Uint8Array(Hv(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},Vv=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Ir(t,e)*2),o.cpos=0)},vt=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Ti=vt;var Pe=(o,e)=>{for(;e>127;)vt(o,128|127&e),e=qt(e/128);vt(o,127&e)},Ai=(o,e)=>{let t=Ci(e);for(t&&(e=-e),vt(o,(e>63?128:0)|(t?64:0)|63&e),e=qt(e/64);e>0;)vt(o,(e>127?128:0)|127&e),e=qt(e/128)},ec=new Uint8Array(3e4),qv=ec.length/3,zv=(o,e)=>{if(e.length<qv){let t=An.encodeInto(e,ec).written||0;Pe(o,t);for(let r=0;r<t;r++)vt(o,ec[r])}else wt(o,Fp(e))},Wv=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Pe(o,r);for(let n=0;n<r;n++)vt(o,t.codePointAt(n))},Yr=An&&An.encodeInto?zv:Wv;var Ls=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=Cn(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Ir(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},wt=(o,e)=>{Pe(o,e.byteLength),Ls(o,e)},tc=(o,e)=>{Vv(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},jv=(o,e)=>tc(o,4).setFloat32(0,e,!1),Kv=(o,e)=>tc(o,8).setFloat64(0,e,!1),Gv=(o,e)=>tc(o,8).setBigInt64(0,e,!1);var Mp=new DataView(new ArrayBuffer(4)),Jv=o=>(Mp.setFloat32(0,o),Mp.getFloat32(0)===o),Fn=(o,e)=>{switch(typeof e){case"string":vt(o,119),Yr(o,e);break;case"number":Ap(e)&&In(e)<=2147483647?(vt(o,125),Ai(o,e)):Jv(e)?(vt(o,124),jv(o,e)):(vt(o,123),Kv(o,e));break;case"bigint":vt(o,122),Gv(o,e);break;case"object":if(e===null)vt(o,126);else if(Jl(e)){vt(o,117),Pe(o,e.length);for(let t=0;t<e.length;t++)Fn(o,e[t])}else if(e instanceof Uint8Array)vt(o,116),wt(o,e);else{vt(o,118);let t=Object.keys(e);Pe(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];Yr(o,n),Fn(o,e[n])}}break;case"boolean":vt(o,e?120:121);break;default:vt(o,127)}},Cs=class extends Qo{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Pe(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var Dp=o=>{o.count>0&&(Ai(o.encoder,o.count===1?o.s:-o.s),o.count>1&&Pe(o.encoder,o.count-2))},Yo=class{constructor(){this.encoder=new Qo,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Dp(this),this.count=1,this.s=e)}toUint8Array(){return Dp(this),Xt(this.encoder)}};var Rp=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Ai(o.encoder,e),o.count>1&&Pe(o.encoder,o.count-2)}},En=class{constructor(){this.encoder=new Qo,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Rp(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Rp(this),Xt(this.encoder)}},Li=class{constructor(){this.sarr=[],this.s="",this.lensE=new Yo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Qo;return this.sarr.push(this.s),this.s="",Yr(e,this.sarr.join("")),Ls(e,this.lensE.toUint8Array()),Xt(e)}};var lr=o=>new Error(o),Cr=()=>{throw lr("Method unimplemented")},cr=()=>{throw lr("Unexpected case")};var $p=lr("Unexpected end of array"),Op=lr("Integer out of Range"),Mn=class{constructor(e){this.arr=e,this.pos=0}},Tr=o=>new Mn(o),Up=o=>o.pos!==o.arr.length;var Qv=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},kt=o=>Qv(o,Le(o));var Zo=o=>o.arr[o.pos++];var Le=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>Yl)throw Op}throw $p},Fi=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>Yl)throw Op}throw $p};var Yv=o=>{let e=Le(o);if(e===0)return"";{let t=String.fromCodePoint(Zo(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Zo(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},Xv=o=>Tn.decode(kt(o)),Lr=Tn?Xv:Yv;var nc=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},Zv=o=>nc(o,4).getFloat32(0,!1),ew=o=>nc(o,8).getFloat64(0,!1),tw=o=>nc(o,8).getBigInt64(0,!1);var rw=[o=>{},o=>null,Fi,Zv,ew,tw,o=>!1,o=>!0,Lr,o=>{let e=Le(o),t={};for(let r=0;r<e;r++){let n=Lr(o);t[n]=Dn(o)}return t},o=>{let e=Le(o),t=[];for(let r=0;r<e;r++)t.push(Dn(o));return t},kt],Dn=o=>rw[127-Zo(o)](o),Ts=class extends Mn{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Up(this)?this.count=Le(this)+1:this.count=-1),this.count--,this.s}};var en=class extends Mn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Fi(this);let e=Ci(this.s);this.count=1,e&&(this.s=-this.s,this.count=Le(this)+2)}return this.count--,this.s}};var Rn=class extends Mn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Fi(this),t=e&1;this.diff=qt(e/2),this.count=1,t&&(this.count=Le(this)+2)}return this.s+=this.diff,this.count--,this.s}},Pi=class{constructor(e){this.decoder=new en(e),this.str=Lr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var JA=crypto.subtle,Bp=crypto.getRandomValues.bind(crypto);var As=()=>Bp(new Uint32Array(1))[0];var ow=[1e7]+-1e3+-4e3+-8e3+-1e11,$n=()=>ow.replace(/[018]/g,o=>(o^As()&15>>o/4).toString(16));var tn=Date.now;var Xr=o=>new Promise(o);var nw=Promise.all.bind(Promise);var ic=o=>o===void 0?null:o;var ac=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Vp=new ac,iw=!0;try{typeof localStorage!="undefined"&&localStorage&&(Vp=localStorage,iw=!1)}catch(o){}var qp=Vp;var zp=Object.assign,lw=Object.keys,Wp=(o,e)=>{for(let t in o)e(o[t],t)};var Ps=o=>lw(o).length;var jp=o=>{for(let e in o)return!1;return!0},cw=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},lc=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),cc=(o,e)=>o===e||Ps(o)===Ps(e)&&cw(o,(t,r)=>(t!==void 0||lc(e,r))&&e[r]===t);var Fs=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Fs(o,e,t+1)}};var Gp=o=>o,fw=(o,e)=>o===e;var On=(o,e)=>{if(o==null||e==null)return fw(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!On(o.get(t),e.get(t)))return!1;break}case Object:if(Ps(o)!==Ps(e))return!1;for(let t in o)if(!lc(o,t)||!On(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!On(o[t],e[t]))return!1;break;default:return!1}return!0},Jp=(o,e)=>e.includes(o);var Es=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var XA=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Or,uw=[],dw=()=>{if(Or===void 0)if(Es){Or=bt();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Or.set(e,""),e=r):e!==null?(Or.set(e,r),e=null):uw.push(r)}e!==null&&Or.set(e,"")}else typeof location=="object"?(Or=bt(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Or.set(`--${Xl(e,"-")}`,t),Or.set(`-${Xl(e,"-")}`,t)}})):Or=bt();return Or},uc=o=>dw().has(o);var dc=o=>Es?ic(process.env[o.toUpperCase().replaceAll("-","_")]):ic(qp.getItem(o));var pw=o=>uc("--"+o)||dc(o)!==null,ZA=pw("production"),Qp=Es&&Jp(process.env.FORCE_COLOR,["true","1","2"]),Yp=!uc("no-colors")&&(!Es||process.stdout.isTTY||Qp)&&(!Es||uc("color")||Qp||dc("COLORTERM")!==null||(dc("TERM")||"").includes("color"));var hw=o=>new Uint8Array(o);var Xp=o=>{let e=hw(o.byteLength);return e.set(o),e};var pc=class{constructor(e,t){this.left=e,this.right=t}},At=(o,e)=>new pc(o,e);var Zp=(o,e)=>o.forEach(t=>e(t.left,t.right));var Ur=typeof document!="undefined"?document:{},yw=o=>Ur.createElement(o),xw=()=>Ur.createDocumentFragment(),bw=o=>Ur.createTextNode(o),eP=typeof DOMParser!="undefined"?new DOMParser:null;var vw=(o,e)=>(Zp(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var ww=o=>{let e=xw();for(let t=0;t<o.length;t++)rm(e,o[t]);return e},em=(o,e)=>(rm(o,ww(e)),o);var Ms=(o,e=[],t=[])=>em(vw(yw(o),e),t);var Un=bw;var tm=o=>Cp(o,(e,t)=>`${t}:${e};`).join("");var rm=(o,e)=>o.appendChild(e),tP=Ur.ELEMENT_NODE,rP=Ur.TEXT_NODE,oP=Ur.CDATA_SECTION_NODE,nP=Ur.COMMENT_NODE,sP=Ur.DOCUMENT_NODE,iP=Ur.DOCUMENT_TYPE_NODE,aP=Ur.DOCUMENT_FRAGMENT_NODE;var Br=Symbol;var Ds=Br(),Rs=Br(),hc=Br(),gc=Br(),yc=Br(),$s=Br(),xc=Br(),Os=Br(),bc=Br(),nm=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var lP=tn();var kw={[Ds]:At("font-weight","bold"),[Rs]:At("font-weight","normal"),[hc]:At("color","blue"),[yc]:At("color","green"),[gc]:At("color","grey"),[$s]:At("color","red"),[xc]:At("color","purple"),[Os]:At("color","orange"),[bc]:At("color","black")},Iw=o=>{var i;o.length===1&&((i=o[0])==null?void 0:i.constructor)===Function&&(o=o[0]());let e=[],t=[],r=bt(),n=[],s=0;for(;s<o.length;s++){let a=o[s],l=kw[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){let c=tm(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let a=o[s];a instanceof Symbol||n.push(a)}return n},Cw=Yp?Iw:nm,sm=(...o)=>{console.log(...Cw(o)),Lw.forEach(e=>e.print(o))};var Lw=$r();var im=o=>({[Symbol.iterator](){return this},next:o}),am=(o,e)=>im(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Mi=(o,e)=>im(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Bs=class{constructor(e,t){this.clock=e,this.len=t}},rn=class{constructor(){this.clients=new Map}},_m=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let i=0;i<r.length;i++){let a=r[i];Fm(o,s,a.clock,a.len,t)}}),Ew=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=qt((t+r)/2),s=o[n],i=s.clock;if(i<=e){if(e<i+s.len)return n;t=n+1}else r=n-1}return null},Rc=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&Ew(t,e.clock)!==null},$c=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=Ir(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},wc=o=>{let e=new rn;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let i=t+1;i<o.length;i++)Tp(s,o[i].clients.get(n)||[]);e.clients.set(n,s)}});return $c(e),e},Ni=(o,e,t,r)=>{Sr(o.clients,e,()=>[]).push(new Bs(t,r))},Oc=()=>new rn,Mw=o=>{let e=Oc();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let i=t[s];if(i.deleted){let a=i.id.clock,l=i.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new Bs(a,l))}}n.length>0&&e.clients.set(r,n)}),e},To=(o,e)=>{Pe(o.restEncoder,e.clients.size),kr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),Pe(o.restEncoder,t);let n=r.length;Pe(o.restEncoder,n);for(let s=0;s<n;s++){let i=r[s];o.writeDsClock(i.clock),o.writeDsLen(i.len)}})},Ns=o=>{let e=new rn,t=Le(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Le(o.restDecoder),s=Le(o.restDecoder);if(s>0){let i=Sr(e.clients,n,()=>[]);for(let a=0;a<s;a++)i.push(new Bs(o.readDsClock(),o.readDsLen()))}}return e},fm=(o,e,t)=>{let r=new rn,n=Le(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let i=Le(o.restDecoder),a=Le(o.restDecoder),l=t.clients.get(i)||[],c=ut(t,i);for(let f=0;f<a;f++){let u=o.readDsClock(),d=u+o.readDsLen();if(u<c){c<d&&Ni(r,i,c,d-c);let m=Hr(l,u),p=l[m];for(!p.deleted&&p.id.clock<u&&(l.splice(m+1,0,Ji(e,p,u-p.id.clock)),m++);m<l.length&&(p=l[m++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&l.splice(m,0,Ji(e,p,d-p.id.clock)),p.delete(e))}else Ni(r,i,u,d-u)}}if(r.clients.size>0){let s=new Zr;return Pe(s.restEncoder,0),To(s,r),s.toUint8Array()}return null};var Sm=As,Zt=class extends Ii{constructor({guid:e=$n(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=Sm(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Wi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Xr(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Xr(c=>{let f=u=>{(u===void 0||u===!0)&&(this.off("sync",f),c())};this.on("sync",f)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&ze(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(kr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return ze(this,e,t)}get(e,t=yt){let r=Sr(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==yt&&n!==t)if(n===yt){let s=new t;s._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=s}),s._start=r._start;for(let i=s._start;i!==null;i=i.right)i.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Nr)}getText(e=""){return this.get(e,Fo)}getMap(e=""){return this.get(e,eo)}getXmlElement(e=""){return this.get(e,Eo)}getXmlFragment(e=""){return this.get(e,to)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){kr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new Zt({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,ze(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Hn=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Le(this.restDecoder)}readDsLen(){return Le(this.restDecoder)}},Hi=class extends Hn{readLeftID(){return Ue(Le(this.restDecoder),Le(this.restDecoder))}readRightID(){return Ue(Le(this.restDecoder),Le(this.restDecoder))}readClient(){return Le(this.restDecoder)}readInfo(){return Zo(this.restDecoder)}readString(){return Lr(this.restDecoder)}readParentInfo(){return Le(this.restDecoder)===1}readTypeRef(){return Le(this.restDecoder)}readLen(){return Le(this.restDecoder)}readAny(){return Dn(this.restDecoder)}readBuf(){return Xp(kt(this.restDecoder))}readJSON(){return JSON.parse(Lr(this.restDecoder))}readKey(){return Lr(this.restDecoder)}},_c=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Le(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Le(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Ao=class extends _c{constructor(e){super(e),this.keys=[],Le(e),this.keyClockDecoder=new Rn(kt(e)),this.clientDecoder=new en(kt(e)),this.leftClockDecoder=new Rn(kt(e)),this.rightClockDecoder=new Rn(kt(e)),this.infoDecoder=new Ts(kt(e),Zo),this.stringDecoder=new Pi(kt(e)),this.parentInfoDecoder=new Ts(kt(e),Zo),this.typeRefDecoder=new en(kt(e)),this.lenDecoder=new en(kt(e))}readLeftID(){return new Lo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Lo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Dn(this.restDecoder)}readBuf(){return kt(this.restDecoder)}readJSON(){return Dn(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Vn=class{constructor(){this.restEncoder=Xo()}toUint8Array(){return Xt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Pe(this.restEncoder,e)}writeDsLen(e){Pe(this.restEncoder,e)}},on=class extends Vn{writeLeftID(e){Pe(this.restEncoder,e.client),Pe(this.restEncoder,e.clock)}writeRightID(e){Pe(this.restEncoder,e.client),Pe(this.restEncoder,e.clock)}writeClient(e){Pe(this.restEncoder,e)}writeInfo(e){Ti(this.restEncoder,e)}writeString(e){Yr(this.restEncoder,e)}writeParentInfo(e){Pe(this.restEncoder,e?1:0)}writeTypeRef(e){Pe(this.restEncoder,e)}writeLen(e){Pe(this.restEncoder,e)}writeAny(e){Fn(this.restEncoder,e)}writeBuf(e){wt(this.restEncoder,e)}writeJSON(e){Yr(this.restEncoder,JSON.stringify(e))}writeKey(e){Yr(this.restEncoder,e)}},Vi=class{constructor(){this.restEncoder=Xo(),this.dsCurrVal=0}toUint8Array(){return Xt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,Pe(this.restEncoder,t)}writeDsLen(e){e===0&&cr(),Pe(this.restEncoder,e-1),this.dsCurrVal+=e}},Zr=class extends Vi{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new En,this.clientEncoder=new Yo,this.leftClockEncoder=new En,this.rightClockEncoder=new En,this.infoEncoder=new Cs(Ti),this.stringEncoder=new Li,this.parentInfoEncoder=new Cs(Ti),this.typeRefEncoder=new Yo,this.lenEncoder=new Yo}toUint8Array(){let e=Xo();return Pe(e,0),wt(e,this.keyClockEncoder.toUint8Array()),wt(e,this.clientEncoder.toUint8Array()),wt(e,this.leftClockEncoder.toUint8Array()),wt(e,this.rightClockEncoder.toUint8Array()),wt(e,Xt(this.infoEncoder)),wt(e,this.stringEncoder.toUint8Array()),wt(e,Xt(this.parentInfoEncoder)),wt(e,this.typeRefEncoder.toUint8Array()),wt(e,this.lenEncoder.toUint8Array()),Ls(e,Xt(this.restEncoder)),Xt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Fn(this.restEncoder,e)}writeBuf(e){wt(this.restEncoder,e)}writeJSON(e){Fn(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Dw=(o,e,t,r)=>{r=Ir(r,e[0].id.clock);let n=Hr(e,r);Pe(o.restEncoder,e.length-n),o.writeClient(t),Pe(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let i=n+1;i<e.length;i++)e[i].write(o,0)},Uc=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{ut(e,s)>n&&r.set(s,n)}),Qi(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),Pe(o.restEncoder,r.size),kr(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{Dw(o,e.clients.get(n),n,s)})},Rw=(o,e)=>{let t=bt(),r=Le(o.restDecoder);for(let n=0;n<r;n++){let s=Le(o.restDecoder),i=new Array(s),a=o.readClient(),l=Le(o.restDecoder);t.set(a,{i:0,refs:i});for(let c=0;c<s;c++){let f=o.readInfo();switch(31&f){case 0:{let u=o.readLen();i[c]=new zt(Ue(a,l),u),l+=u;break}case 10:{let u=Le(o.restDecoder);i[c]=new Wt(Ue(a,l),u),l+=u;break}default:{let u=(f&192)===0,d=new Qe(Ue(a,l),null,(f&128)===128?o.readLeftID():null,null,(f&64)===64?o.readRightID():null,u?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,u&&(f&32)===32?o.readString():null,Qm(o,f));i[c]=d,l+=d.length}}}}return t},$w=(o,e,t)=>{let r=[],n=kr(t.keys()).sort((m,p)=>m-p);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let m=t.get(n[n.length-1]);for(;m.refs.length===m.i;)if(n.pop(),n.length>0)m=t.get(n[n.length-1]);else return null;return m},i=s();if(i===null)return null;let a=new Wi,l=new Map,c=(m,p)=>{let x=l.get(m);(x==null||x>p)&&l.set(m,p)},f=i.refs[i.i++],u=new Map,d=()=>{for(let m of r){let p=m.id.client,x=t.get(p);x?(x.i--,a.clients.set(p,x.refs.slice(x.i)),t.delete(p),x.i=0,x.refs=[]):a.clients.set(p,[m]),n=n.filter(g=>g!==p)}r.length=0};for(;;){if(f.constructor!==Wt){let p=Sr(u,f.id.client,()=>ut(e,f.id.client))-f.id.clock;if(p<0)r.push(f),c(f.id.client,f.id.clock-1),d();else{let x=f.getMissing(o,e);if(x!==null){r.push(f);let g=t.get(x)||{refs:[],i:0};if(g.refs.length===g.i)c(x,ut(e,x)),d();else{f=g.refs[g.i++];continue}}else(p===0||p<f.length)&&(f.integrate(o,p),u.set(f.id.client,f.id.clock+f.length))}}if(r.length>0)f=r.pop();else if(i!==null&&i.i<i.refs.length)f=i.refs[i.i++];else{if(i=s(),i===null)break;f=i.refs[i.i++]}}if(a.clients.size>0){let m=new Zr;return Uc(m,a,new Map),Pe(m.restEncoder,0),{missing:l,update:m.toUint8Array()}}return null},Ow=(o,e)=>Uc(o,e.doc.store,e.beforeState),Uw=(o,e,t,r=new Ao(o))=>ze(e,n=>{n.local=!1;let s=!1,i=n.doc,a=i.store,l=Rw(r,i),c=$w(n,a,l),f=a.pendingStructs;if(f){for(let[d,m]of f.missing)if(m<ut(a,d)){s=!0;break}if(c){for(let[d,m]of c.missing){let p=f.missing.get(d);(p==null||p>m)&&f.missing.set(d,m)}f.update=ji([f.update,c.update])}}else a.pendingStructs=c;let u=fm(r,n,a);if(a.pendingDs){let d=new Ao(Tr(a.pendingDs));Le(d.restDecoder);let m=fm(d,n,a);u&&m?a.pendingDs=ji([u,m]):a.pendingDs=u||m}else a.pendingDs=u;if(s){let d=a.pendingStructs.update;a.pendingStructs=null,km(n.doc,d)}},t,!1);var km=(o,e,t,r=Ao)=>{let n=Tr(e);Uw(n,o,t,new r(n))},dr=(o,e,t)=>km(o,e,t,Hi),Bw=(o,e,t=new Map)=>{Uc(o,e.store,t),To(o,Mw(e.store))},Nw=(o,e=new Uint8Array([0]),t=new Zr)=>{let r=Im(e);Bw(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(Zw(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===on)return Yw(n.map((s,i)=>i===0?s:t_(s)));if(t.constructor===Zr)return ji(n)}return n[0]},ln=(o,e)=>Nw(o,e,new on),Hw=o=>{let e=new Map,t=Le(o.restDecoder);for(let r=0;r<t;r++){let n=Le(o.restDecoder),s=Le(o.restDecoder);e.set(n,s)}return e},Im=o=>Hw(new Hn(Tr(o))),Cm=(o,e)=>(Pe(o.restEncoder,e.size),kr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Pe(o.restEncoder,t),Pe(o.restEncoder,r)}),o),Vw=(o,e)=>Cm(o,Qi(e.store)),qw=(o,e=new Vi)=>(o instanceof Map?Cm(e,o):Vw(e,o),e.toUint8Array()),Lm=o=>qw(o,new Vn),Sc=class{constructor(){this.l=[]}},um=()=>new Sc,dm=(o,e)=>o.l.push(e),pm=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Tm=(o,e,t)=>Fs(o.l,[e,t]),Lo=class{constructor(e,t){this.client=e,this.clock=t}},Nn=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ue=(o,e)=>new Lo(o,e);var Am=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw cr()};var qi=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,i)=>{let a=s.get("ds"),l=s.get("ids"),c=f=>this.clients.set(f,i);a.observe(f=>{f.changes.added.forEach(u=>{u.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(i,wc([this.dss.get(i)||Oc(),Ns(new Hn(Tr(d)))]))})})}),this.dss.set(i,wc(a.map(f=>Ns(new Hn(Tr(f)))))),l.observe(f=>f.changes.added.forEach(u=>u.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(i=>n(t.get(i),i))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,i=s.get(r);i||(i=new eo,i.set("ids",new Nr),i.set("ds",new Nr),s.set(r,i)),i.get("ids").push([t]),s.observe(a=>{setTimeout(()=>{let l=s.get(r);if(l!==i){i=l,this.clients.forEach((u,d)=>{r===u&&i.get("ids").push([d])});let c=new Vn,f=this.dss.get(r);f&&(To(c,f),i.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",a=>{setTimeout(()=>{let l=i.get("ds"),c=a.deleteSet;if(a.local&&c.clients.size>0&&n(a,c)){let f=new Vn;To(f,c),l.push([f.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Rc(r,e))return t;return null}},zi=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var Bc=o=>new zi(o.type==null?null:Ue(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ue(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),kc=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},zw=(o,e,t=0)=>new kc(o,e,t),Di=(o,e,t)=>{let r=null,n=null;return o._item===null?n=Am(o):r=Ue(o._item.id.client,o._item.id.clock),new zi(r,n,e,t)},Nc=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return Di(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Di(o,Ue(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Di(o,r.lastId,t);r=r.right}return Di(o,null,t)};var Hc=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,i=o.assoc,a=null,l=0;if(r!==null){if(ut(t,r.client)<=r.clock)return null;let c=wm(t,r),f=c.item;if(!(f instanceof Qe))return null;if(a=f.parent,a._item===null||!a._item.deleted){l=f.deleted||!f.countable?0:c.diff+(i>=0?0:1);let u=f.left;for(;u!==null;)!u.deleted&&u.countable&&(l+=u.length),u=u.left}}else{if(s!==null)a=e.get(s);else if(n!==null){if(ut(t,n.client)<=n.clock)return null;let{item:c}=wm(t,n);if(c instanceof Qe&&c.content instanceof ur)a=c.content.type;else return null}else throw cr();i>=0?l=a._length:l=0}return zw(a,l,o.assoc)},Vc=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&Nn(o.item,e.item)&&Nn(o.type,e.type)&&o.assoc===e.assoc,Ic=class{constructor(e,t){this.ds=e,this.sv=t}};var Ww=(o,e)=>new Ic(o,e),xP=Ww(Oc(),new Map);var Bn=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Rc(e.ds,o.id),Cc=(o,e)=>{let t=Sr(o.meta,Cc,$r),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<ut(r,s)&&Po(o,Ue(s,n))}),_m(o,e.ds,n=>{}),t.add(e))};var Wi=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Qi=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},ut=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},Pm=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw cr()}t.push(e)},Hr=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let i=qt(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[i],s=n.id.clock,s<=e){if(e<s+n.length)return i;t=i+1}else r=i-1;i=qt((t+r)/2)}throw cr()},jw=(o,e)=>{let t=o.clients.get(e.client);return t[Hr(t,e.clock)]},Oi=jw,Lc=(o,e,t)=>{let r=Hr(e,t),n=e[r];return n.id.clock<t&&n instanceof Qe?(e.splice(r+1,0,Ji(o,n,t-n.id.clock)),r+1):r},Po=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[Lc(o,t,e.clock)]},mm=(o,e,t)=>{let r=e.clients.get(t.client),n=Hr(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==zt&&r.splice(n+1,0,Ji(o,s,t.clock-s.id.clock+1)),s},Kw=(o,e,t)=>{let r=o.clients.get(e.id.client);r[Hr(r,e.id.clock)]=t},Fm=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,i=Lc(o,e,t),a;do a=e[i++],s<a.id.clock+a.length&&Lc(o,e,s),n(a);while(i<e.length&&e[i].id.clock<s)},Tc=class{constructor(e,t,r){this.doc=e,this.deleteSet=new rn,this.beforeState=Qi(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},hm=(o,e)=>e.deleteSet.clients.size===0&&!Lp(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:($c(e.deleteSet),Ow(o,e),To(o,e.deleteSet),!0),gm=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Sr(o.changed,e,$r).add(t)},Ui=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Qe&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},Gw=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){let a=n[i],l=a.clock+a.len;for(let c=Hr(s,a.clock),f=s[c];c<s.length&&f.id.clock<l;f=s[++c]){let u=s[c];if(a.clock+a.len<=u.id.clock)break;u instanceof Qe&&u.deleted&&!u.keep&&t(u)&&u.gc(e,!1)}}}},Jw=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let i=t[s],a=Cn(n.length-1,1+Hr(n,i.clock+i.len-1));for(let l=a,c=n[l];l>0&&c.id.clock>=i.clock;c=n[l])l-=1+Ui(n,l)}})};var Em=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,i=t._mergeStructs;try{$c(s),t.afterState=Qi(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(f=>f.target._item===null||!f.target._item.deleted),l.forEach(f=>{f.currentTarget=c,f._path=null}),l.sort((f,u)=>f.path.length-u.path.length),Tm(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Fs(a,[]),t._needFormattingCleanup&&d_(t)}finally{r.gc&&Gw(s,n,r.gcFilter),Jw(s,n),t.afterState.forEach((f,u)=>{let d=t.beforeState.get(u)||0;if(d!==f){let m=n.clients.get(u),p=Ir(Hr(m,d),1);for(let x=m.length-1;x>=p;)x-=1+Ui(m,x)}});for(let f=i.length-1;f>=0;f--){let{client:u,clock:d}=i[f].id,m=n.clients.get(u),p=Hr(m,d);p+1<m.length&&Ui(m,p+1)>1||p>0&&Ui(m,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(sm(Os,Ds,"[yjs] ",Rs,$s,"Changed the client-id because another client seems to be using it."),r.clientID=Sm()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let f=new on;hm(f,t)&&r.emit("update",[f.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let f=new Zr;hm(f,t)&&r.emit("updateV2",[f.toUint8Array(),t.origin,r,t])}let{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(f=>{f.clientID=r.clientID,f.collectionid==null&&(f.collectionid=r.collectionid),r.subdocs.add(f)}),c.forEach(f=>r.subdocs.delete(f)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(f=>f.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):Em(o,e+1)}}},ze=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,i=null;o._transaction===null&&(s=!0,o._transaction=new Tc(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{i=e(o._transaction)}finally{if(s){let a=o._transaction===n[0];o._transaction=null,a&&Em(n,0)}}return i};function*Qw(o){let e=Le(o.restDecoder);for(let t=0;t<e;t++){let r=Le(o.restDecoder),n=o.readClient(),s=Le(o.restDecoder);for(let i=0;i<r;i++){let a=o.readInfo();if(a===10){let l=Le(o.restDecoder);yield new Wt(Ue(n,s),l),s+=l}else if(31&a){let l=(a&192)===0,c=new Qe(Ue(n,s),null,(a&128)===128?o.readLeftID():null,null,(a&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(a&32)===32?o.readString():null,Qm(o,a));yield c,s+=c.length}else{let l=o.readLen();yield new zt(Ue(n,s),l),s+=l}}}}var Hs=class{constructor(e,t){this.gen=Qw(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Wt);return this.curr}};var Vs=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Yw=o=>ji(o,Hi,on);var Xw=(o,e)=>{if(o.constructor===zt){let{client:t,clock:r}=o.id;return new zt(Ue(t,r+e),o.length-e)}else if(o.constructor===Wt){let{client:t,clock:r}=o.id;return new Wt(Ue(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new Qe(Ue(r,n+e),null,Ue(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},ji=(o,e=Ao,t=Zr)=>{if(o.length===1)return o[0];let r=o.map(f=>new e(Tr(f))),n=r.map(f=>new Hs(f,!0)),s=null,i=new t,a=new Vs(i);for(;n=n.filter(d=>d.curr!==null),n.sort((d,m)=>{if(d.curr.id.client===m.curr.id.client){let p=d.curr.id.clock-m.curr.id.clock;return p===0?d.curr.constructor===m.curr.constructor?0:d.curr.constructor===Wt?1:-1:p}else return m.curr.id.client-d.curr.id.client}),n.length!==0;){let f=n[0],u=f.curr.id.client;if(s!==null){let d=f.curr,m=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=f.next(),m=!0;if(d===null||d.id.client!==u||m&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(u!==s.struct.id.client)Io(a,s.struct,s.offset),s={struct:d,offset:0},f.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Wt)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Io(a,s.struct,s.offset);let p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Wt(Ue(u,s.struct.id.clock+s.struct.length),p),offset:0}}else{let p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===Wt?s.struct.length-=p:d=Xw(d,p)),s.struct.mergeWith(d)||(Io(a,s.struct,s.offset),s={struct:d,offset:0},f.next())}}else s={struct:f.curr,offset:0},f.next();for(let d=f.curr;d!==null&&d.id.client===u&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Wt;d=f.next())Io(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Io(a,s.struct,s.offset),s=null),qc(a);let l=r.map(f=>Ns(f)),c=wc(l);return To(i,c),i.toUint8Array()},Zw=(o,e,t=Ao,r=Zr)=>{let n=Im(e),s=new r,i=new Vs(s),a=new t(Tr(o)),l=new Hs(a,!1);for(;l.curr;){let f=l.curr,u=f.id.client,d=n.get(u)||0;if(l.curr.constructor===Wt){l.next();continue}if(f.id.clock+f.length>d)for(Io(i,f,Ir(d-f.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)Io(i,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}qc(i);let c=Ns(a);return To(s,c),s.toUint8Array()};var Mm=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:Xt(o.encoder.restEncoder)}),o.encoder.restEncoder=Xo(),o.written=0)},Io=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&Mm(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),Pe(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},qc=o=>{Mm(o);let e=o.encoder.restEncoder;Pe(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];Pe(e,r.written),Ls(e,r.restEncoder)}},e_=(o,e,t,r)=>{let n=new t(Tr(o)),s=new Hs(n,!1),i=new r,a=new Vs(i);for(let c=s.curr;c!==null;c=s.next())Io(a,e(c),0);qc(a);let l=Ns(n);return To(i,l),i.toUint8Array()};var t_=o=>e_(o,Gp,Ao,on),ym="You must not compute changes after the event-handler fired.",qn=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=r_(this.currentTarget,this.target))}deletes(e){return Rc(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw lr(ym);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),i,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))i="delete",a=ki(l.content.getContent());else return;else l!==null&&this.deletes(l)?(i="update",a=ki(l.content.getContent())):(i="add",a=void 0)}else if(this.deletes(s))i="delete",a=ki(s.content.getContent());else return;e.set(n,{action:i,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw lr(ym);let t=this.target,r=$r(),n=$r(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null,l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,n.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}},r_=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},Dm=80,zc=0,Ac=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=zc++}},o_=o=>{o.timestamp=zc++},Rm=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=zc++},n_=(o,e,t)=>{if(o.length>=Dm){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return Rm(r,e,t),r}else{let r=new Ac(e,t);return o.push(r),r}},Yi=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,i)=>In(e-s.index)<In(e-i.index)?s:i),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,o_(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&In(t.index-n)<r.parent.length/Dm?(Rm(t,r,n),t):n_(o._searchMarker,r,n)},qs=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=Ir(e,n.index+t))}};var Xi=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;Sr(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;Tm(r._eH,t,e)},yt=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=um(),this._dEH=um(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Cr()}clone(){throw Cr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){dm(this._eH,e)}observeDeep(e){dm(this._dEH,e)}unobserve(e){pm(this._eH,e)}unobserveDeep(e){pm(this._dEH,e)}toJSON(){}},$m=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let i=s.content.getContent();if(i.length<=e)e-=i.length;else{for(let a=e;a<i.length&&r>0;a++)n.push(i[a]),r--;e=0}}s=s.right}return n},Om=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var zs=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},Um=(o,e)=>{let t=[];return zs(o,(r,n)=>{t.push(e(r,n,o))}),t},s_=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},Bm=(o,e)=>{let t=Yi(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ki=(o,e,t,r)=>{let n=t,s=o.doc,i=s.clientID,a=s.store,l=t===null?e._start:t.right,c=[],f=()=>{c.length>0&&(n=new Qe(Ue(i,ut(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new oo(c)),n.integrate(o,0),c=[])};r.forEach(u=>{if(u===null)c.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(u);break;default:switch(f(),u.constructor){case Uint8Array:case ArrayBuffer:n=new Qe(Ue(i,ut(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new nn(new Uint8Array(u))),n.integrate(o,0);break;case Zt:n=new Qe(Ue(i,ut(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new an(u)),n.integrate(o,0);break;default:if(u instanceof yt)n=new Qe(Ue(i,ut(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new ur(u)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),f()},Nm=()=>lr("Length exceeded!"),Hm=(o,e,t,r)=>{if(t>e._length)throw Nm();if(t===0)return e._searchMarker&&qs(e._searchMarker,t,r.length),Ki(o,e,null,r);let n=t,s=Yi(e,t),i=e._start;for(s!==null&&(i=s.p,t-=s.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&Po(o,Ue(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&qs(e._searchMarker,n,r.length),Ki(o,e,i,r)},i_=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,i)=>i.index>s.index?i:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return Ki(o,e,n,t)},Vm=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,i=Yi(e,t),a=e._start;for(i!==null&&(a=i.p,t-=i.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&Po(o,Ue(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Po(o,Ue(a.id.client,a.id.clock+r)),a.delete(o),r-=a.length),a=a.right;if(r>0)throw Nm();e._searchMarker&&qs(e._searchMarker,n,-s+r)},Gi=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},Wc=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,i=s.clientID,a;if(r==null)a=new oo([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new oo([r]);break;case Uint8Array:a=new nn(r);break;case Zt:a=new an(r);break;default:if(r instanceof yt)a=new ur(r);else throw new Error("Unexpected content type")}new Qe(Ue(i,ut(s.store,i)),n,n&&n.lastId,null,null,e,t,a).integrate(o,0)},jc=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},qm=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},zm=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var a_=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Bn(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},Ri=o=>am(o.entries(),e=>!e[1].deleted),Pc=class extends qn{constructor(e,t){super(e,t),this._transaction=t}},Nr=class extends yt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new Nr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Nr}clone(){let e=new Nr;return e.insert(0,this.toArray().map(t=>t instanceof yt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Xi(this,e,new Pc(this,e))}insert(e,t){this.doc!==null?ze(this.doc,r=>{Hm(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?ze(this.doc,t=>{i_(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?ze(this.doc,r=>{Vm(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Bm(this,e)}toArray(){return Om(this)}slice(e=0,t=this.length){return $m(this,e,t)}toJSON(){return this.map(e=>e instanceof yt?e.toJSON():e)}map(e){return Um(this,e)}forEach(e){zs(this,e)}[Symbol.iterator](){return s_(this)}_write(e){e.writeTypeRef(T_)}},l_=o=>new Nr,Fc=class extends qn{constructor(e,t,r){super(e,t),this.keysChanged=r}},eo=class extends yt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new eo}clone(){let e=new eo;return this.forEach((t,r)=>{e.set(r,t instanceof yt?t.clone():t)}),e}_callObserver(e,t){Xi(this,e,new Fc(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof yt?n.toJSON():n}}),e}get size(){return[...Ri(this._map)].length}keys(){return Mi(Ri(this._map),e=>e[0])}values(){return Mi(Ri(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Mi(Ri(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ze(this.doc,t=>{Gi(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?ze(this.doc,r=>{Wc(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return jc(this,e)}has(e){return zm(this,e)}clear(){this.doc!==null?ze(this.doc,e=>{this.forEach(function(t,r,n){Gi(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(A_)}},c_=o=>new eo,Co=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&cc(o,e),Ws=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&cr(),this.right.content.constructor){case at:this.right.deleted||Kn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},xm=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case at:e.right.deleted||Kn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&Po(o,Ue(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},$i=(o,e,t,r)=>{let n=new Map,s=r?Yi(e,t):null;if(s){let i=new Ws(s.p.left,s.p,s.index,n);return xm(o,i,t-s.index)}else{let i=new Ws(null,e._start,0,n);return xm(o,i,t)}},Wm=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===at&&Co(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((i,a)=>{let l=t.left,c=t.right,f=new Qe(Ue(s,ut(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new at(a,i));f.integrate(o,0),t.right=f,t.forward()})},Kn=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},jm=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===at&&Co((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Km=(o,e,t,r)=>{var a;let n=o.doc,s=n.clientID,i=new Map;for(let l in r){let c=r[l],f=(a=t.currentAttributes.get(l))!=null?a:null;if(!Co(f,c)){i.set(l,f);let{left:u,right:d}=t;t.right=new Qe(Ue(s,ut(n.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new at(l,c)),t.right.integrate(o,0),t.forward()}}return i},vc=(o,e,t,r,n)=>{t.currentAttributes.forEach((d,m)=>{n[m]===void 0&&(n[m]=null)});let s=o.doc,i=s.clientID;jm(t,n);let a=Km(o,e,t,n),l=r.constructor===String?new fr(r):r instanceof yt?new ur(r):new ro(r),{left:c,right:f,index:u}=t;e._searchMarker&&qs(e._searchMarker,t.index,l.getLength()),f=new Qe(Ue(i,ut(s.store,i)),c,c&&c.lastId,f,f&&f.id,e,null,l),f.integrate(o,0),t.right=f,t.index=u,t.forward(),Wm(o,e,t,a)},bm=(o,e,t,r,n)=>{let s=o.doc,i=s.clientID;jm(t,n);let a=Km(o,e,t,n);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===at));){if(!t.right.deleted)switch(t.right.content.constructor){case at:{let{key:l,value:c}=t.right.content,f=n[l];if(f!==void 0){if(Co(f,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&Po(o,Ue(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new Qe(Ue(i,ut(s.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new fr(l)),t.right.integrate(o,0),t.forward()}Wm(o,e,t,a)},Gm=(o,e,t,r,n)=>{var c,f;let s=e,i=bt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===at){let u=s.content;i.set(u.key,u)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let u=e.content;switch(u.constructor){case at:{let{key:d,value:m}=u,p=(c=r.get(d))!=null?c:null;(i.get(d)!==u||p===m)&&(e.delete(o),a++,!l&&((f=n.get(d))!=null?f:null)===m&&p!==m&&(p===null?n.delete(d):n.set(d,p))),!l&&!e.deleted&&Kn(n,u);break}}}e=e.right}return a},f_=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===at){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},u_=o=>{let e=0;return ze(o.doc,t=>{let r=o._start,n=o._start,s=bt(),i=Si(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case at:Kn(i,n.content);break;default:e+=Gm(t,r,n,s,i),s=Si(i),r=n;break}n=n.right}}),e},d_=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&Fm(o,t.store.clients.get(r),s,n,i=>{!i.deleted&&i.content.constructor===at&&i.constructor!==zt&&e.add(i.parent)})}ze(t,r=>{_m(o,o.deleteSet,n=>{if(n instanceof zt||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===at?e.add(s):f_(r,n)});for(let n of e)u_(n)})},vm=(o,e,t)=>{let r=t,n=Si(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case ur:case ro:case fr:t<e.right.length&&Po(o,Ue(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&Gm(o,s,e.right,n,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&qs(i._searchMarker,e.index,-r+t),e},Ec=class extends qn{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];ze(e,r=>{var m,p,x;let n=new Map,s=new Map,i=this.target._start,a=null,l={},c="",f=0,u=0,d=()=>{if(a!==null){let g=null;switch(a){case"delete":u>0&&(g={delete:u}),u=0;break;case"insert":(typeof c=="object"||c.length>0)&&(g={insert:c},n.size>0&&(g.attributes={},n.forEach((_,C)=>{_!==null&&(g.attributes[C]=_)}))),c="";break;case"retain":f>0&&(g={retain:f},jp(l)||(g.attributes=zp({},l))),f=0;break}g&&t.push(g),a=null}};for(;i!==null;){switch(i.content.constructor){case ur:case ro:this.adds(i)?this.deletes(i)||(d(),a="insert",c=i.content.getContent()[0],d()):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),u+=1):i.deleted||(a!=="retain"&&(d(),a="retain"),f+=1);break;case fr:this.adds(i)?this.deletes(i)||(a!=="insert"&&(d(),a="insert"),c+=i.content.str):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),u+=i.length):i.deleted||(a!=="retain"&&(d(),a="retain"),f+=i.length);break;case at:{let{key:g,value:_}=i.content;if(this.adds(i)){if(!this.deletes(i)){let C=(m=n.get(g))!=null?m:null;Co(C,_)?_!==null&&i.delete(r):(a==="retain"&&d(),Co(_,(p=s.get(g))!=null?p:null)?delete l[g]:l[g]=_)}}else if(this.deletes(i)){s.set(g,_);let C=(x=n.get(g))!=null?x:null;Co(C,_)||(a==="retain"&&d(),l[g]=C)}else if(!i.deleted){s.set(g,_);let C=l[g];C!==void 0&&(Co(C,_)?C!==null&&i.delete(r):(a==="retain"&&d(),_===null?delete l[g]:l[g]=_))}i.deleted||(a==="insert"&&d(),Kn(n,i.content));break}}i=i.right}for(d();t.length>0;){let g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},Fo=class extends yt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Fo}clone(){let e=new Fo;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Ec(this,e,t);Xi(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===fr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?ze(this.doc,r=>{let n=new Ws(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let i=e[s];if(i.insert!==void 0){let a=!t&&typeof i.insert=="string"&&s===e.length-1&&n.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof a!="string"||a.length>0)&&vc(r,this,n,a,i.attributes||{})}else i.retain!==void 0?bm(r,this,n,i.retain,i.attributes||{}):i.delete!==void 0&&vm(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,i=this.doc,a="",l=this._start;function c(){if(a.length>0){let u={},d=!1;s.forEach((p,x)=>{d=!0,u[x]=p});let m={insert:a};d&&(m.attributes=u),n.push(m),a=""}}let f=()=>{for(;l!==null;){if(Bn(l,e)||t!==void 0&&Bn(l,t))switch(l.content.constructor){case fr:{let u=s.get("ychange");e!==void 0&&!Bn(l,e)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Bn(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):u!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case ur:case ro:{c();let u={insert:l.content.getContent()[0]};if(s.size>0){let d={};u.attributes=d,s.forEach((m,p)=>{d[p]=m})}n.push(u);break}case at:Bn(l,e)&&(c(),Kn(s,l.content));break}l=l.right}c()};return e||t?ze(i,u=>{e&&Cc(u,e),t&&Cc(u,t),f()},"cleanup"):f(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?ze(n,s=>{let i=$i(s,this,e,!r);r||(r={},i.currentAttributes.forEach((a,l)=>{r[l]=a})),vc(s,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?ze(n,s=>{let i=$i(s,this,e,!r);vc(s,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?ze(r,n=>{vm(n,$i(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?ze(n,s=>{let i=$i(s,this,e,!1);i.right!==null&&bm(s,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?ze(this.doc,t=>{Gi(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?ze(this.doc,r=>{Wc(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return jc(this,e)}getAttributes(){return qm(this)}_write(e){e.writeTypeRef(P_)}},p_=o=>new Fo,Us=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Eo||t.constructor===to)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},to=class extends yt{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new to}clone(){let e=new to;return e.insert(0,this.toArray().map(t=>t instanceof yt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Us(this,e)}querySelector(e){e=e.toUpperCase();let r=new Us(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),kr(new Us(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Xi(this,e,new Mc(this,t,e))}toString(){return Um(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),zs(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?ze(this.doc,r=>{Hm(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)ze(this.doc,r=>{let n=e&&e instanceof yt?e._item:e;Ki(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw lr("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?ze(this.doc,r=>{Vm(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Om(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Bm(this,e)}slice(e=0,t=this.length){return $m(this,e,t)}forEach(e){zs(this,e)}_write(e){e.writeTypeRef(E_)}},m_=o=>new to,Eo=class extends to{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new Eo(this.nodeName)}clone(){let e=new Eo(this.nodeName),t=this.getAttributes();return Wp(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof yt?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let a in e)r.push(a);r.sort();let n=r.length;for(let a=0;a<n;a++){let l=r[a];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?ze(this.doc,t=>{Gi(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?ze(this.doc,r=>{Wc(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return jc(this,e)}hasAttribute(e){return zm(this,e)}getAttributes(e){return e?a_(this,e):qm(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let i in s){let a=s[i];typeof a=="string"&&n.setAttribute(i,a)}return zs(this,i=>{n.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(F_),e.writeKey(this.nodeName)}},h_=o=>new Eo(o.readKey()),Mc=class extends qn{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},zn=class extends eo{constructor(e){super(),this.hookName=e}_copy(){return new zn(this.hookName)}clone(){let e=new zn(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(M_),e.writeKey(this.hookName)}},g_=o=>new zn(o.readKey()),Wn=class extends Fo{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Wn}clone(){let e=new Wn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let i in e.attributes[n])s.push({key:i,value:e.attributes[n][i]});s.sort((i,a)=>i.key<a.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let i=0;i<s.attrs.length;i++){let a=s.attrs[i];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(D_)}},y_=o=>new Wn,js=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Cr()}mergeWith(e){return!1}write(e,t,r){throw Cr()}integrate(e,t){throw Cr()}},x_=0,zt=class extends js{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Pm(e.doc.store,this)}write(e,t){e.writeInfo(x_),e.writeLen(this.length-t)}getMissing(e,t){return null}},nn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new nn(this.content)}splice(e){throw Cr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},b_=o=>new nn(o.readBuf()),sn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new sn(this.len)}splice(e){let t=new sn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Ni(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},v_=o=>new sn(o.readLen()),Jm=(o,e)=>new Zt({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),an=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new an(Jm(this.doc.guid,this.opts))}splice(e){throw Cr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},w_=o=>new an(Jm(o.readString(),o.readAny())),ro=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ro(this.embed)}splice(e){throw Cr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},__=o=>new ro(o.readJSON()),at=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new at(this.key,this.value)}splice(e){throw Cr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},S_=o=>new at(o.readKey(),o.readJSON()),jn=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new jn(this.arr)}splice(e){let t=new jn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},k_=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new jn(t)},oo=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new oo(this.arr)}splice(e){let t=new oo(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},I_=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new oo(t)},fr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new fr(this.str)}splice(e){let t=new fr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},C_=o=>new fr(o.readString()),L_=[l_,c_,p_,h_,m_,g_,y_],T_=0,A_=1,P_=2,F_=3,E_=4,M_=5,D_=6,ur=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ur(this.type._copy())}splice(e){throw Cr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},R_=o=>new ur(L_[o.readTypeRef()](o)),wm=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Ue(t.client,t.clock+r)),n=Oi(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof Qe);return{item:n,diff:r}};var Ji=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new Qe(Ue(r,n+t),e,Ue(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ue(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var Qe=class extends js{constructor(e,t,r,n,s,i,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=i,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ut(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ut(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Lo&&this.id.client!==this.parent.client&&this.parent.clock>=ut(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=mm(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Po(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===zt||this.right&&this.right.constructor===zt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Qe&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Qe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Lo){let r=Oi(t,this.parent);r.constructor===zt?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=mm(e,e.doc.store,Ue(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,i=new Set;for(;n!==null&&n!==this.right;){if(i.add(n),s.add(n),Nn(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(Nn(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&i.has(Oi(e.doc.store,n.origin)))s.has(Oi(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Pm(e.doc.store,this),this.content.integrate(e,this),gm(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new zt(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ue(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Nn(e.origin,this.lastId)&&this.right===e&&Nn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Ni(e.deleteSet,this.id.client,this.id.clock,this.length),gm(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw cr();this.content.gc(e),t?Kw(e,this,new zt(this.id,this.length)):this.content=new sn(this.length)}write(e,t){let r=t>0?Ue(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let a=this.parent;if(a._item!==void 0){let l=a._item;if(l===null){let c=Am(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Lo?(e.writeParentInfo(!1),e.writeLeftID(a)):cr();s!==null&&e.writeString(s)}this.content.write(e,t)}},Qm=(o,e)=>$_[e&31](o),$_=[()=>{cr()},v_,k_,b_,C_,__,S_,R_,I_,w_,()=>{cr()}],O_=10,Wt=class extends js{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){cr()}write(e,t){e.writeInfo(O_),Pe(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Ym=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Xm="__ $YJS$ __";Ym[Xm]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Ym[Xm]=!0;var fn=o=>Xr((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Zm=(o,e)=>Xr((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(lr(s.target.error)),n.onsuccess=s=>{let i=s.target.result;i.onversionchange=()=>{i.close()},t(i)}}),eh=o=>fn(indexedDB.deleteDatabase(o)),th=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),pr=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>H_(r,n))},no=(o,e)=>fn(o.count(e)),rh=(o,e)=>fn(o.get(e)),Kc=(o,e)=>fn(o.delete(e)),oh=(o,e,t)=>fn(o.put(e,t));var Zi=(o,e)=>fn(o.add(e)),nh=(o,e,t)=>fn(o.getAll(e,t));var U_=(o,e,t)=>{let r=null;return N_(o,e,n=>(r=n,!1),t).then(()=>r)},sh=(o,e=null)=>U_(o,e,"prev");var B_=(o,e)=>Xr((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var N_=(o,e,t,r="next")=>B_(o.openKeyCursor(e,r),n=>t(n.key)),H_=(o,e)=>o.objectStore(e);var ih=(o,e)=>IDBKeyRange.upperBound(o,e),ah=(o,e)=>IDBKeyRange.lowerBound(o,e);var Gc="custom",lh="updates",ch=500,fh=(o,e=()=>{},t=()=>{})=>{let[r]=pr(o.db,[lh]);return nh(r,ah(o._dbref,!1)).then(n=>{o._destroyed||(e(r),ze(o.doc,()=>{n.forEach(s=>dr(o.doc,s))},o,!1),t(r))}).then(()=>sh(r).then(n=>{o._dbref=n+1})).then(()=>no(r).then(n=>{o._dbsize=n})).then(()=>r)},V_=(o,e=!0)=>fh(o).then(t=>{(e||o._dbsize>=ch)&&Zi(t,ln(o.doc)).then(()=>Kc(t,ih(o._dbref,!0))).then(()=>no(t).then(r=>{o._dbsize=r}))});var Mo=class extends kn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Zm(e,r=>th(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Xr(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,fh(this,i=>Zi(i,ln(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=pr(this.db,[lh]);Zi(s,r),++this._dbsize>=ch&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{V_(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{eh(this.name)})}get(e){return this._db.then(t=>{let[r]=pr(t,[Gc],"readonly");return rh(r,e)})}set(e,t){return this._db.then(r=>{let[n]=pr(r,[Gc]);return oh(n,t,e)})}del(e){return this._db.then(t=>{let[r]=pr(t,[Gc]);return Kc(r,e)})}};var or=_n(ks());var uh=0,ta=1,dh=2,ra=(o,e)=>{Pe(o,uh);let t=Lm(e);wt(o,t)},Jc=(o,e,t)=>{Pe(o,ta),wt(o,ln(e,t))},q_=(o,e,t)=>Jc(e,t,kt(o)),ph=(o,e,t)=>{try{dr(e,kt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},mh=(o,e)=>{Pe(o,dh),wt(o,e)},z_=ph,hh=(o,e,t,r)=>{let n=Le(o);switch(n){case uh:q_(o,e,t);break;case ta:ph(o,t,r);break;case dh:z_(o,t,r);break;default:throw new Error("Unknown message type")}return n};var j_=0;var gh=(o,e,t)=>{switch(Le(o)){case j_:t(e,Lr(o))}};var Qc=3e4,oa=class extends kn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=tn();this.getLocalState()!==null&&Qc/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&Qc<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&na(this,r,"timeout")},qt(Qc/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:tn()});let i=[],a=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&i.push(t):(a.push(t),On(s,e)||l.push(t)),(i.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:i,updated:l,removed:c},"local"]),this.emit("update",[{added:i,updated:a,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},na=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let i=o.meta.get(s);o.meta.set(s,{clock:i.clock+1,lastUpdated:tn()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Gn=(o,e,t=o.states)=>{let r=e.length,n=Xo();Pe(n,r);for(let s=0;s<r;s++){let i=e[s],a=t.get(i)||null,l=o.meta.get(i).clock;Pe(n,i),Pe(n,l),Yr(n,JSON.stringify(a))}return Xt(n)};var yh=(o,e,t)=>{let r=Tr(e),n=tn(),s=[],i=[],a=[],l=[],c=Le(r);for(let f=0;f<c;f++){let u=Le(r),d=Le(r),m=JSON.parse(Lr(r)),p=o.meta.get(u),x=o.states.get(u),g=p===void 0?0:p.clock;(g<d||g===d&&m===null&&o.states.has(u))&&(m===null?u===o.clientID&&o.getLocalState()!=null?d++:o.states.delete(u):o.states.set(u,m),o.meta.set(u,{clock:d,lastUpdated:n}),p===void 0&&m!==null?s.push(u):p!==void 0&&m===null?l.push(u):m!==null&&(On(m,x)||a.push(u),i.push(u)))}(s.length>0||a.length>0||l.length>0)&&o.emit("change",[{added:s,updated:a,removed:l},t]),(s.length>0||i.length>0||l.length>0)&&o.emit("update",[{added:s,updated:i,removed:l},t])};var Qn=()=>new Map,_h=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Sh=()=>new Set,J_=Array.from,_P=Array.isArray,kh=String.fromCharCode,SP=String.fromCodePoint,kP=kh(65535),Q_=o=>o.toLowerCase(),Y_=/^\s*/g,X_=o=>o.replace(Y_,""),Z_=/([A-Z])/g,xh=(o,e)=>X_(o.replace(Z_,t=>`${e}${Q_(t)}`)),e1=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Ks=typeof TextEncoder!="undefined"?new TextEncoder:null,t1=o=>Ks.encode(o),r1=Ks?t1:e1,Yc=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Yc&&Yc.decode(new Uint8Array).length===1&&(Yc=null);var bh=o=>o===void 0?null:o,o1=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},Ih=new o1,of=!0;try{typeof localStorage!="undefined"&&(Ih=localStorage,of=!1)}catch(o){}var Ch=Ih,n1=o=>of||addEventListener("storage",o),s1=o=>of||removeEventListener("storage",o),i1=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},a1=(o,e)=>e.includes(o),Zn=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Lh=typeof window!="undefined"&&typeof document!="undefined"&&!Zn,IP=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Vr,l1=[],c1=()=>{if(Vr===void 0)if(Zn){Vr=Qn();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Vr.set(e,""),e=r):e!==null?(Vr.set(e,r),e=null):l1.push(r)}e!==null&&Vr.set(e,"")}else typeof location=="object"?(Vr=Qn(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Vr.set(`--${xh(e,"-")}`,t),Vr.set(`-${xh(e,"-")}`,t)}})):Vr=Qn();return Vr},Zc=o=>c1().has(o),ef=o=>bh(Zn?process.env[o.toUpperCase()]:Ch.getItem(o)),f1=o=>Zc("--"+o)||ef(o)!==null,CP=f1("production"),vh=Zn&&a1(process.env.FORCE_COLOR,["true","1","2"]),LP=!Zc("no-colors")&&(!Zn||process.stdout.isTTY||vh)&&(!Zn||Zc("color")||vh||ef("COLORTERM")!==null||(ef("TERM")||"").includes("color")),Th=Math.floor,Ah=(o,e)=>o<e?o:e,u1=(o,e)=>o>e?o:e,TP=Number.isNaN,d1=Math.pow,Ph=128,p1=1<<17,m1=1<<18,h1=1<<19,g1=1<<20,y1=1<<21,x1=1<<22,b1=1<<23,v1=1<<24,w1=1<<25,_1=1<<26,S1=1<<27,k1=1<<28,I1=1<<29,C1=1<<30,AP=1<<31,sa=127,PP=p1-1,FP=m1-1,EP=h1-1,MP=g1-1,DP=y1-1,RP=x1-1,$P=b1-1,OP=v1-1,UP=w1-1,BP=_1-1,NP=S1-1,HP=k1-1,VP=I1-1,qP=C1-1,L1=Number.MAX_SAFE_INTEGER,zP=Number.MIN_SAFE_INTEGER,WP=1<<31,jP=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Th(o)===o),KP=Number.isNaN,GP=Number.parseInt,T1=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Ar=()=>new T1,nf=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},mr=o=>{let e=new Uint8Array(nf(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(Mh(o.cbuf.buffer,0,o.cpos),t),e},ia=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Pt=(o,e)=>{for(;e>sa;)ia(o,Ph|sa&e),e=Th(e/128);ia(o,sa&e)},tf=new Uint8Array(3e4),A1=tf.length/3,P1=(o,e)=>{if(e.length<A1){let t=Ks.encodeInto(e,tf).written||0;Pt(o,t);for(let r=0;r<t;r++)ia(o,tf[r])}else Yn(o,r1(e))},F1=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Pt(o,r);for(let n=0;n<r;n++)ia(o,t.codePointAt(n))},JP=Ks&&Ks.encodeInto?P1:F1,E1=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=Ah(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(u1(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},Yn=(o,e)=>{Pt(o,e.byteLength),E1(o,e)},QP=new DataView(new ArrayBuffer(4)),Fh=o=>new Error(o),M1=Fh("Unexpected end of array"),D1=Fh("Integer out of Range"),R1=class{constructor(o){this.arr=o,this.pos=0}},$1=o=>new R1(o),O1=(o,e)=>{let t=Mh(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},U1=o=>O1(o,Eh(o)),Eh=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&sa)*t,t*=128,n<Ph)return e;if(e>L1)throw D1}throw M1},B1=o=>new Uint8Array(o),Mh=(o,e,t)=>new Uint8Array(o,e,t),N1=o=>new Uint8Array(o),H1=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=kh(o[t]);return btoa(e)},V1=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),q1=o=>{let e=atob(o),t=B1(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},z1=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},W1=Lh?H1:V1,j1=Lh?q1:z1,Dh=new Map,K1=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:j1(e.newValue||"")}),n1(this._onChange)}postMessage(o){Ch.setItem(this.room,W1(N1(o)))}close(){s1(this._onChange)}},G1=typeof BroadcastChannel=="undefined"?K1:BroadcastChannel,sf=o=>_h(Dh,o,()=>{let e=Sh(),t=new G1(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),J1=(o,e)=>(sf(o).subs.add(e),e),Q1=(o,e)=>{let t=sf(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),Dh.delete(o)),r},Jn=(o,e,t=null)=>{let r=sf(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},rf=Date.now,Y1=class{constructor(){this._observers=Qn()}on(o,e){_h(this._observers,o,Sh).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return J_((this._observers.get(o)||Qn()).values()).forEach(t=>t(...e))}destroy(){this._observers=Qn()}},X1=o=>i1(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),un=0,Rh=3,Xn=1,Z1=2,Gs=[];Gs[un]=(o,e,t,r,n)=>{Pt(o,un);let s=hh(e,o,t.doc,t);r&&s===ta&&!t.synced&&(t.synced=!0)};Gs[Rh]=(o,e,t,r,n)=>{Pt(o,Xn),Yn(o,Gn(t.awareness,Array.from(t.awareness.getStates().keys())))};Gs[Xn]=(o,e,t,r,n)=>{yh(t.awareness,U1(e),t)};Gs[Z1]=(o,e,t,r,n)=>{gh(e,t.doc,(s,i)=>eS(t,i))};var wh=3e4,eS=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),$h=(o,e,t)=>{let r=$1(e),n=Ar(),s=Eh(r),i=o.messageHandlers[s];return i?i(n,r,o,t,s):console.error("Unable to compute message"),n},Oh=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=rf();let r=$h(o,new Uint8Array(t.data),!0);nf(r)>1&&e.send(mr(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,na(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Oh,Ah(d1(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=rf(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Ar();if(Pt(t,un),ra(t,o.doc),e.send(mr(t)),o.awareness.getLocalState()!==null){let r=Ar();Pt(r,Xn),Yn(r,Gn(o.awareness,[o.doc.clientID])),e.send(mr(r))}},o.emit("status",[{status:"connecting"}])}},Xc=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Jn(o.bcChannel,e,o)},Uh=class extends Y1{constructor(o,e,t,{connect:r=!0,awareness:n=new oa(t),params:s={},WebSocketPolyfill:i=WebSocket,resyncInterval:a=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let f=X1(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(f.length===0?"":"?"+f),this.roomname=e,this.doc=t,this._WS=i,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Gs.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,a>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let u=Ar();Pt(u,un),ra(u,t),this.ws.send(mr(u))}},a)),this._bcSubscriber=(u,d)=>{if(d!==this){let m=$h(this,new Uint8Array(u),!1);nf(m)>1&&Jn(this.bcChannel,mr(m),this)}},this._updateHandler=(u,d)=>{if(d!==this){let m=Ar();Pt(m,un),mh(m,u),Xc(this,mr(m))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:u,updated:d,removed:m},p)=>{let x=u.concat(d).concat(m),g=Ar();Pt(g,Xn),Yn(g,Gn(n,x)),Xc(this,mr(g))},this._unloadHandler=()=>{na(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var u;this.wsconnected&&wh<rf()-this.wsLastMessageReceived&&((u=this.ws)==null||u.close())},wh/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(J1(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Ar();Pt(o,un),ra(o,this.doc),Jn(this.bcChannel,mr(o),this);let e=Ar();Pt(e,un),Jc(e,this.doc),Jn(this.bcChannel,mr(e),this);let t=Ar();Pt(t,Rh),Jn(this.bcChannel,mr(t),this);let r=Ar();Pt(r,Xn),Yn(r,Gn(this.awareness,[this.doc.clientID])),Jn(this.bcChannel,mr(r),this)}disconnectBc(){let o=Ar();Pt(o,Xn),Yn(o,Gn(this.awareness,[this.doc.clientID],new Map)),Xc(this,mr(o)),this.bcconnected&&(Q1(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Oh(this),this.connectBc())}};var _t=new WeakMap,Bh=!1;function la(o){Bh=o}var hr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3,allowStackTraces:!1},Ft,Et,aa=[];function Nh(o,e,t,r){Et=o,Ft=t,r&&(hr={...hr,...r}),e.setInterval(lf,hr.batchInterval)}async function lf(){if(aa.length===0)return;let o=[...aa];aa.length=0;for(let e=0;e<hr.maxRetries;e++)try{await tS();let t=o.map(af).join(`
`)+`
`;await Et.append(Ft,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===hr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function tS(){let o=await Et.stat(Ft);if(o&&o.size>hr.maxFileSize){for(let e=hr.maxBackups;e>0;e--){let t=`${Ft}.${e}`,r=`${Ft}.${e+1}`;await Et.exists(t)&&(e===hr.maxBackups?await Et.remove(t):await Et.rename(t,r))}await Et.exists(Ft)&&await Et.rename(Ft,`${Ft}.1`),await Et.write(Ft,"")}}function af(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}var rS=["token","authorization","email","key"];function oS(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&rS.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Se(o,e="log"){return(...t)=>{if(Bh){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",i=t.map(oS).join(" "),a={timestamp:r,level:e,message:`${o}: ${i}`,callerInfo:s};if(!hr.disableConsole)if(hr.allowStackTraces||e==="debug"||e==="log")console[e](af(a));else{let l={warn:"color: #ff8c00; background: rgba(255, 140, 0, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;",error:"color: #ff5555; background: rgba(255, 85, 85, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;"};console.log(`%c${af(a)}`,l[e])}aa.push(a)}}}async function ca(){let o=[];await Et.exists(Ft)&&o.push(Ft);for(let e=1;e<=hr.maxBackups;e++){let t=`${Ft}.${e}`;await Et.exists(t)&&o.push(t)}return o}async function Hh(){let o=[];if(await Et.exists(Ft)){let e=await Et.read(Ft);o.push(e)}for(let e=1;e<=hr.maxBackups;e++){let t=`${Ft}.${e}`;if(await Et.exists(t)){let r=await Et.read(t);o.push(r)}}return o.reverse().join(`
`)}var dt=class{constructor(e){let t=e||this.constructor.name;this.debug=Se(`[${t}]`,"debug"),this.log=Se(`[${t}]`,"log"),this.warn=Se(`[${t}]`,"warn"),this.error=Se(`[${t}]`,"error")}setLoggers(e){this.debug=Se(`[${e}]`,"debug"),this.log=Se(`[${e}]`,"log"),this.warn=Se(`[${e}]`,"warn"),this.error=Se(`[${e}]`,"error")}};var cf=class{constructor(){this.platform="s3rn";this.product="relay"}},ff=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},so=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},gr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},Mt=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},io=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},uf=class{constructor(e,t,r,n,s,i){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=n;this.contentType=s;this.contentLength=i;this.platform="s3rn";this.product="relay"}},yr=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},ao=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},dn=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},Js=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},Ye=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,i,a,l,c,f,u,d,m,p,x]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(a&&!this.validateUUID(a))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&i==="folder"&&l==="doc")return new gr(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="canvas")return new Mt(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file"&&f==="hash"&&d==="contentType"&&p==="contentLength")return new uf(s,a,c,u,m,x);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file")return new io(s,a,c);if(r==="relay"&&n==="relay"&&i=="folder")return new so(s,a);if(r==="relay"&&n==="folder"&&i==="document")return new ao(s,a);if(r==="relay"&&n==="folder"&&i==="canvas")return new dn(s,a);if(r==="relay"&&n==="folder")return new yr(s);if(r==="relay"&&n==="relay")return new ff(s);if(n===void 0)return new cf;throw new Error("Invalid s3rn format for the given product type")}};function nS(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Vh(o){let e=JSON.stringify(o),t=nS(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Qs={enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableAttachmentSync:!0,enableNetworkLogging:!1,enableCanvasSync:!1,enableVerifyUploads:!1,enableAutomaticDiffResolution:!1,enableDiscordLogin:!1,enableMicrosoftLogin:!1,enableSelfManageHosts:!1};function fa(o){return o in Qs}function sS(){return new Proxy({},{get:(o,e)=>e})}var lo=sS();var es=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var It=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return It.instance||(It.instance=new It(new es),_t.set(this.instance,"postie")),It.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Se("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Se("[postie]","warn")(`All Mail Log:
`+this.prettyPrintMailLog(this.allMailLog))}prettyPrintDeliveredMailLog(){Se("[postie]","warn")(`Delivered Mail Log:
`+this.prettyPrintMailLog(this.deliveredMailLog))}prettyPrintMailLog(e){let t="",r=n=>{t+=`${n}
`};return e.forEach((n,s)=>{r(`Mail #${s+1}:`),r(`  Timestamp: ${new Date(n.timestamp).toISOString()}`),r(`  Transaction ID: ${n.transactionId}`),r(`  Sender: ${n.sender.observableName||n.sender.constructor.name}`),r(`  Recipient: ${n.recipient.name||"Anonymous function"}`),r(`  Recipient Origin: ${n.recipientOrigin||"Unknown"}`),r("---")}),t}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){It.instance&&(It.instance.mailboxes=null,It.instance.allMailLog=[],It.instance.deliveredMailLog=[],It.instance.timeProvider.destroy(),It.instance.timeProvider=null,It.instance.isDelivering=!1,It.instance.isInTransaction=!1,It.instance.currentTransactionId=0,It._destroyed=!0,It.instance=void 0)}},xr=It;xr._destroyed=!1;var df=new Map;function qh(){for(let[,o]of df)o();df.clear()}var Ge=class extends dt{constructor(t){super();this.observableName=t;this.destroyed=!1;df.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)xr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),xr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Fe(){return{...pt.getInstance().flags}}function Do(o,e,t=()=>{}){pt.getInstance().flags[o]?e():t()}function zh(o,e,t=()=>{}){o.forEach(r=>{if(pt.getInstance().flags[r]){e();return}}),t()}var pt=class extends Ge{constructor(){super();this.flags=Qs}async applyServerFlags(t){if(!this.settings)return;let n=t.filter(s=>s.override).reduce((s,i)=>(s[i.name]=i.value,s),{});this.log("applying server flags",n),await this.settings.update(s=>({...s,...n}),!0)}static getInstance(){return pt.instance||(pt.instance=new pt),pt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(n=>({...n,[t]:r}))}static destroy(){pt.instance=null}};var iS={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Wh(o,e,t){let r={token:o.token},n=new Uh(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,id:t.id,color:t.color.color,colorLight:t.color.light}),n}var co=class extends dt{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let i=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new Zt,Fe().enableDocumentHistory&&(this.ydoc.gc=!1),i&&new qi(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,i.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(Ye.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Wh(this.clientToken,this.ydoc,i);let a=this.providerConnectionErrorSubscription(f=>{this.log(`[${this.path}] disconnection event`,f);let u=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),u&&this.connect()});a.on(),this._offConnectionError=a.off;let l=this.providerStateSubscription(f=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Vh(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(Ye.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var i;this.clientToken=t;let r=new Zt,n=Wh(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let a=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${a}`),(i=this._provider.ws)==null||i.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:iS[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.ws&&(this._provider.ws.onopen=null,this._provider.ws.onmessage=null,this._provider.ws.onerror=null,this._provider.ws.onclose=null,(this._provider.ws.readyState===WebSocket.OPEN||this._provider.ws.readyState===WebSocket.CONNECTING)&&this._provider.ws.close(1e3,"Destroyed"),this._provider.ws=null),this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var fo=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},ua=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(i){s(i)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r(a.result?a.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r()}catch(s){n(s)}})}};var Pr=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{Se("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[i,a]=this.checkFunction();i&&r(a)},3e3),this.promiseFunction().then(i=>{this.timeoutId&&clearTimeout(this.timeoutId),n(i)},i=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(i)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},da=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Se("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function jh(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{Se("[Promise]","debug")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var aS={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function Ro(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return aS[e]||"application/octet-stream"}var Kh=_n(pf());function rs(o,e,t){let r=o.getText("contents"),n=r.toString(),s=new Kh.diff_match_patch,i=s.diff_main(n,e);s.diff_cleanupSemantic(i);let a=0,l=Fe().enableDeltaLogging?Se("[diffMatchPatch]","debug"):(...c)=>{};l("Updating YDoc:"),l("Current content length:",n.length),l("Disk buffer length:",e.length),i.length!=0&&(o.transact(()=>{for(let[c,f]of i){switch(c){case 1:l(`Inserting "${f}" at position ${a}`),r.insert(a,f),a+=f.length;break;case 0:l(`Keeping "${f}" (length: ${f.length})`),a+=f.length;break;case-1:l(`Deleting "${f}" at position ${a}`),r.delete(a,f.length);break}l("intermediate",r.toString())}},t),l("result",r.toString()),l("Update complete. New content length:",r.toString().length))}function er(o){return o instanceof mt}var mt=class extends co{constructor(t,r,n,s){let i=s.relayId?new gr(s.relayId,s.guid,r):new ao(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this.pendingOps=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Mo(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{let a=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(a),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(a)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Ye.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),Do(lo.enableDeltaLogging,()=>{let a=l=>{var f,u;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(u=(f=l.transaction.origin)==null?void 0:f.constructor)==null?void 0:u.name}
`;for(let d of l.changes.delta)c+=`insert: ${d.insert}

retain: ${d.retain}

delete: ${d.delete}
`;this.debug(c)};this.ytext.observe(a),this.unsubscribes.push(()=>{this.ytext.unobserve(a)})}),this._tfile=null}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}async process(t){this.tfile&&Fe().enableAutomaticDiffResolution&&this.pendingOps.push(t)}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new fo(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=await this.sharedFolder.backgroundSync.downloadItem(this),s=new Uint8Array(n.arrayBuffer);dr(this.ydoc,s);let i=this.text!==r,a=this.text,l=a,c=[];for(let f of this.pendingOps)if(l=f(l),c.push(f),l==r){if(this.clearDiskBuffer(),a==this.text)rs(this.ydoc,l,this);else return Fe().enableDeltaLogging?this.warn("diffMatchPatch solution is stale an cannot be applied",l,this.text):this.log("diffMatchPatch solution is stale an cannot be applied"),!0;return this.pendingOps=[],!0}return this.pendingOps=[],i||this.clearDiskBuffer(),i}async connect(){return this.sharedFolder.s3rn instanceof yr?!1:(this.s3rn instanceof ao&&(this.sharedFolder.relayId?this.s3rn=new gr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new ao(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Pr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Pr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Ro(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=pr(this._persistence.db,["updates"],"readonly"),r=await no(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var $o=class extends Ge{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var uo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var mf=require("obsidian");function hf(o){return o instanceof Oo}var Oo=class extends dt{constructor(t,r,n){super();this.path=t;this.guid=r;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let s=()=>{let i=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));return i instanceof mf.TFolder?(this._tfolder=i,this.ready=!0,!0):!1};s()||(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0}).catch(()=>{s()})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r){return console.log("virtualpath for new syncfolder",t.getVirtualPath(r.path)),new Oo(t.getVirtualPath(r.path),$n(),t)}disconnect(){this.connected=!1}move(t,r){t!==this.path&&(this._parent=r,this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof mf.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this._tfolder=null}};var qr=_n(ks());var pa,lS=new Uint8Array(16);function gf(){if(!pa&&(pa=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!pa))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pa(lS)}var Ct=[];for(let o=0;o<256;++o)Ct.push((o+256).toString(16).slice(1));function Gh(o,e=0){return Ct[o[e+0]]+Ct[o[e+1]]+Ct[o[e+2]]+Ct[o[e+3]]+"-"+Ct[o[e+4]]+Ct[o[e+5]]+"-"+Ct[o[e+6]]+Ct[o[e+7]]+"-"+Ct[o[e+8]]+Ct[o[e+9]]+"-"+Ct[o[e+10]]+Ct[o[e+11]]+Ct[o[e+12]]+Ct[o[e+13]]+Ct[o[e+14]]+Ct[o[e+15]]}var cS=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),yf={randomUUID:cS};function fS(o,e,t){if(yf.randomUUID&&!e&&!o)return yf.randomUUID();o=o||{};let r=o.random||(o.rng||gf)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return Gh(r)}var os=fS;var uS={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function ma(o){return(o==null?void 0:o.type)==="markdown"}function Jh(o){return(o==null?void 0:o.type)==="folder"}function Xs(o){return{version:0,id:o,type:"markdown"}}function Qh(o){return{version:0,id:o,type:"canvas"}}function ha(o){return{version:0,id:o,type:"folder"}}function Yh(o,e,t,r,n){return n||(n=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:n,hash:r}}var xf=class extends Ge{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||xf.defaults,r.forEach(([n,s])=>this.protocols.set(n,s)),this.unsubscribes.push(t.subscribe(n=>{this.updateFromSettings(n)}))}setEnabled(t,r){let n=this.protocols.get(t);n&&this.protocols.set(t,{...n,enabled:r})}canSync(t,r){var i,a;if(t.endsWith(".md")||Fe().enableCanvasSync&&t.endsWith(".canvas")||!((i=t.split("/").pop())==null?void 0:i.includes(".")))return!0;if(!Fe().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let s=this.getTypeForPath(t);return!!((a=this.protocols.get(s))!=null&&a.enabled)}updateFromSettings(t){Object.entries(uS).forEach(([r,n])=>{this.setEnabled(n,t[r])})}getEnabledFileSyncTypes(){if(!Fe().enableAttachmentSync)return["markdown","canvas"];let t=[];return this.protocols.forEach((r,n)=>{r!=null&&r.enabled&&n!=="folder"&&t.push(n)}),t}getTypeForPath(t){let r=Ro(t);for(let[n,s]of this.protocols)if(s.mimetypes.includes(r))return!Fe().enableCanvasSync&&n==="canvas"?"file":n;return"file"}},Ys=xf;Ys.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var ga=class extends Ge{constructor(t,r,n,s){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.syncSettingsManager=s;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new Ys(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+qr.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let i=this.meta.get(t);Jh(i)?this.moveFolder(t,r):i&&(this.set(r,i),this.delete(t))}new(t){this.assertVPath(t);let r=os();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}willSet(t,r){if(this.assertVPath(t),ma(r)&&this.legacyIds.get(t)!==r.id)return this.log("legacy vpath set to a different ID",this.legacyIds.get(t),r.id),!0;let n=this.meta.get(t);return n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash?!1:(this.log("new meta diff",n,r),!0)}set(t,r){this.assertVPath(t),ma(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let n=this.meta.get(t);n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,n,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,i)=>{if(s.action==="delete"){let a=s.oldValue;(a==null?void 0:a.type)==="folder"&&r.set(a.id,i)}else if(s.action==="add"||s.action==="update"){let a=this.meta.get(i);(a==null?void 0:a.type)==="folder"&&n.set(a.id,i)}}),r.forEach((s,i)=>{let a=n.get(i);if(a&&s!==a){this.log(`Detected folder move from ${s} to ${a}`);let l=new Map;this.meta.forEach((c,f)=>{f.startsWith(a+qr.sep)&&l.set(f,c)}),this.renames.set(s,a),this.log("setting alias",s,a),this.log("paths to move",l),l.forEach((c,f)=>{let u=f.slice(a.length),d=s+u;this.renames.set(d,f),this.log("setting alias",d,f)})}})}start(){Do(lo.enableDeltaLogging,()=>{let n=s=>{var a,l;let i="";i+=`Transaction origin: ${s.transaction.origin}${(l=(a=s.transaction.origin)==null?void 0:a.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((c,f)=>{c.action==="add"&&(i+=`Added ${f}: ${this.get(f)}
`),c.action==="update"&&(i+=`Updated ${f}: ${this.get(f)}
`),c.action==="delete"&&(i+=`Deleted ${f}
`)}),this.debug(i)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),i=Xs(s);return this.overlay.set(t,i),i}if(r){if(ma(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,i)=>{let a;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===s&&c!==i&&(a=c)}),a){let l=(0,qr.dirname)(a),c=(0,qr.dirname)(i);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([s],[i])=>i.length-s.length).forEach(([s,i])=>{r.has(s)||(this.moveFolder(s,i),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((i,a)=>{(a===t||a.startsWith(t+qr.sep))&&n.set(a,i)}),this.overlay.forEach((i,a)=>{(a===t||a.startsWith(t+qr.sep))&&n.set(a,i)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((i,a)=>{if(a===t)return;let l=a.slice(t.length),c=r+l;this.move(a,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var a;if(this.assertVPath(r),((a=this.meta.get(r))==null?void 0:a.id)===t)return;let n=new Set,s=r.split(qr.sep),i="";for(let l=0;l<s.length-1;l++)i=s.slice(0,l+1).join(qr.sep),n.add(i);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,Xs(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=os();console.log("creating folder path",l,c),this.overlay.set(l,ha(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function Xh(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...i){return i.length>0&&typeof i[0]=="string"&&(i[0]=t(i[0],e)),s.apply(r,i)}:s}})}var sg=require("obsidian"),ig=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkfetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(ig.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=ng()));var lt=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.5.11"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},i;if(i=await(0,sg.requestUrl)(s),!i.arrayBuffer.byteLength)return new Response(null,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});let a=new Response(i.arrayBuffer,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});if(Object.defineProperty(a,"json",{value:async()=>JSON.parse(i.text)}),Fe().enableNetworkLogging){let c=i.status>=500?"error":i.status>=400?"warn":"debug",f=i.text,u;if((i.headers["content-type"]||"").includes("application/json"))try{u=JSON.parse(f)}catch(m){}Se("[CustomFetch]",c)(i.status.toString(),r,t,u||f)}if(i.status>=500)throw new Error(i.text);return a};var Dt=class extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,Dt.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof Dt||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},ya=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function IS(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||CS,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let i=o.indexOf(";",n);if(i===-1)i=o.length;else if(i<s){n=o.lastIndexOf(";",s-1)+1;continue}let a=o.slice(n,s).trim();if(t[a]===void 0){let l=o.slice(s+1,i).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[a]=r(l)}catch(c){t[a]=l}}n=i+1}return t}function ag(o,e,t){let r=Object.assign({},t||{}),n=r.encode||LS;if(!ya.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!ya.test(s))throw new TypeError("argument val is invalid");let i=o+"="+s;if(r.maxAge!=null){let a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!ya.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!ya.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function CS(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function LS(o){return encodeURIComponent(o)}var fg;function xa(o){if(o)try{let e=decodeURIComponent(fg(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function ug(o,e=0){let t=xa(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}fg=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,i="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?i+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var lg="pb_auth",ei=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!ug(this.token)}get isAdmin(){return xa(this.token).type==="admin"}get isAuthRecord(){return xa(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=lg){let r=IS(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=lg){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=xa(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=ag(t,JSON.stringify(s),e),a=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(s.model&&a>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let f=["collectionId","username","verified"];for(let u in this.model)f.includes(u)&&(s.model[u]=this.model[u]);i=ag(t,JSON.stringify(s),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},vf=class extends ei{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},po=class{constructor(e){this.client=e}},wf=class extends po{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,s,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},ti=class extends po{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var s;return n.items=((s=n.items)==null?void 0:s.map(i=>this.decode(i)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new Dt({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new Dt({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then(i=>{let a=i.items;return r=r.concat(a),a.length==i.perPage?n(s+1):r});return n(1)}};function tr(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function bf(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var _f=class extends ti{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=tr("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let i=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||bf(this.client);let a=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return a=this.authResponse(a),i&&function(c,f,u,d){bf(c);let m=c.beforeSend,p=c.authStore.model,x=c.authStore.onChange((g,_)=>{(!g||(_==null?void 0:_.id)!=(p==null?void 0:p.id)||(_!=null&&_.collectionId||p!=null&&p.collectionId)&&(_==null?void 0:_.collectionId)!=(p==null?void 0:p.collectionId))&&bf(c)});c._resetAutoRefresh=function(){x(),c.beforeSend=m,delete c._resetAutoRefresh},c.beforeSend=async(g,_)=>{var P;let C=c.authStore.token;if((P=_.query)!=null&&P.autoRefresh)return m?m(g,_):{url:g,sendOptions:_};let L=c.authStore.isValid;if(L&&ug(c.authStore.token,f))try{await u()}catch($){L=!1}L||await d();let F=_.headers||{};for(let $ in F)if($.toLowerCase()=="authorization"&&C==F[$]&&c.authStore.token){F[$]=c.authStore.token;break}return _.headers=F,m?m(g,_):{url:g,sendOptions:_}}}(this.client,i,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s))),a}async authRefresh(e,t){let r={method:"POST"};return r=tr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=tr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=tr("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then(()=>!0)}},TS=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function dg(o){if(o){o.query=o.query||{};for(let e in o)TS.includes(e)||(o.query[e]=o[e],delete o[e])}}var ba=class extends po{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let n=e;if(r){dg(r);let a="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+a}let s=function(a){let l=a,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(f){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let i of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,i);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let i in n){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let a=!1;for(let l=this.subscriptions[i].length-1;l>=0;l--)this.subscriptions[i][l]===t&&(a=!0,delete this.subscriptions[i][l],this.subscriptions[i].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(i,t));a&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new Dt(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Sf=class extends ti{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i,a;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s,i;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=tr("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then(i=>this.authResponse(i))}async authWithOAuth2Code(e,t,r,n,s,i,a){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=tr("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,i,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new Dt(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new ba(this.client),i=null;function a(){i==null||i.close(),s.unsubscribe()}return t.urlCallback||(i=cg(void 0)),new Promise(async(l,c)=>{var f;try{await s.subscribe("@oauth2",async p=>{let x=s.clientId;try{if(!p.state||x!==p.state)throw new Error("State parameters don't match.");let g=Object.assign({},t);delete g.provider,delete g.scopes,delete g.createData,delete g.urlCallback;let _=await this.authWithOAuth2Code(r.name,p.code,r.codeVerifier,n,t.createData,g);l(_)}catch(g){c(new Dt(g))}a()});let u={state:s.clientId};(f=t.scopes)!=null&&f.length&&(u.scope=t.scopes.join(" "));let d=this._replaceQueryParams(r.authUrl+n,u);await(t.urlCallback||function(p){i?i.location.href=p:i=cg(p)})(d)}catch(u){a(),c(new Dt(u))}})}async authRefresh(e,t){let r={method:"POST"};return r=tr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=tr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=tr("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=tr("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=tr("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=tr("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=tr("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},i=n.split("&");for(let a of i){if(a=="")continue;let l=a.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete s[a]:s[a]=t[a]);n="";for(let a in s)s.hasOwnProperty(a)&&(n!=""&&(n+="&"),n+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(s[a].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function cg(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new Dt(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,i=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+i+",left="+s+",resizable,menubar=no")}var kf=class extends ti{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},If=class extends po{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new Dt({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Cf=class extends po{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Lf=class extends po{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+i}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Tf=class extends po{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},ns=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new vf,this.admins=new _f(this),this.collections=new kf(this),this.files=new Lf(this),this.logs=new If(this),this.settings=new wf(this),this.realtime=new ba(this),this.health=new Cf(this),this.backups=new Tf(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Sf(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let s={};try{s=await n.json()}catch(i){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new Dt({url:n.url,status:n.status,data:s});return s}).catch(n=>{throw new Dt(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),dg(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let i of s)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let i of n)t.push(s+"="+encodeURIComponent(i));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var va=class extends dt{constructor(t){super();this.sharedFolder=t;this.pb=new ns("https://auth.system3.md",t.loginManager.authStore),this.tokenStore=t.tokenStore}async verify(t){if(!t.meta)throw new Error("cannot head file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(Ye.encode(t.s3rn),r,t.mimetype,0);return(await lt(n.baseUrl,{method:"HEAD",headers:{Authorization:`Bearer ${n.token}`}})).status===200}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(Ye.encode(t.s3rn),r,t.mimetype,0),s=await lt(n.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(s.status===404)throw new Error(`[${this.sharedFolder.path}] File is missing: ${t.guid} ${t.meta.hash} ${t.meta.type}`);let a=(await s.json()).downloadUrl;return(await lt(a)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),n=await t.caf.hash();if(this.log("writeFile",n),!(r&&n))throw new Error("invalid caf");let s=await this.tokenStore.getFileToken(Ye.encode(t.s3rn),n,t.mimetype,r.byteLength),i=await lt(s.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${s.token}`}}),a=await i.json();if(i.status!==200)throw new Error(a.error);let l=a.uploadUrl;await lt(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null,this.sharedFolder=null}};var jt=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var wa=class extends Ge{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},Kt=class extends Ge{constructor(t,r){super(`NamespacedSettings[${r}]`);this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new jt("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new jt(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([a])=>s.test(a)).reduce((a,[l,c])=>(a[l]=c,a),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new jt("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([f,u])=>{l.test(f)&&(c[f]=u)}),c}let s={...r},i=s;this.path.forEach(l=>{i[l]=i[l]||{},i=i[l]});let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{a.test(l)&&(i[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new jt(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(a=>a),n=[],s=[],i=[];return r.forEach((a,l)=>{let c=a.match(/^\[(\w+)=(.+)\]$/),f=a.match(/^\((.+?)\)$/);if(c){let[,u,d]=c,m=l>0?s[l-1]:a.split("[")[0];i.push({type:"arrayMatch",key:u,value:d,level:l}),n.push(a),s.push(m)}else if(f){let[,u]=f;i.push({type:"wildcard",wildcardPattern:this.createPatternRegex(u),level:l}),n.push(a),s.push(a)}else n.push(a),s.push(a)}),[n,s,i]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>i.test(l)).reduce((l,[c,f])=>(l[c]=f,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let i=this.basePath[0];if(!Array.isArray(r[i]))return;let a=r[i].find(c=>c[s.key]===s.value);if(!a)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=a;for(let f of l){if(!c||typeof c!="object")return;c=c[f]}return c}return a}for(let i=0;i<this.basePath.length;i++){if(!r)return;r=r[this.basePath[i]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(u=>u[s.key]===s.value),f=this.basePath.slice(s.level+1);if(c>=0)if(f.length>0){let u=n[l][c];for(let m=0;m<f.length-1;m++){let p=f[m];u[p]=u[p]||{},u=u[p]}let d=f[f.length-1];u[d]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(f.length>0){let u={[s.key]:s.value},d=u;for(let p=0;p<f.length-1;p++){let x=f[p];d[x]={},d=d[x]}let m=f[f.length-1];d[m]=r,n[l].push(u)}else n[l].push({...r,[s.key]:s.value});return n}let i=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];i[c]=i[c]||{},i=i[c]}let a=this.basePath[this.basePath.length-1];return i[a]=r,n}getParent(){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new Kt(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new Kt(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,i=this.basePath.slice(0,-1);for(let l of i){if(!s[l])return r;s=s[l]}let a=this.basePath[this.basePath.length-1];return delete s[a],r})}subscribe(t){if(this.destroyed)throw new jt("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var Uo=class extends Kt{constructor(t,r,n=!0){super(t,r);this.enabled=n}isExtensionEnabled(t){var s,i;let n=(t.split(".").pop()||"").toLowerCase();if(n==="md"||Fe().enableCanvasSync&&n==="canvas")return!0;if(!this.enabled||!Fe().enableAttachmentSync)return!1;for(let[a,l]of Object.entries(Uo.schema)){let c=a;if(((s=this.get()[c])!=null?s:l.defaultEnabled)&&l.extensions.includes(n))return!0}return(i=this.get().otherTypes)!=null?i:Uo.schema.otherTypes.defaultEnabled}getCategory(t){var s;let r=Uo.schema[t];return{enabled:(s=this.get()[t])!=null?s:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(Uo.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(n=>({...n,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...Uo.defaultFlags}))}},Bo=Uo;Bo.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},Bo.defaultFlags=Object.fromEntries(Object.entries(Uo.schema).map(([t,r])=>[t,r.defaultEnabled]));var ri=require("obsidian");async function Af(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function br(o){return!!o&&o instanceof No}var _a=class extends dt{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let n=indexedDB.open(this.dbName,1);n.onupgradeneeded=s=>{let i=n.result;i.objectStoreNames.contains("files")||i.createObjectStore("files",{keyPath:"path"})},n.onsuccess=s=>{this.db=n.result,t()},n.onerror=s=>{this.error("Error opening ContentAddressedFile database:",n.error),r(n.error)}})}async saveHash(t,r,n){if(await this.ready,!!this.db)return new Promise((s,i)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:n});c.onsuccess=()=>s(),c.onerror=()=>{this.error("Error saving hash:",c.error),i(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readonly").objectStore("files").get(t);a.onsuccess=()=>{r(a.result||null)},a.onerror=()=>{this.error("Error retrieving hash:",a.error),n(a.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);a.onsuccess=()=>r(),a.onerror=()=>{this.error("Error removing hash:",a.error),n(a.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},Pf=class extends dt{constructor(t,r,n){super();this.vault=t;this.path=r;this.store=n;this.content=null;this._tfile=null;let s=this.vault.getAbstractFileByPath(r);s&&s instanceof ri.TFile&&(this._tfile=s)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof ri.TFile)this._tfile=t;else throw new Error(`missing tfile: ${this.path}`)}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await Af(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return r}async _hash(){let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await Af(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return n}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof ri.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();return t||(t=await this._hash(),t)}destroy(){this.vault=null,this._tfile=null}},No=class extends Ge{constructor(t,r,n,s){super();this.path=t;this.guid=r;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=s.relayId?new io(s.relayId,s.guid,r):new Js(s.guid,r),this._parent=s,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new Pf(this.vault,this.sharedFolder.getPath(t),this.hashStore),this.log("created")}get mimetype(){return Ro(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}get pending(){return!!this.sharedFolder.syncStore.pendingUpload.has(this.path)}get tag(){return this.inMeta?"":this.uploadError?this.uploadError:this.pending?"pending":"unknown"}move(t,r){t!==this.path&&(this._parent=r,this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}_refreshMeta(){let t=this.sharedFolder.syncStore.getMeta(this.path);return this.meta=t,t}async push(t=!1){if(this.log("push"),!this.sharedFolder.connected){this.log("skipping push -- folder is disconnected");return}if(!this.sharedFolder.syncStore.canSync(this.path)){this.log("skipping push -- filetype is disabled");return}let r=await this.caf.hash();if(this._refreshMeta(),!this.meta||r&&this.meta.hash!==r||t)try{await this.sharedFolder.cas.writeFile(this),await this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(n){let s="Failed to push file";try{s=n.toString()}catch(i){}this.uploadError=s.replace(/^Error:/,"").trim(),this.notifyListeners()}}async sync(){var t;if(this.log("sync"),this._refreshMeta(),this.caf.exists()){if(!this.meta){await this.push();return}}else{if(!this.meta)throw new Error("unexpected case");await this.pull();return}try{let r=await this.caf.hash();if(Fe().enableVerifyUploads)try{this.verifyUpload()||(this.warn("file in metadata, but not on the server!"),await this.push())}catch(n){}if(r!==this.meta.hash){if(this.stat.mtime>this.meta.synctime){await this.push();return}this.warn("synctime",this.meta.synctime,(t=this.meta)==null?void 0:t.synctime,this.stat.mtime),await this.pull();return}}catch(r){this.warn("unable to compute hash",r)}}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async verifyUpload(){if(this.log("verify upload"),this._refreshMeta(),!this.meta)throw new Error("cannot verify upload without meta");return this.sharedFolder.cas.verify(this)}async pull(){if(this.log("pull"),this._refreshMeta(),!this.meta)throw new Error("cannot pull without meta");if(!(this.caf.exists()&&await this.caf.hash()===this.meta.hash))try{let t=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),t),await this.caf.hash()}catch(t){this.log(t);return}}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof ri.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof yr?!1:(this.s3rn instanceof ao&&(this.sharedFolder.relayId?this.s3rn=new io(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Js(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.caf.destroy()}};function zr(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!zr(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function rr(o){return o instanceof Xe}var Xe=class extends co{constructor(t,r,n,s){let i=s.relayId?new Mt(s.relayId,s.guid,r):new dn(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new Mo(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Ye.encode(this.s3rn))}catch(a){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),n=t.getMap("nodes"),s=[],i=[];for(let[,a]of r.entries())s.push({...a});for(let[,a]of n.entries()){let l=t.getText(a.id);i.push({...a,text:l.toString()||a.text})}return{edges:s,nodes:i}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof yr?!1:(this.s3rn instanceof dn&&(this.sharedFolder.relayId?this.s3rn=new Mt(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new dn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=pr(this._persistence.db,["updates"],"readonly"),r=await no(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Pr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Pr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}static checkExtension(t){return t.endsWith(".canvas")&&Fe().enableCanvasSync}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&t.file===this.tfile)return await this.applyData(t.canvas.getData())}async applyData(t){let r=this.yedges,n=this.ynodes,s=new Set,i=new Map,a=new Set,l=new Map,c=new Set;t.nodes.forEach(f=>{s.add(f.id);let u=n.get(f.id);u?zr(u,f)||i.set(f.id,f):(i.set(f.id,f),f.type==="text"&&this.textNode(f))});for(let f of n.keys())s.has(f)||a.add(f);t.edges.forEach(f=>{s.add(f.id);let u=r.get(f.id);u&&zr(u,f)||l.set(f.id,f)});for(let f of r.keys())s.has(f)||c.add(f);(i.size>0||a.size>0||l.size>0||c.size>0)&&ze(this.ydoc,()=>{for(let f of i.values())this.ynodes.set(f.id,f);for(let f of a)this.ynodes.delete(f);for(let f of l.values())this.yedges.set(f.id,f);for(let f of c)this.yedges.delete(f)},this)}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return Ro(this.path)}get json(){let t=Xe.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};var Ff=class extends $o{constructor(){super(...arguments);this.notifyListeners=(0,We.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},Sa=class extends co{constructor(t,r,n,s,i,a,l,c,f,u,d,m,p=!0){var g;let x=m?new so(m,r):new yr(r);super(r,x,l,s);this.appId=t;this.hashStore=f;this.backgroundSync=u;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let i=this.getVirtualPath(s.path),a=n.contains(i);if(s instanceof We.TFolder){let l=this.getSyncFolder(i,!1);r.push(l)}else if(mt.checkExtension(i))if(a){let l=this.uploadDoc(i,!1);r.push(l)}else{let l=this.getDoc(i,!1);r.push(l)}else if(Xe.checkExtension(i))if(a){let l=this.uploadCanvas(i,!1);r.push(l)}else{let l=this.getCanvas(i,!1);r.push(l)}else if(this.syncStore.canSync(i))if(a){let l=this.uploadSyncFile(i,!1);r.push(l)}else{let l=this.syncFile(i,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=a,this.vault=i,this.files=new Map,this.fset=new Ff,this.pendingUpload=new uo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.pendingUpload.forEach((_,C)=>{this.existsSync(C)||(this.warn("deleting pending upload record because file is missing",C,_),this.pendingUpload.delete(C))}),this.relayManager=c,this.relayId=m,this.diskBufferStore=new ua,this._shouldConnect=(g=this.settings.connect)!=null?g:!0,this.authoritative=!p,this.syncSettingsManager=this._settings.getChild("sync",(_,C)=>new Bo(_,C)),this.syncStore=new ga(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(_=>{this.remote=_.find(C=>C.guid==this.guid)})),this.unsubscribes.push(this.relayManager.storageQuotas.subscribe(async _=>{let C=_.find(L=>{var F;return L.id===((F=this._remote)==null?void 0:F.relay.storageQuotaId)});C!==void 0&&this.storageQuota!==C.quota&&(this.storageQuota!==void 0&&C.quota!==void 0&&C.quota>this.storageQuota&&(this.debug("storage quota increase",this.storageQuota,C.quota),await this.netSync()),this.debug("storage quota update",this.storageQuota,C.quota),this.storageQuota=C.quota)})),this.proxy=Xh(this,this.path,_=>this.getVirtualPath(_));try{this._persistence=new Mo(this.guid,this.ydoc)}catch(_){throw this.warn("Unable to open persistence.",this.guid),console.error(_),_}s.loggedIn&&this.connect(),this.cas=new va(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",Ye.encode(this.s3rn))}catch(_){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),_t.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let n=[];this.fset.forEach(s=>{s instanceof co&&(s.connected&&n.push(s),s.reset())}),this.tokenStore.clear(s=>{var i;return!!(this.relayId&&((i=s.token)!=null&&i.docId.startsWith(this.relayId)))}),r&&(this.connect(),n.forEach(s=>{s.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof We.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path),n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n),i=this.syncSettingsManager.isExtensionEnabled(n);return r&&s&&i}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof We.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return We.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof so&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new so(this.relayId,this.guid):new yr(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(n=>{n.guid===this.relayId&&(this.server=n.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=pr(this._persistence.db,["updates"],"readonly"),r=await no(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Pr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new Pr(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof We.TFile){let i=(0,or.dirname)(r);this.existsSync(i)||(await this.mkdir(i),s==null||s.push(`creating directory ${i}`))}await this.fileManager.renameFile(n,(0,We.normalizePath)(this.getPath(r))).then(()=>{t.move(r,this)})}async _handleServerCreate(t,r,n){let s=(0,or.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),n==null||n.push(`creating directory ${s}`)),r.type==="markdown")return n==null||n.push(`created local .md file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(r.type==="canvas")return n==null||n.push(`created local .canvas file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(r.type==="folder")return n==null||n.push(`created local folder for remotely added folder ${t}`),this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return n==null||n.push(`created local file for remotely added file ${t}`),this.downloadSyncFile(t,!1);throw new Error(`${t}: Unexpected file type ${r.type} ${r.mimetype}`)}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let i=this.files.get(t),a=this.syncStore.getMeta(r);if(!a)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return i&&br(i)&&i.shouldPull(a)?{op:"update",path:r,promise:i.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(n.has(t)&&i){let c=this.getPath(i.path),f=this.vault.getAbstractFileByPath(c);if(f){let u=this._handleServerRename(i,r,f,s);return{op:"rename",path:r,from:c,to:r,promise:u}}}let l=this._handleServerCreate(r,a,s);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],i=n.filter(c=>c instanceof We.TFolder),a=n.filter(c=>c instanceof We.TFile),l=c=>{var g,_;let f=this.isSyncableTFile(c),u=this.checkPath(c.path),d=t.contains(c.path.slice(this.path.length)),m=this.pendingUpload.has(this.getVirtualPath(c.path)),p=this.getVirtualPath(c.path),x=((g=this._provider)==null?void 0:g.synced)&&((_=this._persistence)==null?void 0:_.synced);if(u&&f&&!d&&!m&&x){r.push(`deleted local file ${p} for remotely deleted doc`);let C=this.vault.adapter.trashLocal(c.path);s.push({op:"delete",path:p,promise:C})}};return a.forEach(l),i.forEach(l),s}syncByType(t,r,n,s){t.forEach((i,a)=>{this._assertNamespacing(a),s.contains(i.type)&&(this._assertNamespacing(a),n.push(this.applyRemoteState(i.id,a,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(f=>f.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let i=n.filter(f=>f.op==="create"),a=n.filter(f=>f.op==="rename"),l=n.map(f=>f.path);await Promise.all([...i,...a].map(f=>jh(f.promise,f)));let c=this.cleanupExtraLocalFiles(l,s);[...n,...c].every(f=>f.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...c])),(a.length>0||i.length>0||c.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new da(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,or.join)(this.path,t.path);return this.vault.adapter.read((0,We.normalizePath)(r))}existsSync(t){let r=(0,We.normalizePath)((0,or.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,or.join)(this.path,t.path);return this.vault.adapter.exists((0,We.normalizePath)(r))}flush(t,r){let n=(0,or.join)(this.path,t.path);return this.log("writing to ",(0,We.normalizePath)(n)),this.vault.adapter.write((0,We.normalizePath)(n),r)}getPath(t){return(0,or.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,or.join)(this.path,t);return this.vault.adapter.mkdir((0,We.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+or.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof We.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!er(s))throw new Error("unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof We.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!rr(s))throw new Error("unexpected ifile type");return s}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof We.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){let r=(n,s)=>{this.syncStore&&this.syncStore.willSet(n.path,s)&&(this.log("new meta",n.path,s),this.ydoc.transact(()=>{this.syncStore.markUploaded(n.path,s)},this))};if(er(t)){let n=Xs(t.guid);r(t,n);return}if(rr(t)){let n=Qh(t.guid);r(t,n);return}if(hf(t)){let n=ha(t.guid);r(t,n);return}if(br(t)){let n=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!n)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let i=Yh(n,t.guid,t.mimetype,s,t.stat.mtime);r(t,i);return}}getFile(t,r=!0){let n=this.getVirtualPath(t.path),s=this.syncStore.get(n);if(s){let i=this.files.get(s);if(i)return i}if(t instanceof We.TFolder)return this.getSyncFolder(n,r);if(t instanceof We.TFile){if(mt.checkExtension(n))return this.getDoc(n);if(Xe.checkExtension(n))return this.getCanvas(n);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}return null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.log("place hold new",s),this.syncStore.new(s),r.push(s))})},this),r}getOrCreateCanvas(t,r){let n=this.files.get(t)||new Xe(r,t,this.loginManager,this);if(!rr(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadCanvas(t,r=!0){if(!Xe.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateCanvas(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueCanvasDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadCanvas(t,r=!0){if(!Xe.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),i,a]);!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{s.applyJSON(c)}catch(d){throw console.warn(c),d}},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createCanvas(t,r){if(!Xe.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t);return(async()=>this.whenReady().then(async()=>{let i=await s.getServerSynced();s.stat.size===0&&!i?this.backgroundSync.enqueueCanvasDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!er(n))throw new Error("unexpected ifile type");return n}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!br(n))throw new Error("unexpected ifile type");return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new mt(r,t,this.loginManager,this);if(!er(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadDoc(t,r=!0){if(!mt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!mt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),i,a]),d=s.ydoc.getText("contents");!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{d.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!mt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var a;let i=await s.getServerSynced();((a=s.tfile)==null?void 0:a.stat.size)===0&&!i?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new Oo(r,t,this);if(!hf(n))throw new Error("unexpected ifile type");return n.move(r,this),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFile(t,r,n){let s=this.files.get(t)||new No(r,t,this.hashStore,this);if(!br(s))throw new Error("unexpected ifile type");return s.move(r,this),this.files.set(t,s),s}syncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called sync on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueSync(i),this.files.set(n,i),this.fset.add(i,r),i}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueDownload(i),this.files.set(n,i),this.fset.add(i,r),i}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof We.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.backgroundSync.enqueueSync(i),this.fset.add(i,r),i}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof We.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.syncStore.getMeta(t)?i.pull():(this.log("get syncfile missing meta"),i.push()),this.files.set(n,i),this.fset.add(i,r),i}uploadFile(t,r=!0){let n=this.getVirtualPath(t.path);if(t instanceof We.TFolder)return this.getSyncFolder(n,r);if(t instanceof We.TFile){if(mt.checkExtension(n))return this.uploadDoc(n,r);if(Xe.checkExtension(n))return this.uploadCanvas(n,r);if(this.syncStore.canSync(n))return this.uploadSyncFile(n,r)}throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let n=this.files.get(r);n&&(n.cleanup(),this.fset.delete(n)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",i="";try{s=this.getVirtualPath(n)}catch(a){this.log("Moving out of shared folder")}try{i=this.getVirtualPath(r)}catch(a){this.log("Moving in from outside of shared folder")}if(!(!s&&!i))if(i){let a=this.syncStore.get(i);if(!a)return;let l=this.files.get(a);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(i)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(a);else{if(!this.syncStore.get(i))return;let f=[];l instanceof Oo&&this.syncStore.forEach((u,d)=>{if(d.startsWith(i+or.sep)){let m=d.replace(i,s);f.push([u.id,d,m])}}),this.ydoc.transact(()=>{this.syncStore.move(i,s),l&&l.move(s,this),f.forEach(u=>{let[d,m,p]=u;this.syncStore.move(m,p);let x=this.files.get(d);x&&x.move(p,this)})},this),this.syncStore.resolveMove(i)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(t)}}destroy(){var t,r,n;this.destroyed=!0,this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},ka=class extends $o{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,We.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(i=>{let a=!1;this.items().forEach(l=>{let c=i.find(f=>f.guid==l.guid);l.remote!=c&&(a=!0),l.remote=c}),a&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let i=this.find(f=>f.path==t&&f.guid==r);if(i)return i;let a=this.find(f=>f.guid==r);if(a)throw new Error(`This folder is already mounted at ${a.path}.`);if(this.find(f=>f.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let i=this._new(t,r,n,s);return this.notifyListeners(),i}};var za=require("@codemirror/state"),ds=require("obsidian");function V(){}function te(o,e){for(let t in e)o[t]=e[t];return o}function pg(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function Ef(o){return o()}function Ca(){return Object.create(null)}function be(o){o.forEach(Ef)}function Ve(o){return typeof o=="function"}function z(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Ia;function Mf(o,e){return o===e?!0:(Ia||(Ia=document.createElement("a")),Ia.href=e,o===Ia.href)}function mg(o){return Object.keys(o).length===0}function Lt(o,...e){if(o==null){for(let r of e)r(void 0);return V}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function se(o,e,t){o.$$.on_destroy.push(Lt(e,t))}function ae(o,e,t,r){if(o){let n=hg(o,e,t,r);return o[0](n)}}function hg(o,e,t,r){return o[1]&&r?te(t.ctx.slice(),o[1](r(e))):t.ctx}function le(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],i=Math.max(e.dirty.length,n.length);for(let a=0;a<i;a+=1)s[a]=e.dirty[a]|n[a];return s}return e.dirty|n}return e.dirty}function ce(o,e,t,r,n,s){if(n){let i=hg(e,t,r,s);o.p(i,n)}}function fe(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function pe(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Df(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Rt(o){return o==null?"":o}function La(o,e,t){return o.set(t),e}function Ta(o){return o&&Ve(o.destroy)?o.destroy:V}var pn=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var ss=class{constructor(e){Ze(this,"_listeners","WeakMap"in pn?new WeakMap:void 0);Ze(this,"_observer");Ze(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)ss.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};ss.entries="WeakMap"in pn?new WeakMap:void 0;var gg=!1;function yg(){gg=!0}function xg(){gg=!1}function S(o,e){o.appendChild(e)}function we(o,e,t){let r=bg(o);if(!r.getElementById(e)){let n=k("style");n.id=e,n.textContent=t,FS(r,n)}}function bg(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function FS(o,e){return S(o.head||o,e),e.sheet}function v(o,e,t){o.insertBefore(e,t||null)}function b(o){o.parentNode&&o.parentNode.removeChild(o)}function qe(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function k(o){return document.createElement(o)}function Fr(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function N(o){return document.createTextNode(o)}function A(){return N(" ")}function ge(){return N("")}function j(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function vg(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function oi(o,e){for(let t in e)h(o,t,e[t])}function wg(o){return Array.from(o.childNodes)}function Z(o,e){e=""+e,o.data!==e&&(o.data=e)}function Gt(o,e){o.value=e==null?"":e}function ie(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Rf(o,e,t){for(let r=0;r<o.options.length;r+=1){let n=o.options[r];if(n.__value===e){n.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Be(o,e,t){o.classList.toggle(e,!!t)}function Aa(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Ho=class{constructor(e=!1){Ze(this,"is_svg",!1);Ze(this,"e");Ze(this,"n");Ze(this,"t");Ze(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Fr(t.nodeName):this.e=k(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)v(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(b)}};function _g(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function is(o,e){return new o(e)}var Vo;function nr(o){Vo=o}function ni(){if(!Vo)throw new Error("Function called outside component initialization");return Vo}function $t(o){ni().$$.on_mount.push(o)}function $f(o){ni().$$.on_destroy.push(o)}function ht(){let o=ni();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=Aa(e,t,{cancelable:r});return n.slice().forEach(i=>{i.call(o,s)}),!s.defaultPrevented}return!0}}function vr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var mn=[];var Jt=[],ls=[],Uf=[],OS=Promise.resolve(),Bf=!1;function Sg(){Bf||(Bf=!0,OS.then(ii))}function si(o){ls.push(o)}function kg(o){Uf.push(o)}var Of=new Set,as=0;function ii(){if(as!==0)return;let o=Vo;do{try{for(;as<mn.length;){let e=mn[as];as++,nr(e),US(e.$$)}}catch(e){throw mn.length=0,as=0,e}for(nr(null),mn.length=0,as=0;Jt.length;)Jt.pop()();for(let e=0;e<ls.length;e+=1){let t=ls[e];Of.has(t)||(Of.add(t),t())}ls.length=0}while(mn.length);for(;Uf.length;)Uf.pop()();Bf=!1,Of.clear(),nr(o)}function US(o){if(o.fragment!==null){o.update(),be(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(si)}}function Ig(o){let e=[],t=[];ls.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),ls=e}var Pa=new Set,hn;function oe(){hn={r:0,c:[],p:hn}}function ne(){hn.r||be(hn.c),hn=hn.p}function y(o,e){o&&o.i&&(Pa.delete(o),o.i(e))}function w(o,e,t,r){if(o&&o.o){if(Pa.has(o))return;Pa.add(o),hn.c.push(()=>{Pa.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function mo(o,e){let t=e.token={};function r(n,s,i,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;i!==void 0&&(l=l.slice(),l[i]=a);let c=n&&(e.current=n)(l),f=!1;e.block&&(e.blocks?e.blocks.forEach((u,d)=>{d!==s&&u&&(oe(),w(u,1,1,()=>{e.blocks[d]===u&&(e.blocks[d]=null)}),ne())}):e.block.d(1),c.c(),y(c,1),c.m(e.mount(),e.anchor),f=!0),e.block=c,e.blocks&&(e.blocks[s]=c),f&&ii()}if(pg(o)){let n=ni();if(o.then(s=>{nr(n),r(e.then,1,e.value,s),nr(null)},s=>{if(nr(n),r(e.catch,2,e.error,s),nr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function cs(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function _e(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Cg(o,e){w(o,1,1,()=>{e.delete(o.key)})}function Lg(o,e,t,r,n,s,i,a,l,c,f,u){let d=o.length,m=s.length,p=d,x={};for(;p--;)x[o[p].key]=p;let g=[],_=new Map,C=new Map,L=[];for(p=m;p--;){let I=u(n,s,p),T=t(I),O=i.get(T);O?r&&L.push(()=>O.p(I,e)):(O=c(T,I),O.c()),_.set(T,g[p]=O),T in x&&C.set(T,Math.abs(p-x[T]))}let F=new Set,P=new Set;function $(I){y(I,1),I.m(a,f),i.set(I.key,I),f=I.first,m--}for(;d&&m;){let I=g[m-1],T=o[d-1],O=I.key,G=T.key;I===T?(f=I.first,d--,m--):_.has(G)?!i.has(O)||F.has(O)?$(I):P.has(G)?d--:C.get(O)>C.get(G)?(P.add(O),$(I)):(F.add(G),d--):(l(T,i),d--)}for(;d--;){let I=o[d];_.has(I.key)||l(I,i)}for(;m;)$(g[m-1]);return be(L),g}function Te(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let i=o[s],a=e[s];if(a){for(let l in i)l in a||(r[l]=1);for(let l in a)n[l]||(t[l]=a[l],n[l]=1);o[s]=a}else for(let l in i)n[l]=1}for(let i in r)i in t||(t[i]=void 0);return t}function Ee(o){return typeof o=="object"&&o!==null?o:{}}var BS=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],NS=new Set([...BS]);function Tg(o,e,t){let r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function R(o){o&&o.c()}function M(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),si(()=>{let s=o.$$.on_mount.map(Ef).filter(Ve);o.$$.on_destroy?o.$$.on_destroy.push(...s):be(s),o.$$.on_mount=[]}),n.forEach(si)}function D(o,e){let t=o.$$;t.fragment!==null&&(Ig(t.after_update),be(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function VS(o,e){o.$$.dirty[0]===-1&&(mn.push(o),Sg(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function K(o,e,t,r,n,s,i=null,a=[-1]){let l=Vo;nr(o);let c=o.$$={fragment:null,ctx:[],props:s,update:V,not_equal:n,bound:Ca(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Ca(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let f=!1;if(c.ctx=t?t(o,e.props||{},(u,d,...m)=>{let p=m.length?m[0]:d;return c.ctx&&n(c.ctx[u],c.ctx[u]=p)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](p),f&&VS(o,u)),d}):[],c.update(),f=!0,be(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){yg();let u=wg(e.target);c.fragment&&c.fragment.l(u),u.forEach(b)}else c.fragment&&c.fragment.c();e.intro&&y(o.$$.fragment),M(o,e.target,e.anchor),xg(),ii()}nr(l)}var qS;typeof HTMLElement=="function"&&(qS=class extends HTMLElement{constructor(e,t,r){super();Ze(this,"$$ctor");Ze(this,"$$s");Ze(this,"$$c");Ze(this,"$$cn",!1);Ze(this,"$$d",{});Ze(this,"$$r",!1);Ze(this,"$$p_d",{});Ze(this,"$$l",{});Ze(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let i;return{c:function(){i=k("slot"),s!=="default"&&h(i,"name",s)},m:function(c,f){v(c,i,f)},d:function(c){c&&b(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=_g(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=Nf(i,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let i=Nf(s,this.$$d[s],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,i)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let i of this.$$l[s]){let a=this.$$c.$on(s,i);this.$$l_u.set(i,a)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Nf(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Nf(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var W=class{constructor(){Ze(this,"$$");Ze(this,"$$set")}$destroy(){D(this,1),this.$destroy=V}$on(e,t){if(!Ve(t))return V;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!mg(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Ag="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ag);var zS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Hf=zS;function Pg(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Vf(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=te(r,t[n]);return{c(){e=Fr(o[11]),oi(e,r)},m(n,s){v(n,e,s)},p(n,s){oi(e,r=Te(t,[s&32&&n[12]]))},d(n){n&&b(e)}}}function Fg(o){let e=o[11],t,r=o[11]&&Vf(o);return{c(){r&&r.c(),t=ge()},m(n,s){r&&r.m(n,s),v(n,t,s)},p(n,s){n[11]?e?z(e,n[11])?(r.d(1),r=Vf(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=Vf(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&b(t),r&&r.d(n)}}}function WS(o){let e,t,r,n,s,i=_e(o[5]),a=[];for(let d=0;d<i.length;d+=1)a[d]=Fg(Pg(o,i,d));let l=o[10].default,c=ae(l,o,o[9],null),f=[Hf,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],u={};for(let d=0;d<f.length;d+=1)u=te(u,f[d]);return{c(){e=Fr("svg");for(let d=0;d<a.length;d+=1)a[d].c();t=ge(),c&&c.c(),oi(e,u)},m(d,m){v(d,e,m);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(e,null);S(e,t),c&&c.m(e,null),s=!0},p(d,[m]){if(m&32){i=_e(d[5]);let p;for(p=0;p<i.length;p+=1){let x=Pg(d,i,p);a[p]?a[p].p(x,m):(a[p]=Fg(x),a[p].c(),a[p].m(e,t))}for(;p<a.length;p+=1)a[p].d(1);a.length=i.length}c&&c.p&&(!s||m&512)&&ce(c,l,d,d[9],s?le(l,d[9],m,null):fe(d[9]),null),oi(e,u=Te(f,[Hf,m&128&&d[7],(!s||m&4)&&{width:d[2]},(!s||m&4)&&{height:d[2]},(!s||m&2)&&{stroke:d[1]},(!s||m&28&&r!==(r=d[4]?Number(d[3])*24/Number(d[2]):d[3]))&&{"stroke-width":r},(!s||m&257&&n!==(n=d[6]("lucide-icon","lucide",d[0]?`lucide-${d[0]}`:"",d[8].class)))&&{class:n}]))},i(d){s||(y(c,d),s=!0)},o(d){w(c,d),s=!1},d(d){d&&b(e),qe(a,d),c&&c.d(d)}}}function jS(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=Df(e,r),{$$slots:s={},$$scope:i}=e,{name:a=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:f=2}=e,{absoluteStrokeWidth:u=!1}=e,{iconNode:d}=e,m=(...p)=>p.filter((x,g,_)=>Boolean(x)&&_.indexOf(x)===g).join(" ");return o.$$set=p=>{t(8,e=te(te({},e),pe(p))),t(7,n=Df(e,r)),"name"in p&&t(0,a=p.name),"color"in p&&t(1,l=p.color),"size"in p&&t(2,c=p.size),"strokeWidth"in p&&t(3,f=p.strokeWidth),"absoluteStrokeWidth"in p&&t(4,u=p.absoluteStrokeWidth),"iconNode"in p&&t(5,d=p.iconNode),"$$scope"in p&&t(9,i=p.$$scope)},e=pe(e),[a,l,c,f,u,d,m,n,e,i,s]}var qf=class extends W{constructor(e){super(),K(this,e,jS,WS,z,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},Me=qf;function KS(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function GS(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[KS]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function JS(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var zf=class extends W{constructor(e){super(),K(this,e,JS,GS,z,{})}},Wf=zf;function QS(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function YS(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[QS]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function XS(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var jf=class extends W{constructor(e){super(),K(this,e,XS,YS,z,{})}},Kf=jf;function ZS(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function e0(o){let e,t,r=[{name:"check"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ZS]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function t0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 6 9 17l-5-5"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var Gf=class extends W{constructor(e){super(),K(this,e,t0,e0,z,{})}},Jf=Gf;function r0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function o0(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[r0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function n0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var Qf=class extends W{constructor(e){super(),K(this,e,n0,o0,z,{})}},Yf=Qf;function s0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function i0(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[s0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function a0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var Xf=class extends W{constructor(e){super(),K(this,e,a0,i0,z,{})}},Zf=Xf;function l0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function c0(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[l0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function f0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var eu=class extends W{constructor(e){super(),K(this,e,f0,c0,z,{})}},tu=eu;function u0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function d0(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[u0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function p0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var ru=class extends W{constructor(e){super(),K(this,e,p0,d0,z,{})}},ai=ru;function m0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function h0(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[m0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function g0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var ou=class extends W{constructor(e){super(),K(this,e,g0,h0,z,{})}},li=ou;function y0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function x0(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[y0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function b0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var nu=class extends W{constructor(e){super(),K(this,e,b0,x0,z,{})}},su=nu;function v0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function w0(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[v0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function _0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var iu=class extends W{constructor(e){super(),K(this,e,_0,w0,z,{})}},au=iu;function S0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function k0(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[S0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function I0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var lu=class extends W{constructor(e){super(),K(this,e,I0,k0,z,{})}},cu=lu;function C0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function L0(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[C0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function T0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var fu=class extends W{constructor(e){super(),K(this,e,T0,L0,z,{})}},ho=fu;function A0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function P0(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[A0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function F0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var uu=class extends W{constructor(e){super(),K(this,e,F0,P0,z,{})}},du=uu;function E0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function M0(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[E0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function D0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var pu=class extends W{constructor(e){super(),K(this,e,D0,M0,z,{})}},mu=pu;function R0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function $0(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[R0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function O0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var hu=class extends W{constructor(e){super(),K(this,e,O0,$0,z,{})}},gu=hu;function U0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function B0(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[U0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function N0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var yu=class extends W{constructor(e){super(),K(this,e,N0,B0,z,{})}},xu=yu;function H0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function V0(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[H0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function q0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var bu=class extends W{constructor(e){super(),K(this,e,q0,V0,z,{})}},vu=bu;function z0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function W0(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[z0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function j0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var wu=class extends W{constructor(e){super(),K(this,e,j0,W0,z,{})}},gn=wu;function K0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function G0(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[K0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function J0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var _u=class extends W{constructor(e){super(),K(this,e,J0,G0,z,{})}},Su=_u;function Q0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function Y0(o){let e,t,r=[{name:"square-pen"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Q0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function X0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var ku=class extends W{constructor(e){super(),K(this,e,X0,Y0,z,{})}},Iu=ku;function Z0(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function ek(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Z0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function tk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var Cu=class extends W{constructor(e){super(),K(this,e,tk,ek,z,{})}},ci=Cu;function rk(o){let e,t=o[2].default,r=ae(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ce(r,t,n,n[3],e?le(t,n[3],s,null):fe(n[3]),null)},i(n){e||(y(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function ok(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[rk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=te(n,r[s]);return e=new Me({props:n}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Ee(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function nk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=i=>{t(1,e=te(te({},e),pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=pe(e),[s,e,r,n]}var Lu=class extends W{constructor(e){super(),K(this,e,nk,ok,z,{})}},Tu=Lu;function sk(o){we(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function ik(o){let e,t,r,n,s,i;return t=new ho({props:{class:"svg-icon inline-icon"}}),{c(){var a;e=k("button"),R(t.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(a=o[0].view.file)==null?void 0:a.name)},m(a,l){v(a,e,l),M(t,e,null),i=!0},p(a,l){var c;(!i||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(a[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!i||l&1&&n!==(n=a[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!i||l&1&&s!==(s=(c=a[0].view.file)==null?void 0:c.name))&&h(e,"data-filename",s)},i(a){i||(y(t.$$.fragment,a),i=!0)},o(a){w(t.$$.fragment,a),i=!1},d(a){a&&b(e),D(t)}}}function ak(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;return t=new ho({props:{class:"svg-icon inline-icon"}}),l=new gn({props:{class:"svg-icon inline-icon"}}),{c(){var p;e=k("button"),R(t.$$.fragment),i=A(),a=k("button"),R(l.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(p=o[0].view.file)==null?void 0:p.name),h(a,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),h(a,"aria-label",f=`${o[2].relay.name} (${o[1].status})`),h(a,"tabindex","0")},m(p,x){v(p,e,x),M(t,e,null),v(p,i,x),v(p,a,x),M(l,a,null),u=!0,d||(m=[j(a,"click",o[3]),j(a,"keypress",o[4])],d=!0)},p(p,x){var g;(!u||x&1&&r!==(r="clickable-icon view-action system3-view-action "+(p[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!u||x&1&&n!==(n=p[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!u||x&1&&s!==(s=(g=p[0].view.file)==null?void 0:g.name))&&h(e,"data-filename",s),(!u||x&2&&c!==(c="system3-"+p[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&h(a,"class",c),(!u||x&6&&f!==(f=`${p[2].relay.name} (${p[1].status})`))&&h(a,"aria-label",f)},i(p){u||(y(t.$$.fragment,p),y(l.$$.fragment,p),u=!0)},o(p){w(t.$$.fragment,p),w(l.$$.fragment,p),u=!1},d(p){p&&(b(e),b(i),b(a)),D(t),D(l),d=!1,be(m)}}}function lk(o){let e,t,r,n,s=[ak,ik],i=[];function a(l,c){return l[2]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ge()},m(l,c){i[e].m(l,c),v(l,r,c),n=!0},p(l,[c]){let f=e;e=a(l,c),e===f?i[e].p(l,c):(oe(),w(i[f],1,1,()=>{i[f]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),y(t,1),t.m(r.parentNode,r))},i(l){n||(y(t),n=!0)},o(l){w(t),n=!1},d(l){l&&b(r),i[e].d(l)}}}function ck(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,i={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},a=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&a()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,s=c.remote)},[r,n,s,a,l]}var Au=class extends W{constructor(e){super(),K(this,e,ck,lk,z,{view:0,state:1,remote:2},sk)}},Pu=Au;var yn=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var Fa=require("@codemirror/state"),Eg=require("@codemirror/view");function go(o,e){let t=Object.keys(e).map(r=>fk(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function fk(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},i=t(s);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(a,i),o[e]=a,l;function a(...c){return i===s&&o[e]===a&&l(),i.apply(this,c)}function l(){o[e]===a&&(n?o[e]=s:delete o[e]),i!==s&&(i=s,Object.setPrototypeOf(a,r||Function))}}var Mg=_n(pf());var uk=25,I$=Fa.Facet.define({combine(o){return o[o.length-1]}}),Fu=Fa.Annotation.define(),Eu=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var n,s,i,a;if(this.unsubscribes=[],this.editor=e,this.connectionManager=this.editor.state.field(Wr),this.view=(n=this.connectionManager)==null?void 0:n.findView(e),!this.view||(this.log=Se(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=Se(`[LiveCMPluginValue][${(i=this.view.view.file)==null?void 0:i.path}]`,"warn"),this.debug=Se(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=!1,r=this;this.unsubscribes.push(go(this.view.view,{setViewData(l){return function(c,f){if(f)Er(r.view)&&r.view.document.text===c&&(r.view.tracking=!0),r.resync();else if(t){let u=r.incrementalBufferChange(c);e.dispatch({changes:u})}return l.call(this,c,f)}},saveFrontmatter(l){return function(c){t=!0;let f=l.call(this,c);return t=!1,f}}})),this.unsubscribes.push(go(this.view.view.previewMode,{edit(l){return function(c){if(Er(r.view)&&r.view.view.getMode()==="preview"){let f=r.incrementalBufferChange(c);e.dispatch({changes:f})}return l.call(this,c)}}})),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(l,c)=>{if(!Er(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(c.origin!==this){let f=l.delta,u=[],d=0;for(let m=0;m<f.length;m++){let p=f[m];p.insert!=null?u.push({from:d,to:d,insert:p.insert}):p.delete!=null?(u.push({from:d,to:d+p.delete,insert:""}),d+=p.delete):p.retain!=null&&(d+=p.retain)}!this.view.tracking||Fe().enableEditorTweens&&this.keyFrameCounter>uk?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),Er(this.view)&&(e.dispatch({changes:u,annotations:[Fu.of(this.editor)]}),this.view.tracking=!0)}this.render()},this.observer=(l,c)=>{var f;try{(f=this._observer)==null||f.call(this,l,c)}catch(u){u instanceof RangeError&&Er(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}render(){var e;((e=this.view)==null?void 0:e.view.getMode())==="preview"&&(this.view.view.previewMode.renderer.set(this.editor.state.doc.toString()),this.view.view.onInternalDataChange())}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new Mg.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],i=0;for(let[a,l]of n)switch(a){case 0:i+=l.length;break;case 1:s.push({from:i,to:i,insert:l}),i+=l.length;break;case-1:s.push({from:i,to:i+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(Er(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();Er(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Fu.of(this.editor)]})}}async getKeyFrame(e=!1){return!Er(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),Er(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var n,s,i,a;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Fu)===this.editor)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(i=(s=this.view)==null?void 0:s.document)==null?void 0:i.ytext;r&&((a=r.doc)==null||a.transact(()=>{let l=0;e.changes.iterChanges((c,f,u,d,m)=>{let p=m.sliceString(0,m.length,`
`);c!==f&&r.delete(c+l,f-c),p.length>0&&r.insert(c+l,p),l+=p.length-(f-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.unsubscribes.forEach(t=>{t()}),this.unsubscribes.length=0,this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Dg=Eg.ViewPlugin.fromClass(Eu);var Ea=require("@codemirror/state"),Qt=require("@codemirror/view");var Rg=Qt.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),dk=Ea.Annotation.define(),Mu=class extends Qt.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Ms("span",[At("class","cm-ySelectionCaret"),At("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Un("\u2060"),Ms("div",[At("class","cm-ySelectionCaretDot")]),Un("\u2060"),Ms("div",[At("class","cm-ySelectionInfo")],[Un(this.name)]),Un("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},Du=class{constructor(e){var r,n;this.editor=e,this.decorations=Ea.RangeSet.of([]),this.connectionManager=this.editor.state.field(Wr);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof qo){this.view=t;let s=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:i,updated:a,removed:l},c,f)=>{i.concat(a).concat(l).findIndex(d=>{var m;return d!==((m=this._awareness)==null?void 0:m.doc.clientID)})>=0&&e.dispatch({annotations:[dk.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,f,u,d;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(u=(f=this.view)==null?void 0:f.document)==null?void 0:u.ytext;if(!(this.view&&r&&r.doc))return;let n=(d=this.view.document)==null?void 0:d._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,i=r.doc,a=[],l=this._awareness.getLocalState();if(l!=null){let m=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),p=m?e.state.selection.main:null,x=l.cursor==null?null:Bc(l.cursor.anchor),g=l.cursor==null?null:Bc(l.cursor.head);if(p!=null){let _=Nc(r,p.anchor),C=Nc(r,p.head);(l.cursor==null||!Vc(x,_)||!Vc(g,C))&&s.setLocalStateField("cursor",{anchor:_,head:C})}else l.cursor!=null&&m&&s.setLocalStateField("cursor",null)}s.getStates().forEach((m,p)=>{if(p===s.doc.clientID)return;let x=m.cursor;if(x==null||x.anchor==null||x.head==null)return;let g=Hc(x.anchor,i),_=Hc(x.head,i);if(g==null||_==null||g.type!==r||_.type!==r)return;if(g.index>e.state.doc.length||_.index>e.state.doc.length){Se("[RemoteSelections]","warn")(`cursor positions (${g.index}, ${_.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=Qt.Decoration.none;return}let{color:C="#30bced",name:L="Anonymous"}=m.user||{},F=m.user&&m.user.colorLight||C+"33",P=Cn(g.index,_.index),$=Ir(g.index,_.index),I=e.view.state.doc.lineAt(P),T=e.view.state.doc.lineAt($);if(I.number===T.number)a.push({from:P,to:$,value:Qt.Decoration.mark({attributes:{style:`background-color: ${F}`},class:"cm-ySelection"})});else{a.push({from:P,to:I.from+I.length,value:Qt.Decoration.mark({attributes:{style:`background-color: ${F}`},class:"cm-ySelection"})}),a.push({from:T.from,to:$,value:Qt.Decoration.mark({attributes:{style:`background-color: ${F}`},class:"cm-ySelection"})});for(let O=I.number+1;O<T.number;O++){let G=e.view.state.doc.line(O).from;a.push({from:G,to:G,value:Qt.Decoration.line({attributes:{style:`background-color: ${F}`,class:"cm-yLineSelection"}})})}}a.push({from:_.index,to:_.index,value:Qt.Decoration.widget({side:_.index-g.index>0?-1:1,block:!1,widget:new Mu(C,L)})})}),this.decorations=Qt.Decoration.set(a,!0)}},$g=Qt.ViewPlugin.fromClass(Du,{decorations:o=>o.decorations});var Ma=require("@codemirror/state"),yo=require("@codemirror/view"),Og=require("@codemirror/view");var B$=Ma.Annotation.define(),$u=class extends Og.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},Ru=Ma.StateEffect.define(),Ou=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(Wr),this.decorations=yo.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:Ru.of(null)})},!this.connectionManager){Se("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Se(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,n;if(this.connectionManager&&this.app&&((n=(r=this.view)==null?void 0:r.document)!=null&&n.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let s=this.app.metadataCache.getFileCache(this.view.document.tfile);s&&(this.updateFromMetadata(s),this.editor.dispatch({effects:Ru.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(yo.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(i,a,l)=>{var u;(((u=l.spec)==null?void 0:u.class)||"").contains("cm-formatting-link-end")&&t.push({from:i,to:a})})}),t}updateFromMetadata(e){var r,n,s,i;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.tfile))return;let t=new Map;for(let a of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}for(let a of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,i,a,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.sharedFolder)||!((l=(a=this.view)==null?void 0:a.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let f=null;for(let[m,p]of r)if(c.from<=p.to&&c.to>=p.from){f=p,r.delete(m);break}if(!f)continue;let u=this.app.metadataCache.getFirstLinkpathDest(f.link,this.view.document.path);u&&!this.view.document.sharedFolder.checkPath(u.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>yo.Decoration.widget({widget:new $u,side:1}).range(t));e.length>0?this.decorations=yo.Decoration.set(e,!0):this.decorations=yo.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(Ru))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Ug=yo.ViewPlugin.fromClass(Ou,{decorations:o=>o.decorations});function xo(){}xo.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var i=this;function a(F){return s?(setTimeout(function(){s(void 0,F)},0),!0):F}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,f=1,u=l+c;n.maxEditLength&&(u=Math.min(u,n.maxEditLength));var d=(r=n.timeout)!==null&&r!==void 0?r:1/0,m=Date.now()+d,p=[{oldPos:-1,lastComponent:void 0}],x=this.extractCommon(p[0],t,e,0);if(p[0].oldPos+1>=c&&x+1>=l)return a([{value:this.join(t),count:t.length}]);var g=-1/0,_=1/0;function C(){for(var F=Math.max(g,-f);F<=Math.min(_,f);F+=2){var P=void 0,$=p[F-1],I=p[F+1];$&&(p[F-1]=void 0);var T=!1;if(I){var O=I.oldPos-F;T=I&&0<=O&&O<l}var G=$&&$.oldPos+1<c;if(!T&&!G){p[F]=void 0;continue}if(!G||T&&$.oldPos+1<I.oldPos?P=i.addToPath(I,!0,void 0,0):P=i.addToPath($,void 0,!0,1),x=i.extractCommon(P,t,e,F),P.oldPos+1>=c&&x+1>=l)return a(pk(i,P.lastComponent,t,e,i.useLongestToken));p[F]=P,P.oldPos+1>=c&&(_=Math.min(_,F-1)),x+1>=l&&(g=Math.max(g,F+1))}f++}if(s)(function F(){setTimeout(function(){if(f>u||Date.now()>m)return s();C()||F()},0)})();else for(;f<=u&&Date.now()<=m;){var L=C();if(L)return L}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,i=r.length,a=e.oldPos,l=a-n,c=0;l+1<s&&a+1<i&&this.equals(t[l+1],r[a+1]);)l++,a++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=a,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function pk(o,e,t,r,n){for(var s=[],i;e;)s.push(e),i=e.previousComponent,delete e.previousComponent,e=i;s.reverse();for(var a=0,l=s.length,c=0,f=0;a<l;a++){var u=s[a];if(u.removed){if(u.value=o.join(r.slice(f,f+u.count)),f+=u.count,a&&s[a-1].added){var m=s[a-1];s[a-1]=s[a],s[a]=m}}else{if(!u.added&&n){var d=t.slice(c,c+u.count);d=d.map(function(x,g){var _=r[f+g];return _.length>x.length?_:x}),u.value=o.join(d)}else u.value=o.join(t.slice(c,c+u.count));c+=u.count,u.added||(f+=u.count)}}var p=s[l-1];return l>1&&typeof p.value=="string"&&(p.added||p.removed)&&o.equals("",p.value)&&(s[l-2].value+=p.value,s.pop()),s}var H$=new xo;function mk(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Bg=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Ng=/\S/,Vu=new xo;Vu.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Ng.test(o)&&!Ng.test(e)};Vu.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Bg.test(e[t])&&Bg.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Hg(o,e,t){return t=mk(t,{ignoreWhitespace:!0}),Vu.diff(o,e,t)}var qu=new xo;qu.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function hk(o,e,t){return qu.diff(o,e,t)}var gk=new xo;gk.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var yk=new xo;yk.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Da(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Da=function(e){return typeof e}:Da=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Da(o)}function Uu(o){return xk(o)||bk(o)||vk(o)||wk()}function xk(o){if(Array.isArray(o))return Bu(o)}function bk(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function vk(o,e){if(o){if(typeof o=="string")return Bu(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Bu(o,e)}}function Bu(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function wk(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _k=Object.prototype.toString,fi=new xo;fi.useLongestToken=!0;fi.tokenize=qu.tokenize;fi.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,i){return typeof i=="undefined"?t:i}:r;return typeof o=="string"?o:JSON.stringify(Nu(o,null,null,n),n,"  ")};fi.equals=function(o,e){return xo.prototype.equals.call(fi,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Nu(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var i;if(_k.call(o)==="[object Array]"){for(e.push(o),i=new Array(o.length),t.push(i),s=0;s<o.length;s+=1)i[s]=Nu(o[s],e,t,r,n);return e.pop(),t.pop(),i}if(o&&o.toJSON&&(o=o.toJSON()),Da(o)==="object"&&o!==null){e.push(o),i={},t.push(i);var a=[],l;for(l in o)o.hasOwnProperty(l)&&a.push(l);for(a.sort(),s=0;s<a.length;s+=1)l=a[s],i[l]=Nu(o[l],e,t,r,l);e.pop(),t.pop()}else i=o;return i}var Hu=new xo;Hu.tokenize=function(o){return o.slice()};Hu.join=Hu.removeEmpty=function(o){return o};function Vg(o,e,t,r,n,s,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var a=hk(t,r,i);if(!a)return;a.push({value:"",lines:[]});function l(_){return _.map(function(C){return" "+C})}for(var c=[],f=0,u=0,d=[],m=1,p=1,x=function(C){var L=a[C],F=L.lines||L.value.replace(/\n$/,"").split(`
`);if(L.lines=F,L.added||L.removed){var P;if(!f){var $=a[C-1];f=m,u=p,$&&(d=i.context>0?l($.lines.slice(-i.context)):[],f-=d.length,u-=d.length)}(P=d).push.apply(P,Uu(F.map(function(H){return(L.added?"+":"-")+H}))),L.added?p+=F.length:m+=F.length}else{if(f)if(F.length<=i.context*2&&C<a.length-2){var I;(I=d).push.apply(I,Uu(l(F)))}else{var T,O=Math.min(F.length,i.context);(T=d).push.apply(T,Uu(l(F.slice(0,O))));var G={oldStart:f,oldLines:m-f+O,newStart:u,newLines:p-u+O,lines:d};if(C>=a.length-2&&F.length<=i.context){var J=/\n$/.test(t),q=/\n$/.test(r),E=F.length==0&&d.length>G.oldLines;!J&&E&&t.length>0&&d.splice(G.oldLines,0,"\\ No newline at end of file"),(!J&&!E||!q)&&d.push("\\ No newline at end of file")}c.push(G),f=0,u=0,d=[]}m+=F.length,p+=F.length}},g=0;g<a.length;g++)x(g);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var qg=require("obsidian");var Ra=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var $a=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let i=0;i<r.lines.length;i+=1){let a=r.lines[i];if(a.startsWith("+")||a.startsWith("-")){let l=i,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let f=r.lines.slice(l,c+1).filter(d=>d.startsWith("-")).map(d=>d.slice(1)),u=r.lines.slice(l,c+1).filter(d=>d.startsWith("+")).map(d=>d.slice(1));t.push(new Ra({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:f,file2Lines:u})),n+=f.length,s+=u.length,i+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function zu(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function ui(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function di(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function fs(o){return o!==""?o:"\u200E"}var Yt=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var jr=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Oa=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof mt){rs(e.ydoc,t,e);return}else if(e instanceof fo){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new Yt({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),jr.build(t),new Yt({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),jr.build(t),new Yt({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),jr.build(t),new Yt({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new Yt({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),jr.build(t),new Yt({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new Yt({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),jr.build(t),new Yt({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=ui({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=ui({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=ui({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=ui({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=di({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=di({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=zu({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=zu({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=di({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=di({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var us="system3-differences-view";async function zg(o,e){o.detachLeavesOfType(us);let t=o.getLeaf(!0);t.setViewState({type:us,active:!0,state:e}),o.revealLeaf(t)}var Ua=class extends qg.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];let r=this.constructor.name;this.log=Se(`[${r}]`,"log")}async getContent(t){return t instanceof mt?t.text:t instanceof fo?t.contents:await this.app.vault.read(t)}getViewType(){return us}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=Vg(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));if(this.fileDifferences=$a.fromParsedDiff(t),this.fileDifferences.differences.length===0){if(this.file1Content!==this.file2Content){if(this.log("byte level difference with differ equivalence",this.file1Content.length,this.file2Content.length),Fe().enableDeltaLogging){let s=this.file1Content||"",i=this.file2Content||"",a=Math.max(s.length,i.length);for(let l=0;l<a;l++){let c=l<s.length?s.charCodeAt(l):void 0,f=l<i.length?i.charCodeAt(l):void 0;if(c!==f){let u=c!==void 0?`0x${c.toString(16).padStart(2,"0")}`:"EOF",d=f!==void 0?`0x${f.toString(16).padStart(2,"0")}`:"EOF";this.log(`Byte difference at position ${l}: file1=${c} (${u}), file2=${f} (${d})`)}}}await this.modify(this.state.file2,this.file1Content||"")}this.leaf.detach()}}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new Yt({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),jr.build(r),new Yt({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof mt){rs(t.ydoc,r,t);return}else if(t instanceof fo){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var i,a,l;let r=0,n=0,s=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((a=this.file2Lines)==null?void 0:a.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(f=>f.file1Start===r&&f.file2Start===n);if(c!=null){let f=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(f,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let f=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:fs(f),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Oa(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=fs(t);else if(t!=null&&r!=null){let i=Hg(r,t);for(let a of i){if(a.removed)continue;let l=document.createElement("span");l.textContent=fs(a.value),a.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=fs(t),i.classList.add(n),s.appendChild(i)}else s.textContent=fs(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var Ba=class extends dt{constructor(t){super();this.view=t.view,this.canvas=t.view.canvas,this.relayCanvas=t.canvas,this.unsubscribes=[],this.relayCanvasView=t,this.observedTextNodes=new Set,this.install()}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[]),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),n=t.id,s=i=>{let a=this.canvas.nodes.get(n);a&&(a.setText(r.toString()),this.canvas.markDirty(a))};r.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(s),this.observedTextNodes.delete(n)})}}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}install(){var c;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(c=this.view.file)==null?void 0:c.path,this.relayCanvas.path);let t=this,r=Xe.exportCanvasData(this.relayCanvas.ydoc),n=r.nodes.length>0||r.edges.length>0;this.relayCanvas.hasLocalDB()&&n&&this.canvas.importData(r,!0),this.unsubscribes.push(go(this.canvas,{requestSave(f){return function(){let u=f.call(this);try{t.relayCanvas.importFromView(t.view)}catch(d){t.log(d)}return u}},applyHistory(f){return function(u){let d=f.call(this,u);try{t.relayCanvas.importFromView(t.view)}catch(m){t.log(m)}return d}}}));let i=(f,u)=>{var p,x,g,_;let d="";if(d+=`Transaction origin: ${f.transaction.origin} ${(x=(p=f.transaction.origin)==null?void 0:p.constructor)==null?void 0:x.name}
`,this.relayCanvas||this.log("relay canvas is already destroyed"),!this.canvas){this.log("canvas is already destroyed");return}if(!((g=this.view.file)!=null&&g.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(f.transaction.origin===this.relayCanvas)return;let m=Xe.exportCanvasData(this.relayCanvas.ydoc);for(let[C,L]of f.changes.keys)d+=`key: ${C} action: ${L.action}

`;this.debug(d),this.debug("importing data",(_=this.view.file)==null?void 0:_.path,this.relayCanvas.path,m),this.canvas.importData(m,!0),this.canvas.requestSave();for(let C of f.keysChanged){let L=u.get(C);L&&(this.canvas.nodes.has(L.id)&&this.observeNode(L.getData()),this.canvas.markMoved(L),this.canvas.markDirty(L))}},a=f=>i(f,this.canvas.nodes);this.relayCanvas.ynodes.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(a)});for(let[,f]of this.relayCanvas.ynodes)this.observeNode(f);let l=f=>i(f,this.canvas.edges);this.relayCanvas.yedges.observe(l),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(l)}),this.relayCanvasView.tracking=!0}};var Na=require("@codemirror/state"),jg=require("@codemirror/view");var C4=Na.Facet.define({combine(o){return o[o.length-1]}}),Wg=Na.Annotation.define(),Wu=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,n,s;this.editor=e,this.connectionManager=this.editor.state.field(Wr),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=Se(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=Se(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"warn"),this.debug=Se(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"debug"),this.debug("created"),this._observer=async(i,a)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(a.origin!==this){let c=i.delta,f=[],u=0;for(let d=0;d<c.length;d++){let m=c[d];m.insert!=null?f.push({from:u,to:u,insert:m.insert}):m.delete!=null?(f.push({from:u,to:u+m.delete,insert:""}),u+=m.delete):m.retain!=null&&(u+=m.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:f,annotations:[Wg.of(this.editor)]})}},this.observer=(i,a)=>{var l;try{(l=this._observer)==null||l.call(this,i,a)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,n,s,i;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(a=>{if(a&&a.node)return a.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((n=this.node)==null?void 0:n.id)&&this.observer&&((s=this._ytext)==null||s.unobserve(this.observer)),this.node=e.node,(i=this.view)==null?void 0:i.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Wg)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let n=0;e.changes.iterChanges((s,i,a,l,c)=>{let f=c.sliceString(0,c.length,`
`);s!==i&&t.delete(s+n,i-s),f.length>0&&t.insert(s+n,f),n+=f.length-(i-s)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Kg=jg.ViewPlugin.fromClass(Wu);var kk=3;function ju(o,e){o.iterateAllLeaves(t=>{t.view instanceof ds.MarkdownView&&e(t.view)})}function Ku(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&Fe().enableCanvasSync&&e(t.view)})}function Ik(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(((t=o[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((n=o[i].document)==null?void 0:n.path)!==((s=e[i].document)==null?void 0:s.path))return!1;return!0}var Ha=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new yn(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function Er(o){return o instanceof qo&&o.document!==void 0&&o.document.text!==void 0}function Ck(o){return o instanceof Va&&o.document!==void 0}var Va=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this.tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}offlineBanner(){if(this.shouldConnect){let e=new yn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Pu({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.setConnectionDot(),this.plugin||(this.plugin=new Ba(this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.canvas=null}},qo=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new yn(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new yn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Pu({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;if(this.view.getMode()==="preview")return!1;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},qa=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new za.Compartment,this.log=Se("[LiveViews]","log"),this.warn=Se("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,f)=>{let u=this.metadataListeners.get(l);u==null||u(c,f)},i=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(i)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let a=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(f=>{var u;((u=f.document)==null?void 0:u.sharedFolder)===l&&f.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,a(l))})})),_t.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([Wr.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){zg(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return ju(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),Ku(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(ju(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),Ku(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return ju(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getDoc(r),a=new qo(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new Ha(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),Ku(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getCanvas(r),a=new Va(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new Ha(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),e}findView(e){return this.views.filter(Er).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(Ck).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof qo).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=kk){let r=this.workspace.getActiveViewOfType(ds.MarkdownView),n=0,s=e.sort((a,l)=>l.view.leaf.activeTime-a.view.leaf.activeTime),i=new Set;for(let a of s)a instanceof qo&&(a.view===r||i.has(a.document)?(a.canConnect=!0,i.add(a.document)):n<t?(a.canConnect=!0,i.add(a.document),n++):a.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(i=>{if(n.document==i.document&&n.view==i.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=Se(r,"debug"),s=(u,d)=>{n(u,d.map(m=>{var p;return{type:m.constructor.name,file:(p=m.document)==null?void 0:p.path,canConnect:m.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let i=[];try{i=await this.getViews()}catch(u){return this.warn("[System 3][Relay][Live Views] error getting views",u),!1}let a=this.findFolders();if(a.length===0&&i.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?a.forEach(u=>{u.connect()}):this.sharedFolders.forEach(u=>{u.disconnect()});let[l,c]=this.deduplicate(i);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&Ik(l,this.views)){let u=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",u)}else{let u=await this.viewsReady(l);s("Ready Views",u);let d=await this.viewsAttachedWithConnectionPool(u);s("Attached Views",d),this.views=l}n("loading plugins"),this.load();let f=ds.moment.utc();return n(`refresh completed in ${f.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Se(e,"warn"),r=ds.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(Wr.init(()=>this)),Dg,Kg,Rg,$g,Ug]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},Wr=za.StateField.define({create(o){},update(o,e){return o}});var ps=require("obsidian");function Lk(o){we(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Gg(o){let e,t,r,n;return{c(){e=k("span"),t=N(o[3]),r=N("%"),h(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),ie(e,"opacity","1")},m(s,i){v(s,e,i),S(e,t),S(e,r)},p(s,i){i&8&&Z(t,s[3]),i&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&h(e,"class",n)},d(s){s&&b(e)}}}function Tk(o){let e,t,r;return t=new ho({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=k("span"),R(t.$$.fragment),h(e,"class","notebook system3-icon svelte-1siabfk"),h(e,"aria-label","Tracking Changes")},m(n,s){v(n,e,s),M(t,e,null),r=!0},p:V,i(n){r||(y(t.$$.fragment,n),r=!0)},o(n){w(t.$$.fragment,n),r=!1},d(n){n&&b(e),D(t)}}}function Ak(o){let e,t,r,n,s,i,a,l;return t=new ho({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new gn({props:{class:"inline-icon"}}),{c(){var c;e=k("span"),R(t.$$.fragment),r=A(),n=k("span"),R(s.$$.fragment),h(e,"class","notebook system3-icon hidden svelte-1siabfk"),h(e,"aria-label","Tracking Changes"),h(n,"class",i="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),h(n,"aria-label",a=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,f){v(c,e,f),M(t,e,null),v(c,r,f),v(c,n,f),M(s,n,null),l=!0},p(c,f){var u;(!l||f&1&&i!==(i="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&h(n,"class",i),(!l||f&5&&a!==(a=`${((u=c[2])==null?void 0:u.relay.name)||"Relay Server"} (${c[0]})`))&&h(n,"aria-label",a)},i(c){l||(y(t.$$.fragment,c),y(s.$$.fragment,c),l=!0)},o(c){w(t.$$.fragment,c),w(s.$$.fragment,c),l=!1},d(c){c&&(b(e),b(r),b(n)),D(t),D(s)}}}function Pk(o){let e,t,r,n,s,i=o[5]&&Gg(o),a=[Ak,Tk],l=[];function c(f,u){return f[1]?0:1}return r=c(o,-1),n=l[r]=a[r](o),{c(){e=k("div"),i&&i.c(),t=A(),n.c(),h(e,"class","system3-folder-icons svelte-1siabfk")},m(f,u){v(f,e,u),i&&i.m(e,null),S(e,t),l[r].m(e,null),s=!0},p(f,[u]){f[5]?i?i.p(f,u):(i=Gg(f),i.c(),i.m(e,t)):i&&(i.d(1),i=null);let d=r;r=c(f,u),r===d?l[r].p(f,u):(oe(),w(l[d],1,1,()=>{l[d]=null}),ne(),n=l[r],n?n.p(f,u):(n=l[r]=a[r](f),n.c()),y(n,1),n.m(e,null))},i(f){s||(y(n),s=!0)},o(f){w(n),s=!1},d(f){f&&b(e),i&&i.d(),l[r].d()}}}function Fk(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:i}=e,{progress:a=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,i=c.remote),"progress"in c&&t(3,a=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||a<100)&&a>0)}},[n,s,i,a,l,r]}var Gu=class extends W{constructor(e){super(),K(this,e,Fk,Pk,z,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},Lk)}},Jg=Gu;function Ek(o){we(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function Mk(o){let e,t,r;return{c(){e=k("div"),t=k("span"),r=N(o[0]),h(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),h(e,"aria-label",o[1])},m(n,s){v(n,e,s),S(e,t),S(t,r)},p(n,[s]){s&1&&Z(r,n[0]),s&2&&h(e,"aria-label",n[1])},i:V,o:V,d(n){n&&b(e)}}}function Dk(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var Ju=class extends W{constructor(e){super(),K(this,e,Dk,Mk,z,{text:0,label:1},Ek)}},Qg=Ju;function Rk(o){we(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function $k(o){let e,t,r,n;return{c(){e=k("div"),t=k("span"),r=N(o[0]),h(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),h(e,"aria-label",o[1]),h(e,"style",n=o[2]?`color:${o[2]}`:"")},m(s,i){v(s,e,i),S(e,t),S(t,r)},p(s,[i]){i&1&&Z(r,s[0]),i&2&&h(e,"aria-label",s[1]),i&4&&n!==(n=s[2]?`color:${s[2]}`:"")&&h(e,"style",n)},i:V,o:V,d(s){s&&b(e)}}}function Ok(o,e,t){let{text:r}=e,{label:n}=e,{color:s}=e;return o.$$set=i=>{"text"in i&&t(0,r=i.text),"label"in i&&t(1,n=i.label),"color"in i&&t(2,s=i.color)},[r,n,s]}var Qu=class extends W{constructor(e){super(),K(this,e,Ok,$k,z,{text:0,label:1,color:2},Rk)}},Yg=Qu;var Yu=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},zo=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},Xu=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new Yu(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},Zu=class extends zo{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Xu(t.selfEl,n):(r&&r.destroy(),null)}},ed=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new Jg({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},td=class extends zo{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new ed(t.selfEl,n):(r&&r.destroy(),null)}},rd=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},od=class extends zo{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&mt.checkExtension(t.path)?n||new rd(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},nd=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(r=>{r.remove()}),this.unsubscribes.push(this.file.subscribe(()=>{this.setText()}))}setText(){var e;if(this.file){if(this.file.inMeta){(e=this.pill)==null||e.$destroy();return}this.pill?this.pill.$set({text:this.file.tag}):this.pill=new Yg({target:this.el,props:{text:this.file.tag}})}}destroy(){var e;this.unsubscribes.forEach(t=>t()),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()}),(e=this.pill)==null||e.$destroy(),this.file=null}},sd=class extends zo{visitFile(e,t,r,n){if(n&&!mt.checkExtension(e.path)&&!Xe.checkExtension(e.path)&&n.isSyncableTFile(e)&&n.ready&&n.connected){let s=n.proxy.viewSyncFile(e.path);if(s&&br(s))return r&&r.file===s?r:new nd(t.selfEl,s)}return r&&r.destroy(),null}},id=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Qg({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},ad=class extends zo{visitFile(e,t,r,n){return n&&n.checkPath(e.path)&&!n.isSyncableTFile(e)?r||new id(t.selfEl):(r&&r.destroy(),null)}},ld=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},cd=class extends zo{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),i=n.syncStore.get(s);if(!i)return null;let a=n.files.get(i);return!(a instanceof mt)||!a?null:r||new ld(t.el,a,e)}catch(s){return null}return r&&r.destroy(),null}},Wa=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,i)=>{let a=s.get(n),l=i.visitFolder(e,n,a,r);a&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof ps.TFolder)this.walk(s,r);else if(s instanceof ps.TFile){let i=this.getFileExplorerItem(this.fileExplorer,s);if(!i)return;this.storage.forEach((a,l)=>{let c=a.get(i),f=l.visitFile(s,i,c,r);c&&!f?a.delete(i):f&&a.set(i,f)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},ja=class{constructor(e,t,r,n){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{zh([lo.enableDocumentStatus],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(s.syncSettingsManager.subscribe(i=>{this.quickRefresh()})),this.unsubscribes.push(s.subscribe(this,()=>{this.quickRefresh()})),this.unsubscribes.push(s.syncStore.subscribe(i=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new Zu),e.push(new td),Do(lo.enableDocumentStatus,()=>{e.push(new cd),e.push(new od(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new sd),e.push(new ad),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new Wa(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let i=this.vault.getAbstractFileByPath(s);i instanceof ps.TFolder&&n.walk(i)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new Wa(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof ps.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var Ax=require("obsidian");function Ne(o,e,t,r){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(f){try{c(r.next(f))}catch(u){i(u)}}function l(f){try{c(r.throw(f))}catch(u){i(u)}}function c(f){f.done?s(f.value):n(f.value).then(a,l)}c((r=r.apply(o,e||[])).next())})}var Mr=require("obsidian");function Uk(o){let e,t,r;return{c(){e=Fr("svg"),t=Fr("g"),r=Fr("path"),h(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),h(r,"fill","#5865F2"),h(r,"fill-rule","nonzero"),h(e,"width",o[0]),h(e,"height",o[0]),h(e,"viewBox","0 -28.5 256 256"),h(e,"version","1.1"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),h(e,"preserveAspectRatio","xMidYMid")},m(n,s){v(n,e,s),S(e,t),S(t,r)},p(n,[s]){s&1&&h(e,"width",n[0]),s&1&&h(e,"height",n[0])},i:V,o:V,d(n){n&&b(e)}}}function Bk(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var fd=class extends W{constructor(e){super(),K(this,e,Bk,Uk,z,{size:0})}},Ka=fd;function Nk(o){we(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function Xg(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;return a=new Ka({props:{size:20}}),{c(){e=k("div"),t=k("div"),r=A(),n=k("div"),s=k("span"),i=k("a"),R(a.$$.fragment),l=A(),c=k("span"),c.textContent="Join the community",h(t,"class","arrow svelte-4t8k3t"),h(i,"href","https://discord.system3.md"),h(i,"target","_blank"),h(i,"rel","noopener noreferrer"),h(i,"class","menu-item svelte-4t8k3t"),ie(s,"text-align","center"),ie(s,"display","flex"),h(n,"class","menu-content svelte-4t8k3t"),h(e,"class","menu-dropdown svelte-4t8k3t")},m(p,x){v(p,e,x),S(e,t),S(e,r),S(e,n),S(n,s),S(s,i),M(a,i,null),S(i,l),S(i,c),u=!0,d||(m=Ta(f=o[1].call(null,e)),d=!0)},i(p){u||(y(a.$$.fragment,p),u=!0)},o(p){w(a.$$.fragment,p),u=!1},d(p){p&&b(e),D(a),d=!1,m()}}}function Hk(o){let e,t,r,n,s,i,a;r=new mu({props:{size:"20px"}});let l=o[0]&&Xg(o);return{c(){e=k("div"),t=k("button"),R(r.$$.fragment),n=A(),l&&l.c(),h(t,"class","menu-button svelte-4t8k3t"),h(e,"class","menu-container svelte-4t8k3t")},m(c,f){v(c,e,f),S(e,t),M(r,t,null),S(e,n),l&&l.m(e,null),s=!0,i||(a=j(t,"click",vg(o[2])),i=!0)},p(c,[f]){c[0]?l?f&1&&y(l,1):(l=Xg(c),l.c(),y(l,1),l.m(e,null)):l&&(oe(),w(l,1,1,()=>{l=null}),ne())},i(c){s||(y(r.$$.fragment,c),y(l),s=!0)},o(c){w(r.$$.fragment,c),w(l),s=!1},d(c){c&&b(e),D(r),l&&l.d(),i=!1,a()}}}function Vk(o,e,t){let r=!1;function n(i){let a=l=>{let c=document.querySelector(".menu-button");!i.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",a)},0),{destroy(){document.removeEventListener("click",a)}}}function s(i){i.stopPropagation(),t(0,r=!r)}return[r,n,s]}var ud=class extends W{constructor(e){super(),K(this,e,Vk,Hk,z,{},Nk)}},Zg=ud;function qk(o){we(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function zk(o){let e,t;return{c(){e=Fr("svg"),t=Fr("path"),h(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),h(e,"class","relay-text svelte-ycfe1d"),h(e,"width",o[0]),h(e,"height",o[1]),h(e,"viewBox","0 0 154.24573 66.293579"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){v(r,e,n),S(e,t)},p:V,i:V,o:V,d(r){r&&b(e)}}}function Wk(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=i=>{"size"in i&&t(2,r=i.size)},[n,s,r]}var dd=class extends W{constructor(e){super(),K(this,e,Wk,zk,z,{size:2},qk)}},Ga=dd;function jk(o){we(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function Kk(o){let e,t,r,n,s,i;return e=new Ga({props:{size:140}}),{c(){R(e.$$.fragment),t=A(),r=k("p"),r.textContent="Real-time collaboration in Obsidian",n=A(),s=k("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,h(r,"class","subtitle svelte-120r7kg"),h(s,"class","description svelte-120r7kg")},m(a,l){M(e,a,l),v(a,t,l),v(a,r,l),v(a,n,l),v(a,s,l),i=!0},p:V,i(a){i||(y(e.$$.fragment,a),i=!0)},o(a){w(e.$$.fragment,a),i=!1},d(a){a&&(b(t),b(r),b(n),b(s)),D(e,a)}}}var pd=class extends W{constructor(e){super(),K(this,e,null,Kk,z,{},jk)}},ey=pd;var Ja=require("obsidian");function Gk(o){we(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function Jk(o){let e,t,r,n;return{c(){e=k("div"),t=k("div"),r=A(),n=k("p"),n.textContent=`${ry}`,h(t,"class","arrow svelte-1kvxms3"),h(e,"class","popover svelte-1kvxms3"),Be(e,"visible",o[1])},m(s,i){v(s,e,i),S(e,t),S(e,r),S(e,n),o[10](e)},p(s,i){i&2&&Be(e,"visible",s[1])},d(s){s&&b(e),o[10](null)}}}function Qk(o){let e,t=o[1]&&ty(o);return{c(){t&&t.c(),e=ge()},m(r,n){t&&t.m(r,n),v(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=ty(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&b(e),t&&t.d(r)}}}function ty(o){let e,t;return{c(){e=k("div"),t=k("p"),t.textContent=`${ry}`,h(e,"class","help-content svelte-1kvxms3")},m(r,n){v(r,e,n),S(e,t)},p:V,d(r){r&&b(e)}}}function Yk(o){let e,t,r,n=o[0]?"Why sign in with Google?":"Why do I need to sign in?",s,i,a,l,c,f,u,d,m,p;function x(C,L){return C[2]?Qk:Jk}let g=x(o,-1),_=g(o);return f=new Ka({}),{c(){e=k("div"),t=k("div"),r=k("button"),s=N(n),i=A(),_.c(),a=A(),l=k("div"),c=k("a"),R(f.$$.fragment),u=N(`
		Join the project on Discord`),h(r,"class","why-google svelte-1kvxms3"),Be(r,"mobile",o[2]),h(t,"class","help-container svelte-1kvxms3"),h(e,"class","help-section svelte-1kvxms3"),h(c,"href","https://discord.system3.md"),h(c,"class","discord-link svelte-1kvxms3"),h(l,"class","footer svelte-1kvxms3")},m(C,L){v(C,e,L),S(e,t),S(t,r),S(r,s),o[9](r),S(t,i),_.m(t,null),v(C,a,L),v(C,l,L),S(l,c),M(f,c,null),S(c,u),d=!0,m||(p=[j(r,"mouseenter",o[5]),j(r,"mouseleave",o[6]),j(r,"click",o[7])],m=!0)},p(C,[L]){(!d||L&1)&&n!==(n=C[0]?"Why sign in with Google?":"Why do I need to sign in?")&&Z(s,n),(!d||L&4)&&Be(r,"mobile",C[2]),g===(g=x(C,L))&&_?_.p(C,L):(_.d(1),_=g(C),_&&(_.c(),_.m(t,null)))},i(C){d||(y(f.$$.fragment,C),d=!0)},o(C){w(f.$$.fragment,C),d=!1},d(C){C&&(b(e),b(a),b(l)),o[9](null),_.d(),D(f),m=!1,be(p)}}}var ry="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function Xk(o,e,t){var r;let n=!1,s=!1,{isGoogle:i=!0}=e,a,l;function c(){s||t(1,n=!0)}function f(){s||t(1,n=!1)}function u(){s&&t(1,n=!n)}function d(p){Jt[p?"unshift":"push"](()=>{a=p,t(3,a)})}function m(p){Jt[p?"unshift":"push"](()=>{l=p,t(4,l)})}return o.$$set=p=>{"isGoogle"in p&&t(0,i=p.isGoogle)},o.$$.update=()=>{if(o.$$.dirty&256){e:t(2,s=t(8,r=Ja.Platform===null||Ja.Platform===void 0?void 0:Ja.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[i,n,s,a,l,c,f,u,r,d,m]}var md=class extends W{constructor(e){super(),K(this,e,Xk,Yk,z,{isGoogle:0},Gk)}},oy=md;var ny=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],Qa=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=ny[As()%ny.length]}};function Zk(o){we(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function eI(o){let e,t;return{c(){e=k("span"),t=N(o[5]),h(e,"class","initial svelte-18fffd7"),ie(e,"font-size",o[4])},m(r,n){v(r,e,n),S(e,t)},p(r,n){n&32&&Z(t,r[5]),n&16&&ie(e,"font-size",r[4])},d(r){r&&b(e)}}}function tI(o){let e,t,r,n;return{c(){e=k("img"),Mf(e.src,t=o[0].picture)||h(e,"src",t),h(e,"alt",o[1]),h(e,"referrerpolicy","no-referrer"),h(e,"class","svelte-18fffd7")},m(s,i){v(s,e,i),r||(n=j(e,"error",o[6]),r=!0)},p(s,i){i&1&&!Mf(e.src,t=s[0].picture)&&h(e,"src",t),i&2&&h(e,"alt",s[1])},d(s){s&&b(e),r=!1,n()}}}function rI(o){let e;function t(s,i){return!s[3]&&s[0].picture?tI:eI}let r=t(o,-1),n=r(o);return{c(){e=k("div"),n.c(),h(e,"class","avatar svelte-18fffd7"),ie(e,"width",o[2]),ie(e,"height",o[2])},m(s,i){v(s,e,i),n.m(e,null)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),i&4&&ie(e,"width",s[2]),i&4&&ie(e,"height",s[2])},i:V,o:V,d(s){s&&b(e),n.d()}}}function oI(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function nI(o,e,t){let r,n,s,{user:i}=e,{alt:a="Profile picture"}=e,{size:l="40px"}=e,c=!1;function f(){t(3,c=!0)}return o.$$set=u=>{"user"in u&&t(0,i=u.user),"alt"in u&&t(1,a=u.alt),"size"in u&&t(2,l=u.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=i.name?i.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=oI(l))}if(o.$$.dirty&132){e:t(4,s=`${parseFloat(l)/2}${n}`)}},[i,a,l,c,s,r,f,n]}var hd=class extends W{constructor(e){super(),K(this,e,nI,rI,z,{user:0,alt:1,size:2},Zk)}},sy=hd;var eU=require("obsidian");function sI(o){we(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function iI(o){let e,t,r,n,s,i=(o[0].name||"")+"",a,l,c,f,u=(o[0].email||"")+"",d,m,p,x;t=new sy({props:{size:"2.5em",user:o[0]}});let g=o[2].default,_=ae(g,o,o[1],null);return{c(){e=k("div"),R(t.$$.fragment),r=A(),n=k("div"),s=k("div"),a=N(i),l=A(),c=k("br"),f=A(),d=N(u),m=A(),p=k("div"),_&&_.c(),h(s,"class","setting-item-description"),h(n,"class","setting-item-info svelte-zlums1"),ie(n,"display","grid"),h(p,"class","setting-item-control svelte-zlums1"),h(e,"class","setting-item svelte-zlums1")},m(C,L){v(C,e,L),M(t,e,null),S(e,r),S(e,n),S(n,s),S(s,a),S(s,l),S(s,c),S(s,f),S(s,d),S(e,m),S(e,p),_&&_.m(p,null),x=!0},p(C,[L]){let F={};L&1&&(F.user=C[0]),t.$set(F),(!x||L&1)&&i!==(i=(C[0].name||"")+"")&&Z(a,i),(!x||L&1)&&u!==(u=(C[0].email||"")+"")&&Z(d,u),_&&_.p&&(!x||L&2)&&ce(_,g,C,C[1],x?le(g,C[1],L,null):fe(C[1]),null)},i(C){x||(y(t.$$.fragment,C),y(_,C),x=!0)},o(C){w(t.$$.fragment,C),w(_,C),x=!1},d(C){C&&b(e),D(t),_&&_.d(C)}}}function aI(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=i=>{"user"in i&&t(0,s=i.user),"$$scope"in i&&t(1,n=i.$$scope)},[s,n,r]}var gd=class extends W{constructor(e){super(),K(this,e,aI,iI,z,{user:0},sI)}},Ya=gd;var Xa=require("obsidian");function lI(o){we(o,"svelte-1da9go9",".help-container.svelte-1da9go9.svelte-1da9go9{position:relative;display:inline-block}button.svelte-1da9go9.svelte-1da9go9{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-1da9go9.svelte-1da9go9:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-1da9go9.svelte-1da9go9:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.help-container.svelte-1da9go9>.popover.svelte-1da9go9{position:absolute;z-index:70;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.help-container.svelte-1da9go9>.popover.left.svelte-1da9go9{right:100%;margin-right:8px}.help-container.svelte-1da9go9>.popover.right.svelte-1da9go9{left:0}.arrow.svelte-1da9go9.svelte-1da9go9{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-1da9go9.svelte-1da9go9{right:8px}.arrow.right.svelte-1da9go9.svelte-1da9go9{left:8px}p.svelte-1da9go9.svelte-1da9go9{margin:0;color:var(--text-normal)}")}function iy(o){let e,t,r,n,s;return{c(){e=k("div"),t=k("div"),r=A(),n=k("p"),s=N(o[0]),h(t,"class","arrow svelte-1da9go9"),Be(t,"left",o[4]==="left"),Be(t,"right",o[4]==="right"),h(n,"class","svelte-1da9go9"),h(e,"class","popover svelte-1da9go9"),Be(e,"left",o[4]==="left"),Be(e,"right",o[4]==="right")},m(i,a){v(i,e,a),S(e,t),S(e,r),S(e,n),S(n,s),o[9](e)},p(i,a){a&16&&Be(t,"left",i[4]==="left"),a&16&&Be(t,"right",i[4]==="right"),a&1&&Z(s,i[0]),a&16&&Be(e,"left",i[4]==="left"),a&16&&Be(e,"right",i[4]==="right")},d(i){i&&b(e),o[9](null)}}}function cI(o){let e,t,r,n,s,i,a;r=new ai({props:{size:16}});let l=o[1]&&iy(o);return{c(){e=k("div"),t=k("button"),R(r.$$.fragment),n=A(),l&&l.c(),h(t,"type","button"),h(t,"class","svelte-1da9go9"),h(e,"class","help-container svelte-1da9go9")},m(c,f){v(c,e,f),S(e,t),M(r,t,null),o[8](t),S(e,n),l&&l.m(e,null),s=!0,i||(a=[j(t,"mouseenter",o[5]),j(t,"mouseleave",o[6]),j(t,"click",o[7])],i=!0)},p(c,[f]){c[1]?l?l.p(c,f):(l=iy(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(y(r.$$.fragment,c),s=!0)},o(c){w(r.$$.fragment,c),s=!1},d(c){c&&b(e),D(r),o[8](null),l&&l.d(),i=!1,be(a)}}}function fI(o,e,t){let{helpText:r}=e,n=!1,s="right",i,a;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function f(){t(1,n=!n)}function u(m){Jt[m?"unshift":"push"](()=>{i=m,t(2,i)})}function d(m){Jt[m?"unshift":"push"](()=>{a=m,t(3,a)})}return o.$$set=m=>{"helpText"in m&&t(0,r=m.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&i&&a){let m=i.getBoundingClientRect(),p=a.getBoundingClientRect(),x=window.innerWidth;t(4,s=m.right+p.width>x-20?"left":"right")}}},[r,n,i,a,s,l,c,f,u,d]}var yd=class extends W{constructor(e){super(),K(this,e,fI,cI,z,{helpText:0},lI)}},ay=yd;function uI(o){we(o,"svelte-5o4y9d",".setting-item-name.svelte-5o4y9d{display:flex;align-items:center;gap:8px;overflow:unset}.help-button.svelte-5o4y9d{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-5o4y9d:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-5o4y9d:active{color:var(--text-normal)}.help-content.svelte-5o4y9d{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-5o4y9d{margin:0}")}var dI=o=>({}),ly=o=>({}),pI=o=>({}),cy=o=>({}),mI=o=>({}),fy=o=>({});function hI(o){let e;return{c(){e=N(o[0])},m(t,r){v(t,e,r)},p(t,r){r&1&&Z(e,t[0])},d(t){t&&b(e)}}}function uy(o){let e,t,r,n,s=[yI,gI],i=[];function a(l,c){return l[3]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ge()},m(l,c){i[e].m(l,c),v(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(oe(),w(i[f],1,1,()=>{i[f]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),y(t,1),t.m(r.parentNode,r))},i(l){n||(y(t),n=!0)},o(l){w(t),n=!1},d(l){l&&b(r),i[e].d(l)}}}function gI(o){let e,t;return e=new ay({props:{helpText:o[1]}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function yI(o){let e,t,r,n,s;return t=new ai({props:{size:16}}),{c(){e=k("button"),R(t.$$.fragment),h(e,"class","help-button svelte-5o4y9d"),h(e,"aria-expanded",o[2])},m(i,a){v(i,e,a),M(t,e,null),r=!0,n||(s=j(e,"click",o[4]),n=!0)},p(i,a){(!r||a&4)&&h(e,"aria-expanded",i[2])},i(i){r||(y(t.$$.fragment,i),r=!0)},o(i){w(t.$$.fragment,i),r=!1},d(i){i&&b(e),D(t),n=!1,s()}}}function xI(o){let e,t,r=o[7].description,n=ae(r,o,o[6],ly);return{c(){e=k("div"),n&&n.c(),h(e,"class","setting-item-description")},m(s,i){v(s,e,i),n&&n.m(e,null),t=!0},p(s,i){n&&n.p&&(!t||i&64)&&ce(n,r,s,s[6],t?le(r,s[6],i,dI):fe(s[6]),ly)},i(s){t||(y(n,s),t=!0)},o(s){w(n,s),t=!1},d(s){s&&b(e),n&&n.d(s)}}}function dy(o){let e,t,r;return{c(){e=k("div"),t=k("p"),r=N(o[1]),h(t,"class","svelte-5o4y9d"),h(e,"class","help-content svelte-5o4y9d"),Be(e,"expanded",o[2])},m(n,s){v(n,e,s),S(e,t),S(t,r)},p(n,s){s&2&&Z(r,n[1]),s&4&&Be(e,"expanded",n[2])},d(n){n&&b(e)}}}function bI(o){let e,t,r,n,s,i,a,l,c,f=o[7].name,u=ae(f,o,o[6],fy),d=u||hI(o),m=o[1]&&uy(o),p=o[7].description,x=ae(p,o,o[6],cy),g=x||xI(o),_=o[1]&&o[2]&&o[3]&&dy(o),C=o[7].default,L=ae(C,o,o[6],null);return{c(){e=k("div"),t=k("div"),r=k("div"),d&&d.c(),n=A(),m&&m.c(),s=A(),g&&g.c(),i=A(),_&&_.c(),a=A(),l=k("div"),L&&L.c(),h(r,"class","setting-item-name svelte-5o4y9d"),h(t,"class","setting-item-info"),h(l,"class","setting-item-control"),h(e,"class","setting-item setting-item-heading mod-list-item")},m(F,P){v(F,e,P),S(e,t),S(t,r),d&&d.m(r,null),S(r,n),m&&m.m(r,null),S(t,s),g&&g.m(t,null),S(t,i),_&&_.m(t,null),S(e,a),S(e,l),L&&L.m(l,null),c=!0},p(F,[P]){u?u.p&&(!c||P&64)&&ce(u,f,F,F[6],c?le(f,F[6],P,mI):fe(F[6]),fy):d&&d.p&&(!c||P&1)&&d.p(F,c?P:-1),F[1]?m?(m.p(F,P),P&2&&y(m,1)):(m=uy(F),m.c(),y(m,1),m.m(r,null)):m&&(oe(),w(m,1,1,()=>{m=null}),ne()),x?x.p&&(!c||P&64)&&ce(x,p,F,F[6],c?le(p,F[6],P,pI):fe(F[6]),cy):g&&g.p&&(!c||P&64)&&g.p(F,c?P:-1),F[1]&&F[2]&&F[3]?_?_.p(F,P):(_=dy(F),_.c(),_.m(t,null)):_&&(_.d(1),_=null),L&&L.p&&(!c||P&64)&&ce(L,C,F,F[6],c?le(C,F[6],P,null):fe(F[6]),null)},i(F){c||(y(d,F),y(m),y(g,F),y(L,F),c=!0)},o(F){w(d,F),w(m),w(g,F),w(L,F),c=!1},d(F){F&&b(e),d&&d.d(F),m&&m.d(),g&&g.d(F),_&&_.d(),L&&L.d(F)}}}function vI(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:i=""}=e,{helpText:a=void 0}=e,l=!1,c=!1;function f(){c&&t(2,l=!l)}return o.$$set=u=>{"name"in u&&t(0,i=u.name),"helpText"in u&&t(1,a=u.helpText),"$$scope"in u&&t(6,n=u.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,s=Xa.Platform===null||Xa.Platform===void 0?void 0:Xa.Platform.isMobile)!==null&&s!==void 0?s:!1)}},[i,a,l,c,f,s,n,r]}var xd=class extends W{constructor(e){super(),K(this,e,vI,bI,z,{name:0,helpText:1},uI)}},He=xd;var ms=[];function wI(o,e){return{subscribe:he(o,e).subscribe}}function he(o,e=V){let t,r=new Set;function n(a){if(z(o,a)&&(o=a,t)){let l=!ms.length;for(let c of r)c[1](),ms.push(c,o);if(l){for(let c=0;c<ms.length;c+=2)ms[c][0](ms[c+1]);ms.length=0}}}function s(a){n(a(o))}function i(a,l=V){let c=[a,l];return r.add(c),r.size===1&&(t=e(n,s)||V),a(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:i}}function Ot(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return wI(t,(i,a)=>{let l=!1,c=[],f=0,u=V,d=()=>{if(f)return;u();let p=e(r?c[0]:c,i,a);s?i(p):u=Ve(p)?p:V},m=n.map((p,x)=>Lt(p,g=>{c[x]=g,f&=~(1<<x),l&&d()},()=>{f|=1<<x}));return l=!0,d(),function(){be(m),u(),l=!1}})}function _I(o){we(o,"svelte-17e43s7",`.continue.svelte-17e43s7{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-17e43s7{color:var(--text-muted)}.link.svelte-17e43s7:hover{color:var(--text-normal)}.not-working.svelte-17e43s7{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-17e43s7{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-17e43s7:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-17e43s7{height:auto;padding:0}.welcome.svelte-17e43s7{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-17e43s7{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-17e43s7:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-17e43s7:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-17e43s7{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHdpZHRoPSIxOCIgICBoZWlnaHQ9IjE4IiAgIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgICB2ZXJzaW9uPSIxLjEiICAgaWQ9InN2ZzYiICAgc29kaXBvZGk6ZG9jbmFtZT0iZGlzY29yZC5zdmciICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICA8ZGVmcyAgICAgaWQ9ImRlZnMxMCIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJuYW1lZHZpZXc4IiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIgICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiICAgICBzaG93Z3JpZD0iZmFsc2UiICAgICBpbmtzY2FwZTp6b29tPSIyNC4yNSIgICAgIGlua3NjYXBlOmN4PSI0LjM3MTEzNCIgICAgIGlua3NjYXBlOmN5PSIxNC40NTM2MDgiICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDY0IiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTA5NiIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc2IiAvPiAgPGcgICAgIGlkPSJnNCIgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMDg4NzYxMiwwLDAsMS4wNDc4NTU0LC0xMC40NTgyNzYsMzMuNDI2NTI1KSI+ICAgIDxwYXRoICAgICAgIGQ9Ik0gMjE2Ljg1NjM0LDE2LjU5NjYwMyBDIDIwMC4yODUsOC44NDMyODY3IDE4Mi41NjYxNCwzLjIwODQ5ODggMTY0LjA0MTU2LDAgYyAtMi4yNzUwNCw0LjExMzE4MTEgLTQuOTMyOTQsOS42NDU0OTkxIC02Ljc2NTQ2LDE0LjA0NjQzOCAtMTkuNjkyMTEsLTIuOTYxNDQ4IC0zOS4yMDMxMywtMi45NjE0NDggLTU4LjUzMzA4NCwwIEMgOTYuOTEwODQyLDkuNjQ1NDk5MSA5NC4xOTI1ODQsNC4xMTMxODExIDkxLjg5NzE4OSwwIDczLjM1MjYwNywzLjIwODQ5ODggNTUuNjEzMzk1LDguODYzOTkxMiAzOS4wNDIwNTgsMTYuNjM3NjYxIDUuNjE3NTIyOSw2Ny4xNDY1MTQgLTMuNDQzMzE5MSwxMTYuNDAwODEgMS4wODcxMTA3LDE2NC45NTU3MiAyMy4yNTYwMiwxODEuNTEwOTEgNDQuNzQwMzYzLDE5MS41Njc3IDY1Ljg2MjEzMywxOTguMTQ4NTggYyA1LjIxNTA4MiwtNy4xNzc0NSA5Ljg2NjIzLC0xNC44MDcyNSAxMy44NzMwODEsLTIyLjg0ODMyIC03LjYzMTE5NSwtMi44OTk2OSAtMTQuOTQwMjQyLC02LjQ3ODA2IC0yMS44NDY0MjcsLTEwLjYzMjMgMS44MzIxNzQsLTEuMzU3MzcgMy42MjQzNDMsLTIuNzc2NTEgNS4zNTU4MDMsLTQuMjM2NyA0Mi4xMjI4MiwxOS43MDE5MyA4Ny44OTAzNCwxOS43MDE5MyAxMjkuNTA5OTMsMCAxLjc1MTgyLDEuNDYwMTkgMy41NDM2MywyLjg3OTMzIDUuMzU1ODEsNC4yMzY3IC02LjkyNjU0LDQuMTc0NiAtMTQuMjU1NTksNy43NTI5NyAtMjEuODg2NzksMTAuNjUzIDQuMDA2ODUsOC4wMjAzNyA4LjYzOCwxNS42NzA4NyAxMy44NzMwOCwyMi44NDc5NyAyMS4xNDIxMywtNi41ODA4OCA0Mi42NDY0LC0xNi42MzczMSA2NC44MTUzMywtMzMuMjEzMjEgNS4zMTU4LC01Ni4yODc1MiAtOS4wODA4NiwtMTA1LjA4OTQ3NyAtMzguMDU1NjEsLTE0OC4zNTkxMTcgeiBNIDg1LjQ3Mzg3NSwxMzUuMDk0ODkgYyAtMTIuNjQ0ODQ3LDAgLTIzLjAxNDY1MywtMTEuODA0NzMgLTIzLjAxNDY1MywtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODM3MywtMjYuMjAwMzQxIDIzLjAxNDY1MywtMjYuMjAwMzQxIDEyLjg2NjYzMSwwIDIzLjIzNjA4NSwxMS44MDQzODQgMjMuMDE0NjU1LDI2LjIwMDM0MSAwLjAyLDE0LjM3NTI2IC0xMC4xNDgwMjQsMjYuMTc5OTkgLTIzLjAxNDY1NSwyNi4xNzk5OSB6IG0gODUuMDUxMzY1LDAgYyAtMTIuNjQ0ODUsMCAtMjMuMDE0NjYsLTExLjgwNDczIC0yMy4wMTQ2NiwtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODAzLC0yNi4yMDAzNDEgMjMuMDE0NjYsLTI2LjIwMDM0MSAxMi44NjYyOCwwIDIzLjIzNjA4LDExLjgwNDM4NCAyMy4wMTQ2NSwyNi4yMDAzNDEgMCwxNC4zNzUyNiAtMTAuMTQ4MzcsMjYuMTc5OTkgLTIzLjAxNDY1LDI2LjE3OTk5IHoiICAgICAgIGZpbGw9IiM1ODY1ZjIiICAgICAgIGZpbGwtcnVsZT0ibm9uemVybyIgICAgICAgaWQ9InBhdGgyIiAvPiAgPC9nPjwvc3ZnPg==);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.discord-sign-in-button.svelte-17e43s7:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-17e43s7:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-17e43s7{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4gICAgPHRpdGxlPk1pY3Jvc29mdDwvdGl0bGU+ICAgIDxnPiAgICAgICAgPHBvbHlnb24gZmlsbD0iI0YxNTExQiIgcG9pbnRzPSIxMjEuNjY2MDk1IDEyMS42NjYwOTUgMCAxMjEuNjY2MDk1IDAgMCAxMjEuNjY2MDk1IDAiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiM4MENDMjgiIHBvaW50cz0iMjU2IDEyMS42NjYwOTUgMTM0LjMzNTM1NiAxMjEuNjY2MDk1IDEzNC4zMzUzNTYgMCAyNTYgMCIvPiAgICAgICAgPHBvbHlnb24gZmlsbD0iIzAwQURFRiIgcG9pbnRzPSIxMjEuNjYzMTk0IDI1Ni4wMDIxODggMCAyNTYuMDAyMTg4IDAgMTM0LjMzNjA5NSAxMjEuNjYzMTk0IDEzNC4zMzYwOTUiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiNGQkJDMDkiIHBvaW50cz0iMjU2IDI1Ni4wMDIxODggMTM0LjMzNTM1NiAyNTYuMDAyMTg4IDEzNC4zMzUzNTYgMTM0LjMzNjA5NSAyNTYgMTM0LjMzNjA5NSIvPiAgICA8L2c+PC9zdmc+);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.microsoft-sign-in-button.svelte-17e43s7:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-17e43s7:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.login-buttons.svelte-17e43s7{display:flex;flex-direction:column;gap:0.85rem;padding:1rem;background:var(--background-modifier-border-hover);border-radius:0.5rem}.choose-another.svelte-17e43s7{text-align:center;margin-top:0.25rem;margin-bottom:1rem;font-size:0.85em;color:var(--text-normal)}`)}function py(o,e,t){let r=o.slice();return r[46]=e[t],r}function my(o,e,t){let r=o.slice();return r[46]=e[t],r}function SI(o){let e,t,r,n,s,i,a,l;t=new ey({});function c(g,_){return g[5]?CI:II}let f=c(o,[-1,-1]),u=f(o);function d(g,_){if(g[9])return PI;if(g[7])return AI}let m=d(o,[-1,-1]),p=m&&m(o),x=o[3].provider&&!o[7]&&xy(o);return a=new oy({props:{isGoogle:!Fe().enableDiscordLogin&&!Fe().enableMicrosoftLogin}}),{c(){e=k("div"),R(t.$$.fragment),r=A(),u.c(),n=A(),p&&p.c(),s=A(),x&&x.c(),i=A(),R(a.$$.fragment),h(e,"class","welcome svelte-17e43s7")},m(g,_){v(g,e,_),M(t,e,null),S(e,r),u.m(e,null),S(e,n),p&&p.m(e,null),v(g,s,_),x&&x.m(g,_),v(g,i,_),M(a,g,_),l=!0},p(g,_){f===(f=c(g,_))&&u?u.p(g,_):(u.d(1),u=f(g),u&&(u.c(),u.m(e,n))),m===(m=d(g,_))&&p?p.p(g,_):(p&&p.d(1),p=m&&m(g),p&&(p.c(),p.m(e,null))),g[3].provider&&!g[7]?x?x.p(g,_):(x=xy(g),x.c(),x.m(i.parentNode,i)):x&&(x.d(1),x=null)},i(g){l||(y(t.$$.fragment,g),y(a.$$.fragment,g),l=!0)},o(g){w(t.$$.fragment,g),w(a.$$.fragment,g),l=!1},d(g){g&&(b(e),b(s),b(i)),D(t),u.d(),p&&p.d(),x&&x.d(g),D(a,g)}}}function kI(o){let e,t,r,n,s,i,a;e=new He({props:{$$slots:{name:[EI],default:[FI]},$$scope:{ctx:o}}}),r=new He({props:{name:"Account"}}),s=new Ya({props:{user:o[4].user,$$slots:{default:[MI]},$$scope:{ctx:o}}});let l=o[29].default,c=ae(l,o,o[37],null);return{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment),n=A(),R(s.$$.fragment),i=A(),c&&c.c()},m(f,u){M(e,f,u),v(f,t,u),M(r,f,u),v(f,n,u),M(s,f,u),v(f,i,u),c&&c.m(f,u),a=!0},p(f,u){let d={};u[1]&64&&(d.$$scope={dirty:u,ctx:f}),e.$set(d);let m={};u[0]&16&&(m.user=f[4].user),u[1]&64&&(m.$$scope={dirty:u,ctx:f}),s.$set(m),c&&c.p&&(!a||u[1]&64)&&ce(c,l,f,f[37],a?le(l,f[37],u,null):fe(f[37]),null)},i(f){a||(y(e.$$.fragment,f),y(r.$$.fragment,f),y(s.$$.fragment,f),y(c,f),a=!0)},o(f){w(e.$$.fragment,f),w(r.$$.fragment,f),w(s.$$.fragment,f),w(c,f),a=!1},d(f){f&&(b(t),b(n),b(i)),D(e,f),D(r,f),D(s,f),c&&c.d(f)}}}function II(o){let e,t=_e(o[6]),r=[];for(let n=0;n<t.length;n+=1)r[n]=hy(py(o,t,n));return{c(){e=k("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"class","login-buttons svelte-17e43s7")},m(n,s){v(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s[0]&134222018){t=_e(n[6]);let i;for(i=0;i<t.length;i+=1){let a=py(n,t,i);r[i]?r[i].p(a,s):(r[i]=hy(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&b(e),qe(r,n)}}}function CI(o){let e,t=_e(o[6]),r=[];for(let n=0;n<t.length;n+=1)r[n]=gy(my(o,t,n));return{c(){e=k("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"class","login-buttons svelte-17e43s7")},m(n,s){v(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s[0]&33558976){t=_e(n[6]);let i;for(i=0;i<t.length;i+=1){let a=my(n,t,i);r[i]?r[i].p(a,s):(r[i]=gy(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&b(e),qe(r,n)}}}function LI(o){let e,t,r=`${hs(o[46])}`,n,s,i;return{c(){e=k("button"),t=N("Sign in with "),n=N(r),h(e,"class",s=Rt(`${o[46]}-sign-in-button`)+" svelte-17e43s7"),e.disabled=i=!0},m(a,l){v(a,e,l),S(e,t),S(e,n)},p(a,l){l[0]&64&&r!==(r=`${hs(a[46])}`)&&Z(n,r),l[0]&64&&s!==(s=Rt(`${a[46]}-sign-in-button`)+" svelte-17e43s7")&&h(e,"class",s)},d(a){a&&b(e)}}}function TI(o){let e,t,r,n=`${hs(o[46])}`,s,i,a,l,c,f,u;return{c(){e=k("a"),t=k("button"),r=N("Sign in with "),s=N(n),l=A(),h(t,"class",i=Rt(`${o[46]}-sign-in-button`)+" svelte-17e43s7"),t.disabled=a=o[7]||!o[1][o[46]],h(e,"href",c=o[1][o[46]].fullAuthUrl),h(e,"target","_blank")},m(d,m){v(d,e,m),S(e,t),S(t,r),S(t,s),S(e,l),f||(u=j(t,"click",o[32]),f=!0)},p(d,m){m[0]&64&&n!==(n=`${hs(d[46])}`)&&Z(s,n),m[0]&64&&i!==(i=Rt(`${d[46]}-sign-in-button`)+" svelte-17e43s7")&&h(t,"class",i),m[0]&194&&a!==(a=d[7]||!d[1][d[46]])&&(t.disabled=a),m[0]&66&&c!==(c=d[1][d[46]].fullAuthUrl)&&h(e,"href",c)},d(d){d&&b(e),f=!1,u()}}}function hy(o){let e;function t(s,i){return s[1][s[46]]?TI:LI}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=ge()},m(s,i){n.m(s,i),v(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&b(e),n.d(s)}}}function gy(o){let e,t,r=`${hs(o[46])}`,n,s,i,a,l;function c(){return o[31](o[46])}return{c(){e=k("button"),t=N("Sign in with "),n=N(r),h(e,"class",s=Rt(`${o[46]}-sign-in-button`)+" svelte-17e43s7"),e.disabled=i=o[7]||!o[8].contains(o[46])},m(f,u){v(f,e,u),S(e,t),S(e,n),a||(l=j(e,"click",function(){Ve((0,Mr.debounce)(c))&&(0,Mr.debounce)(c).apply(this,arguments)}),a=!0)},p(f,u){o=f,u[0]&64&&r!==(r=`${hs(o[46])}`)&&Z(n,r),u[0]&64&&s!==(s=Rt(`${o[46]}-sign-in-button`)+" svelte-17e43s7")&&h(e,"class",s),u[0]&448&&i!==(i=o[7]||!o[8].contains(o[46]))&&(e.disabled=i)},d(f){f&&b(e),a=!1,l()}}}function AI(o){let e,t,r,n,s,i,a,l;return{c(){e=k("div"),t=k("p"),t.textContent="Continue in your browser...",r=A(),n=k("p"),s=N(`Not working?
					`),i=k("button"),i.textContent="(try again)",h(t,"class","continue svelte-17e43s7"),h(i,"class","link link-button svelte-17e43s7"),h(n,"class","not-working svelte-17e43s7")},m(c,f){v(c,e,f),S(e,t),S(e,r),S(e,n),S(n,s),S(n,i),a||(l=j(i,"click",o[35]),a=!0)},p:V,d(c){c&&b(e),a=!1,l()}}}function PI(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[10]&&yy(o);return{c(){e=k("p"),t=N(o[9]),r=N("."),n=k("br"),s=A(),d&&d.c(),i=A(),a=k("p"),l=N(`Not working?
				`),c=k("button"),c.textContent="(try again)",h(c,"class","link link-button svelte-17e43s7"),h(a,"class","not-working svelte-17e43s7")},m(m,p){v(m,e,p),S(e,t),S(e,r),S(e,n),S(e,s),d&&d.m(e,null),v(m,i,p),v(m,a,p),S(a,l),S(a,c),f||(u=j(c,"click",o[34]),f=!0)},p(m,p){p[0]&512&&Z(t,m[9]),m[10]?d?d.p(m,p):(d=yy(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},d(m){m&&(b(e),b(i),b(a)),d&&d.d(),f=!1,u()}}}function yy(o){let e,t,r,n;return{c(){e=N("Already logged in? "),t=k("button"),t.textContent="(click here)",h(t,"class","link link-button svelte-17e43s7")},m(s,i){v(s,e,i),v(s,t,i),r||(n=j(t,"click",function(){Ve((0,Mr.debounce)(o[33]))&&(0,Mr.debounce)(o[33]).apply(this,arguments)}),r=!0)},p(s,i){o=s},d(s){s&&(b(e),b(t)),r=!1,n()}}}function xy(o){let e,t,r,n;return{c(){e=k("p"),t=k("button"),t.textContent="(choose another provider)",h(t,"class","link link-button svelte-17e43s7"),h(e,"class","choose-another svelte-17e43s7")},m(s,i){v(s,e,i),S(e,t),r||(n=j(t,"click",(0,Mr.debounce)(o[36])),r=!0)},p:V,d(s){s&&b(e),r=!1,n()}}}function FI(o){let e,t;return e=new Zg({}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function EI(o){let e,t;return e=new Ga({props:{slot:"name"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p:V,i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function MI(o){let e,t,r;return{c(){e=k("button"),e.textContent="Logout"},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,Mr.debounce)(o[30])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function DI(o){let e,t,r,n,s=[kI,SI],i=[];function a(l,c){return l[4].hasUser&&l[4].user?0:1}return e=a(o,[-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=ge()},m(l,c){i[e].m(l,c),v(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(oe(),w(i[f],1,1,()=>{i[f]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),y(t,1),t.m(r.parentNode,r))},i(l){n||(y(t),n=!0)},o(l){w(t),n=!1},d(l){l&&b(r),i[e].d(l)}}}function hs(o){return o?o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():""}function RI(o,e,t){let r,n,s,i,a,l,c=V,f=()=>(c(),c=Lt(F,ve=>t(4,l=ve)),F),u,d,m,p,x,g;o.$$.on_destroy.push(()=>c());let{$$slots:_={},$$scope:C}=e,{plugin:L}=e,F,P=he(!Mr.Platform.isIosApp);se(o,P,ve=>t(5,u=ve));let $=he(!1);se(o,$,ve=>t(7,m=ve)),f(F=L.loginManager);let I=he(!1);se(o,I,ve=>t(10,g=ve));let T=he(!1),O=he(!0);se(o,O,ve=>t(39,s=ve));let G=he("");se(o,G,ve=>t(2,r=ve));let J=pt.getInstance();se(o,J,ve=>t(40,i=ve));let q={},E=he(!1),H=F.loginSettings;se(o,H,ve=>t(3,a=ve));let ue=Ot([G,J],()=>{let ve=["google"];return i.getFlag("enableMicrosoftLogin")&&ve.push("microsoft"),i.getFlag("enableDiscordLogin")&&ve.push("discord"),ve});se(o,ue,ve=>t(38,n=ve));let ye=Ot([G,F.loginSettings,J],()=>{if(a&&a.provider)return[a.provider];if(r!=="")return[r];let ve=["google"];return i.getFlag("enableMicrosoftLogin")&&ve.push("microsoft"),i.getFlag("enableDiscordLogin")&&ve.push("discord"),ve});se(o,ye,ve=>t(6,d=ve));function de(){F.clearPreferredProvider(),G.set(""),Re()}let ee=Ot([G,L.loginSettings,J,E],()=>r?[r]:Object.keys(q));se(o,ee,ve=>t(8,p=ve));let Ie,B=he("");se(o,B,ve=>t(9,x=ve));function U(){return Ne(this,void 0,void 0,function*(){L.loginManager.logout(),T.set(!1),$.set(!1),G.set(""),I.set(!1)})}function me(){return Ne(this,arguments,void 0,function*(ve="google"){try{G.set(ve),(yield L.loginManager.login(ve))&&T.set(!0)}catch(ot){P.set(!1),T.set(!1);let Ht=q[ve];Ht&&(window.open(Ht.fullAuthUrl,"_blank"),Oe(ve))}})}let Y=he(L.loginManager.pb);function ke(){Y.set(L.loginManager.pb)}function Re(){try{let ve=s?lt:fetch;F.initiateManualOAuth2CodeFlow(ve,n).then(ot=>{t(1,q=ot),E.set(!0)}).catch(ot=>{let Ht=ot.message;throw Ht=Ht,B.set(Ht),T.set(!1),G.set(""),ot})}catch(ve){B.set(ve.message)}}$t(()=>{T.set(!1),Re()});function Oe(){return Ne(this,arguments,void 0,function*(ve="google"){let ot=q[ve];if(ot)return G.set(ve),yield L.loginManager.poll(ot).then(Ht=>{T.set(!0),$.set(!1),B.set("")}).catch(Ht=>{I.set(!0),$.set(!1),T.set(!1),B.set(Ht.message)})})}function xe(ve){let ot=ve.target;ot.focus(),ot.select(),navigator.clipboard.writeText(ot.value).then(()=>new Mr.Notice("Invite link copied")).catch(Ht=>{}),Oe(r)}let gt=()=>{U()},it=async ve=>{$.set(!0),await me(ve)},rt=()=>{$.set(!0),Oe()},xt=()=>{Oe(r||"google")},bs=()=>{$.set(!1),P.set(!1),B.set(""),G.set(""),E.set(!1),Re()},Jo=()=>{$.set(!1),P.set(!1),B.set(""),G.set("")},vs=()=>{de()};return o.$$set=ve=>{"plugin"in ve&&t(28,L=ve.plugin),"$$scope"in ve&&t(37,C=ve.$$scope)},[F,q,r,a,l,u,d,m,p,x,g,P,$,I,O,G,J,E,H,ue,ye,de,ee,B,U,me,Re,Oe,L,_,gt,it,rt,xt,bs,Jo,vs,C]}var bd=class extends W{constructor(e){super(),K(this,e,RI,DI,z,{plugin:28},_I,[-1,-1])}},by=bd;function vy(o,e,t){let r=o.slice();return r[5]=e[t],r}var $I=o=>({}),wy=o=>({}),OI=o=>({}),_y=o=>({});function UI(o){let e;return{c(){e=N(o[0])},m(t,r){v(t,e,r)},p(t,r){r&1&&Z(e,t[0])},d(t){t&&b(e)}}}function BI(o){let e,t=_e(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Sy(vy(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ge()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);v(n,e,s)},p(n,s){if(s&2){t=_e(n[1]);let i;for(i=0;i<t.length;i+=1){let a=vy(n,t,i);r[i]?r[i].p(a,s):(r[i]=Sy(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&b(e),qe(r,n)}}}function Sy(o){let e;return{c(){e=k("div"),e.textContent=`${o[5]} `},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function NI(o){let e,t=o[1].length>0&&BI(o);return{c(){t&&t.c(),e=ge()},m(r,n){t&&t.m(r,n),v(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&b(e),t&&t.d(r)}}}function HI(o){let e,t,r,n,s,i,a,l,c=o[4].name,f=ae(c,o,o[3],_y),u=f||UI(o),d=o[4].description,m=ae(d,o,o[3],wy),p=m||NI(o),x=o[4].default,g=ae(x,o,o[3],null);return{c(){e=k("div"),t=k("div"),r=k("div"),u&&u.c(),n=A(),s=k("div"),p&&p.c(),i=A(),a=k("div"),g&&g.c(),h(r,"class","setting-item-name"),ie(r,"display","grid"),ie(r,"align-items","center"),h(s,"class","setting-item-description"),h(t,"class","setting-item-info"),ie(t,"display","grid"),h(a,"class","setting-item-control"),h(e,"class","setting-item")},m(_,C){v(_,e,C),S(e,t),S(t,r),u&&u.m(r,null),S(t,n),S(t,s),p&&p.m(s,null),S(e,i),S(e,a),g&&g.m(a,null),l=!0},p(_,[C]){f?f.p&&(!l||C&8)&&ce(f,c,_,_[3],l?le(c,_[3],C,OI):fe(_[3]),_y):u&&u.p&&(!l||C&1)&&u.p(_,l?C:-1),m&&m.p&&(!l||C&8)&&ce(m,d,_,_[3],l?le(d,_[3],C,$I):fe(_[3]),wy),g&&g.p&&(!l||C&8)&&ce(g,x,_,_[3],l?le(x,_[3],C,null):fe(_[3]),null)},i(_){l||(y(u,_),y(p,_),y(g,_),l=!0)},o(_){w(u,_),w(p,_),w(g,_),l=!1},d(_){_&&b(e),u&&u.d(_),p&&p.d(_),g&&g.d(_)}}}function VI(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i}=e,a=i!==void 0?i.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,i=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,a,i,n,r]}var vd=class extends W{constructor(e){super(),K(this,e,VI,HI,z,{name:0,description:2})}},De=vd;function qI(o){we(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var zI=o=>({}),ky=o=>({}),WI=o=>({}),Iy=o=>({});function jI(o){let e;return{c(){e=N(o[0])},m(t,r){v(t,e,r)},p(t,r){r&1&&Z(e,t[0])},d(t){t&&b(e)}}}function Cy(o){let e,t;return{c(){e=k("div"),t=N(o[1]),h(e,"class","setting-item-description")},m(r,n){v(r,e,n),S(e,t)},p(r,n){n&2&&Z(t,r[1])},d(r){r&&b(e)}}}function KI(o){let e,t=o[1]&&Cy(o);return{c(){t&&t.c(),e=ge()},m(r,n){t&&t.m(r,n),v(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=Cy(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&b(e),t&&t.d(r)}}}function GI(o){let e,t,r,n,s,i,a,l=o[3].name,c=ae(l,o,o[2],Iy),f=c||jI(o),u=o[3].description,d=ae(u,o,o[2],ky),m=d||KI(o),p=o[3].default,x=ae(p,o,o[2],null);return{c(){e=k("div"),t=k("div"),r=k("div"),f&&f.c(),n=A(),m&&m.c(),s=A(),i=k("div"),x&&x.c(),h(r,"class","setting-item-name truncate svelte-11hpkul"),h(t,"class","setting-item-info svelte-11hpkul"),h(i,"class","setting-item-control svelte-11hpkul"),h(e,"class","setting-item mod-list-item svelte-11hpkul")},m(g,_){v(g,e,_),S(e,t),S(t,r),f&&f.m(r,null),S(t,n),m&&m.m(t,null),S(e,s),S(e,i),x&&x.m(i,null),a=!0},p(g,[_]){c?c.p&&(!a||_&4)&&ce(c,l,g,g[2],a?le(l,g[2],_,WI):fe(g[2]),Iy):f&&f.p&&(!a||_&1)&&f.p(g,a?_:-1),d?d.p&&(!a||_&4)&&ce(d,u,g,g[2],a?le(u,g[2],_,zI):fe(g[2]),ky):m&&m.p&&(!a||_&2)&&m.p(g,a?_:-1),x&&x.p&&(!a||_&4)&&ce(x,p,g,g[2],a?le(p,g[2],_,null):fe(g[2]),null)},i(g){a||(y(f,g),y(m,g),y(x,g),a=!0)},o(g){w(f,g),w(m,g),w(x,g),a=!1},d(g){g&&b(e),f&&f.d(g),m&&m.d(g),x&&x.d(g)}}}function JI(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"description"in a&&t(1,i=a.description),"$$scope"in a&&t(2,n=a.$$scope)},[s,i,n,r]}var wd=class extends W{constructor(e){super(),K(this,e,JI,GI,z,{name:0,description:1},qI)}},ct=wd;function QI(o){we(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function YI(o){let e,t,r,n,s;return t=new Su({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=k("div"),R(t.$$.fragment),h(e,"class","clickable-icon extra-setting-button svelte-y529x8"),h(e,"aria-label","Options"),h(e,"role","button"),h(e,"tabindex","0")},m(i,a){v(i,e,a),M(t,e,null),r=!0,n||(s=[j(e,"click",o[0]),j(e,"keydown",o[0])],n=!0)},p:V,i(i){r||(y(t.$$.fragment,i),r=!0)},o(i){w(t.$$.fragment,i),r=!1},d(i){i&&b(e),D(t),n=!1,be(s)}}}function XI(o){let e=ht();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var _d=class extends W{constructor(e){super(),K(this,e,XI,YI,z,{},QI)}},xn=_d;function ZI(o){let e,t,r,n,s,i;t=new gn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let a=o[3].default,l=ae(a,o,o[2],null);return{c(){e=k("span"),R(t.$$.fragment),r=A(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ie(e,"display","flex"),ie(e,"align-items","center"),ie(e,"width","100%")},m(c,f){v(c,e,f),M(t,e,null),S(e,r),l&&l.m(e,null),n=!0,s||(i=[j(e,"keypress",o[0]),j(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&4)&&ce(l,a,c,c[2],n?le(a,c[2],f,null):fe(c[2]),null)},i(c){n||(y(t.$$.fragment,c),y(l,c),n=!0)},o(c){w(t.$$.fragment,c),w(l,c),n=!1},d(c){c&&b(e),D(t),l&&l.d(c),s=!1,be(i)}}}function eC(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,i=ht();function a(){s&&i("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var Sd=class extends W{constructor(e){super(),K(this,e,eC,ZI,z,{relay:1})}},bo=Sd;function tC(o){let e,t,r,n,s,i;t=new au({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let a=o[3].default,l=ae(a,o,o[2],null);return{c(){e=k("span"),R(t.$$.fragment),r=A(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ie(e,"display","inline-flex"),ie(e,"align-items","center"),ie(e,"width","100%")},m(c,f){v(c,e,f),M(t,e,null),S(e,r),l&&l.m(e,null),n=!0,s||(i=[j(e,"keypress",o[0]),j(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&4)&&ce(l,a,c,c[2],n?le(a,c[2],f,null):fe(c[2]),null)},i(c){n||(y(t.$$.fragment,c),y(l,c),n=!0)},o(c){w(t.$$.fragment,c),w(l,c),n=!1},d(c){c&&b(e),D(t),l&&l.d(c),s=!1,be(i)}}}function rC(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,i=ht();function a(){var l;s&&i("manageSharedFolder",{folder:s,relay:(l=s.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,s=l.folder),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var kd=class extends W{constructor(e){super(),K(this,e,rC,tC,z,{folder:1})}},Kr=kd;function oC(o){let e,t=o[0].name+"",r;return{c(){e=k("span"),r=N(t),ie(e,"overflow","hidden"),ie(e,"text-overflow","ellipsis"),ie(e,"white-space","nowrap")},m(n,s){v(n,e,s),S(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&Z(r,t)},d(n){n&&b(e)}}}function Ly(o){let e,t,r,n,s;return t=new Wf({props:{size:16,class:"svg-icon"}}),n=new bo({props:{relay:o[1],$$slots:{default:[nC]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=k("span"),R(t.$$.fragment),r=A(),R(n.$$.fragment),ie(e,"width","16px"),ie(e,"flex-shrink","0"),ie(e,"display","flex"),ie(e,"justify-content","center")},m(i,a){v(i,e,a),M(t,e,null),v(i,r,a),M(n,i,a),s=!0},p(i,a){let l={};a&2&&(l.relay=i[1]),a&17&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){s||(y(t.$$.fragment,i),y(n.$$.fragment,i),s=!0)},o(i){w(t.$$.fragment,i),w(n.$$.fragment,i),s=!1},d(i){i&&(b(e),b(r)),D(t),D(n,i)}}}function nC(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=k("span"),r=N(t),ie(e,"flex","1"),ie(e,"min-width","0"),ie(e,"text-overflow","ellipsis"),ie(e,"white-space","nowrap")},m(n,s){v(n,e,s),S(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&Z(r,t)},d(n){n&&b(e)}}}function sC(o){let e,t,r,n,s;r=new Kr({props:{folder:o[0],$$slots:{default:[oC]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let i=o[0].remote&&Ly(o);return{c(){e=k("span"),t=k("span"),R(r.$$.fragment),n=A(),i&&i.c(),ie(t,"display","inline-flex"),ie(t,"align-items","center"),ie(t,"width","200px"),ie(t,"min-width","200px"),ie(t,"flex-shrink","0"),ie(e,"display","inline-flex"),ie(e,"align-items","center"),ie(e,"width","100%"),ie(e,"gap","8px")},m(a,l){v(a,e,l),S(e,t),M(r,t,null),S(e,n),i&&i.m(e,null),s=!0},p(a,[l]){let c={};l&1&&(c.folder=a[0]),l&17&&(c.$$scope={dirty:l,ctx:a}),r.$set(c),a[0].remote?i?(i.p(a,l),l&1&&y(i,1)):(i=Ly(a),i.c(),y(i,1),i.m(e,null)):i&&(oe(),w(i,1,1,()=>{i=null}),ne())},i(a){s||(y(r.$$.fragment,a),y(i),s=!0)},o(a){w(r.$$.fragment,a),w(i),s=!1},d(a){a&&b(e),D(r),i&&i.d()}}}function iC(o,e,t){let{folder:r}=e,{relay:n}=e;function s(a){vr.call(this,o,a)}function i(a){vr.call(this,o,a)}return o.$$set=a=>{"folder"in a&&t(0,r=a.folder),"relay"in a&&t(1,n=a.relay)},[r,n,s,i]}var Id=class extends W{constructor(e){super(),K(this,e,iC,sC,z,{folder:0,relay:1})}},Ty=Id;var wr=require("obsidian");var Gr=require("obsidian");function aC(o){we(o,"svelte-1fe7ajn",".input-with-icon.svelte-1fe7ajn{position:relative;width:100%}.secret-text-toggle-icon.svelte-1fe7ajn{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.secret-text-toggle-icon.svelte-1fe7ajn:hover{background-color:var(--background-modifier-hover)}.system3-secret-text.svelte-1fe7ajn{padding-inline-end:28px !important;font-family:monospace !important}.system3-input-invalid.svelte-1fe7ajn{border:1px solid var(--color-red) !important}")}function lC(o){let e,t,r,n;return{c(){e=k("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","password"),e.readOnly=o[3],h(e,"class",t=Rt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){v(s,e,i),r||(n=[j(e,"click",function(){Ve(o[4]?(0,Gr.debounce)(o[12]):null)&&(o[4]?(0,Gr.debounce)(o[12]):null).apply(this,arguments)}),j(e,"input",o[15]),j(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=Rt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&b(e),r=!1,be(n)}}}function cC(o){let e,t,r,n;return{c(){e=k("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","text"),e.readOnly=o[3],h(e,"class",t=Rt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){v(s,e,i),r||(n=[j(e,"click",function(){Ve(o[4]?(0,Gr.debounce)(o[12]):null)&&(o[4]?(0,Gr.debounce)(o[12]):null).apply(this,arguments)}),j(e,"input",o[14]),j(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=Rt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&b(e),r=!1,be(n)}}}function fC(o){let e,t,r,n,s,i,a;function l(u,d){return u[6]?cC:lC}let c=l(o,-1),f=c(o);return{c(){e=k("div"),f.c(),t=A(),r=k("div"),h(r,"class","secret-text-toggle-icon svelte-1fe7ajn"),h(r,"role","button"),h(r,"tabindex","0"),h(r,"aria-label",n=o[6]?"Hide text":"Show text"),h(e,"class","input-with-icon svelte-1fe7ajn")},m(u,d){v(u,e,d),f.m(e,null),S(e,t),S(e,r),i||(a=[Ta(s=o[11].call(null,r)),j(r,"click",o[16]),j(r,"keypress",o[17])],i=!0)},p(u,[d]){c===(c=l(u,d))&&f?f.p(u,d):(f.d(1),f=c(u),f&&(f.c(),f.m(e,t))),d&64&&n!==(n=u[6]?"Hide text":"Show text")&&h(r,"aria-label",n)},i:V,o:V,d(u){u&&b(e),f.d(),i=!1,be(a)}}}function uC(o,e,t){let r,n,s=ht(),{value:i}=e,{disabled:a=!1}=e,{placeholder:l="please wait..."}=e,{readonly:c=!0}=e,{copyOnClick:f=!0}=e,{successMessage:u="Copied to clipboard"}=e,{invalid:d=!1}=e,m=he(!1);se(o,m,I=>t(6,r=I));let p=he(!1);se(o,p,I=>t(19,n=I));let x;function g(I){I.key==="Enter"&&!a&&s("enter")}function _(I){x=I;let T=()=>{n?((0,Gr.setIcon)(I,"clipboard-check"),I.addClass("mod-success")):((0,Gr.setIcon)(I,r?"eye-off":"eye"),I.removeClass("mod-success"))},O=m.subscribe(()=>{T()}),G=p.subscribe(()=>{T()});return T(),{destroy(){O(),G()}}}function C(I){!f||!i||a||navigator.clipboard.writeText(i).then(()=>{new Gr.Notice(u),p.set(!0),setTimeout(()=>{p.set(!1)},800)}).catch(T=>{console.error("Failed to copy: ",T)})}let L=I=>{t(0,i=I.currentTarget.value),s("input",I)},F=I=>{t(0,i=I.currentTarget.value),s("input",I)},P=()=>m.update(I=>!I),$=()=>m.update(I=>!I);return o.$$set=I=>{"value"in I&&t(0,i=I.value),"disabled"in I&&t(1,a=I.disabled),"placeholder"in I&&t(2,l=I.placeholder),"readonly"in I&&t(3,c=I.readonly),"copyOnClick"in I&&t(4,f=I.copyOnClick),"successMessage"in I&&t(13,u=I.successMessage),"invalid"in I&&t(5,d=I.invalid)},[i,a,l,c,f,d,r,s,m,p,g,_,C,u,L,F,P,$]}var Cd=class extends W{constructor(e){super(),K(this,e,uC,fC,z,{value:0,disabled:1,placeholder:2,readonly:3,copyOnClick:4,successMessage:13,invalid:5},aC)}},Za=Cd;var Ld=require("obsidian");function dC(o){we(o,"svelte-zmx7zz","span.faint.svelte-zmx7zz{color:var(--text-faint)}div.spacer.svelte-zmx7zz{height:3em}")}function Ay(o,e,t){let r=o.slice();return r[30]=e[t],r}function Py(o,e,t){let r=o.slice();return r[33]=e[t],r[34]=e,r[35]=t,r}function Fy(o,e,t){let r=o.slice();return r[36]=e[t],r}function Ey(o,e,t){let r=o.slice();return r[39]=e[t],r}function pC(o){let e,t,r,n,s,i,a,l;function c(u){o[18](u)}let f={disabled:o[6],placeholder:"Enter share key",readonly:!1,copyOnClick:!1,invalid:o[5]};return o[4]!==void 0&&(f.value=o[4]),e=new Za({props:f}),Jt.push(()=>Tg(e,"value",c)),e.$on("input",o[15]),e.$on("enter",function(){Ve((0,wr.debounce)(o[19]))&&(0,wr.debounce)(o[19]).apply(this,arguments)}),{c(){R(e.$$.fragment),r=A(),n=k("button"),s=N("Join"),h(n,"class","mod-cta"),n.disabled=o[6]},m(u,d){M(e,u,d),v(u,r,d),v(u,n,d),S(n,s),i=!0,a||(l=j(n,"click",function(){Ve((0,wr.debounce)(o[20]))&&(0,wr.debounce)(o[20]).apply(this,arguments)}),a=!0)},p(u,d){o=u;let m={};d[0]&64&&(m.disabled=o[6]),d[0]&32&&(m.invalid=o[5]),!t&&d[0]&16&&(t=!0,m.value=o[4],kg(()=>t=!1)),e.$set(m),(!i||d[0]&64)&&(n.disabled=o[6])},i(u){i||(y(e.$$.fragment,u),i=!0)},o(u){w(e.$$.fragment,u),i=!1},d(u){u&&(b(r),b(n)),D(e,u),a=!1,l()}}}function mC(o){let e;return{c(){e=k("span"),e.textContent="Relay Servers",h(e,"slot","name"),ie(e,"display","inline-flex"),ie(e,"align-items","center")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function hC(o){let e,t;function r(){return o[22](o[39])}return e=new xn({}),e.$on("settings",r),{c(){R(e.$$.fragment)},m(n,s){M(e,n,s),t=!0},p(n,s){o=n},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function gC(o){let e;return{c(){e=k("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function yC(o){let e=o[39].name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[39].name+"")&&Z(t,e)},d(r){r&&b(t)}}}function xC(o){let e;function t(s,i){return s[39].name?yC:gC}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=ge()},m(s,i){n.m(s,i),v(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&b(e),n.d(s)}}}function bC(o){let e,t;return e=new bo({props:{slot:"name",relay:o[39],$$slots:{default:[xC]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[39]),n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function My(o){let e,t;return e=new ct({props:{$$slots:{name:[bC],default:[hC]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function vC(o){let e,t,r;return{c(){e=k("button"),e.textContent="Create",h(e,"class","mod-cta")},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,wr.debounce)(o[23])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function Dy(o){let e,t;return e=new De({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function wC(o){let e,t;function r(){return o[26](o[36])}return e=new xn({}),e.$on("settings",function(){Ve((0,wr.debounce)(r))&&(0,wr.debounce)(r).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(n,s){M(e,n,s),t=!0},p(n,s){o=n},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function _C(o){var r;let e,t;return e=new Ty({props:{folder:o[36],relay:(r=o[36].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[24]),e.$on("manageSharedFolder",o[25]),{c(){R(e.$$.fragment)},m(n,s){M(e,n,s),t=!0},p(n,s){var a;let i={};s[0]&256&&(i.folder=n[36]),s[0]&256&&(i.relay=(a=n[36].remote)==null?void 0:a.relay),e.$set(i)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ry(o){let e,t;return e=new ct({props:{$$slots:{name:[_C],default:[wC]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&384|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function $y(o){let e,t,r,n,s,i;r=new He({props:{name:"Subscriptions",helpText:"Subscriptions are tied to each Relay Server, not to your user account. Modify and cancel your subscription via our payment processor Stripe."}});let a=_e(o[9].values()),l=[];for(let f=0;f<a.length;f+=1)l[f]=Oy(Py(o,a,f));let c=f=>w(l[f],1,1,()=>{l[f]=null});return{c(){e=k("div"),t=A(),R(r.$$.fragment),n=A();for(let f=0;f<l.length;f+=1)l[f].c();s=ge(),h(e,"class","spacer svelte-zmx7zz")},m(f,u){v(f,e,u),v(f,t,u),M(r,f,u),v(f,n,u);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(f,u);v(f,s,u),i=!0},p(f,u){if(u[0]&8705){a=_e(f[9].values());let d;for(d=0;d<a.length;d+=1){let m=Py(f,a,d);l[d]?(l[d].p(m,u),y(l[d],1)):(l[d]=Oy(m),l[d].c(),y(l[d],1),l[d].m(s.parentNode,s))}for(oe(),d=a.length;d<l.length;d+=1)c(d);ne()}},i(f){if(!i){y(r.$$.fragment,f);for(let u=0;u<a.length;u+=1)y(l[u]);i=!0}},o(f){w(r.$$.fragment,f),l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)w(l[u]);i=!1},d(f){f&&(b(e),b(t),b(n),b(s)),D(r,f),qe(l,f)}}}function SC(o){let e,t,r,n;function s(){return o[28](o[33],o[34],o[35])}return{c(){e=k("button"),e.textContent="Manage",t=A()},m(i,a){v(i,e,a),v(i,t,a),r||(n=j(e,"click",function(){Ve((0,wr.debounce)(s))&&(0,wr.debounce)(s).apply(this,arguments)}),r=!0)},p(i,a){o=i},d(i){i&&(b(e),b(t)),r=!1,n()}}}function kC(o){let e;return{c(){e=k("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function IC(o){let e=o[33].relay.name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[33].relay.name+"")&&Z(t,e)},d(r){r&&b(t)}}}function CC(o){let e;function t(s,i){return s[33].relay.name?IC:kC}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=A()},m(s,i){n.m(s,i),v(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&b(e),n.d(s)}}}function LC(o){let e,t;return e=new bo({props:{slot:"name",relay:o[33].relay,$$slots:{default:[CC]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[27]),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.relay=r[33].relay),n[0]&512|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Oy(o){let e,t;return e=new ct({props:{name:"",description:o[33].cancelAt?o[13](o[33].cancelAt):"",$$slots:{name:[LC],default:[SC]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.description=r[33].cancelAt?r[13](r[33].cancelAt):""),n[0]&513|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function TC(o){let e,t,r=o[10].values().length===0,n,s,i;e=new He({props:{name:"Hosts",helpText:"Manage self-hosted Relay Servers"}});let a=r&&Uy(o),l=_e(o[10].values()),c=[];for(let u=0;u<l.length;u+=1)c[u]=By(Ay(o,l,u));let f=u=>w(c[u],1,1,()=>{c[u]=null});return{c(){R(e.$$.fragment),t=A(),a&&a.c(),n=A();for(let u=0;u<c.length;u+=1)c[u].c();s=ge()},m(u,d){M(e,u,d),v(u,t,d),a&&a.m(u,d),v(u,n,d);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(u,d);v(u,s,d),i=!0},p(u,d){if(d[0]&1024&&(r=u[10].values().length===0),r?a?d[0]&1024&&y(a,1):(a=Uy(u),a.c(),y(a,1),a.m(n.parentNode,n)):a&&(oe(),w(a,1,1,()=>{a=null}),ne()),d[0]&1024){l=_e(u[10].values());let m;for(m=0;m<l.length;m+=1){let p=Ay(u,l,m);c[m]?(c[m].p(p,d),y(c[m],1)):(c[m]=By(p),c[m].c(),y(c[m],1),c[m].m(s.parentNode,s))}for(oe(),m=l.length;m<c.length;m+=1)f(m);ne()}},i(u){if(!i){y(e.$$.fragment,u),y(a);for(let d=0;d<l.length;d+=1)y(c[d]);i=!0}},o(u){w(e.$$.fragment,u),w(a),c=c.filter(Boolean);for(let d=0;d<c.length;d+=1)w(c[d]);i=!1},d(u){u&&(b(t),b(n),b(s)),D(e,u),a&&a.d(u),qe(c,u)}}}function Uy(o){let e,t;return e=new De({props:{description:"See our documentation for how to host a Relay Server."}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function By(o){var r,n;let e,t;return e=new ct({props:{name:(r=o[30])==null?void 0:r.name,description:(n=o[30])==null?void 0:n.url}}),{c(){R(e.$$.fragment)},m(s,i){M(e,s,i),t=!0},p(s,i){var l,c;let a={};i[0]&1024&&(a.name=(l=s[30])==null?void 0:l.name),i[0]&1024&&(a.description=(c=s[30])==null?void 0:c.url),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function AC(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[8].items().length===0,m,p,x=o[3].values().length>0,g,_=Fe().enableSelfManageHosts,C,L;e=new He({props:{name:"Join a Relay Server"}}),r=new De({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[pC]},$$scope:{ctx:o}}}),s=new He({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[mC]},$$scope:{ctx:o}}});let F=_e(o[7].values().filter(Ny).sort(Hy)),P=[];for(let E=0;E<F.length;E+=1)P[E]=My(Ey(o,F,E));let $=E=>w(P[E],1,1,()=>{P[E]=null});l=new De({props:{name:"",description:"",$$slots:{default:[vC]},$$scope:{ctx:o}}}),f=new He({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let I=d&&Dy(o),T=_e(o[8].items()),O=[];for(let E=0;E<T.length;E+=1)O[E]=Ry(Fy(o,T,E));let G=E=>w(O[E],1,1,()=>{O[E]=null}),J=x&&$y(o),q=_&&TC(o);return{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment),n=A(),R(s.$$.fragment),i=A();for(let E=0;E<P.length;E+=1)P[E].c();a=A(),R(l.$$.fragment),c=A(),R(f.$$.fragment),u=A(),I&&I.c(),m=A();for(let E=0;E<O.length;E+=1)O[E].c();p=A(),J&&J.c(),g=A(),q&&q.c(),C=ge()},m(E,H){M(e,E,H),v(E,t,H),M(r,E,H),v(E,n,H),M(s,E,H),v(E,i,H);for(let ue=0;ue<P.length;ue+=1)P[ue]&&P[ue].m(E,H);v(E,a,H),M(l,E,H),v(E,c,H),M(f,E,H),v(E,u,H),I&&I.m(E,H),v(E,m,H);for(let ue=0;ue<O.length;ue+=1)O[ue]&&O[ue].m(E,H);v(E,p,H),J&&J.m(E,H),v(E,g,H),q&&q.m(E,H),v(E,C,H),L=!0},p(E,H){let ue={};H[0]&112|H[1]&2048&&(ue.$$scope={dirty:H,ctx:E}),r.$set(ue);let ye={};if(H[1]&2048&&(ye.$$scope={dirty:H,ctx:E}),s.$set(ye),H[0]&4224){F=_e(E[7].values().filter(Ny).sort(Hy));let ee;for(ee=0;ee<F.length;ee+=1){let Ie=Ey(E,F,ee);P[ee]?(P[ee].p(Ie,H),y(P[ee],1)):(P[ee]=My(Ie),P[ee].c(),y(P[ee],1),P[ee].m(a.parentNode,a))}for(oe(),ee=F.length;ee<P.length;ee+=1)$(ee);ne()}let de={};if(H[1]&2048&&(de.$$scope={dirty:H,ctx:E}),l.$set(de),H[0]&256&&(d=E[8].items().length===0),d?I?H[0]&256&&y(I,1):(I=Dy(E),I.c(),y(I,1),I.m(m.parentNode,m)):I&&(oe(),w(I,1,1,()=>{I=null}),ne()),H[0]&16768){T=_e(E[8].items());let ee;for(ee=0;ee<T.length;ee+=1){let Ie=Fy(E,T,ee);O[ee]?(O[ee].p(Ie,H),y(O[ee],1)):(O[ee]=Ry(Ie),O[ee].c(),y(O[ee],1),O[ee].m(p.parentNode,p))}for(oe(),ee=T.length;ee<O.length;ee+=1)G(ee);ne()}H[0]&8&&(x=E[3].values().length>0),x?J?(J.p(E,H),H[0]&8&&y(J,1)):(J=$y(E),J.c(),y(J,1),J.m(g.parentNode,g)):J&&(oe(),w(J,1,1,()=>{J=null}),ne()),_&&q.p(E,H)},i(E){if(!L){y(e.$$.fragment,E),y(r.$$.fragment,E),y(s.$$.fragment,E);for(let H=0;H<F.length;H+=1)y(P[H]);y(l.$$.fragment,E),y(f.$$.fragment,E),y(I);for(let H=0;H<T.length;H+=1)y(O[H]);y(J),y(q),L=!0}},o(E){w(e.$$.fragment,E),w(r.$$.fragment,E),w(s.$$.fragment,E),P=P.filter(Boolean);for(let H=0;H<P.length;H+=1)w(P[H]);w(l.$$.fragment,E),w(f.$$.fragment,E),w(I),O=O.filter(Boolean);for(let H=0;H<O.length;H+=1)w(O[H]);w(J),w(q),L=!1},d(E){E&&(b(t),b(n),b(i),b(a),b(c),b(u),b(m),b(p),b(g),b(C)),D(e,E),D(r,E),D(s,E),qe(P,E),D(l,E),D(f,E),I&&I.d(E),qe(O,E),J&&J.d(E),q&&q.d(E)}}}function Ny(o){return!!o.acl}function Hy(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function PC(o,e,t){let r,n=V,s=()=>(n(),n=Lt(p,Y=>t(7,r=Y)),p),i,a,l=V,c=()=>(l(),l=Lt(g,Y=>t(9,a=Y)),g),f,u=V,d=()=>(u(),u=Lt(x,Y=>t(10,f=Y)),x);o.$$.on_destroy.push(()=>n()),o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>u());let{plugin:m}=e,{relays:p}=e;s();let{providers:x}=e;d();let{subscriptions:g}=e;c();let _=m.sharedFolders;se(o,_,Y=>t(8,i=Y));let C="",L=!1,F=!1,P=ht();function $(Y){Y&&P("manageRelay",{relay:Y})}function I(Y){if(!Y)return"Active";let ke=Ld.moment.utc(),Re=Ld.moment.utc(Y),Oe=Re.diff(ke,"days");return Oe<=0?"Subscription has ended":Oe===1?"Active for 1 more day":Oe>31?`Ends on ${Re.format("YYYY-MM-DD")}`:`Active for ${Oe} more days`}function T(Y,ke){Y&&P("manageSharedFolder",{folder:Y,relay:ke})}function O(){t(5,L=!1)}function G(Y){return Ne(this,void 0,void 0,function*(){try{t(6,F=!0);let ke=yield m.relayManager.acceptInvitation(Y).catch(Re=>{throw Re.status===429&&new wr.Notice("Slow down"),Re});t(6,F=!1),P("joinRelay",{relay:ke})}catch(ke){t(5,L=!0),t(6,F=!1)}})}function J(){P("createRelay")}function q(Y){C=Y,t(4,C)}let E=()=>G(C),H=()=>G(C);function ue(Y){vr.call(this,o,Y)}let ye=Y=>{$(Y)},de=()=>J();function ee(Y){vr.call(this,o,Y)}function Ie(Y){vr.call(this,o,Y)}let B=Y=>{let ke=r.values().find(Re=>{var Oe;return((Oe=Y.remote)==null?void 0:Oe.relay.guid)===Re.guid});T(Y,ke)};function U(Y){vr.call(this,o,Y)}let me=async(Y,ke,Re)=>{if(!Y.token){let gt=await m.relayManager.getSubscriptionToken(Y);La(g,ke[Re].token=gt,a)}let Oe=Y.id,xe=Y.token;window.open(m.buildApiUrl(`/subscriptions/${Oe}/manage?token=${xe}`),"_blank")};return o.$$set=Y=>{"plugin"in Y&&t(0,m=Y.plugin),"relays"in Y&&s(t(1,p=Y.relays)),"providers"in Y&&d(t(2,x=Y.providers)),"subscriptions"in Y&&c(t(3,g=Y.subscriptions))},[m,p,x,g,C,L,F,r,i,a,f,_,$,I,T,O,G,J,q,E,H,ue,ye,de,ee,Ie,B,U,me]}var Td=class extends W{constructor(e){super(),K(this,e,PC,AC,z,{plugin:0,relays:1,providers:2,subscriptions:3},dC,[-1,-1])}},Jr=Td;var et=require("obsidian");var yx=_n(ks());function FC(o){we(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function EC(o){let e,t,r;return t=new du({props:{class:"svg-icon"}}),{c(){e=k("span"),R(t.$$.fragment),h(e,"class","lock-icon svelte-15ov1wm")},m(n,s){v(n,e,s),M(t,e,null),r=!0},p:V,i(n){r||(y(t.$$.fragment,n),r=!0)},o(n){w(t.$$.fragment,n),r=!1},d(n){n&&b(e),D(t)}}}var Ad=class extends W{constructor(e){super(),K(this,e,null,EC,z,{},FC)}},el=Ad;function MC(o){let e,t,r,n,s,i,a,l,c;n=new Zf({props:{size:16}});let f=o[3].default,u=ae(f,o,o[4],null);return{c(){e=k("span"),t=N(o[1]),r=A(),R(n.$$.fragment),s=A(),i=k("span"),u&&u.c(),h(e,"tabindex","0"),h(e,"role","button"),ie(i,"flex","1"),ie(i,"min-width","0"),ie(i,"text-overflow","ellipsis"),ie(i,"white-space","nowrap"),ie(i,"overflow","hidden")},m(d,m){v(d,e,m),S(e,t),v(d,r,m),M(n,d,m),v(d,s,m),v(d,i,m),u&&u.m(i,null),a=!0,l||(c=[j(e,"click",o[2]),j(e,"keypress",o[2])],l=!0)},p(d,m){(!a||m&2)&&Z(t,d[1]),u&&u.p&&(!a||m&16)&&ce(u,f,d,d[4],a?le(f,d[4],m,null):fe(d[4]),null)},i(d){a||(y(n.$$.fragment,d),y(u,d),a=!0)},o(d){w(n.$$.fragment,d),w(u,d),a=!1},d(d){d&&(b(e),b(r),b(s),b(i)),D(n,d),u&&u.d(d),l=!1,be(c)}}}function DC(o){let e,t,r;var n=o[0];function s(i,a){return{props:{$$slots:{default:[MC]},$$scope:{ctx:i}}}}return n&&(t=is(n,s(o))),{c(){e=k("h4"),t&&R(t.$$.fragment)},m(i,a){v(i,e,a),t&&M(t,e,null),r=!0},p(i,[a]){if(a&1&&n!==(n=i[0])){if(t){oe();let l=t;w(l.$$.fragment,1,0,()=>{D(l,1)}),ne()}n?(t=is(n,s(i,a)),R(t.$$.fragment),y(t.$$.fragment,1),M(t,e,null)):t=null}else if(n){let l={};a&18&&(l.$$scope={dirty:a,ctx:i}),t.$set(l)}},i(i){r||(t&&y(t.$$.fragment,i),r=!0)},o(i){t&&w(t.$$.fragment,i),r=!1},d(i){i&&b(e),t&&D(t)}}}function RC(o,e,t){let{$$slots:r={},$$scope:n}=e,{category:s}=e,{categoryText:i}=e,a=ht();function l(){a("goBack")}return o.$$set=c=>{"category"in c&&t(0,s=c.category),"categoryText"in c&&t(1,i=c.categoryText),"$$scope"in c&&t(4,n=c.$$scope)},[s,i,l,r,n]}var Pd=class extends W{constructor(e){super(),K(this,e,RC,DC,z,{category:0,categoryText:1})}},tl=Pd;function $C(o){we(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function OC(o){let e,t,r,n,s,i;return{c(){e=k("div"),t=k("div"),n=A(),s=k("div"),i=N(o[1]),h(t,"class","system3-disk-usage-bar svelte-1ezpbya"),ie(t,"width",o[0]+"%"),h(t,"data-state",r=o[0]>90?"warning":""),h(e,"class","system3-disk-usage-container svelte-1ezpbya"),h(s,"class","system3-disk-usage-report svelte-1ezpbya")},m(a,l){v(a,e,l),S(e,t),v(a,n,l),v(a,s,l),S(s,i)},p(a,[l]){l&1&&ie(t,"width",a[0]+"%"),l&1&&r!==(r=a[0]>90?"warning":"")&&h(t,"data-state",r),l&2&&Z(i,a[1])},i:V,o:V,d(a){a&&(b(e),b(n),b(s))}}}function UC(o,e,t){let{diskUsagePercentage:r=0}=e,{text:n=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=s=>{"diskUsagePercentage"in s&&t(0,r=s.diskUsagePercentage),"text"in s&&t(1,n=s.text)},[r,n]}var Fd=class extends W{constructor(e){super(),K(this,e,UC,OC,z,{diskUsagePercentage:0,text:1},$C)}},Vy=Fd;var ol=require("obsidian");function BC(o){let e,t,r=o[0].shared&&qy(o);return{c(){e=k("div"),r&&r.c(),h(e,"class","suggestion-icon")},m(n,s){v(n,e,s),r&&r.m(e,null),t=!0},p(n,s){n[0].shared?r?s&1&&y(r,1):(r=qy(n),r.c(),y(r,1),r.m(e,null)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(n){t||(y(r),t=!0)},o(n){w(r),t=!1},d(n){n&&b(e),r&&r.d()}}}function NC(o){let e;return{c(){e=k("span"),e.textContent="Enter to create",h(e,"class","suggestion-action")},m(t,r){v(t,e,r)},p:V,i:V,o:V,d(t){t&&b(e)}}}function qy(o){let e,t;return e=new ho({props:{class:"svg-icon"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function HC(o){let e,t,r=o[0].folder+"",n,s,i,a,l,c,f=[NC,BC],u=[];function d(m,p){return m[0].exists?1:0}return a=d(o,-1),l=u[a]=f[a](o),{c(){e=k("div"),t=k("div"),n=N(r),s=A(),i=k("div"),l.c(),h(t,"class","suggestion-title"),h(e,"class","suggestion-content"),h(i,"class","suggestion-aux")},m(m,p){v(m,e,p),S(e,t),S(t,n),v(m,s,p),v(m,i,p),u[a].m(i,null),c=!0},p(m,[p]){(!c||p&1)&&r!==(r=m[0].folder+"")&&Z(n,r);let x=a;a=d(m,p),a===x?u[a].p(m,p):(oe(),w(u[x],1,1,()=>{u[x]=null}),ne(),l=u[a],l?l.p(m,p):(l=u[a]=f[a](m),l.c()),y(l,1),l.m(i,null))},i(m){c||(y(l),c=!0)},o(m){w(l),c=!1},d(m){m&&(b(e),b(s),b(i)),u[a].d()}}}function VC(o,e,t){let{suggestion:r}=e;return o.$$set=n=>{"suggestion"in n&&t(0,r=n.suggestion)},[r]}var Ed=class extends W{constructor(e){super(),K(this,e,VC,HC,z,{suggestion:0})}},zy=Ed;var rl=class extends ol.SuggestModal{constructor(t,r,n){super(t);this.sharedFolders=r;this.onChoose=n;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path)),this.hasRemotes=new Set(this.sharedFolders.filter(s=>s.remote!==void 0).map(s=>s.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(a=>{a.$destroy()});let r=t.toLowerCase(),n=[],s=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!s&&n.push({folder:t,exists:!1,shared:!1});let i=a=>{let l=this.sharedPaths.has(a.path),c=this.hasRemotes.has(a.path);if(a.path.toLowerCase().contains(r)&&a.path.length>1&&!c&&n.push({folder:a.path,exists:!0,shared:l}),!l)for(let f of a.children)f instanceof ol.TFolder&&i(f)};return i(this.app.vault.getRoot()),n.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let n=new zy({target:r,props:{suggestion:t}});this.components.push(n)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Qy=require("obsidian");var Dd=require("obsidian");var Wy=require("obsidian"),jy=require("obsidian"),nl=class extends jy.AbstractInputSuggest{constructor(t,r,n){super(t,n);this.app=t;this.sharedFolders=r;this.inputEl=n;this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path))}getSuggestions(t){let r=t.toLowerCase(),n=[],s=i=>{if(!this.sharedPaths.has(i.path)){i.path.toLowerCase().contains(r)&&n.push(i.path);for(let l of i.children)l instanceof Wy.TFolder&&s(l)}};return s(this.app.vault.getRoot()),n}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function qC(o){let e,t,r,n;return{c(){e=k("div"),t=k("input"),h(t,"type","text"),h(t,"placeholder","/"),h(e,"class","folder-suggest-container")},m(s,i){v(s,e,i),S(e,t),o[5](t),Gt(t,o[2]),r||(n=[j(t,"input",zC),j(t,"input",o[6])],r=!0)},p(s,[i]){i&4&&t.value!==s[2]&&Gt(t,s[2])},i:V,o:V,d(s){s&&b(e),o[5](null),r=!1,be(n)}}}function zC(){}function WC(o,e,t){let r,n=V,s=()=>(n(),n=Lt(f,m=>t(2,r=m)),f);o.$$.on_destroy.push(()=>n());let{app:i}=e,a,l,{sharedFolders:c}=e,{selectedFolder:f=he()}=e;s(),$t(()=>{l=new nl(i,c,a);let m=p=>{s(t(0,f=p.detail.folder.path))};return a.addEventListener("folder-selected",m),()=>{a.removeEventListener("folder-selected",m)}}),$f(()=>{l&&l.close()});function u(m){Jt[m?"unshift":"push"](()=>{a=m,t(1,a)})}function d(){r=this.value,f.set(r)}return o.$$set=m=>{"app"in m&&t(3,i=m.app),"sharedFolders"in m&&t(4,c=m.sharedFolders),"selectedFolder"in m&&s(t(0,f=m.selectedFolder))},[f,a,r,i,c,u,d]}var Md=class extends W{constructor(e){super(),K(this,e,WC,qC,z,{app:3,sharedFolders:4,selectedFolder:0})}},Ky=Md;function jC(o){we(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function KC(o){let e,t,r;return{c(){e=k("input"),h(e,"type","text")},m(n,s){v(n,e,s),Gt(e,o[4]),t||(r=j(e,"input",o[8]),t=!0)},p(n,s){s&16&&e.value!==n[4]&&Gt(e,n[4])},d(n){n&&b(e),t=!1,r()}}}function GC(o){let e,t;return e=new Ky({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&4&&(s.sharedFolders=r[2]),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Gy(o){let e,t;return{c(){e=k("span"),t=N(o[5]),h(e,"class","mod-warning error svelte-hgd3zf")},m(r,n){v(r,e,n),S(e,t)},p(r,n){n&32&&Z(t,r[5])},d(r){r&&b(e)}}}function JC(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;n=new De({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[KC]},$$scope:{ctx:o}}}),i=new De({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[GC]},$$scope:{ctx:o}}});let p=o[5]&&Gy(o);return{c(){e=k("div"),e.textContent="Add to vault",t=A(),r=k("div"),R(n.$$.fragment),s=A(),R(i.$$.fragment),a=A(),l=k("div"),p&&p.c(),c=A(),f=k("button"),f.textContent="Confirm",h(e,"class","modal-title"),h(f,"class","mod-cta"),h(l,"class","modal-button-container"),h(r,"class","modal-content")},m(x,g){v(x,e,g),v(x,t,g),v(x,r,g),M(n,r,null),S(r,s),M(i,r,null),S(r,a),S(r,l),p&&p.m(l,null),S(l,c),S(l,f),u=!0,d||(m=j(f,"click",function(){Ve((0,Dd.debounce)(o[9]))&&(0,Dd.debounce)(o[9]).apply(this,arguments)}),d=!0)},p(x,[g]){o=x;let _={};g&1040&&(_.$$scope={dirty:g,ctx:o}),n.$set(_);let C={};g&1029&&(C.$$scope={dirty:g,ctx:o}),i.$set(C),o[5]?p?p.p(o,g):(p=Gy(o),p.c(),p.m(l,c)):p&&(p.d(1),p=null)},i(x){u||(y(n.$$.fragment,x),y(i.$$.fragment,x),u=!0)},o(x){w(n.$$.fragment,x),w(i.$$.fragment,x),u=!1},d(x){x&&(b(e),b(t),b(r)),D(n),D(i),p&&p.d(),d=!1,m()}}}function QC(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{sharedFolders:i}=e,{onConfirm:a}=e,l=s.name,c=he();se(o,c,m=>t(6,r=m));let f="";function u(){l=this.value,t(4,l)}let d=async()=>{a(s,l,r||"").catch(m=>{t(5,f=m.message)})};return o.$$set=m=>{"app"in m&&t(0,n=m.app),"remoteFolder"in m&&t(1,s=m.remoteFolder),"sharedFolders"in m&&t(2,i=m.sharedFolders),"onConfirm"in m&&t(3,a=m.onConfirm)},[n,s,i,a,l,f,r,c,u,d]}var Rd=class extends W{constructor(e){super(),K(this,e,QC,JC,z,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},jC)}},Jy=Rd;var sl=class extends Qy.Modal{constructor(t,r,n,s){super(t);this.sharedFolders=r;this.remoteFolder=n;this.onConfirm=s;this.onConfirm=s}onOpen(){let{contentEl:t}=this;this.component=new Jy({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var $d=require("obsidian");function YC(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function XC(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function Wo(o){let e=YC(o);return XC(e)}function ZC(o){we(o,"svelte-3c0ydk",`.faint.svelte-3c0ydk{color:var(--text-faint) !important}.edit-members-button.svelte-3c0ydk{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-3c0ydk:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-3c0ydk:focus{outline:none;color:var(--icon-color-focus)}.share-key-container.svelte-3c0ydk{width:100%}.share-key-disabled-notice.svelte-3c0ydk{color:var(--text-error) !important;font-size:0.85em !important}.relay-host-check.svelte-3c0ydk{text-align:right}`)}function Yy(o,e,t){let r=o.slice();return r[67]=e[t],r}function Xy(o,e,t){let r=o.slice();return r[70]=e[t],r}function eL(o){let e;return{c(){e=k("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-3c0ydk")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function tL(o){let e=o[0].name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].name+"")&&Z(t,e)},d(r){r&&b(t)}}}function rL(o){let e;function t(s,i){return s[0].name?tL:eL}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=ge()},m(s,i){n.m(s,i),v(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&b(e),n.d(s)}}}function Zy(o){let e,t;return e=new De({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[oL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&4241|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function oL(o){let e,t,r,n;return{c(){e=k("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=Rt((o[12]?"system3-updating":"")+(o[7]?"":" system3-input-invalid"))+" svelte-3c0ydk")},m(s,i){v(s,e,i),Gt(e,o[0].name),o[48](e),r||(n=[j(e,"input",o[47]),j(e,"input",o[38])],r=!0)},p(s,i){i[0]&4224&&t!==(t=Rt((s[12]?"system3-updating":"")+(s[7]?"":" system3-input-invalid"))+" svelte-3c0ydk")&&h(e,"class",t),i[0]&1&&e.value!==s[0].name&&Gt(e,s[0].name)},d(s){s&&b(e),o[48](null),r=!1,be(n)}}}function nL(o){let e,t;return e=new ct({props:{$$slots:{name:[lL],default:[iL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&8192|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function sL(o){let e,t;return e=new ct({props:{$$slots:{name:[uL],default:[cL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&24576|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function iL(o){let e,t,r;function n(){return o[52](o[70])}return{c(){e=k("button"),e.textContent="Add to Vault",h(e,"class","mod-cta"),h(e,"aria-label","Add shared folder to vault"),ie(e,"max-width","8em")},m(s,i){v(s,e,i),t||(r=j(e,"click",function(){Ve((0,et.debounce)(n))&&(0,et.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&b(e),t=!1,r()}}}function aL(o){let e=o[70].name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&8192&&e!==(e=r[70].name+"")&&Z(t,e)},d(r){r&&b(t)}}}function lL(o){let e,t;return e=new Kr({props:{slot:"name",$$slots:{default:[aL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&8192|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function cL(o){let e,t;function r(){return o[51](o[70])}return e=new xn({}),e.$on("settings",function(){Ve((0,et.debounce)(r))&&(0,et.debounce)(r).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(n,s){M(e,n,s),t=!0},p(n,s){o=n},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function fL(o){let e=o[70].name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&8192&&e!==(e=r[70].name+"")&&Z(t,e)},d(r){r&&b(t)}}}function uL(o){let e,t;function r(...n){return o[49](o[70],...n)}return e=new Kr({props:{folder:o[14].find(r),slot:"name",$$slots:{default:[fL]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[50]),{c(){R(e.$$.fragment)},m(n,s){M(e,n,s),t=!0},p(n,s){o=n;let i={};s[0]&24576&&(i.folder=o[14].find(r)),s[0]&8192|s[2]&2048&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ex(o){let e,t,r,n,s;function i(...f){return o[46](o[70],...f)}let a=[sL,nL],l=[];function c(f,u){return u[0]&24576&&(e=null),e==null&&(e=!!f[14].find(i)),e?0:1}return t=c(o,[-1,-1,-1]),r=l[t]=a[t](o),{c(){r.c(),n=ge()},m(f,u){l[t].m(f,u),v(f,n,u),s=!0},p(f,u){o=f;let d=t;t=c(o,u),t===d?l[t].p(o,u):(oe(),w(l[d],1,1,()=>{l[d]=null}),ne(),r=l[t],r?r.p(o,u):(r=l[t]=a[t](o),r.c()),y(r,1),r.m(n.parentNode,n))},i(f){s||(y(r),s=!0)},o(f){w(r),s=!1},d(f){f&&b(n),l[t].d(f)}}}function dL(o){let e,t,r;return{c(){e=k("button"),e.textContent="Share a folder",h(e,"class","mod-cta"),h(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,et.debounce)(o[53])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function tx(o){let e,t,r,n,s,i,a,l=[mL,pL],c=[];function f(u,d){return u[15]?0:1}return t=f(o,[-1,-1,-1]),r=c[t]=l[t](o),{c(){e=k("div"),r.c(),h(e,"class","edit-members-button svelte-3c0ydk"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[15]?"Cancel editing members":"Edit members")},m(u,d){v(u,e,d),c[t].m(e,null),s=!0,i||(a=[j(e,"click",o[43]),j(e,"keypress",o[43])],i=!0)},p(u,d){let m=t;t=f(u,d),t!==m&&(oe(),w(c[m],1,1,()=>{c[m]=null}),ne(),r=c[t],r||(r=c[t]=l[t](u),r.c()),y(r,1),r.m(e,null)),(!s||d[0]&32768&&n!==(n=u[15]?"Cancel editing members":"Edit members"))&&h(e,"aria-label",n)},i(u){s||(y(r),s=!0)},o(u){w(r),s=!1},d(u){u&&b(e),c[t].d(),i=!1,be(a)}}}function pL(o){let e,t;return e=new Iu({props:{class:"svg-icon"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function mL(o){let e,t;return e=new Jf({props:{class:"svg-icon"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function hL(o){let e,t,r=o[10].owner&&tx(o);return{c(){r&&r.c(),e=ge()},m(n,s){r&&r.m(n,s),v(n,e,s),t=!0},p(n,s){n[10].owner?r?(r.p(n,s),s[0]&1024&&y(r,1)):(r=tx(n),r.c(),y(r,1),r.m(e.parentNode,e)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(n){t||(y(r),t=!0)},o(n){w(r),t=!1},d(n){n&&b(e),r&&r.d(n)}}}function gL(o){let e,t=o[67].role+"",r;return{c(){e=k("span"),r=N(t),h(e,"class","role-label")},m(n,s){v(n,e,s),S(e,r)},p(n,s){s[0]&64&&t!==(t=n[67].role+"")&&Z(r,t)},d(n){n&&b(e)}}}function yL(o){let e;function t(s,i){return s[15]?bL:xL}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=ge()},m(s,i){n.m(s,i),v(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&b(e),n.d(s)}}}function xL(o){let e,t,r,n,s,i,a,l,c,f;return{c(){var u,d;e=k("div"),t=k("select"),r=k("option"),r.textContent="Owner",n=k("option"),n.textContent="Member",r.__value="Owner",Gt(r,r.__value),n.__value="Member",Gt(n,n.__value),h(t,"class","dropdown"),t.disabled=s=o[67].userId===((u=o[1].loginManager.user)==null?void 0:u.id),h(t,"aria-label",i=o[67].userId===((d=o[1].loginManager.user)==null?void 0:d.id)?"Cannot modify your own role":void 0),h(t,"data-role-id",l=o[67].id),ie(e,"display","flex"),ie(e,"gap","8px"),ie(e,"align-items","center")},m(u,d){v(u,e,d),S(e,t),S(t,r),S(t,n),Rf(t,o[67].role),c||(f=j(t,"change",o[41]),c=!0)},p(u,d){var m,p;d[0]&66&&s!==(s=u[67].userId===((m=u[1].loginManager.user)==null?void 0:m.id))&&(t.disabled=s),d[0]&66&&i!==(i=u[67].userId===((p=u[1].loginManager.user)==null?void 0:p.id)?"Cannot modify your own role":void 0)&&h(t,"aria-label",i),d[0]&64&&a!==(a=u[67].role)&&Rf(t,u[67].role),d[0]&64&&l!==(l=u[67].id)&&h(t,"data-role-id",l)},d(u){u&&b(e),c=!1,f()}}}function bL(o){var r;let e,t=o[67].userId!==((r=o[1].loginManager.user)==null?void 0:r.id)&&rx(o);return{c(){t&&t.c(),e=ge()},m(n,s){t&&t.m(n,s),v(n,e,s)},p(n,s){var i;n[67].userId!==((i=n[1].loginManager.user)==null?void 0:i.id)?t?t.p(n,s):(t=rx(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){n&&b(e),t&&t.d(n)}}}function rx(o){let e,t,r;function n(){return o[54](o[67])}return{c(){e=k("button"),e.textContent="Kick",h(e,"class","mod-destructive")},m(s,i){v(s,e,i),t||(r=j(e,"click",function(){Ve((0,et.debounce)(n))&&(0,et.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&b(e),t=!1,r()}}}function vL(o){let e;function t(s,i){return s[10].owner?yL:gL}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=ge()},m(s,i){n.m(s,i),v(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&b(e),n.d(s)}}}function ox(o){let e,t;return e=new Ya({props:{user:o[67].user,$$slots:{default:[vL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.user=r[67].user),n[0]&33858|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function wL(o){let e,t=o[6].values().length+"",r,n,s=o[10].userLimit+"",i,a;return{c(){e=k("span"),r=N(t),n=N(" of "),i=N(s),a=N(" seats used"),h(e,"class","faint svelte-3c0ydk")},m(l,c){v(l,e,c),S(e,r),S(e,n),S(e,i),S(e,a)},p(l,c){c[0]&64&&t!==(t=l[6].values().length+"")&&Z(r,t),c[0]&1024&&s!==(s=l[10].userLimit+"")&&Z(i,s)},d(l){l&&b(e)}}}function nx(o){let e,t;return e=new el({}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function _L(o){let e,t,r,n,s,i,a,l,c,f,u,d=!o[0].owner&&nx(o);return{c(){e=k("div"),d&&d.c(),t=A(),r=k("div"),n=k("input"),i=A(),a=k("div"),h(n,"type","checkbox"),n.checked=o[8],n.disabled=s=!o[0].owner,h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",o[8]),h(r,"tabindex","0"),h(r,"class",l=o[0].owner?"checkbox-container":"checkbox-container checkbox-locked"),Be(r,"is-enabled",o[8]),h(e,"class","setting-item-control")},m(m,p){v(m,e,p),d&&d.m(e,null),S(e,t),S(e,r),S(r,n),S(r,i),S(r,a),c=!0,f||(u=[j(n,"change",o[55]),j(r,"keypress",o[56]),j(r,"click",o[57])],f=!0)},p(m,p){m[0].owner?d&&(oe(),w(d,1,1,()=>{d=null}),ne()):d?p[0]&1&&y(d,1):(d=nx(m),d.c(),y(d,1),d.m(e,t)),(!c||p[0]&256)&&(n.checked=m[8]),(!c||p[0]&1&&s!==(s=!m[0].owner))&&(n.disabled=s),(!c||p[0]&256)&&h(r,"aria-checked",m[8]),(!c||p[0]&1&&l!==(l=m[0].owner?"checkbox-container":"checkbox-container checkbox-locked"))&&h(r,"class",l),(!c||p[0]&257)&&Be(r,"is-enabled",m[8])},i(m){c||(y(d),c=!0)},o(m){w(d),c=!1},d(m){m&&b(e),d&&d.d(),f=!1,be(u)}}}function SL(o){let e;return{c(){e=k("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",h(e,"class","setting-item-description mod-warning")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function kL(o){let e;return{c(){e=k("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",h(e,"class","setting-item-description")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function IL(o){let e;return{c(){e=k("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",h(e,"class","setting-item-description")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function CL(o){let e;function t(s,i){return s[0].owner?IL:s[8]?kL:SL}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){e=k("fragment"),n.c(),h(e,"slot","description")},m(s,i){v(s,e,i),n.m(e,null)},p(s,i){r!==(r=t(s,i))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e,null)))},d(s){s&&b(e),n.d()}}}function sx(o){let e,t,r,n;e=new De({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[AL]},$$scope:{ctx:o}}});let s=o[0].owner&&ix(o);return{c(){R(e.$$.fragment),t=A(),s&&s.c(),r=ge()},m(i,a){M(e,i,a),v(i,t,a),s&&s.m(i,a),v(i,r,a),n=!0},p(i,a){let l={};a[0]&288|a[2]&2048&&(l.$$scope={dirty:a,ctx:i}),e.$set(l),i[0].owner?s?(s.p(i,a),a[0]&1&&y(s,1)):(s=ix(i),s.c(),y(s,1),s.m(r.parentNode,r)):s&&(oe(),w(s,1,1,()=>{s=null}),ne())},i(i){n||(y(e.$$.fragment,i),y(s),n=!0)},o(i){w(e.$$.fragment,i),w(s),n=!1},d(i){i&&(b(t),b(r)),D(e,i),s&&s.d(i)}}}function LL(o){let e,t;return e=new Za({props:{value:o[5]?o[5].key:"please wait...",disabled:!o[8],placeholder:"please wait...",readonly:!0,copyOnClick:!0,successMessage:"Invite link copied"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&32&&(s.value=r[5]?r[5].key:"please wait..."),n[0]&256&&(s.disabled=!r[8]),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function TL(o){let e;return{c(){e=k("span"),e.textContent="Share key is currently disabled",h(e,"role","button"),h(e,"tabindex","0"),h(e,"class","input-like share-key-disabled-notice svelte-3c0ydk")},m(t,r){v(t,e,r)},p:V,i:V,o:V,d(t){t&&b(e)}}}function AL(o){let e,t,r,n,s=[TL,LL],i=[];function a(l,c){return l[8]?1:0}return t=a(o,[-1,-1,-1]),r=i[t]=s[t](o),{c(){e=k("div"),r.c(),h(e,"class","share-key-container svelte-3c0ydk")},m(l,c){v(l,e,c),i[t].m(e,null),n=!0},p(l,c){let f=t;t=a(l,c),t===f?i[t].p(l,c):(oe(),w(i[f],1,1,()=>{i[f]=null}),ne(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),y(r,1),r.m(e,null))},i(l){n||(y(r),n=!0)},o(l){w(r),n=!1},d(l){l&&b(e),i[t].d()}}}function ix(o){let e,t;return e=new De({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[PL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function PL(o){let e,t,r;return{c(){e=k("button"),e.textContent="Rotate key",h(e,"class","mod-destructive")},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,et.debounce)(o[35])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function ax(o){let e,t,r,n,s,i,a,l;e=new He({props:{name:"Plan"}});let c=[EL,FL],f=[];function u(p,x){return p[16]?0:1}r=u(o,[-1,-1,-1]),n=f[r]=c[r](o);let d=o[17]&&o[17].quota>0&&fx(o),m=o[0].provider&&ux(o);return{c(){R(e.$$.fragment),t=A(),n.c(),s=A(),d&&d.c(),i=A(),m&&m.c(),a=ge()},m(p,x){M(e,p,x),v(p,t,x),f[r].m(p,x),v(p,s,x),d&&d.m(p,x),v(p,i,x),m&&m.m(p,x),v(p,a,x),l=!0},p(p,x){let g=r;r=u(p,x),r===g?f[r].p(p,x):(oe(),w(f[g],1,1,()=>{f[g]=null}),ne(),n=f[r],n?n.p(p,x):(n=f[r]=c[r](p),n.c()),y(n,1),n.m(s.parentNode,s)),p[17]&&p[17].quota>0?d?(d.p(p,x),x[0]&131072&&y(d,1)):(d=fx(p),d.c(),y(d,1),d.m(i.parentNode,i)):d&&(oe(),w(d,1,1,()=>{d=null}),ne()),p[0].provider?m?(m.p(p,x),x[0]&1&&y(m,1)):(m=ux(p),m.c(),y(m,1),m.m(a.parentNode,a)):m&&(oe(),w(m,1,1,()=>{m=null}),ne())},i(p){l||(y(e.$$.fragment,p),y(n),y(d),y(m),l=!0)},o(p){w(e.$$.fragment,p),w(n),w(d),w(m),l=!1},d(p){p&&(b(t),b(s),b(i),b(a)),D(e,p),f[r].d(p),d&&d.d(p),m&&m.d(p)}}}function FL(o){let e,t;return e=new De({props:{name:`Plan: ${o[10].plan}`,description:o[10].cta||"Thanks for supporting Relay development",$$slots:{default:[ML]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&1024&&(s.name=`Plan: ${r[10].plan}`),n[0]&1024&&(s.description=r[10].cta||"Thanks for supporting Relay development"),n[0]&1024|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function EL(o){let e,t,r=!o[11].values()[0].active||o[11].values()[0].cancelAt,n,s;e=new De({props:{name:`Plan: ${o[10].plan}`,description:"",$$slots:{description:[RL],default:[DL]},$$scope:{ctx:o}}});let i=r&&cx(o);return{c(){R(e.$$.fragment),t=A(),i&&i.c(),n=ge()},m(a,l){M(e,a,l),v(a,t,l),i&&i.m(a,l),v(a,n,l),s=!0},p(a,l){let c={};l[0]&1024&&(c.name=`Plan: ${a[10].plan}`),l[0]&68608|l[2]&2048&&(c.$$scope={dirty:l,ctx:a}),e.$set(c),l[0]&2048&&(r=!a[11].values()[0].active||a[11].values()[0].cancelAt),r?i?(i.p(a,l),l[0]&2048&&y(i,1)):(i=cx(a),i.c(),y(i,1),i.m(n.parentNode,n)):i&&(oe(),w(i,1,1,()=>{i=null}),ne())},i(a){s||(y(e.$$.fragment,a),y(i),s=!0)},o(a){w(e.$$.fragment,a),w(i),s=!1},d(a){a&&(b(t),b(n)),D(e,a),i&&i.d(a)}}}function ML(o){let e,t,r;return{c(){e=k("button"),e.textContent="Upgrade",h(e,"class","mod-cta")},m(n,s){v(n,e,s),t||(r=j(e,"click",function(){Ve((0,et.debounce)(o[60]))&&(0,et.debounce)(o[60]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&b(e),t=!1,r()}}}function lx(o){let e,t,r;return{c(){e=k("button"),e.textContent="Cancel",h(e,"class","mod-destructive")},m(n,s){v(n,e,s),t||(r=j(e,"click",function(){Ve((0,et.debounce)(o[59]))&&(0,et.debounce)(o[59]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&b(e),t=!1,r()}}}function DL(o){let e,t,r=o[11].values()[0].active&&!o[11].values()[0].cancelAt,n,s,i,a=r&&lx(o);return{c(){e=k("button"),e.textContent="Manage",t=A(),a&&a.c(),n=ge()},m(l,c){v(l,e,c),v(l,t,c),a&&a.m(l,c),v(l,n,c),s||(i=j(e,"click",function(){Ve((0,et.debounce)(o[58]))&&(0,et.debounce)(o[58]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&2048&&(r=o[11].values()[0].active&&!o[11].values()[0].cancelAt),r?a?a.p(o,c):(a=lx(o),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(l){l&&(b(e),b(t),b(n)),a&&a.d(l),s=!1,i()}}}function RL(o){let e,t=o[10].cta+"",r;return{c(){e=k("fragment"),r=N(t),h(e,"slot","description")},m(n,s){v(n,e,s),S(e,r)},p(n,s){s[0]&1024&&t!==(t=n[10].cta+"")&&Z(r,t)},d(n){n&&b(e)}}}function cx(o){let e,t;return e=new De({props:{description:"",$$slots:{name:[OL],default:[$L]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&2048|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function $L(o){let e=o[20](o[11].values()[0].cancelAt)+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&2048&&e!==(e=r[20](r[11].values()[0].cancelAt)+"")&&Z(t,e)},d(r){r&&b(t)}}}function OL(o){let e;return{c(){e=k("span"),e.textContent="Status: Cancelled",h(e,"slot","name"),h(e,"class","mod-warning")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function fx(o){let e,t,r,n,s,i,a,l,c,f;return e=new He({props:{name:"Storage"}}),r=new Vy({props:{diskUsagePercentage:Math.round(o[17].usage*100/o[17].quota)}}),s=new ct({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[UL]},$$scope:{ctx:o}}}),a=new ct({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[BL]},$$scope:{ctx:o}}}),c=new ct({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[NL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment),n=A(),R(s.$$.fragment),i=A(),R(a.$$.fragment),l=A(),R(c.$$.fragment)},m(u,d){M(e,u,d),v(u,t,d),M(r,u,d),v(u,n,d),M(s,u,d),v(u,i,d),M(a,u,d),v(u,l,d),M(c,u,d),f=!0},p(u,d){let m={};d[0]&131072&&(m.diskUsagePercentage=Math.round(u[17].usage*100/u[17].quota)),r.$set(m);let p={};d[0]&131072|d[2]&2048&&(p.$$scope={dirty:d,ctx:u}),s.$set(p);let x={};d[0]&131072|d[2]&2048&&(x.$$scope={dirty:d,ctx:u}),a.$set(x);let g={};d[0]&131072|d[2]&2048&&(g.$$scope={dirty:d,ctx:u}),c.$set(g)},i(u){f||(y(e.$$.fragment,u),y(r.$$.fragment,u),y(s.$$.fragment,u),y(a.$$.fragment,u),y(c.$$.fragment,u),f=!0)},o(u){w(e.$$.fragment,u),w(r.$$.fragment,u),w(s.$$.fragment,u),w(a.$$.fragment,u),w(c.$$.fragment,u),f=!1},d(u){u&&(b(t),b(n),b(i),b(l)),D(e,u),D(r,u),D(s,u),D(a,u),D(c,u)}}}function UL(o){let e=gs(o[17].usage)+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&131072&&e!==(e=gs(r[17].usage)+"")&&Z(t,e)},d(r){r&&b(t)}}}function BL(o){let e=gs(o[17].quota)+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&131072&&e!==(e=gs(r[17].quota)+"")&&Z(t,e)},d(r){r&&b(t)}}}function NL(o){let e=gs(o[17].maxFileSize)+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&131072&&e!==(e=gs(r[17].maxFileSize)+"")&&Z(t,e)},d(r){r&&b(t)}}}function ux(o){let e,t,r,n,s,i,a,l,c,f=[VL,HL],u=[];function d(p,x){return p[0].provider.selfHosted?0:1}e=d(o,[-1,-1,-1]),t=u[e]=f[e](o),n=new De({props:{name:"Name",description:"",$$slots:{default:[qL]},$$scope:{ctx:o}}}),i=new De({props:{name:"Domain",description:"",$$slots:{default:[zL]},$$scope:{ctx:o}}});let m=o[0].provider.selfHosted&&dx(o);return{c(){t.c(),r=A(),R(n.$$.fragment),s=A(),R(i.$$.fragment),a=A(),m&&m.c(),l=ge()},m(p,x){u[e].m(p,x),v(p,r,x),M(n,p,x),v(p,s,x),M(i,p,x),v(p,a,x),m&&m.m(p,x),v(p,l,x),c=!0},p(p,x){let g=e;e=d(p,x),e!==g&&(oe(),w(u[g],1,1,()=>{u[g]=null}),ne(),t=u[e],t||(t=u[e]=f[e](p),t.c()),y(t,1),t.m(r.parentNode,r));let _={};x[0]&1|x[2]&2048&&(_.$$scope={dirty:x,ctx:p}),n.$set(_);let C={};x[0]&1|x[2]&2048&&(C.$$scope={dirty:x,ctx:p}),i.$set(C),p[0].provider.selfHosted?m?m.p(p,x):(m=dx(p),m.c(),m.m(l.parentNode,l)):m&&(m.d(1),m=null)},i(p){c||(y(t),y(n.$$.fragment,p),y(i.$$.fragment,p),c=!0)},o(p){w(t),w(n.$$.fragment,p),w(i.$$.fragment,p),c=!1},d(p){p&&(b(r),b(s),b(a),b(l)),u[e].d(p),D(n,p),D(i,p),m&&m.d(p)}}}function HL(o){let e,t;return e=new He({props:{name:"Host"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function VL(o){let e,t;return e=new He({props:{name:"Self hosting"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function qL(o){let e=o[0].provider.name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.name+"")&&Z(t,e)},d(r){r&&b(t)}}}function zL(o){let e=o[0].provider.url+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.url+"")&&Z(t,e)},d(r){r&&b(t)}}}function dx(o){let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:KL,then:jL,catch:WL,value:66};return mo(t=o[19](o[0]),r),{c(){e=ge(),r.block.c()},m(n,s){v(n,e,s),r.block.m(n,r.anchor=s),r.mount=()=>e.parentNode,r.anchor=e},p(n,s){o=n,r.ctx=o,s[0]&1&&t!==(t=o[19](o[0]))&&mo(t,r)||cs(r,o,s)},d(n){n&&b(e),r.block.d(n),r.token=null,r=null}}}function WL(o){return{c:V,m:V,p:V,d:V}}function jL(o){let e,t=o[66].level==="warning"&&px(o);return{c(){t&&t.c(),e=ge()},m(r,n){t&&t.m(r,n),v(r,e,n)},p(r,n){r[66].level==="warning"?t?t.p(r,n):(t=px(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&b(e),t&&t.d(r)}}}function px(o){let e,t,r=Wo(o[66].status)+"",n,s=o[66].link&&mx(o);return{c(){e=k("p"),t=new Ho(!1),n=A(),s&&s.c(),t.a=n,h(e,"class","mod-warning relay-host-check svelte-3c0ydk")},m(i,a){v(i,e,a),t.m(r,e),S(e,n),s&&s.m(e,null)},p(i,a){a[0]&1&&r!==(r=Wo(i[66].status)+"")&&t.p(r),i[66].link?s?s.p(i,a):(s=mx(i),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(i){i&&b(e),s&&s.d()}}}function mx(o){let e,t,r,n=Wo(o[66].link.text)+"",s;return{c(){e=k("br"),t=A(),r=k("a"),h(r,"href",s=o[66].link.url)},m(i,a){v(i,e,a),v(i,t,a),v(i,r,a),r.innerHTML=n},p(i,a){a[0]&1&&n!==(n=Wo(i[66].link.text)+"")&&(r.innerHTML=n),a[0]&1&&s!==(s=i[66].link.url)&&h(r,"href",s)},d(i){i&&(b(e),b(t),b(r))}}}function KL(o){return{c:V,m:V,p:V,d:V}}function hx(o){let e,t,r,n;return e=new He({props:{name:"Membership"}}),r=new De({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[GL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment)},m(s,i){M(e,s,i),v(s,t,i),M(r,s,i),n=!0},p(s,i){let a={};i[2]&2048&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(y(e.$$.fragment,s),y(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&b(t),D(e,s),D(r,s)}}}function GL(o){let e,t,r;return{c(){e=k("button"),e.textContent="Leave",h(e,"class","mod-warning")},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,et.debounce)(o[61])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function gx(o){let e,t,r,n;return e=new He({props:{name:"Danger zone"}}),r=new De({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[YL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment)},m(s,i){M(e,s,i),v(s,t,i),M(r,s,i),n=!0},p(s,i){let a={};i[0]&2048|i[2]&2048&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(y(e.$$.fragment,s),y(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&b(t),D(e,s),D(r,s)}}}function JL(o){let e,t,r;return{c(){e=k("button"),e.textContent="Destroy",h(e,"class","mod-warning")},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,et.debounce)(o[39])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function QL(o){let e,t;return{c(){e=k("button"),e.textContent="Destroy",e.disabled=t=!0,h(e,"class","mod-warning"),h(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){v(r,e,n)},p:V,d(r){r&&b(e)}}}function YL(o){let e,t;function r(i,a){return a[0]&2048&&(e=null),e==null&&(e=i[11].values().length>0&&!i[11].values()[0].cancelAt),e?QL:JL}let n=r(o,[-1,-1,-1]),s=n(o);return{c(){s.c(),t=ge()},m(i,a){s.m(i,a),v(i,t,a)},p(i,a){n===(n=r(i,a))&&s?s.p(i,a):(s.d(1),s=n(i),s&&(s.c(),s.m(t.parentNode,t)))},d(i){i&&b(t),s.d(i)}}}function XL(o){let e,t,r,n,s,i,a,l,c,f,u,d,m,p,x,g,_,C,L,F,P=!o[10].owner||o[9].filter(o[45]).values().length>1,$,I,T;e=new tl({props:{category:bo,categoryText:"Relay Servers",$$slots:{default:[rL]},$$scope:{ctx:o}}}),e.$on("goBack",o[32]);let O=o[0].owner&&Zy(o);n=new He({props:{name:"Folders on this Relay Server"}});let G=_e(o[13].values()),J=[];for(let B=0;B<G.length;B+=1)J[B]=ex(Xy(o,G,B));let q=B=>w(J[B],1,1,()=>{J[B]=null});a=new De({props:{description:"",name:"",$$slots:{default:[dL]},$$scope:{ctx:o}}}),f=new He({props:{name:"Users",$$slots:{default:[hL]},$$scope:{ctx:o}}});let E=_e(o[6].values().sort(o[21])),H=[];for(let B=0;B<E.length;B+=1)H[B]=ox(Yy(o,E,B));let ue=B=>w(H[B],1,1,()=>{H[B]=null});m=new De({props:{description:"",name:"",$$slots:{default:[wL]},$$scope:{ctx:o}}}),x=new He({props:{name:"Sharing"}}),_=new ct({props:{name:o[0].owner?"Enable key sharing":"Key sharing",$$slots:{description:[CL],default:[_L]},$$scope:{ctx:o}}});let ye=o[8]&&sx(o),de=o[10].owner&&ax(o),ee=P&&hx(o),Ie=o[10].owner&&gx(o);return{c(){R(e.$$.fragment),t=A(),O&&O.c(),r=A(),R(n.$$.fragment),s=A();for(let B=0;B<J.length;B+=1)J[B].c();i=A(),R(a.$$.fragment),l=A(),c=k("div"),R(f.$$.fragment),u=A();for(let B=0;B<H.length;B+=1)H[B].c();d=A(),R(m.$$.fragment),p=A(),R(x.$$.fragment),g=A(),R(_.$$.fragment),C=A(),ye&&ye.c(),L=A(),de&&de.c(),F=A(),ee&&ee.c(),$=A(),Ie&&Ie.c(),I=ge(),h(c,"class","users-header")},m(B,U){M(e,B,U),v(B,t,U),O&&O.m(B,U),v(B,r,U),M(n,B,U),v(B,s,U);for(let me=0;me<J.length;me+=1)J[me]&&J[me].m(B,U);v(B,i,U),M(a,B,U),v(B,l,U),v(B,c,U),M(f,c,null),v(B,u,U);for(let me=0;me<H.length;me+=1)H[me]&&H[me].m(B,U);v(B,d,U),M(m,B,U),v(B,p,U),M(x,B,U),v(B,g,U),M(_,B,U),v(B,C,U),ye&&ye.m(B,U),v(B,L,U),de&&de.m(B,U),v(B,F,U),ee&&ee.m(B,U),v(B,$,U),Ie&&Ie.m(B,U),v(B,I,U),T=!0},p(B,U){let me={};if(U[0]&1|U[2]&2048&&(me.$$scope={dirty:U,ctx:B}),e.$set(me),B[0].owner?O?(O.p(B,U),U[0]&1&&y(O,1)):(O=Zy(B),O.c(),y(O,1),O.m(r.parentNode,r)):O&&(oe(),w(O,1,1,()=>{O=null}),ne()),U[0]&24576|U[1]&2112){G=_e(B[13].values());let xe;for(xe=0;xe<G.length;xe+=1){let gt=Xy(B,G,xe);J[xe]?(J[xe].p(gt,U),y(J[xe],1)):(J[xe]=ex(gt),J[xe].c(),y(J[xe],1),J[xe].m(i.parentNode,i))}for(oe(),xe=G.length;xe<J.length;xe+=1)q(xe);ne()}let Y={};U[2]&2048&&(Y.$$scope={dirty:U,ctx:B}),a.$set(Y);let ke={};if(U[0]&33792|U[2]&2048&&(ke.$$scope={dirty:U,ctx:B}),f.$set(ke),U[0]&2131010|U[1]&1536){E=_e(B[6].values().sort(B[21]));let xe;for(xe=0;xe<E.length;xe+=1){let gt=Yy(B,E,xe);H[xe]?(H[xe].p(gt,U),y(H[xe],1)):(H[xe]=ox(gt),H[xe].c(),y(H[xe],1),H[xe].m(d.parentNode,d))}for(oe(),xe=E.length;xe<H.length;xe+=1)ue(xe);ne()}let Re={};U[0]&1088|U[2]&2048&&(Re.$$scope={dirty:U,ctx:B}),m.$set(Re);let Oe={};U[0]&1&&(Oe.name=B[0].owner?"Enable key sharing":"Key sharing"),U[0]&257|U[2]&2048&&(Oe.$$scope={dirty:U,ctx:B}),_.$set(Oe),B[8]?ye?(ye.p(B,U),U[0]&256&&y(ye,1)):(ye=sx(B),ye.c(),y(ye,1),ye.m(L.parentNode,L)):ye&&(oe(),w(ye,1,1,()=>{ye=null}),ne()),B[10].owner?de?(de.p(B,U),U[0]&1024&&y(de,1)):(de=ax(B),de.c(),y(de,1),de.m(F.parentNode,F)):de&&(oe(),w(de,1,1,()=>{de=null}),ne()),U[0]&1537&&(P=!B[10].owner||B[9].filter(B[45]).values().length>1),P?ee?(ee.p(B,U),U[0]&1537&&y(ee,1)):(ee=hx(B),ee.c(),y(ee,1),ee.m($.parentNode,$)):ee&&(oe(),w(ee,1,1,()=>{ee=null}),ne()),B[10].owner?Ie?(Ie.p(B,U),U[0]&1024&&y(Ie,1)):(Ie=gx(B),Ie.c(),y(Ie,1),Ie.m(I.parentNode,I)):Ie&&(oe(),w(Ie,1,1,()=>{Ie=null}),ne())},i(B){if(!T){y(e.$$.fragment,B),y(O),y(n.$$.fragment,B);for(let U=0;U<G.length;U+=1)y(J[U]);y(a.$$.fragment,B),y(f.$$.fragment,B);for(let U=0;U<E.length;U+=1)y(H[U]);y(m.$$.fragment,B),y(x.$$.fragment,B),y(_.$$.fragment,B),y(ye),y(de),y(ee),y(Ie),T=!0}},o(B){w(e.$$.fragment,B),w(O),w(n.$$.fragment,B),J=J.filter(Boolean);for(let U=0;U<J.length;U+=1)w(J[U]);w(a.$$.fragment,B),w(f.$$.fragment,B),H=H.filter(Boolean);for(let U=0;U<H.length;U+=1)w(H[U]);w(m.$$.fragment,B),w(x.$$.fragment,B),w(_.$$.fragment,B),w(ye),w(de),w(ee),w(Ie),T=!1},d(B){B&&(b(t),b(r),b(s),b(i),b(l),b(c),b(u),b(d),b(p),b(g),b(C),b(L),b(F),b($),b(I)),D(e,B),O&&O.d(B),D(n,B),qe(J,B),D(a,B),D(f),qe(H,B),D(m,B),D(x,B),D(_,B),ye&&ye.d(B),de&&de.d(B),ee&&ee.d(B),Ie&&Ie.d(B)}}}function gs(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,n)).toFixed(e)+" "+r[n]}function ZL(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function e2(o,e,t){let r,n,s,i,a=V,l=()=>(a(),a=Lt(O,X=>t(9,i=X)),O),c,f=V,u=()=>(f(),f=Lt(P,X=>t(10,c=X)),P),d,m,p,x,g=V,_=()=>(g(),g=Lt(T,X=>t(14,x=X)),T),C,L,F;o.$$.on_destroy.push(()=>a()),o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>g());let{relay:P}=e;u();let $=P.folders;se(o,$,X=>t(13,p=X));let{plugin:I}=e,{sharedFolders:T}=e;_();let{relayRoles:O}=e;l();function G(X){return Ne(this,void 0,void 0,function*(){let Ae=yield I.loginManager.checkRelayHost(X.guid);if(Ae.status===200)return Ae.json})}function J(X){if(!X)return"Active";let Ae=$d.moment.utc(),je=$d.moment.utc(X),Vt=je.diff(Ae,"days");return Vt<=0?"Subscription has ended":Vt===1?"Active for 1 more day":Vt>31?`Ends on ${je.format("YYYY-MM-DD")}`:`Active for ${Vt} more days`}function q(X,Ae){var je;return X.role==="Owner"&&Ae.role==="Owner"?X.userId===((je=I.loginManager.user)===null||je===void 0?void 0:je.id)?-1:1:X.role==="Owner"&&Ae.role!=="Owner"?-1:X.role!=="Owner"&&Ae.role==="Owner"||X.user.name>Ae.user.name?1:-1}let E=c.subscriptions;se(o,E,X=>t(11,d=X));let H=Ot(d,X=>{if(X.values().length===0)return;let Ae=X.values()[0];return Ae.token||I.relayManager.getSubscriptionToken(Ae).then(je=>{Ae.token=je}),Ae});se(o,H,X=>t(16,L=X));let ue=c.storageQuota;se(o,ue,X=>t(17,F=X));let ye=i.filter(X=>X.relayId===P.id);se(o,ye,X=>t(6,r=X));let de=he(!0);se(o,de,X=>t(7,n=X));let ee;$t(()=>{ee&&ee.value===""&&ee.focus()});let Ie=ht();function B(X){return Ne(this,void 0,void 0,function*(){var Ae;if(!(!((Ae=I.loginManager)===null||Ae===void 0)&&Ae.user))return;let je={relay:X.id,quantity:10,user_email:I.loginManager.user.email},Vt=btoa(JSON.stringify(je)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(I.buildApiUrl(`/subscribe/${Vt}`),"_blank")})}function U(X){return Ne(this,void 0,void 0,function*(){let Ae=X.token,je=X.id;window.open(I.buildApiUrl(`/subscriptions/${je}/manage?token=${Ae}`),"_blank")})}function me(X){return Ne(this,void 0,void 0,function*(){let Ae=X.token,je=X.id;window.open(I.buildApiUrl(`/subscriptions/${je}/cancel?token=${Ae}`),"_blank")})}function Y(X){P.owner&&(xe.set(X),I.relayManager.toggleRelayInvitation(Oe,s).then(Ae=>{xe.set(Ae.enabled)}))}function ke(){return Ne(this,void 0,void 0,function*(){I.relayManager.leaveRelay(P),Ie("goBack",{clear:!0})})}function Re(){return Ne(this,void 0,void 0,function*(){Ie("goBack",{clear:!0})})}let Oe,xe=he(!0);se(o,xe,X=>t(8,s=X));let gt=he(!1);se(o,gt,X=>t(15,C=X)),I.relayManager.getRelayInvitation(P).then(X=>{X&&(t(5,Oe=X),xe.set(X.enabled))});function it(){return Ne(this,void 0,void 0,function*(){Oe&&t(5,Oe=yield I.relayManager.rotateKey(Oe).catch(X=>{throw X.status===429&&new et.Notice("Slow down"),X}))})}function rt(X,Ae,je){return Ne(this,void 0,void 0,function*(){let Vt=(0,et.normalizePath)((0,yx.join)(je,Ae));I.vault.getFolderByPath(Vt)===null&&(yield I.vault.createFolder(Vt));let wn=I.sharedFolders.new(Vt,X.guid,P.guid,!0);return wn.remote=X,I.sharedFolders.notifyListeners(),wn})}let xt=he(!1);se(o,xt,X=>t(12,m=X));let bs=I.timeProvider.debounce(()=>{I.relayManager.updateRelay(P).then(()=>{xt.set(!1)})},500),Jo=X=>{new sl(I.app,T,X,rt).open()};function vs(){de.set(ZL(ee.value)),n&&ee.value!==""&&(xt.set(!0),bs())}function ve(){I.relayManager.destroyRelay(P),Ie("goBack",{})}function ot(X){I.relayManager.kick(X)}function Ht(X,Ae){return Ne(this,void 0,void 0,function*(){yield I.relayManager.updateRelayRole(X,Ae)})}function ws(X){return Ne(this,void 0,void 0,function*(){let Ae=X.target,je=r.get(Ae.dataset.roleId);if(je){let Vt=je.role;try{yield Ht(je,Ae.value)}catch(wn){Ae.value=Vt}}})}function _s(X,Ae){X&&Ie("manageSharedFolder",{folder:X,relay:Ae,mount:!1})}function Dl(X){(X instanceof MouseEvent||X instanceof KeyboardEvent&&(X.key==="Enter"||X.key===" "))&&gt.update(Ae=>!Ae)}let _i=new rl(I.app,T,X=>Ne(void 0,void 0,void 0,function*(){let Ae=(0,et.normalizePath)(X),je=T.find(Wl=>Wl.path==X);if(je){let Wl=yield I.relayManager.createRemoteFolder(je,P);je.remote=Wl,je.connect(),I.sharedFolders.notifyListeners();return}I.vault.getFolderByPath(Ae)===null&&(yield I.vault.createFolder(Ae));let Vt=$n(),wn=I.sharedFolders.new((0,et.normalizePath)(X),Vt,P.guid,!0),Iv=yield I.relayManager.createRemoteFolder(wn,P);wn.remote=Iv,I.sharedFolders.notifyListeners()})),Rl=X=>X.role==="Owner"&&X.relayId===P.id,$l=(X,Ae)=>Ae.remote===X;function Ol(){P.name=this.value,u(t(0,P))}function Ul(X){Jt[X?"unshift":"push"](()=>{ee=X,t(4,ee)})}let Bl=(X,Ae)=>Ae.remote===X;function Nl(X){vr.call(this,o,X)}let Hl=X=>{let Ae=x.find(je=>je.remote===X);Ae&&_s(Ae,X.relay)},Vl=X=>{Jo(X)},ql=()=>{_i.open()},zl=X=>{ot(X)},Q=X=>Y(X.currentTarget.checked),Ce=()=>Y(!s),nt=()=>Y(!s),So=()=>{U(L)},_r=()=>{me(L)},Sv=()=>{B(c)},kv=()=>{ke()};return o.$$set=X=>{"relay"in X&&u(t(0,P=X.relay)),"plugin"in X&&t(1,I=X.plugin),"sharedFolders"in X&&_(t(2,T=X.sharedFolders)),"relayRoles"in X&&l(t(3,O=X.relayRoles))},[P,I,T,O,ee,Oe,r,n,s,i,c,d,m,p,x,C,L,F,$,G,J,q,E,H,ue,ye,de,B,U,me,Y,ke,Re,xe,gt,it,xt,Jo,vs,ve,ot,ws,_s,Dl,_i,Rl,$l,Ol,Ul,Bl,Nl,Hl,Vl,ql,zl,Q,Ce,nt,So,_r,Sv,kv]}var Od=class extends W{constructor(e){super(),K(this,e,e2,XL,z,{relay:0,plugin:1,sharedFolders:2,relayRoles:3},ZC,[-1,-1,-1])}},ys=Od;function t2(o){let e,t,r,n,s,i;return r=new Yf({}),{c(){e=k("div"),t=k("div"),R(r.$$.fragment),h(t,"class","clickable-icon"),h(t,"aria-label","Back"),h(t,"tabindex","0"),h(t,"role","button"),h(e,"class","modal-setting-nav-bar")},m(a,l){v(a,e,l),S(e,t),M(r,t,null),n=!0,s||(i=[j(t,"click",o[0]),j(t,"keypress",o[1])],s=!0)},p:V,i(a){n||(y(r.$$.fragment,a),n=!0)},o(a){w(r.$$.fragment,a),n=!1},d(a){a&&b(e),D(r),s=!1,be(i)}}}function r2(o){let e=ht();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var Ud=class extends W{constructor(e){super(),K(this,e,r2,t2,z,{})}},xx=Ud;var jo=require("obsidian");function bx(o,e,t){let r=o.slice();return r[32]=e[t][0],r[33]=e[t][1],r}function o2(o){let e=o[1].name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&2&&e!==(e=r[1].name+"")&&Z(t,e)},d(r){r&&b(t)}}}function n2(o){let e,t;return e=new De({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p:V,i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function s2(o){let e,t;return e=new ct({props:{$$slots:{name:[l2],default:[i2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function i2(o){let e,t;return e=new xn({}),e.$on("settings",function(){Ve((0,jo.debounce)(o[22]))&&(0,jo.debounce)(o[22]).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){o=r},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function a2(o){let e=o[7].name+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[7].name+"")&&Z(t,e)},d(r){r&&b(t)}}}function l2(o){let e,t;return e=new bo({props:{slot:"name",relay:o[7],$$slots:{default:[a2]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[7]),n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function vx(o){let e,t,r,n,s;e=new He({props:{name:"Sync settings",helpText:"You must have attachment storage available in order to sync attachments."}});let i=_e(o[4]),a=[];for(let f=0;f<i.length;f+=1)a[f]=_x(bx(o,i,f));let l=f=>w(a[f],1,1,()=>{a[f]=null}),c=o[6]&&o[7]&&Sx(o);return{c(){R(e.$$.fragment),t=A();for(let f=0;f<a.length;f+=1)a[f].c();r=A(),c&&c.c(),n=ge()},m(f,u){M(e,f,u),v(f,t,u);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(f,u);v(f,r,u),c&&c.m(f,u),v(f,n,u),s=!0},p(f,u){if(u[0]&16728){i=_e(f[4]);let d;for(d=0;d<i.length;d+=1){let m=bx(f,i,d);a[d]?(a[d].p(m,u),y(a[d],1)):(a[d]=_x(m),a[d].c(),y(a[d],1),a[d].m(r.parentNode,r))}for(oe(),d=i.length;d<a.length;d+=1)l(d);ne()}f[6]&&f[7]?c?(c.p(f,u),u[0]&192&&y(c,1)):(c=Sx(f),c.c(),y(c,1),c.m(n.parentNode,n)):c&&(oe(),w(c,1,1,()=>{c=null}),ne())},i(f){if(!s){y(e.$$.fragment,f);for(let u=0;u<i.length;u+=1)y(a[u]);y(c),s=!0}},o(f){w(e.$$.fragment,f),a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)w(a[u]);w(c),s=!1},d(f){f&&(b(t),b(r),b(n)),D(e,f),qe(a,f),c&&c.d(f)}}}function wx(o){let e,t;return e=new el({}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function c2(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[6]&&wx(o);function m(...g){return o[23](o[32],...g)}function p(){return o[24](o[32])}function x(){return o[25](o[32])}return{c(){e=k("div"),d&&d.c(),t=A(),r=k("div"),n=k("input"),i=A(),a=k("div"),h(n,"type","checkbox"),n.checked=s=o[8][o[32]]&&!o[6],n.disabled=o[3],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",l=o[8][o[32]]&&!o[6]),h(r,"tabindex","0"),h(r,"class","checkbox-container"),Be(r,"is-enabled",o[8][o[32]]&&!o[6]),h(e,"class","setting-item-control")},m(g,_){v(g,e,_),d&&d.m(e,null),S(e,t),S(e,r),S(r,n),S(r,i),S(r,a),c=!0,f||(u=[j(n,"change",m),j(r,"keypress",p),j(r,"click",x)],f=!0)},p(g,_){o=g,o[6]?d?_[0]&64&&y(d,1):(d=wx(o),d.c(),y(d,1),d.m(e,t)):d&&(oe(),w(d,1,1,()=>{d=null}),ne()),(!c||_[0]&336&&s!==(s=o[8][o[32]]&&!o[6]))&&(n.checked=s),(!c||_[0]&8)&&(n.disabled=o[3]),(!c||_[0]&336&&l!==(l=o[8][o[32]]&&!o[6]))&&h(r,"aria-checked",l),(!c||_[0]&336)&&Be(r,"is-enabled",o[8][o[32]]&&!o[6])},i(g){c||(y(d),c=!0)},o(g){w(d),c=!1},d(g){g&&b(e),d&&d.d(),f=!1,be(u)}}}function _x(o){let e,t;return e=new ct({props:{name:o[33].name,description:o[33].description,$$slots:{default:[c2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&16&&(s.name=r[33].name),n[0]&16&&(s.description=r[33].description),n[0]&344|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Sx(o){let e,t;return e=new ct({props:{name:"",$$slots:{default:[f2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function f2(o){let e,t,r;return{c(){e=k("button"),e.textContent="Buy storage",h(e,"class","mod-cta")},m(n,s){v(n,e,s),t||(r=j(e,"click",function(){Ve((0,jo.debounce)(o[26]))&&(0,jo.debounce)(o[26]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&b(e),t=!1,r()}}}function u2(o){let e,t,r;return{c(){e=k("button"),e.textContent="Delete local",h(e,"class","mod-warning")},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,jo.debounce)(o[27])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function d2(o){let e,t,r,n,s,i,a;return{c(){e=k("button"),t=N("Delete metadata"),h(e,"class",r=o[7]?"mod-disabled":"mod-warning"),e.disabled=n=!!o[7],h(e,"aria-label",s=o[7]?"Metadata is required for sharing.":"")},m(l,c){v(l,e,c),S(e,t),i||(a=j(e,"click",(0,jo.debounce)(o[28])),i=!0)},p(l,c){c[0]&128&&r!==(r=l[7]?"mod-disabled":"mod-warning")&&h(e,"class",r),c[0]&128&&n!==(n=!!l[7])&&(e.disabled=n),c[0]&128&&s!==(s=l[7]?"Metadata is required for sharing.":"")&&h(e,"aria-label",s)},d(l){l&&b(e),i=!1,a()}}}function kx(o){var n,s,i,a,l;let e,t,r=(((n=o[7])==null?void 0:n.owner)||((a=(i=(s=o[5])==null?void 0:s.remote)==null?void 0:i.creator)==null?void 0:a.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&Ix(o);return{c(){r&&r.c(),e=ge()},m(c,f){r&&r.m(c,f),v(c,e,f),t=!0},p(c,f){var u,d,m,p,x;(u=c[7])!=null&&u.owner||((p=(m=(d=c[5])==null?void 0:d.remote)==null?void 0:m.creator)==null?void 0:p.id)===((x=c[0].relayManager.user)==null?void 0:x.id)?r?(r.p(c,f),f[0]&161&&y(r,1)):(r=Ix(c),r.c(),y(r,1),r.m(e.parentNode,e)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(c){t||(y(r),t=!0)},o(c){w(r),t=!1},d(c){c&&b(e),r&&r.d(c)}}}function Ix(o){let e,t,r,n;return e=new He({props:{name:"Remote Folder"}}),r=new De({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[p2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment)},m(s,i){M(e,s,i),v(s,t,i),M(r,s,i),n=!0},p(s,i){let a={};i[1]&32&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(y(e.$$.fragment,s),y(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&b(t),D(e,s),D(r,s)}}}function p2(o){let e,t,r;return{c(){e=k("button"),e.textContent="Delete remote",h(e,"class","mod-destructive")},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,jo.debounce)(o[17])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function m2(o){let e,t,r,n,s,i,a,l=o[7]&&Fe().enableAttachmentSync,c,f,u,d,m,p,x,g,_;e=new tl({props:{category:Kr,categoryText:"Shared Folders",$$slots:{default:[o2]},$$scope:{ctx:o}}}),e.$on("goBack",o[15]),r=new He({props:{name:"Relay Server"}});let C=[s2,n2],L=[];function F(I,T){return I[7]?0:1}s=F(o,[-1,-1]),i=L[s]=C[s](o);let P=l&&vx(o);f=new He({props:{name:"Local folder"}}),d=new De({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[u2]},$$scope:{ctx:o}}}),p=new De({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[d2]},$$scope:{ctx:o}}});let $=o[7]&&kx(o);return{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment),n=A(),i.c(),a=A(),P&&P.c(),c=A(),R(f.$$.fragment),u=A(),R(d.$$.fragment),m=A(),R(p.$$.fragment),x=A(),$&&$.c(),g=ge()},m(I,T){M(e,I,T),v(I,t,T),M(r,I,T),v(I,n,T),L[s].m(I,T),v(I,a,T),P&&P.m(I,T),v(I,c,T),M(f,I,T),v(I,u,T),M(d,I,T),v(I,m,T),M(p,I,T),v(I,x,T),$&&$.m(I,T),v(I,g,T),_=!0},p(I,T){let O={};T[0]&2|T[1]&32&&(O.$$scope={dirty:T,ctx:I}),e.$set(O);let G=s;s=F(I,T),s===G?L[s].p(I,T):(oe(),w(L[G],1,1,()=>{L[G]=null}),ne(),i=L[s],i?i.p(I,T):(i=L[s]=C[s](I),i.c()),y(i,1),i.m(a.parentNode,a)),T[0]&128&&(l=I[7]&&Fe().enableAttachmentSync),l?P?(P.p(I,T),T[0]&128&&y(P,1)):(P=vx(I),P.c(),y(P,1),P.m(c.parentNode,c)):P&&(oe(),w(P,1,1,()=>{P=null}),ne());let J={};T[1]&32&&(J.$$scope={dirty:T,ctx:I}),d.$set(J);let q={};T[0]&128|T[1]&32&&(q.$$scope={dirty:T,ctx:I}),p.$set(q),I[7]?$?($.p(I,T),T[0]&128&&y($,1)):($=kx(I),$.c(),y($,1),$.m(g.parentNode,g)):$&&(oe(),w($,1,1,()=>{$=null}),ne())},i(I){_||(y(e.$$.fragment,I),y(r.$$.fragment,I),y(i),y(P),y(f.$$.fragment,I),y(d.$$.fragment,I),y(p.$$.fragment,I),y($),_=!0)},o(I){w(e.$$.fragment,I),w(r.$$.fragment,I),w(i),w(P),w(f.$$.fragment,I),w(d.$$.fragment,I),w(p.$$.fragment,I),w($),_=!1},d(I){I&&(b(t),b(n),b(a),b(c),b(u),b(m),b(x),b(g)),D(e,I),D(r,I),L[s].d(I),P&&P.d(I),D(f,I),D(d,I),D(p,I),$&&$.d(I)}}}function h2(o,e,t){let r,n,s,i,a=V,l=()=>(a(),a=Lt(m,U=>t(29,i=U)),m),c,f;o.$$.on_destroy.push(()=>a());let{plugin:u}=e,{sharedFolder:d}=e,{sharedFolders:m}=e;l();let{relayRoles:p}=e;function x(U){return Ne(this,void 0,void 0,function*(){var me;if(!(!((me=u.loginManager)===null||me===void 0)&&me.user))return;let Y={relay:U.id,quantity:10,user_email:u.loginManager.user.email},ke=btoa(JSON.stringify(Y)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(u.buildApiUrl(`/subscribe/${ke}?action="buy_storage"`),"_blank")})}let g=Ot(i,U=>U.find(me=>me===d));se(o,g,U=>t(5,n=U));let _=d.syncSettingsManager;se(o,_,U=>t(8,f=U));let C=Ot([g,p],([U,me])=>{var Y;return(Y=me.find(ke=>{var Re;return ke.relay===((Re=U==null?void 0:U.remote)===null||Re===void 0?void 0:Re.relay)}))===null||Y===void 0?void 0:Y.relay});se(o,C,U=>t(7,c=U));let L=Ot([g,p],([U,me])=>{var Y,ke,Re;return((Re=(ke=(Y=me.find(Oe=>{var xe;return Oe.relay===((xe=U==null?void 0:U.remote)===null||xe===void 0?void 0:xe.relay)}))===null||Y===void 0?void 0:Y.relay)===null||ke===void 0?void 0:ke.storageQuota)===null||Re===void 0?void 0:Re.quota)===0});se(o,L,U=>t(6,s=U));let F=!1;function P(U,me){return Ne(this,void 0,void 0,function*(){if(!F&&!s){t(3,F=!0);try{yield _.toggleCategory(U,me),t(4,r=Object.entries(_.getCategories()))}catch(Y){}finally{t(3,F=!1)}}})}let $;$t(()=>{!d&&$&&$.value===""&&$.focus()});let I=ht();function T(){return Ne(this,void 0,void 0,function*(){I("goBack",{clear:!0})})}function O(U){U&&I("manageRelay",{relay:U})}function G(){return Ne(this,void 0,void 0,function*(){yield u.relayManager.deleteRemote(d),u.sharedFolders.notifyListeners()})}function J(){return Ne(this,void 0,void 0,function*(){n&&u.sharedFolders.delete(n),I("goBack",{clear:!0})})}function q(){let U=u.vault.getFolderByPath(d.path);U&&u.app.vault.trash(U,!1),I("goBack",{})}function E(U){vr.call(this,o,U)}let H=()=>{O(c)},ue=(U,me)=>P(U,me.currentTarget.checked),ye=U=>P(U,!f[U]),de=U=>P(U,!f[U]),ee=()=>{x(c)},Ie=()=>{q()},B=()=>{J()};o.$$set=U=>{"plugin"in U&&t(0,u=U.plugin),"sharedFolder"in U&&t(1,d=U.sharedFolder),"sharedFolders"in U&&l(t(2,m=U.sharedFolders)),"relayRoles"in U&&t(20,p=U.relayRoles)};e:t(4,r=Object.entries(_.getCategories()));return[u,d,m,F,r,n,s,c,f,x,g,_,C,L,P,T,O,G,J,q,p,E,H,ue,ye,de,ee,Ie,B]}var Bd=class extends W{constructor(e){super(),K(this,e,h2,m2,z,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:20},null,[-1,-1])}},Nd=Bd;function g2(o){we(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function y2(o){let e,t,r,n,s=o[0].networkStatus.status&&Cx(o);return{c(){e=k("div"),t=k("span"),s&&s.c(),h(t,"class","system3-announcement svelte-d22j3"),ie(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),h(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),h(e,"role","button"),h(e,"tabindex","0"),ie(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(i,a){v(i,e,a),S(e,t),s&&s.m(t,null),r||(n=[j(e,"click",o[19]),j(e,"keypress",o[20])],r=!0)},p(i,a){i[0].networkStatus.status?s?s.p(i,a):(s=Cx(i),s.c(),s.m(t,null)):s&&(s.d(1),s=null),a&1&&ie(t,"color",i[0].networkStatus.status.color?i[0].networkStatus.status.color:"var(--text-on-accent)",1),a&1&&ie(e,"background-color",i[0].networkStatus.status.backgroundColor?i[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:V,o:V,d(i){i&&b(e),s&&s.d(),r=!1,be(n)}}}function x2(o){let e,t;return e=new xx({}),e.$on("goBack",o[11]),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p:V,i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Cx(o){let e,t=Wo(o[0].networkStatus.status.status)+"",r;return{c(){e=new Ho(!1),r=ge(),e.a=r},m(n,s){e.m(t,n,s),v(n,r,s)},p(n,s){s&1&&t!==(t=Wo(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(b(r),e.d())}}}function b2(o){let e,t;return e=new by({props:{plugin:o[0],$$slots:{default:[_2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&33554433&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function v2(o){let e,t;return e=new ys({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[7]}}),e.$on("goBack",o[11]),e.$on("close",o[12]),e.$on("manageSharedFolder",o[9]),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function w2(o){let e,t;return e=new Nd({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[7]}}),e.$on("goBack",o[11]),e.$on("close",o[12]),e.$on("manageRelay",o[8]),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function _2(o){let e,t;return e=new Jr({props:{relays:o[4],subscriptions:o[5],providers:o[6],plugin:o[0]}}),e.$on("manageRelay",o[8]),e.$on("manageSharedFolder",o[9]),e.$on("createRelay",o[10]),e.$on("joinRelay",o[13]),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Lx(o){let e,t=o[0].version+"",r;return{c(){e=k("span"),r=N(t),h(e,"class","relay-version svelte-d22j3")},m(n,s){v(n,e,s),S(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&Z(r,t)},d(n){n&&b(e)}}}function S2(o){let e,t,r,n,s,i,a,l,c,f=[x2,y2],u=[];function d(_,C){return _[2]||_[1]?0:_[0].networkStatus.status?1:-1}~(e=d(o,-1))&&(t=u[e]=f[e](o));let m=[w2,v2,b2],p=[];function x(_,C){return _[1]?0:_[2]?1:2}s=x(o,-1),i=p[s]=m[s](o);let g=o[0].manifest.version!==o[0].version&&Lx(o);return{c(){t&&t.c(),r=A(),n=k("div"),i.c(),a=A(),g&&g.c(),l=ge(),h(n,"class","vertical-tab-content svelte-d22j3")},m(_,C){~e&&u[e].m(_,C),v(_,r,C),v(_,n,C),p[s].m(n,null),v(_,a,C),g&&g.m(_,C),v(_,l,C),c=!0},p(_,[C]){let L=e;e=d(_,C),e===L?~e&&u[e].p(_,C):(t&&(oe(),w(u[L],1,1,()=>{u[L]=null}),ne()),~e?(t=u[e],t?t.p(_,C):(t=u[e]=f[e](_),t.c()),y(t,1),t.m(r.parentNode,r)):t=null);let F=s;s=x(_,C),s===F?p[s].p(_,C):(oe(),w(p[F],1,1,()=>{p[F]=null}),ne(),i=p[s],i?i.p(_,C):(i=p[s]=m[s](_),i.c()),y(i,1),i.m(n,null)),_[0].manifest.version!==_[0].version?g?g.p(_,C):(g=Lx(_),g.c(),g.m(l.parentNode,l)):g&&(g.d(1),g=null)},i(_){c||(y(t),y(i),c=!0)},o(_){w(t),w(i),c=!1},d(_){_&&(b(r),b(n),b(a),b(l)),~e&&u[e].d(_),p[s].d(),g&&g.d(_)}}}function k2(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,i=n.app,a=n.relayManager,l=a.relayRoles,c=a.relays;se(o,c,q=>t(18,r=q));let f=a.subscriptions,u=a.providers,d=n.sharedFolders,m,p=Jr,x,g=[{component:Jr}],{close:_}=e;function C(q){if(t(2,x=void 0),t(1,m=void 0),q==="/"){t(17,p=Jr);return}let E=new URLSearchParams(q.split("?")[1]||""),H=E.get("id");if(q.startsWith("/relays")){H?(t(2,x=a.relays.find(ue=>ue.guid===H)),t(17,p=ys)):t(17,p=Jr);return}if(q.startsWith("/shared-folders")){if(H){t(1,m=d.find(ye=>ye.guid===H));let ue=E.get("relay");ue&&t(2,x=a.relays.get(ue)),t(17,p=Nd)}return}}function L(q){g.push({currentRelay:x,sharedFolder:m,component:p}),t(2,x=q.detail.relay),t(1,m=void 0),t(17,p=ys)}function F(q){g.push({currentRelay:x,sharedFolder:m,component:p}),t(1,m=q.detail.folder),t(2,x=q.detail.relay)}function P(q){return Ne(this,void 0,void 0,function*(){g.push({currentRelay:x,sharedFolder:m,component:p}),t(2,x=yield n.relayManager.createRelay("")),t(17,p=ys)})}function $(q){if(q.detail.clear){g.length=0,t(2,x=void 0),t(1,m=void 0),t(17,p=Jr);return}let E=g.pop();if(E)for(;E;){if(!E.currentRelay&&!E.sharedFolder)t(2,x=E.currentRelay),t(1,m=E.sharedFolder),t(17,p=E.component);else if(E.sharedFolder&&d.has(E.sharedFolder)){t(2,x=E.currentRelay),t(1,m=E.sharedFolder),t(17,p=E.component);break}else if(E.currentRelay&&a.relays.get(E.currentRelay.id)){t(2,x=E.currentRelay),t(1,m=E.sharedFolder),t(17,p=E.component);break}E=g.pop()}else t(2,x=void 0),t(1,m=void 0),t(17,p=Jr)}function I(q){g.length=0,_()}function T(q){t(2,x=q.detail.relay),t(17,p=ys)}function O(){var q;!((q=n.networkStatus.status)===null||q===void 0)&&q.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let G=()=>{var q,E;(q=n.networkStatus.status)!=null&&q.versions?O():(E=n.networkStatus.status)!=null&&E.link&&window.open(n.networkStatus.status.link)},J=()=>{var q,E;(q=n.networkStatus.status)!=null&&q.versions?O():(E=n.networkStatus.status)!=null&&E.link&&window.open(n.networkStatus.status.link)};return o.$$set=q=>{"plugin"in q&&t(0,n=q.plugin),"path"in q&&t(15,s=q.path),"close"in q&&t(16,_=q.close)},o.$$.update=()=>{if(o.$$.dirty&32768){e:s&&C(s)}if(o.$$.dirty&262148){e:x&&!r.has(x.id)&&(t(2,x=void 0),t(17,p=Jr))}if(o.$$.dirty&2){e:m&&!d.has(m)&&(t(1,m=void 0),t(17,p=Jr))}if(o.$$.dirty&131078){e:(p||x||m)&&setTimeout(()=>{let q=document.querySelector(".vertical-tab-content");q&&(q.scrollTop=0)},0)}},[n,m,x,l,c,f,u,d,L,F,P,$,I,T,O,s,_,p,r,G,J]}var Hd=class extends W{constructor(e){super(),K(this,e,k2,S2,z,{plugin:0,path:15,close:16},g2)}},Tx=Hd;var il=class extends Ax.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new Tx({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var ll=require("obsidian");var al=class extends ei{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};function I2(o){if("email"in o&&"name"in o){let e=o;return{name:e.name,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}if("mail"in o&&"displayName"in o){let e=o;return{name:e.displayName,given_name:e.givenName,family_name:e.surname,email:e.mail}}return null}function C2(o,e,t,r){let n=r?I2(r):null;return new Qa(o,(t==null?void 0:t.name)||(n==null?void 0:n.name)||"",(t==null?void 0:t.email)||(n==null?void 0:n.email)||"",(t==null?void 0:t.picture)||(n==null?void 0:n.picture)||"",e)}var Vd=class{constructor(e,t,r){this.fullAuthUrl=e,this.info=t,this.login=r}},cl=class extends Ge{constructor(t,r,n,s,i){var l;super();this.beforeLogin=s;this.loginSettings=i;let a=Se("[Pocketbase]","debug");this.authStore=new al(`pocketbase_auth_${t}`),this.pb=new ns("https://auth.system3.md",this.authStore),this.pb.beforeSend=(c,f)=>(a(c,f),f.fetch=lt,f.headers=Object.assign({},f.headers,{"Relay-Version":"0.5.11"}),{url:c,options:f}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(l=this.pb.authStore.model)!=null&&l.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(c=>{c.status===404&&this.logout()}),_t.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),i=new Date(s.exp*1e3),a=new Date,l=Math.ceil((i.getTime()-a.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:i.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t,r){var n,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(n=t==null?void 0:t.meta)==null?void 0:n.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(i=>{this.log(i)}),r&&this.loginSettings.set({provider:r}),!0):(this.notifyListeners(),!1)}clearPreferredProvider(){this.loginSettings.set({provider:void 0})}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.11"};return(0,ll.requestUrl)({url:`https://api.system3.md/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.11"};(0,ll.requestUrl)({url:"https://api.system3.md/flags",method:"GET",headers:t}).then(r=>{if(r.status===200){let n=r.json;pt.getInstance().applyServerFlags(n)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,ll.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var n;return C2((n=t.model)==null?void 0:n.id,t.token,t.model,r)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}getWebviewIntercepts(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r=n=>{let s=n.replace(/\//g,"\\/");return new RegExp(`^${s}.*?[?&]redirect_uri=(${t}|${encodeURIComponent(t)})`,"i")};return[r("https://accounts.google.com/o/oauth2/auth"),r("https://discord.com/api/oauth2/authorize"),r("https://login.microsoftonline.com/common/oauth2/v2.0/authorize")]}async initiateManualOAuth2CodeFlow(t,r=["google"]){this.beforeLogin();let n=await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError}),s=this.pb.buildUrl("/api/oauth2-redirect"),i={};for(let a of r){let l=n.authProviders.find(f=>f.name===a);if(!l){this.log(`Warning: unable to find provider: ${a}`);continue}let c=async f=>this.pb.collection("users").authWithOAuth2Code(l.name,f,l.codeVerifier,s,{fetch:t}).then(u=>(this.setup(u,l.name),u));i[a]=new Vd(l.authUrl+s,l,c)}if(Object.keys(i).length===0)throw new Error(`No valid providers found from requested list: ${r.join(", ")}`);return i}async poll(t){let r=0,n=1e3;return new Promise((s,i)=>{let a=setInterval(()=>{if(r+=1,r>=30)return clearInterval(a),i(new Error(`Auth timeout: Timed out after ${r*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.info.state.slice(0,15)).then(l=>{if(l)return clearInterval(a),s(t.login(l.code))}).catch(l=>{})},n)})}async login(t="google"){this.beforeLogin();let r=await this.pb.collection("users").authWithOAuth2({provider:t});return this.setup(r,t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Tt=crypto;var Qr=new TextEncoder,sr=new TextDecoder,GB=2**32;var Px=o=>{let e=o;typeof e=="string"&&(e=Qr.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},Dr=o=>Px(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Fx=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},bn=o=>{let e=o;e instanceof Uint8Array&&(e=sr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Fx(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var qd={};Kl(qd,{JOSEAlgNotAllowed:()=>mi,JOSEError:()=>St,JOSENotSupported:()=>ft,JWEDecryptionFailed:()=>hi,JWEInvalid:()=>ir,JWKInvalid:()=>ul,JWKSInvalid:()=>dl,JWKSMultipleMatchingKeys:()=>pl,JWKSNoMatchingKey:()=>gi,JWKSTimeout:()=>ml,JWSInvalid:()=>vo,JWSSignatureVerificationFailed:()=>yi,JWTClaimValidationFailed:()=>pi,JWTExpired:()=>fl,JWTInvalid:()=>Ut});var St=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},pi=class extends St{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},fl=class extends St{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},mi=class extends St{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},ft=class extends St{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},hi=class extends St{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},ir=class extends St{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},vo=class extends St{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Ut=class extends St{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},ul=class extends St{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},dl=class extends St{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},gi=class extends St{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},pl=class extends St{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},ml=class extends St{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},yi=class extends St{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var hl=Tt.getRandomValues.bind(Tt);function F2(o){return typeof o=="object"&&o!==null}function Bt(o){if(!F2(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var q2=Symbol();var Z2,xl,Vx;(typeof navigator=="undefined"||!((Vx=(xl=navigator.userAgent)==null?void 0:xl.startsWith)!=null&&Vx.call(xl,"Mozilla/5.0 ")))&&(Z2="jose/v5.3.0");var jd={};Kl(jd,{decode:()=>bl,encode:()=>eT});var eT=Dr,bl=bn;function Kd(o){if(typeof o!="string")throw new Ut("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new Ut("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Ut("Invalid JWT");if(!e)throw new Ut("JWTs must contain a payload");let r;try{r=bl(e)}catch(s){throw new Ut("Failed to base64url decode the payload")}let n;try{n=JSON.parse(sr.decode(r))}catch(s){throw new Ut("Failed to parse the decoded payload as JSON")}if(!Bt(n))throw new Ut("Invalid JWT Claims Set");return n}function qx(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function tT(o){let e=Kd(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var vl=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=tT,this.maxConnections=t,this.refreshInterval=null,_t.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=a=>{r(a)},i=a=>{this.removeFromRefreshQueue(e),n(a)};this.refresh(e,s,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){var n;let t=this.tokenMap.get(e),r=((n=t==null?void 0:t.attempts)!=null?n:0)+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){var a;let n=this._activePromises.get(e);if(n)return n;let s=this.tokenMap.get(e);this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:(a=s==null?void 0:s.attempts)!=null?a:0}),this.callbacks.set(e,r);let i=this.onRefresh(e).then(l=>(this.onTokenRefreshed(e,l),this._activePromises.delete(e),l)).catch(l=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),l});return this._activePromises.set(e,i),i}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Error("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,i)=>s[1].expiryTime-i[1].expiryTime);for(let[s,{friendlyName:i,expiryTime:a,attempts:l}]of n){if(!e(s))continue;let c=a-r,f="";c>0?f=`expires in ${qx(c-this.expiryMargin)}`:f="expired",t.push(`${s} (${i}): ${l} attempts, (${f})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${qx(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function rT(o){return o.expiryTime||0}function oT(o,e){return(...t)=>e(o,...t)}async function nT(o,e,t,r){var c;let n=Se("[TokenStore][Refresh]","debug"),s=Se("[TokenStore][Refresh]","error");n(`${e}`);let i=Ye.decode(e),a;if(i instanceof gr)a=JSON.stringify({docId:i.documentId,relay:i.relayId,folder:i.folderId});else if(i instanceof Mt)a=JSON.stringify({docId:i.canvasId,relay:i.relayId,folder:i.folderId});else if(i instanceof so)a=JSON.stringify({docId:i.folderId,relay:i.relayId,folder:i.folderId});else if(i instanceof io)a=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.5.11"};try{let f=await lt("https://api.system3.md/token",{method:"POST",headers:l,body:a});if(!f.ok){n(f.status,await f.text()),r(Error(`Received status code ${f.status} from an API.`));return}let u=await f.json();t(u)}catch(f){s(f,a),r(f)}}var wl=class extends vl{constructor(t,r,n,s=5){super({log:Se("[LiveTokenStore]","debug"),refresh:oT(t,nT),getJwtExpiry:rT,getStorage:function(){return new uo("TokenStore/"+n)},getTimeProvider:()=>r},s);this.loginManager=t}async getFileTokenFromNetwork(t,r,n,s){let i=`${t}${r}`,a=this._activePromises.get(i);if(a)return a;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,n,s).then(c=>{let f=this.getJwtExpiry(c),u=this.tokenMap.get(i);return this.tokenMap.set(r,{...u,token:c,expiryTime:f}),this._activePromises.delete(i),c}).catch(c=>{throw this._activePromises.delete(i),c});return this._activePromises.set(i,l),l}async fetchFileToken(t,r,n,s){var d;let i=Se("[TokenStore][Fetch]","debug");i(`${t}`);let a=Ye.decode(t),l;if(a instanceof io)l=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId,hash:r,contentType:n,contentLength:s});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(d=this.loginManager.user)==null?void 0:d.token}`,"Relay-Version":"0.5.11"},f=await lt("https://api.system3.md/file-token",{method:"POST",headers:c,body:l});if(!f.ok){i(f.status,await f.text());let m=await f.json();throw new Error(m.error)}return await f.json()}async getFileToken(t,r,n,s){let i=`${t}${r}`,a=this.tokenMap.get(i);return a&&a.token&&this.isTokenValid(a)?(this.log("token was valid, cache hit!"),this._activePromises.delete(i),Promise.resolve(a.token)):this.getFileTokenFromNetwork(t,r,n,s)}};var zx=require("obsidian");var Gd=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Se("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,zx.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.5.11"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Wx=Gd;var Nt=class extends Ge{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Jd(this,t);return this._derivedMaps.set(t,n),n}},Jd=class extends Nt{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,n)=>{this.predicate(r,n)&&t.set(n,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function Qd(o){return typeof o.id=="string"}function sT(o){return typeof o.name=="string"}var Yd=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function jx(o){return typeof o.aggregate_root=="object"}function Kx(o){return typeof o.acl=="object"}var bi=class{get aggregate_root(){}get acl(){}},Xd=class extends Ge{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get name(){return this.storageQuota.name}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}get aggregate_root(){var t;return["relays",(t=this.relays.find(r=>r.storageQuotaId===this.storageQuota.id))==null?void 0:t.id]}},Zd=class{constructor(e,t,r){this.subscribeRecord=e;this.storageQuota=t;this.relays=r;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new Xd(e,this.relays);return this.subscribeRecord(this.collectionName,e.id,[]).then(n=>{r.offRecordSubscription=n}),this.storageQuota.set(e.id,r),r}delete(e){var r;let t=this.storageQuota.get(e);(r=t==null?void 0:t.offRecordSubscription)==null||r.call(t),this.storageQuota.delete(e)}},_l=class extends bi{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},ep=class extends Ge{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}update(t){return this.provider=t,this}},tp=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new ep(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},rp=class extends bi{constructor(t,r,n){super();this.remoteFolder=t;this.relays=r;this.users=n}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},op=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new rp(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},np=class{constructor(e,t,r,n,s,i,a,l,c){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this.subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Sl(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},sp=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new fp(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},ip=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new up(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},ap=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new _l(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},lp=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new dp(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},cp=class extends dt{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);_t.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=xr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=xr.getInstance();r.beginTransaction();let n=this._ingest(t);return r.commitTransaction(),n}_ingest(t){if(!t)return;let r,n=this.collections.get(t.collectionName);if(n?r=n.ingest(t):this.error("No collection found for record",t),jx(r)){let s=r.aggregate_root;if(s){let i=t.id,a=this.relationships.get(s.join(":"))||new Set;a.add([t.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if(Kx(r)){let s=r.acl;if(s){let i=t.id,a=this.relationships.get(s.join(":"))||new Set;a.add([t.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if(t.expand)for(let[,s]of Object.entries(t.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,n]of this.collections)for(let s of n.items()){if(!Qd(s)){this.warn("record has no id",s);continue}let i=r+"_"+s.id;if(sT(s)&&(i=r+"_"+s.name),t+=`  ${r}_${s.id} [label="${i}"];
`,Qd(s)&&jx(s)&&s.aggregate_root){let[a,l]=s.aggregate_root;t+=`  ${r}_${s.id} -> ${a}_${l};
`}if(Qd(s)&&Kx(s)&&s.acl){let[a,l]=s.acl;t+=`  ${r}_${s.id} -> ${a}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let n=this.collections.get(t),s=this.relationships.get([t,r].join(":")),i=xr.getInstance();i.beginTransaction(),n&&(this.warn("cascade delete parent",t,r),n.delete(r)),this.relationships.delete([t,r].join(":"));for(let a of s||[]){let[l,c]=a.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}i.commitTransaction()}},fp=class extends bi{constructor(t,r,n,s){super();this.users=n,this.roles=s,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},up=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},dp=class extends Ge{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Sl=class extends Ge{constructor(t,r,n,s,i,a,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get storageQuotaId(){return this.relay.storage_quota}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},kl=class extends dt{constructor(t){super();this.loginManager=t;this.destroyed=!1;this._handleEvent=(t,r)=>{var n,s;this.debug(`[Event]: ${t}`,r.action,r.record),r.action==="delete"?(n=this.store)==null||n.delete(r.record):(s=this.store)==null||s.ingest(r.record)};this.pb=this.loginManager.pb,this.users=new Nt("users"),this.relays=new Nt("relays"),this.providers=new Nt("providers"),this.remoteFolders=new Nt("remote folders"),this.relayInvitations=new Nt("relay invitations"),this.relayRoles=new Nt("relay roles"),this.roles=new Nt("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new Nt("subscriptions"),this.storageQuotas=new Nt("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.loginManager.loggedIn?this.login():this.logout()}),this.setUser(),this.user&&(_t.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new Yd(this.roles),r=new ap(this.users),n=new tp(this.providers),s=new np(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),i=new sp(this.relayRoles,this.relays,this.users,this.roles),a=new ip(this.relayInvitations,this.relays,this.roles),l=new op(this.remoteFolders,this.relays,this.users),c=new lp(this.subscriptions,this.relays,this.users),f=new Zd(this.subscribeRecord.bind(this),this.storageQuotas,this.relays);this.store=new cp([t,r,s,i,a,l,c,f,n])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new _l(this.authUser),this.users.set(this.user.id,this.user))}login(){var t;this.authUser&&this.authUser==((t=this.pb)==null?void 0:t.authStore.model)||(this.setUser(),this.buildGraph(),this.subscribe(),this.update())}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var s;let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("unable to rotate key");return n})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(n=>{var i;let s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("unable to toggle invitation enable");return s})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(n=>n.relay.id===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(i=>{var a;(a=this.store)==null||a.ingest(i)});let s=this.relayInvitations.find(i=>i.relay.id===t.id);if(s)return s})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}];for(let n of t)this.pb.collection(n.name).subscribe("*",s=>this._handleEvent(n.name,s),{expand:n.expand.join(","),fetch:lt})}async subscribeRecord(t,r,n){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}return this.pb.collection(t).subscribe(r,i=>this._handleEvent(t,i),{expand:n.join(","),fetch:lt})}async update(){let t=(n,s={})=>{var i;return!this.pb||!this.pb.authStore.isValid||((i=this.pb.authStore.model)==null?void 0:i.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let i of s)!this.destroyed&&this.store&&this.store.ingest(i)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(i=>{throw i});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var i;let r=os(),n=await((i=this.pb)==null?void 0:i.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=new Sl(n,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(s.id,s),s}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var n;t.remote=void 0;let r=this.remoteFolders.find(s=>s.guid===t.guid);return r?(await((n=this.pb)==null?void 0:n.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var i,a;if(!this.pb)throw new Error("Failed to create folder");let n=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(i=this.user)==null?void 0:i.id,private:!1},{expand:"relay"}),s=(a=this.store)==null?void 0:a.ingest(n);if(!s)throw new Error("Failed to create folder");return s}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(i=>{var a;return i.userId===((a=this.user)==null?void 0:a.id)&&i.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}async updateRelayRole(t,r){var a;if(!this.pb)throw new Error("Failed to update relay role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update relay role");let s=await this.pb.collection("relay_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update relay role");return i}destroy(){var t,r,n;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(n=this.store)==null||n.destroy(),this.pb=null,this.authUser=null,this.store=null}};var _v=require("obsidian");var pp=require("obsidian");function Go(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let i=t[s].match(/\d+/g),a=r[s].match(/\d+/g);if(i&&a){let l=parseInt(i[0]),c=parseInt(a[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}var Il=class extends dt{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new $o;this.activeDownloads=new $o;this.syncGroups=new Nt;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;_t.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,i=0,a=0;this.syncGroups.forEach(u=>{t+=u.total,r+=u.completed,n+=u.syncs,s+=u.completedSyncs,i+=u.downloads,a+=u.completedDownloads});let l=t>0?r/t*100:0,c=n>0?s/n*100:0,f=i>0?a/i*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(f),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:i,completedDownloads:a}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,i=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(i),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc;n instanceof No?await this.syncFile(n):await this.syncDocument(n),r.status="completed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.debug(`[Sync Progress] Before: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completedSyncs++,i.completed++,this.debug(`[Sync Progress] After: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completed===i.total&&(i.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,i))}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Sync Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(n=>n.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{r.doc instanceof Xe?await this.getCanvas(r.doc):r.doc instanceof No?await this.getSyncFile(r.doc):await this.getDocument(r.doc),r.status="completed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let s=this.syncGroups.get(r.sharedFolder);s&&(s.completedDownloads++,s.completed++,s.completed===s.total&&(s.status="completed"),this.syncGroups.set(r.sharedFolder,s))}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.error("[processDownloadQueue]",n)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(n=>n.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?new Promise((l,c)=>{a.resolve=l,a.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.total++,s.syncs++,this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let i=new Promise((a,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort(Go),this.processSyncQueue(),i}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let a=this.downloadCompletionCallbacks.get(t.guid);return a?(this.processDownloadQueue(),new Promise((l,c)=>{a.resolve=l,a.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let i=new Promise((a,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort(Go),this.processDownloadQueue(),i}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(er),n=[...t.files.values()].filter(rr),s=[...t.files.values()].filter(br),i=[...r,...n,...s],a={sharedFolder:t,total:i.length,completed:0,status:"pending",downloads:0,syncs:i.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let l=[...r].sort(Go),c=[...n].sort(Go),f=[...s].sort(Go);for(let u of l)this.enqueueDocumentForGroupSync(u);for(let u of c)this.enqueueCanvasForGroupSync(u,t);for(let u of f)this.enqueueSyncFileForGroupSync(u);a.status="running",this.syncGroups.set(t,a)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(Go),this.processSyncQueue(),s}async enqueueSyncFileForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSyncFileForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(Go),this.processSyncQueue(),s}getAuthHeader(t){var r;return{Authorization:Fe().enableDocumentServer?`Bearer ${t.token}`:`Bearer ${(r=this.loginManager.user)==null?void 0:r.token}`}}getBaseUrl(t,r){var a;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");s.pop(),s.push(t.docId),n.pathname=s.join("/");let i=((a=t.baseUrl)==null?void 0:a.replace(/\/$/,""))||n.toString();if(Fe().enableDocumentServer)return i;if(r instanceof gr)return`https://api.system3.md/relay/${r.relayId}/doc/${r.documentId}`;if(r instanceof Mt)return`https://api.system3.md/relay/${r.relayId}/doc/${r.canvasId}`;throw new Error("unexpected case")}async downloadItem(t){let r=f=>f instanceof Mt?f.canvasId:f.documentId,n=t.s3rn;if(this.log("[downloadItem]",t.path,`${Ye.encode(n)}`),!(n instanceof gr||n instanceof Mt))throw new Error(`Unable to decode S3RN: ${Ye.encode(n)}`);let s=await t.getProviderToken(),i=this.getAuthHeader(s),l=`${this.getBaseUrl(s,n)}/as-update`,c=await(0,pp.requestUrl)({url:l,method:"GET",headers:i,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(n),c.status);else throw this.error("[downloadItem]",r(n),l,c.status,c.text),new Error(`Unable to download item: ${Ye.encode(n)}`);return c}async syncDocumentWebsocket(t){let r="",n="",s=null;rr(t)?(s=Xe.exportCanvasData(t.ydoc),n=JSON.stringify(s)):er(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let i=!1;if(rr(t)&&s){let c=r?JSON.parse(r):{nodes:[],edges:[]};i=zr(s,c)}else i=n===r;if(!i&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&await a,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(Ye.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${Ye.encode(r)}`),!(r instanceof gr)&&!(r instanceof Mt))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let n=await t.getProviderToken(),s={"Content-Type":"application/octet-stream",...this.getAuthHeader(n)},i=ln(t.ydoc),l=`${this.getBaseUrl(n,r)}/update`,c=await(0,pp.requestUrl)({url:l,method:"POST",headers:s,body:i.buffer,throw:!1});return c.status===200?this.debug("[uploadItem]",r instanceof Mt?r.canvasId:r.documentId,c.status,c.text):this.error("[uploadItem]",r instanceof Mt?r.canvasId:r.documentId,l,c.status,c.text),c}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async enqueueCanvasForGroupSync(t,r){try{if(!r.syncStore.has(t.path)){this.debug("[enqueueCanvasForGroupSync] Skipping canvas, not in sync list",t.path);return}await this.enqueueDownload(t)}catch(n){this.error("[enqueueCanvasForGroupSync]",n)}}async getCanvas(t,r=3,n=3e3){try{let s=Xe.exportCanvasData(t.ydoc),i={edges:[],nodes:[]};try{let d=await t.sharedFolder.read(t);i=JSON.parse(d)}catch(d){}let a=zr(s.edges,i.edges)&&zr(s.nodes,i.nodes),l=i.nodes.length>0,f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f);if(this.log("[getCanvas] applying content from server"),dr(t.ydoc,u),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(s){throw this.error(s),s}}async getDocument(t,r=3,n=3e3){try{let s=t.text,i="";try{i=await t.sharedFolder.read(t)}catch(x){}let a=s===i,l=i!=="",f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f),d=new Zt;dr(d,u);let m=d.getMap("users");if(d.getText("contents").toString()===""){if(m.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",m.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),dr(t.ydoc,u),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncItem(t){let r="",n="",s=null;rr(t)?(s=Xe.exportCanvasData(t.ydoc),n=JSON.stringify(s)):er(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(m){}let i=!1;if(rr(t)&&s){let m=r?JSON.parse(r):{nodes:[],edges:[]};i=zr(s,m)}else i=n===r;if(!i)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=await this.downloadItem(t);if(a.status!==200)return this.log("server returned an error."),!1;let l=a.arrayBuffer,c=new Uint8Array(l),f=new Zt;dr(f,c);let u=f.getMap("users"),d=!1;if(rr(t)&&s){let m=Xe.exportCanvasData(f);d=u.size>0&&zr(m,s)}else{let m=f.getText("contents").toString();d=u.size>0&&m===n}return d||(dr(t.ydoc,c),rr(t)?t.sharedFolder.flush(t,t.json):er(t)&&t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncFile(t){t.sync()}async getSyncFile(t){t.pull()}async syncDocument(t){var r;try{Fe().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),er(t)?await this.syncDocumentWebsocket(t):rr(t)&&await this.syncDocumentWebsocket(t))}catch(n){console.error(n);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),i=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),i()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var Xx=require("obsidian");var Qx=require("obsidian");function iT(o){we(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Gx(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function Jx(o){let e,t,r,n=o[8]+"",s,i,a,l,c=o[8]+"",f,u,d,m,p,x,g,_,C,L,F,P;function $(){return o[6](o[8])}function I(){return o[7](o[8])}return{c(){e=k("div"),t=k("div"),r=k("div"),s=N(n),i=A(),a=k("div"),l=N("Toggle "),f=N(c),u=N(" on or off"),d=A(),m=k("div"),p=k("div"),x=k("input"),_=A(),C=k("div"),h(r,"class","setting-item-name"),h(a,"class","setting-item-description"),h(t,"class","setting-item-info"),h(x,"type","checkbox"),h(x,"tabindex","-1"),x.checked=g=o[9],h(C,"class","checkbox-toggle"),h(p,"role","checkbox"),h(p,"aria-checked",L=o[9]),h(p,"tabindex","0"),h(p,"class","checkbox-container svelte-4kkvmr"),Be(p,"is-enabled",o[9]),h(m,"class","setting-item-control"),h(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(T,O){v(T,e,O),S(e,t),S(t,r),S(r,s),S(t,i),S(t,a),S(a,l),S(a,f),S(a,u),S(e,d),S(e,m),S(m,p),S(p,x),S(p,_),S(p,C),F||(P=[j(p,"keypress",$),j(p,"click",I)],F=!0)},p(T,O){o=T,O&2&&n!==(n=o[8]+"")&&Z(s,n),O&2&&c!==(c=o[8]+"")&&Z(f,c),O&2&&g!==(g=o[9])&&(x.checked=g),O&2&&L!==(L=o[9])&&h(p,"aria-checked",L),O&2&&Be(p,"is-enabled",o[9])},d(T){T&&b(e),F=!1,be(P)}}}function aT(o){let e,t,r,n,s,i,a,l,c,f=_e(Object.entries(o[1]).filter(o[5]).sort()),u=[];for(let d=0;d<f.length;d+=1)u[d]=Jx(Gx(o,f,d));return{c(){e=k("div"),t=k("h2"),t.textContent="Feature Flags",r=A();for(let d=0;d<u.length;d+=1)u[d].c();n=A(),s=k("div"),i=k("div"),a=k("button"),a.textContent="Apply",h(a,"aria-label","apply flag settings"),h(a,"tabindex","0"),h(i,"class","setting-item-control"),h(s,"class","setting-item"),h(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(d,m){v(d,e,m),S(e,t),S(e,r);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(e,null);S(e,n),S(e,s),S(s,i),S(i,a),l||(c=[j(a,"click",function(){Ve(o[0])&&o[0].apply(this,arguments)}),j(a,"keypress",function(){Ve(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(d,[m]){if(o=d,m&10){f=_e(Object.entries(o[1]).filter(o[5]).sort());let p;for(p=0;p<f.length;p+=1){let x=Gx(o,f,p);u[p]?u[p].p(x,m):(u[p]=Jx(x),u[p].c(),u[p].m(e,n))}for(;p<u.length;p+=1)u[p].d(1);u.length=f.length}},i:V,o:V,d(d){d&&b(e),qe(u,d),l=!1,be(c)}}}function lT(o,e,t){let r,n,{reload:s}=e,i=pt.getInstance();se(o,i,u=>t(4,n=u));function a(u){let d=!r[u];t(1,r[u]=d,r),i.setFlag(u,r[u])}$t(()=>{Object.keys(r).forEach(u=>{let d=document.getElementById(`toggle-${u}`);d&&(0,Qx.setIcon)(d,"check")})});let l=([u,d])=>fa(u),c=u=>{if(!fa(u))throw new Error("Unexpected feature flag!");a(u)},f=u=>{if(!fa(u))throw new Error("Unexpected feature flag!");a(u)};return o.$$set=u=>{"reload"in u&&t(0,s=u.reload)},o.$$.update=()=>{if(o.$$.dirty&16){e:t(1,r=Object.assign({},n.flags))}},[s,r,i,a,n,l,c,f]}var mp=class extends W{constructor(e){super(),K(this,e,lT,aT,z,{reload:0},iT)}},Yx=mp;var Cl=class extends Xx.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new Yx({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var lb=require("obsidian");var ib=require("obsidian");function Zx(o,e,t){let r=o.slice();return r[13]=e[t],r}function eb(o,e,t){let r=o.slice();return r[16]=e[t],r}function cT(o){let e,t,r;return{c(){e=k("button"),e.textContent="Refresh"},m(n,s){v(n,e,s),t||(r=j(e,"click",(0,ib.debounce)(o[12])),t=!0)},p:V,d(n){n&&b(e),t=!1,r()}}}function fT(o){let e=navigator.userAgent+"",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p:V,d(r){r&&b(t)}}}function uT(o){let e;return{c(){e=N(o[1])},m(t,r){v(t,e,r)},p(t,r){r&2&&Z(e,t[1])},d(t){t&&b(e)}}}function dT(o){let e;return{c(){e=N(o[2])},m(t,r){v(t,e,r)},p(t,r){r&4&&Z(e,t[2])},d(t){t&&b(e)}}}function pT(o){let e;return{c(){e=N(o[3])},m(t,r){v(t,e,r)},p(t,r){r&8&&Z(e,t[3])},d(t){t&&b(e)}}}function mT(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=N(e)},m(r,n){v(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&Z(t,e)},d(r){r&&b(t)}}}function tb(o){let e,t=`${o[16]}`,r,n;return{c(){e=k("div"),r=N(t),n=A()},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&16&&t!==(t=`${s[16]}`)&&Z(r,t)},d(s){s&&b(e)}}}function hT(o){let e,t=_e(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=tb(eb(o,t,n));return{c(){e=k("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){v(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&16){t=_e(Object.keys(n[4].cancelControllers));let i;for(i=0;i<t.length;i+=1){let a=eb(n,t,i);r[i]?r[i].p(a,s):(r[i]=tb(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&b(e),qe(r,n)}}}function rb(o){let e,t=`${o[13]}`,r,n;return{c(){e=k("div"),r=N(t),n=A()},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&32&&t!==(t=`${s[13]}`)&&Z(r,t)},d(s){s&&b(e)}}}function gT(o){let e,t=_e(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=rb(Zx(o,t,n));return{c(){e=k("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){v(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=_e(n[5]);let i;for(i=0;i<t.length;i+=1){let a=Zx(n,t,i);r[i]?r[i].p(a,s):(r[i]=rb(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&b(e),qe(r,n)}}}function yT(o){let e,t,r,n,s,i,a,l,c,f,u,d,m,p,x,g,_,C,L,F,P,$,I;return n=new He({props:{name:"Environment",$$slots:{default:[cT]},$$scope:{ctx:o}}}),i=new De({props:{name:"User Agent",description:"",$$slots:{default:[fT]},$$scope:{ctx:o}}}),l=new De({props:{name:"Fetch",description:"",$$slots:{default:[uT]},$$scope:{ctx:o}}}),f=new De({props:{name:"Response",description:"",$$slots:{default:[dT]},$$scope:{ctx:o}}}),d=new De({props:{name:"Blink Fetch",description:"",$$slots:{default:[pT]},$$scope:{ctx:o}}}),p=new De({props:{name:"Startup Time",description:"",$$slots:{default:[mT]},$$scope:{ctx:o}}}),g=new He({props:{name:"Connections"}}),C=new De({props:{name:"",description:"",$$slots:{description:[hT]},$$scope:{ctx:o}}}),F=new He({props:{name:"Log Files"}}),$=new De({props:{name:"",description:"",$$slots:{description:[gT]},$$scope:{ctx:o}}}),{c(){e=k("div"),e.textContent="Debug Info",t=A(),r=k("div"),R(n.$$.fragment),s=A(),R(i.$$.fragment),a=A(),R(l.$$.fragment),c=A(),R(f.$$.fragment),u=A(),R(d.$$.fragment),m=A(),R(p.$$.fragment),x=A(),R(g.$$.fragment),_=A(),R(C.$$.fragment),L=A(),R(F.$$.fragment),P=A(),R($.$$.fragment),h(e,"class","modal-title"),h(r,"class","modal-content")},m(T,O){v(T,e,O),v(T,t,O),v(T,r,O),M(n,r,null),S(r,s),M(i,r,null),S(r,a),M(l,r,null),S(r,c),M(f,r,null),S(r,u),M(d,r,null),S(r,m),M(p,r,null),S(r,x),M(g,r,null),S(r,_),M(C,r,null),S(r,L),M(F,r,null),S(r,P),M($,r,null),I=!0},p(T,[O]){let G={};O&524288&&(G.$$scope={dirty:O,ctx:T}),n.$set(G);let J={};O&524288&&(J.$$scope={dirty:O,ctx:T}),i.$set(J);let q={};O&524290&&(q.$$scope={dirty:O,ctx:T}),l.$set(q);let E={};O&524292&&(E.$$scope={dirty:O,ctx:T}),f.$set(E);let H={};O&524296&&(H.$$scope={dirty:O,ctx:T}),d.$set(H);let ue={};O&524289&&(ue.$$scope={dirty:O,ctx:T}),p.$set(ue);let ye={};O&524304&&(ye.$$scope={dirty:O,ctx:T}),C.$set(ye);let de={};O&524320&&(de.$$scope={dirty:O,ctx:T}),$.$set(de)},i(T){I||(y(n.$$.fragment,T),y(i.$$.fragment,T),y(l.$$.fragment,T),y(f.$$.fragment,T),y(d.$$.fragment,T),y(p.$$.fragment,T),y(g.$$.fragment,T),y(C.$$.fragment,T),y(F.$$.fragment,T),y($.$$.fragment,T),I=!0)},o(T){w(n.$$.fragment,T),w(i.$$.fragment,T),w(l.$$.fragment,T),w(f.$$.fragment,T),w(d.$$.fragment,T),w(p.$$.fragment,T),w(g.$$.fragment,T),w(C.$$.fragment,T),w(F.$$.fragment,T),w($.$$.fragment,T),I=!1},d(T){T&&(b(e),b(t),b(r)),D(n),D(i),D(l),D(f),D(d),D(p),D(g),D(C),D(F),D($)}}}function ob(){try{return Response.toString()}catch(o){return"undefined"}}function nb(){try{return fetch.toString()}catch(o){return"undefined"}}function sb(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function xT(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=he(ob());se(o,c,g=>t(2,n=g));let f=he(nb());se(o,f,g=>t(1,r=g));let u=he(sb());se(o,u,g=>t(3,s=g));let d=he(l.loginManager.pb);se(o,d,g=>t(4,i=g));let m=he([]);se(o,m,g=>t(5,a=g)),ca().then(g=>{m.set(g)});function p(){c.set(ob()),f.set(nb()),u.set(sb()),d.set(l.loginManager.pb)}let x=()=>{p()};return o.$$set=g=>{"plugin"in g&&t(0,l=g.plugin)},[l,r,n,s,i,a,c,f,u,d,m,p,x]}var hp=class extends W{constructor(e){super(),K(this,e,xT,yT,z,{plugin:0})}},ab=hp;var Ll=class extends lb.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new ab({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var cb=require("obsidian"),Tl=class{notify(e){new cb.Notice(e)}},Al=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var xb=require("obsidian");var gb=require("obsidian");function bT(o){we(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function fb(o,e,t){let r=o.slice();return r[21]=e[t],r}function vT(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;r=new De({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),a=new De({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[ST]},$$scope:{ctx:o}}});let p=o[4]&&ub(o);return f=new De({props:{name:"",description:"",$$slots:{default:[IT]},$$scope:{ctx:o}}}),{c(){e=k("div"),t=k("div"),R(r.$$.fragment),n=A(),s=k("textarea"),i=A(),R(a.$$.fragment),l=A(),p&&p.c(),c=A(),R(f.$$.fragment),h(s,"placeholder","Describe the issue here..."),h(s,"class","svelte-jmqfac"),h(t,"class","form-content svelte-jmqfac"),h(e,"class","report-container svelte-jmqfac")},m(x,g){v(x,e,g),S(e,t),M(r,t,null),S(t,n),S(t,s),Gt(s,o[3]),S(t,i),M(a,t,null),S(t,l),p&&p.m(t,null),S(e,c),M(f,e,null),u=!0,d||(m=j(s,"input",o[13]),d=!0)},p(x,g){g&8&&Gt(s,x[3]);let _={};g&16777232&&(_.$$scope={dirty:g,ctx:x}),a.$set(_),x[4]?p?(p.p(x,g),g&16&&y(p,1)):(p=ub(x),p.c(),y(p,1),p.m(t,null)):p&&(oe(),w(p,1,1,()=>{p=null}),ne());let C={};g&16777293&&(C.$$scope={dirty:g,ctx:x}),f.$set(C)},i(x){u||(y(r.$$.fragment,x),y(a.$$.fragment,x),y(p),y(f.$$.fragment,x),u=!0)},o(x){w(r.$$.fragment,x),w(a.$$.fragment,x),w(p),w(f.$$.fragment,x),u=!1},d(x){x&&b(e),D(r),D(a),p&&p.d(),D(f),d=!1,m()}}}function wT(o){let e;return{c(){e=k("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',h(e,"class","centered-message svelte-jmqfac")},m(t,r){v(t,e,r)},p:V,i:V,o:V,d(t){t&&b(e)}}}function _T(o){let e,t,r;return t=new De({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=k("div"),R(t.$$.fragment),h(e,"class","centered-message svelte-jmqfac")},m(n,s){v(n,e,s),M(t,e,null),r=!0},p:V,i(n){r||(y(t.$$.fragment,n),r=!0)},o(n){w(t.$$.fragment,n),r=!1},d(n){n&&b(e),D(t)}}}function ST(o){let e,t,r,n,s,i;return{c(){e=k("div"),t=k("input"),r=A(),n=k("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),t.checked=o[4],h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[4]),h(e,"tabindex","0"),h(e,"class","checkbox-container"),Be(e,"is-enabled",o[4])},m(a,l){v(a,e,l),S(e,t),S(e,r),S(e,n),s||(i=[j(e,"keypress",LT),j(e,"click",o[14])],s=!0)},p(a,l){l&16&&(t.checked=a[4]),l&16&&h(e,"aria-checked",a[4]),l&16&&Be(e,"is-enabled",a[4])},d(a){a&&b(e),s=!1,be(i)}}}function ub(o){let e,t;return e=new De({props:{name:"Logs",description:"",$$slots:{description:[kT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function db(o){let e,t=`${o[21]}
`,r,n;return{c(){e=k("div"),r=N(t),n=A()},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&32&&t!==(t=`${s[21]}
`)&&Z(r,t)},d(s){s&&b(e)}}}function kT(o){let e,t=_e(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=db(fb(o,t,n));return{c(){e=k("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){v(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=_e(n[5]);let i;for(i=0;i<t.length;i+=1){let a=fb(n,t,i);r[i]?r[i].p(a,s):(r[i]=db(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&b(e),qe(r,n)}}}function IT(o){let e,t,r,n;return{c(){e=k("button"),t=N("Send"),e.disabled=o[2]},m(s,i){v(s,e,i),S(e,t),r||(n=j(e,"click",o[15]),r=!0)},p(s,i){i&4&&(e.disabled=s[2])},d(s){s&&b(e),r=!1,n()}}}function CT(o){let e,t,r,n,s,i,a=[_T,wT,vT],l=[];function c(f,u){return f[1]?0:f[2]&&!f[1]?1:2}return n=c(o,-1),s=l[n]=a[n](o),{c(){e=k("div"),e.textContent="Send Bug Report",t=A(),r=k("div"),s.c(),h(e,"class","modal-title"),h(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(f,u){v(f,e,u),v(f,t,u),v(f,r,u),l[n].m(r,null),i=!0},p(f,[u]){let d=n;n=c(f,u),n===d?l[n].p(f,u):(oe(),w(l[d],1,1,()=>{l[d]=null}),ne(),s=l[n],s?s.p(f,u):(s=l[n]=a[n](f),s.c()),y(s,1),s.m(r,null))},i(f){i||(y(s),i=!0)},o(f){w(s),i=!1},d(f){f&&(b(e),b(t),b(r)),l[n].d()}}}function pb(){try{return Response.toString()}catch(o){return"undefined"}}function mb(){try{return fetch.toString()}catch(o){return"undefined"}}function hb(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var LT=()=>{};function TT(o,e,t){let r,n,s,i,a,l,{plugin:c}=e,f=he(pb()),u=he(mb()),d=he(hb()),m=he("");se(o,m,T=>t(3,s=T));let p=he(!1);se(o,p,T=>t(4,i=T));let x=he(!1),g=he(!1);se(o,g,T=>t(2,n=T));let _=he(!1);se(o,_,T=>t(1,r=T));let C=he(c.loginManager.pb);se(o,C,T=>t(6,l=T));let L=he([]);se(o,L,T=>t(5,a=T)),ca().then(T=>{L.set(T)});function F(){f.set(pb()),u.set(mb()),d.set(hb()),C.set(c.loginManager.pb)}function P(){s=this.value,m.set(s)}let $=()=>{let T=!i;p.set(T)},I=async()=>{var O;let T=`Bug Report

`;if(T+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(O=l==null?void 0:l.authStore.model)==null?void 0:O.id,loadTime:c.loadTime,description:s},null,2),T+=`

`,p){let G=await Hh();T+=G}(0,gb.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:T,headers:{"Content-Type":"text/plain"}}).then(()=>{_.set(!0)}),g.set(!0)};return o.$$set=T=>{"plugin"in T&&t(0,c=T.plugin)},[c,r,n,s,i,a,l,m,p,g,_,C,L,P,$,I]}var gp=class extends W{constructor(e){super(),K(this,e,TT,CT,z,{plugin:0},bT)}},yb=gp;var Pl=class extends xb.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new yb({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Lb=require("obsidian");async function bb(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,i=[],a=0,l=0,c=0,f=0;for(let u of n)if(u.name){try{let d=await new Promise((m,p)=>{let x=indexedDB.open(u.name);x.onerror=()=>p(x.error),x.onsuccess=g=>m(g.target.result)});try{let m=Array.from(d.objectStoreNames);if(!m.includes("updates")||!m.includes("custom"))continue;let p=d.transaction(["updates","custom"],"readonly"),x=p.objectStore("updates"),g=p.objectStore("custom"),_=await new Promise(L=>{let F=g.get("appId");F.onsuccess=()=>L(F.result||"")});a++;let C=await new Promise((L,F)=>{let P=x.count();P.onsuccess=()=>L(P.result),P.onerror=()=>F(P.error)});if(l+=C,C>0){let L=0;if(await new Promise((F,P)=>{let $=x.openCursor();$.onsuccess=I=>{let T=I.target.result;if(T){let O=T.value instanceof Uint8Array?T.value.byteLength:JSON.stringify(T.value).length;L+=O,T.continue()}else F()},$.onerror=()=>P($.error)}),c+=L,L>1024*1024&&(!t||_===e)){let F=await new Promise(I=>{let T=g.get("path");T.onsuccess=()=>I(T.result||"")}),P=await new Promise(I=>{let T=g.get("relay");T.onsuccess=()=>I(T.result||"")}),$=!u.name.startsWith(`${e}-relay`);i.push({slug:`${u.name}/${x.name}`,path:F,relay:P,appId:_||"unknown",count:C,estimatedSizeMB:Math.round(L/(1024*1024)*100)/100,isLegacy:$})}}}finally{d.close()}}catch(d){console.error(`Error processing database ${u.name}:`,d);continue}f++,r&&r(f/n.length*100)}return{totalStores:a,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:i.sort((u,d)=>d.estimatedSizeMB-u.estimatedSizeMB)}}async function vb(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let i=indexedDB.open(e);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((i,a)=>{let l=s.clear();l.onsuccess=()=>i(),l.onerror=()=>a(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var bW=require("obsidian");function AT(o){we(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function wb(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function _b(o,e,t){let r=o.slice();return r[22]=e[t],r}function PT(o){let e,t,r,n,s,i=o[0].databaseCount.toLocaleString()+"",a,l,c,f,u,d,m,p,x=o[0].totalStores+"",g,_,C,L,F,P,$=o[0].totalItems.toLocaleString()+"",I,T,O,G,J,q,E=o[0].totalSizeMB.toFixed(2)+"",H,ue,ye,de,ee;function Ie(Y,ke){if(Y[0].databaseCount>45e3)return DT;if(Y[0].databaseCount>4e4)return MT}let B=Ie(o,-1),U=B&&B(o),me=o[0].largeStores.length>0&&Sb(o);return{c(){e=k("div"),t=k("div"),r=k("div"),r.textContent="Global Database Limit",n=A(),s=k("div"),a=N(i),l=N(" / 50,000"),c=A(),U&&U.c(),f=A(),u=k("div"),d=k("div"),d.textContent="Relay Databases",m=A(),p=k("div"),g=N(x),_=A(),C=k("div"),L=k("div"),L.textContent="Document Updates",F=A(),P=k("div"),I=N($),T=A(),O=k("div"),G=k("div"),G.textContent="Total Size",J=A(),q=k("div"),H=N(E),ue=N(" MB"),ye=A(),me&&me.c(),de=ge(),h(r,"class","system3-stat-label svelte-1n3w4sk"),h(s,"class","system3-stat-value svelte-1n3w4sk"),Be(s,"system3-warning",o[0].databaseCount>4e4),Be(s,"system3-critical",o[0].databaseCount>45e3),h(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),h(d,"class","system3-stat-label svelte-1n3w4sk"),h(p,"class","system3-stat-value svelte-1n3w4sk"),h(u,"class","system3-stat-item svelte-1n3w4sk"),h(L,"class","system3-stat-label svelte-1n3w4sk"),h(P,"class","system3-stat-value svelte-1n3w4sk"),h(C,"class","system3-stat-item svelte-1n3w4sk"),h(G,"class","system3-stat-label svelte-1n3w4sk"),h(q,"class","system3-stat-value svelte-1n3w4sk"),h(O,"class","system3-stat-item svelte-1n3w4sk"),h(e,"class","system3-summary-stats svelte-1n3w4sk")},m(Y,ke){v(Y,e,ke),S(e,t),S(t,r),S(t,n),S(t,s),S(s,a),S(s,l),S(t,c),U&&U.m(t,null),S(e,f),S(e,u),S(u,d),S(u,m),S(u,p),S(p,g),S(e,_),S(e,C),S(C,L),S(C,F),S(C,P),S(P,I),S(e,T),S(e,O),S(O,G),S(O,J),S(O,q),S(q,H),S(q,ue),v(Y,ye,ke),me&&me.m(Y,ke),v(Y,de,ke),ee=!0},p(Y,ke){(!ee||ke&1)&&i!==(i=Y[0].databaseCount.toLocaleString()+"")&&Z(a,i),(!ee||ke&1)&&Be(s,"system3-warning",Y[0].databaseCount>4e4),(!ee||ke&1)&&Be(s,"system3-critical",Y[0].databaseCount>45e3),B!==(B=Ie(Y,ke))&&(U&&U.d(1),U=B&&B(Y),U&&(U.c(),U.m(t,null))),(!ee||ke&1)&&x!==(x=Y[0].totalStores+"")&&Z(g,x),(!ee||ke&1)&&$!==($=Y[0].totalItems.toLocaleString()+"")&&Z(I,$),(!ee||ke&1)&&E!==(E=Y[0].totalSizeMB.toFixed(2)+"")&&Z(H,E),Y[0].largeStores.length>0?me?(me.p(Y,ke),ke&1&&y(me,1)):(me=Sb(Y),me.c(),y(me,1),me.m(de.parentNode,de)):me&&(oe(),w(me,1,1,()=>{me=null}),ne())},i(Y){ee||(y(me),ee=!0)},o(Y){w(me),ee=!1},d(Y){Y&&(b(e),b(ye),b(de)),U&&U.d(),me&&me.d(Y)}}}function FT(o){let e,t;return{c(){e=k("div"),t=N(o[5]),h(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){v(r,e,n),S(e,t)},p(r,n){n&32&&Z(t,r[5])},i:V,o:V,d(r){r&&b(e)}}}function ET(o){let e,t,r,n,s,i,a;return{c(){e=k("div"),t=k("div"),r=A(),n=k("div"),n.textContent="Analyzing Databases...",s=A(),i=k("div"),a=k("div"),h(t,"class","system3-loading-spinner svelte-1n3w4sk"),h(n,"class","loading-text"),h(a,"class","system3-progress-fill svelte-1n3w4sk"),ie(a,"width",o[4]+"%"),h(i,"class","system3-progress-bar svelte-1n3w4sk"),h(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){v(l,e,c),S(e,t),S(e,r),S(e,n),S(e,s),S(e,i),S(i,a)},p(l,c){c&16&&ie(a,"width",l[4]+"%")},i:V,o:V,d(l){l&&b(e)}}}function MT(o){let e;return{c(){e=k("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,h(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function DT(o){let e;return{c(){e=k("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,h(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function Sb(o){let e,t,r,n;e=new He({props:{name:"Large Stores (>1MB)"}});let s=_e(o[2]),i=[];for(let l=0;l<s.length;l+=1)i[l]=Ib(wb(o,s,l));let a=l=>w(i[l],1,1,()=>{i[l]=null});return{c(){R(e.$$.fragment),t=A();for(let l=0;l<i.length;l+=1)i[l].c();r=ge()},m(l,c){M(e,l,c),v(l,t,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,c);v(l,r,c),n=!0},p(l,c){if(c&2052){s=_e(l[2]);let f;for(f=0;f<s.length;f+=1){let u=wb(l,s,f);i[f]?(i[f].p(u,c),y(i[f],1)):(i[f]=Ib(u),i[f].c(),y(i[f],1),i[f].m(r.parentNode,r))}for(oe(),f=s.length;f<i.length;f+=1)a(f);ne()}},i(l){if(!n){y(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)y(i[c]);n=!0}},o(l){w(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)w(i[c]);n=!1},d(l){l&&(b(t),b(r)),D(e,l),qe(i,l)}}}function RT(o){let e,t,r,n,s;function i(){return o[17](o[22])}return{c(){e=k("div"),t=k("button"),t.textContent="Delete",r=A(),h(t,"class","mod-warning"),h(t,"title","Delete all data in this store"),h(e,"class","system3-actions svelte-1n3w4sk")},m(a,l){v(a,e,l),S(e,t),v(a,r,l),n||(s=j(t,"click",i),n=!0)},p(a,l){o=a},d(a){a&&(b(e),b(r)),n=!1,s()}}}function kb(o){let e,t;return e=new De({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[RT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Ib(o){let e,t,r,n;e=new He({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=_e(o[19]),i=[];for(let l=0;l<s.length;l+=1)i[l]=kb(_b(o,s,l));let a=l=>w(i[l],1,1,()=>{i[l]=null});return{c(){R(e.$$.fragment),t=A();for(let l=0;l<i.length;l+=1)i[l].c();r=ge()},m(l,c){M(e,l,c),v(l,t,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,c);v(l,r,c),n=!0},p(l,c){let f={};if(c&4&&(f.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(f),c&2052){s=_e(l[19]);let u;for(u=0;u<s.length;u+=1){let d=_b(l,s,u);i[u]?(i[u].p(d,c),y(i[u],1)):(i[u]=kb(d),i[u].c(),y(i[u],1),i[u].m(r.parentNode,r))}for(oe(),u=s.length;u<i.length;u+=1)a(u);ne()}},i(l){if(!n){y(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)y(i[c]);n=!0}},o(l){w(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)w(i[c]);n=!1},d(l){l&&(b(t),b(r)),D(e,l),qe(i,l)}}}function $T(o){let e,t,r,n,s,i,a,l,c,f,u,d,m,p,x,g,_,C=[ET,FT,PT],L=[];function F(P,$){return P[3]?0:P[5]?1:P[0]?2:-1}return~(m=F(o,-1))&&(p=L[m]=C[m](o)),{c(){e=k("div"),e.textContent="Relay database analysis",t=A(),r=k("div"),n=k("div"),s=k("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,i=A(),a=k("div"),l=k("div"),c=k("input"),f=A(),u=k("div"),d=A(),p&&p.c(),h(e,"class","modal-title"),h(s,"class","setting-item-info"),h(c,"type","checkbox"),h(c,"tabindex","-1"),c.checked=o[1],h(u,"class","checkbox-toggle"),h(l,"role","checkbox"),h(l,"aria-checked",o[1]),h(l,"tabindex","0"),h(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Be(l,"is-enabled",o[1]),h(a,"class","setting-item-control"),h(n,"class","setting-item"),h(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(P,$){v(P,e,$),v(P,t,$),v(P,r,$),S(r,n),S(n,s),S(n,i),S(n,a),S(a,l),S(l,c),S(l,f),S(l,u),S(r,d),~m&&L[m].m(r,null),x=!0,g||(_=[j(l,"keypress",o[15]),j(l,"click",o[16])],g=!0)},p(P,[$]){(!x||$&2)&&(c.checked=P[1]),(!x||$&2)&&h(l,"aria-checked",P[1]),(!x||$&2)&&Be(l,"is-enabled",P[1]);let I=m;m=F(P,$),m===I?~m&&L[m].p(P,$):(p&&(oe(),w(L[I],1,1,()=>{L[I]=null}),ne()),~m?(p=L[m],p?p.p(P,$):(p=L[m]=C[m](P),p.c()),y(p,1),p.m(r,null)):p=null)},i(P){x||(y(p),x=!0)},o(P){w(p),x=!1},d(P){P&&(b(e),b(t),b(r)),~m&&L[m].d(),g=!1,be(_)}}}function OT(o,e,t){let r,n,s,i,a,l;var c;let{plugin:f}=e,u=he(!0);se(o,u,P=>t(3,i=P));let d=he(0);se(o,d,P=>t(4,a=P));let m=he(null);se(o,m,P=>t(0,s=P));let p=he(null);se(o,p,P=>t(5,l=P));let x=!1;function g(){return Ne(this,void 0,void 0,function*(){u.set(!0),p.set(null);try{let P=yield bb({appId:f.appId,filterByAppId:!x,onProgress:$=>d.set($)});m.set(P)}catch(P){p.set(`Analysis failed: ${P.message}`)}finally{u.set(!1)}})}function _(P){return Ne(this,void 0,void 0,function*(){try{yield vb(P),s&&La(m,s.largeStores=s.largeStores.filter($=>$.slug!==P),s)}catch($){p.set(`Failed to delete ${P}: ${$.message}`)}})}$t(()=>{g()});let C=()=>{t(1,x=!x),g()},L=()=>{t(1,x=!x),g()},F=P=>_(P.slug);return o.$$set=P=>{"plugin"in P&&t(12,f=P.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((P,$)=>{let I=$.relay||"local";return P[I]||(P[I]=[]),P[I].push($),P},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,n=Object.entries(r).sort(([P],[$])=>P==="local"?-1:$==="local"?1:P.localeCompare($)))}},[s,x,n,i,a,l,u,d,m,p,g,_,f,c,r,C,L,F]}var yp=class extends W{constructor(e){super(),K(this,e,OT,$T,z,{plugin:12},AT)}},Cb=yp;var Fl=class extends Lb.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Cb({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var tv=require("obsidian");var{Boolean:Bb}=pn;function UT(o){we(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function Tb(o,e,t){let r=o.slice();return r[20]=e[t],r}function Ab(o,e,t){let r=o.slice();return r[23]=e[t],r}function BT(o){return{c:V,m:V,p:V,i:V,o:V,d:V}}function NT(o){let e,t,r=_e(Ub(o[19].documents)),n=[];for(let i=0;i<r.length;i+=1)n[i]=Rb(Tb(o,r,i));let s=i=>w(n[i],1,1,()=>{n[i]=null});return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=ge()},m(i,a){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(i,a);v(i,e,a),t=!0},p(i,a){if(a&8311){r=_e(Ub(i[19].documents));let l;for(l=0;l<r.length;l+=1){let c=Tb(i,r,l);n[l]?(n[l].p(c,a),y(n[l],1)):(n[l]=Rb(c),n[l].c(),y(n[l],1),n[l].m(e.parentNode,e))}for(oe(),l=r.length;l<n.length;l+=1)s(l);ne()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)y(n[a]);t=!0}},o(i){n=n.filter(Bb);for(let a=0;a<n.length;a+=1)w(n[a]);t=!1},d(i){i&&b(e),qe(n,i)}}}function Pb(o){let e,t=Ob(o[23].queueState.timestamp)+"",r;return{c(){e=N("\u2022 "),r=N(t)},m(n,s){v(n,e,s),v(n,r,s)},p(n,s){s&3&&t!==(t=Ob(n[23].queueState.timestamp)+"")&&Z(r,t)},d(n){n&&(b(e),b(r))}}}function Fb(o){let e,t=o[23].queueState.error+"",r;return{c(){e=k("div"),r=N(t),h(e,"class","error-message svelte-18bqwhy")},m(n,s){v(n,e,s),S(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&Z(r,t)},d(n){n&&b(e)}}}function Eb(o){let e,t,r,n,s,i;t=new vu({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function a(){return o[10](o[23])}return{c(){e=k("button"),R(t.$$.fragment),r=N(`
							Retry`),h(e,"class","mod-warning svelte-18bqwhy")},m(l,c){v(l,e,c),M(t,e,null),S(e,r),n=!0,s||(i=j(e,"click",a),s=!0)},p(l,c){o=l},i(l){n||(y(t.$$.fragment,l),n=!0)},o(l){w(t.$$.fragment,l),n=!1},d(l){l&&b(e),D(t),s=!1,i()}}}function HT(o){var m,p,x;let e,t,r=o[5](o[23]).text+"",n,s,i,a,l,c,f=((m=o[23].queueState)==null?void 0:m.timestamp)&&Pb(o),u=((p=o[23].queueState)==null?void 0:p.error)&&Fb(o),d=((x=o[23].queueState)==null?void 0:x.status)==="failed"&&Eb(o);return{c(){e=k("div"),t=k("span"),n=N(r),s=A(),f&&f.c(),i=A(),u&&u.c(),a=A(),d&&d.c(),l=ge(),h(t,"class","details svelte-18bqwhy"),h(e,"class","details-container svelte-18bqwhy")},m(g,_){v(g,e,_),S(e,t),S(t,n),S(t,s),f&&f.m(t,null),S(t,i),u&&u.m(t,null),v(g,a,_),d&&d.m(g,_),v(g,l,_),c=!0},p(g,_){var C,L,F;(!c||_&3)&&r!==(r=g[5](g[23]).text+"")&&Z(n,r),(C=g[23].queueState)!=null&&C.timestamp?f?f.p(g,_):(f=Pb(g),f.c(),f.m(t,i)):f&&(f.d(1),f=null),(L=g[23].queueState)!=null&&L.error?u?u.p(g,_):(u=Fb(g),u.c(),u.m(t,null)):u&&(u.d(1),u=null),((F=g[23].queueState)==null?void 0:F.status)==="failed"?d?(d.p(g,_),_&3&&y(d,1)):(d=Eb(g),d.c(),y(d,1),d.m(l.parentNode,l)):d&&(oe(),w(d,1,1,()=>{d=null}),ne())},i(g){c||(y(d),c=!0)},o(g){w(d),c=!1},d(g){g&&(b(e),b(a),b(l)),f&&f.d(),u&&u.d(),d&&d.d(g)}}}function VT(o){let e,t=o[9].default,r=ae(t,o,o[13],null),n=r||HT(o);return{c(){n&&n.c()},m(s,i){n&&n.m(s,i),e=!0},p(s,i){r?r.p&&(!e||i&8192)&&ce(r,t,s,s[13],e?le(t,s[13],i,null):fe(s[13]),null):n&&n.p&&(!e||i&3)&&n.p(s,e?i:-1)},i(s){e||(y(n,s),e=!0)},o(s){w(n,s),e=!1},d(s){n&&n.d(s)}}}function qT(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",i,a;var l=o[5](o[23]).icon;function c(f,u){return{props:{size:16,class:"svg-icon "+f[5](f[23]).iconClass}}}return l&&(t=is(l,c(o))),{c(){e=k("span"),t&&R(t.$$.fragment),r=A(),n=k("span"),i=N(s),h(e,"slot","name"),h(e,"class","file-name svelte-18bqwhy")},m(f,u){v(f,e,u),t&&M(t,e,null),S(e,r),S(e,n),S(n,i),a=!0},p(f,u){if(u&3&&l!==(l=f[5](f[23]).icon)){if(t){oe();let d=t;w(d.$$.fragment,1,0,()=>{D(d,1)}),ne()}l?(t=is(l,c(f,u)),R(t.$$.fragment),y(t.$$.fragment,1),M(t,e,r)):t=null}else if(l){let d={};u&3&&(d.class="svg-icon "+f[5](f[23]).iconClass),t.$set(d)}(!a||u&3)&&s!==(s=f[23].path.split("/").pop()+"")&&Z(i,s)},i(f){a||(t&&y(t.$$.fragment,f),a=!0)},o(f){t&&w(t.$$.fragment,f),a=!1},d(f){f&&b(e),t&&D(t)}}}function Mb(o){let e,t;return e=new ct({props:{$$slots:{name:[qT],default:[VT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Db(o){let e,t;return e=new ct({props:{$$slots:{name:[zT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function zT(o){let e,t,r=$b(o[1](o[20]).remainingCount)+"",n,s,i=o[20].title.toLowerCase()+"",a,l,c,f,u,d,m,p;function x(){return o[11](o[20])}function g(..._){return o[12](o[20],..._)}return{c(){var _;e=k("span"),t=N("...and "),n=N(r),s=N(` more
					`),a=N(i),l=A(),c=k("span"),f=N("(show more)"),d=A(),h(c,"class","show-more-link svelte-18bqwhy"),h(c,"role","button"),h(c,"tabindex","0"),h(c,"aria-label",u=`Show ${((_=o[2][o[20].title])==null?void 0:_.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),h(e,"slot","name"),h(e,"class","more-files svelte-18bqwhy")},m(_,C){v(_,e,C),S(e,t),S(e,n),S(e,s),S(e,a),S(e,l),S(e,c),S(c,f),S(e,d),m||(p=[j(c,"click",x),j(c,"keydown",g)],m=!0)},p(_,C){var L;o=_,C&3&&r!==(r=$b(o[1](o[20]).remainingCount)+"")&&Z(n,r),C&1&&i!==(i=o[20].title.toLowerCase()+"")&&Z(a,i),C&1&&u!==(u=`Show ${((L=o[2][o[20].title])==null?void 0:L.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&h(c,"aria-label",u)},d(_){_&&b(e),m=!1,be(p)}}}function Rb(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,i;e=new He({props:{name:o[20].title}});let a=_e(o[1](o[20]).visibleDocs),l=[];for(let u=0;u<a.length;u+=1)l[u]=Mb(Ab(o,a,u));let c=u=>w(l[u],1,1,()=>{l[u]=null}),f=n&&Db(o);return{c(){R(e.$$.fragment),t=A();for(let u=0;u<l.length;u+=1)l[u].c();r=A(),f&&f.c(),s=ge()},m(u,d){M(e,u,d),v(u,t,d);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(u,d);v(u,r,d),f&&f.m(u,d),v(u,s,d),i=!0},p(u,d){let m={};if(d&1&&(m.name=u[20].title),e.$set(m),d&8291){a=_e(u[1](u[20]).visibleDocs);let p;for(p=0;p<a.length;p+=1){let x=Ab(u,a,p);l[p]?(l[p].p(x,d),y(l[p],1)):(l[p]=Mb(x),l[p].c(),y(l[p],1),l[p].m(r.parentNode,r))}for(oe(),p=a.length;p<l.length;p+=1)c(p);ne()}d&3&&(n=u[1](u[20]).remainingCount>0),n?f?(f.p(u,d),d&3&&y(f,1)):(f=Db(u),f.c(),y(f,1),f.m(s.parentNode,s)):f&&(oe(),w(f,1,1,()=>{f=null}),ne())},i(u){if(!i){y(e.$$.fragment,u);for(let d=0;d<a.length;d+=1)y(l[d]);y(f),i=!0}},o(u){w(e.$$.fragment,u),l=l.filter(Bb);for(let d=0;d<l.length;d+=1)w(l[d]);w(f),i=!1},d(u){u&&(b(t),b(r),b(s)),D(e,u),qe(l,u),f&&f.d(u)}}}function WT(o){let e;return{c(){e=k("div"),e.textContent="Loading...",h(e,"class","loading")},m(t,r){v(t,e,r)},p:V,i:V,o:V,d(t){t&&b(e)}}}function jT(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:WT,then:NT,catch:BT,value:19,blocks:[,,,]};return mo(t=o[0],n),{c(){e=ge(),n.block.c()},m(s,i){v(s,e,i),n.block.m(s,n.anchor=i),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[i]){o=s,n.ctx=o,i&1&&t!==(t=o[0])&&mo(t,n)||cs(n,o,i)},i(s){r||(y(n.block),r=!0)},o(s){for(let i=0;i<3;i+=1){let a=n.blocks[i];w(a)}r=!1},d(s){s&&b(e),n.block.d(s),n.token=null,n=null}}}function $b(o){return new Intl.NumberFormat().format(o)}function Ob(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let i=Math.floor(s/24);return i===1?"yesterday":`${i} days ago`}function Ub(o){let e=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="running"}),t=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="failed"}),r=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="pending"}),n=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function KT(o,e,t){let r,n,s,i,a,{$$slots:l={},$$scope:c}=e,{folder:f}=e,{backgroundSync:u}=e,d={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},m=he({}),p=Ot(m,$=>I=>{let T=d[I.title]||d.default,O=$[I.title]||T.initialCount,G=I.documents.slice(0,O),J=I.documents.length-O;return{visibleCount:O,visibleDocs:G,remainingCount:J}});se(o,p,$=>t(1,a=$));function x($){let I=d[$]||d.default;m.update(T=>Object.assign(Object.assign({},T),{[$]:(T[$]||I.initialCount)+I.incrementCount}))}function g($){return Ne(this,void 0,void 0,function*(){var I;let T=[],O=Array.from($.docs.values());for(let G of O){let J=yield G.getOrigin(),q=yield G.getServerSynced(),E={guid:G.guid,path:$.getPath(G.path),doc:G,origin:J||"unknown",serverSynced:q},H=Array.from(r).find(de=>de.guid===G.guid),ue=Array.from(n).find(de=>de.guid===G.guid),ye=s.find(de=>de.guid===G.guid);if(H||ue||ye){let de=H||ue||ye;E.queueState={status:de.status,type:"type"in de?de.type:"sync",error:"error"in de?de.error:void 0,timestamp:"timestamp"in de?de.timestamp:Date.now()}}else J==="local"&&!q?E.queueState={status:"pending",type:"sync",timestamp:Date.now()}:q?E.queueState={status:"completed",type:"sync",timestamp:Date.now()}:E.queueState={status:"pending",type:"sync",timestamp:Date.now()};T.push(E)}return{folder:$,documents:T,progress:((I=u.getGroupProgress($))===null||I===void 0?void 0:I.percent)||0}})}function _($){let{origin:I,serverSynced:T,queueState:O}=$,G=(O==null?void 0:O.status)||"completed",J=(O==null?void 0:O.type)||"sync";return I==="remote"&&!T&&G==="running"&&J==="download"?{text:"Downloading",description:"Initial acquisition",icon:su,iconClass:"mod-primary"}:I==="remote"&&!T&&G==="pending"&&J==="download"?{text:"Queued for Download",description:"Waiting to download",icon:li,iconClass:""}:I==="remote"&&!T&&G==="failed"&&J==="download"?{text:"Download stuck",description:"Needs retry",icon:ci,iconClass:"mod-warning"}:I==="local"&&!T&&G==="running"&&J==="sync"?{text:"Uploading",description:"First-time upload",icon:Tu,iconClass:"mod-primary"}:I==="local"&&!T&&G==="pending"&&J==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:li,iconClass:""}:I==="local"&&!T&&G==="failed"&&J==="sync"?{text:"Upload stuck",description:"Needs retry",icon:ci,iconClass:"mod-warning"}:T&&G==="running"&&J==="sync"?{text:"Syncing",description:"Collaborative update",icon:Kf,iconClass:"mod-primary"}:T&&G==="pending"&&J==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:li,iconClass:""}:T&&G==="failed"&&J==="sync"?{text:"Sync stuck",description:"Needs retry",icon:ci,iconClass:"mod-warning"}:T&&G==="completed"?{text:"Complete",description:"Fully synchronized",icon:tu,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:cu,iconClass:""}}function C($){return Ne(this,void 0,void 0,function*(){var I,T;let O={id:$.guid,guid:$.guid,path:$.path,timestamp:((I=$.queueState)===null||I===void 0?void 0:I.timestamp)||Date.now(),type:((T=$.queueState)===null||T===void 0?void 0:T.type)||"sync",status:"failed",sharedFolderGuid:$.doc.sharedFolder.guid};yield u.retryLogItem(O)})}let L=$=>C($),F=$=>{x($.title)},P=($,I)=>I.key==="Enter"&&x($.title);return o.$$set=$=>{"folder"in $&&t(7,f=$.folder),"backgroundSync"in $&&t(8,u=$.backgroundSync),"$$scope"in $&&t(13,c=$.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(u.activeSync.items())}if(o.$$.dirty&256){e:n=new Set(u.activeDownloads.items())}if(o.$$.dirty&256){e:s=u.getSyncLog()}if(o.$$.dirty&128){e:t(0,i=g(f))}},[i,a,d,p,x,_,C,f,u,l,L,F,P,c]}var xp=class extends W{constructor(e){super(),K(this,e,KT,jT,z,{folder:7,backgroundSync:8},UT)}},bp=xp;var{Map:GT}=pn;function JT(o){we(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Nb(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function Hb(o){let e,t;return e=new He({props:{name:"Sync Status"}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Vb(o){let e,t;return e=new De({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[XT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function qb(o){let e,t,r,n,s,i,a=[YT,QT],l=[];function c(f,u){return f[9]?0:1}return t=c(o,-1),r=l[t]=a[t](o),{c(){e=k("button"),r.c(),h(e,"class","mod-cta")},m(f,u){v(f,e,u),l[t].m(e,null),n=!0,s||(i=j(e,"click",o[16]),s=!0)},p(f,u){let d=t;t=c(f,u),t!==d&&(oe(),w(l[d],1,1,()=>{l[d]=null}),ne(),r=l[t],r||(r=l[t]=a[t](f),r.c()),y(r,1),r.m(e,null))},i(f){n||(y(r),n=!0)},o(f){w(r),n=!1},d(f){f&&b(e),l[t].d(),s=!1,i()}}}function QT(o){let e,t,r;return e=new gu({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){R(e.$$.fragment),t=N(`
						Pause`)},m(n,s){M(e,n,s),v(n,t,s),r=!0},i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){n&&b(t),D(e,n)}}}function YT(o){let e,t,r;return e=new xu({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){R(e.$$.fragment),t=N(`
						Resume`)},m(n,s){M(e,n,s),v(n,t,s),r=!0},i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){n&&b(t),D(e,n)}}}function XT(o){let e,t,r=(o[11]||o[10])&&qb(o);return{c(){r&&r.c(),e=ge()},m(n,s){r&&r.m(n,s),v(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&y(r,1)):(r=qb(n),r.c(),y(r,1),r.m(e.parentNode,e)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(n){t||(y(r),t=!0)},o(n){w(r),t=!1},d(n){n&&b(e),r&&r.d(n)}}}function ZT(o){let e=[],t=new GT,r,n,s=_e(o[6]),i=a=>a[25].guid;for(let a=0;a<s.length;a+=1){let l=Nb(o,s,a),c=i(l);t.set(c,e[a]=Jb(c,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=ge()},m(a,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(a,l);v(a,r,l),n=!0},p(a,l){l&32851&&(s=_e(a[6]),oe(),e=Lg(e,l,i,1,a,s,t,r.parentNode,Cg,Jb,r,Nb),ne())},i(a){if(!n){for(let l=0;l<s.length;l+=1)y(e[l]);n=!0}},o(a){for(let l=0;l<e.length;l+=1)w(e[l]);n=!1},d(a){a&&b(r);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function eA(o){let e,t,r,n;return e=new He({props:{$$slots:{name:[iA],default:[nA]},$$scope:{ctx:o}}}),r=new bp({props:{folder:o[5],backgroundSync:o[0]}}),{c(){R(e.$$.fragment),t=A(),R(r.$$.fragment)},m(s,i){M(e,s,i),v(s,t,i),M(r,s,i),n=!0},p(s,i){let a={};i&536875040&&(a.$$scope={dirty:i,ctx:s}),e.$set(a);let l={};i&32&&(l.folder=s[5]),i&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(y(e.$$.fragment,s),y(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&b(t),D(e,s),D(r,s)}}}function zb(o){let e,t,r,n,s,i=o[26].progress+"",a,l;return{c(){e=k("div"),t=k("div"),r=k("div"),n=A(),s=k("span"),a=N(i),l=N("%"),h(r,"class","progress-value svelte-ztgdsf"),ie(r,"width",o[26].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,f){v(c,e,f),S(e,t),S(t,r),S(e,n),S(e,s),S(s,a),S(s,l)},p(c,f){f&80&&ie(r,"width",c[26].progress+"%"),f&80&&i!==(i=c[26].progress+"")&&Z(a,i)},d(c){c&&b(e)}}}function tA(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&zb(o);return{c(){t&&t.c(),e=ge()},m(r,n){t&&t.m(r,n),v(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=zb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&b(e),t&&t.d(r)}}}function Wb(o){let e,t=o[26].running+"",r,n;return{c(){e=k("span"),r=N(t),n=N(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&80&&t!==(t=s[26].running+"")&&Z(r,t)},d(s){s&&b(e)}}}function jb(o){let e,t=o[26].failed+"",r,n;return{c(){e=k("span"),r=N(t),n=N(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&80&&t!==(t=s[26].failed+"")&&Z(r,t)},d(s){s&&b(e)}}}function Kb(o){let e,t=o[26].pending+"",r,n;return{c(){e=k("span"),r=N(t),n=N(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&80&&t!==(t=s[26].pending+"")&&Z(r,t)},d(s){s&&b(e)}}}function rA(o){var F,P,$;let e,t,r,n,s,i=o[25].name+"",a,l,c,f,u,d,m,p,x=((F=o[26])==null?void 0:F.running)>0&&Wb(o),g=((P=o[26])==null?void 0:P.failed)>0&&jb(o),_=(($=o[26])==null?void 0:$.pending)>0&&Kb(o);function C(){return o[22](o[25])}function L(...I){return o[23](o[25],...I)}return{c(){e=k("div"),t=k("span"),r=N("\u25B6"),s=A(),a=N(i),l=A(),c=k("span"),x&&x.c(),f=A(),g&&g.c(),u=A(),_&&_.c(),h(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),h(c,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-expanded",d=!!o[1][o[25].guid])},m(I,T){v(I,e,T),S(e,t),S(t,r),S(e,s),S(e,a),S(e,l),S(e,c),x&&x.m(c,null),S(c,f),g&&g.m(c,null),S(c,u),_&&_.m(c,null),m||(p=[j(e,"click",C),j(e,"keydown",L)],m=!0)},p(I,T){var O,G,J;o=I,T&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&h(t,"class",n),T&64&&i!==(i=o[25].name+"")&&Z(a,i),((O=o[26])==null?void 0:O.running)>0?x?x.p(o,T):(x=Wb(o),x.c(),x.m(c,f)):x&&(x.d(1),x=null),((G=o[26])==null?void 0:G.failed)>0?g?g.p(o,T):(g=jb(o),g.c(),g.m(c,u)):g&&(g.d(1),g=null),((J=o[26])==null?void 0:J.pending)>0?_?_.p(o,T):(_=Kb(o),_.c(),_.m(c,null)):_&&(_.d(1),_=null),T&66&&d!==(d=!!o[1][o[25].guid])&&h(e,"aria-expanded",d)},d(I){I&&b(e),x&&x.d(),g&&g.d(),_&&_.d(),m=!1,be(p)}}}function oA(o){let e,t;return e=new Kr({props:{folder:o[25],$$slots:{default:[rA]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Gb(o){let e,t;return e=new bp({props:{folder:o[25],backgroundSync:o[0]}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Jb(o,e){let t,r,n,s,i;r=new He({props:{$$slots:{name:[oA],default:[tA]},$$scope:{ctx:e}}});let a=e[1][e[25].guid]&&Gb(e);return{key:o,first:null,c(){t=ge(),R(r.$$.fragment),n=A(),a&&a.c(),s=ge(),this.first=t},m(l,c){v(l,t,c),M(r,l,c),v(l,n,c),a&&a.m(l,c),v(l,s,c),i=!0},p(l,c){e=l;let f={};c&536870994&&(f.$$scope={dirty:c,ctx:e}),r.$set(f),e[1][e[25].guid]?a?(a.p(e,c),c&66&&y(a,1)):(a=Gb(e),a.c(),y(a,1),a.m(s.parentNode,s)):a&&(oe(),w(a,1,1,()=>{a=null}),ne())},i(l){i||(y(r.$$.fragment,l),y(a),i=!0)},o(l){w(r.$$.fragment,l),w(a),i=!1},d(l){l&&(b(t),b(n),b(s)),D(r,l),a&&a.d(l)}}}function Qb(o){let e,t,r,n,s,i=o[12].progress+"",a,l;return{c(){e=k("div"),t=k("div"),r=k("div"),n=A(),s=k("span"),a=N(i),l=N("%"),h(r,"class","progress-value svelte-ztgdsf"),ie(r,"width",o[12].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,f){v(c,e,f),S(e,t),S(t,r),S(e,n),S(e,s),S(s,a),S(s,l)},p(c,f){f&4096&&ie(r,"width",c[12].progress+"%"),f&4096&&i!==(i=c[12].progress+"")&&Z(a,i)},d(c){c&&b(e)}}}function nA(o){let e,t=(o[12].running>0||o[12].failed>0)&&Qb(o);return{c(){t&&t.c(),e=ge()},m(r,n){t&&t.m(r,n),v(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=Qb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&b(e),t&&t.d(r)}}}function Yb(o){let e,t=o[12].running+"",r,n;return{c(){e=k("span"),r=N(t),n=N(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&4096&&t!==(t=s[12].running+"")&&Z(r,t)},d(s){s&&b(e)}}}function Xb(o){let e,t=o[12].failed+"",r,n;return{c(){e=k("span"),r=N(t),n=N(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&4096&&t!==(t=s[12].failed+"")&&Z(r,t)},d(s){s&&b(e)}}}function Zb(o){let e,t=o[12].pending+"",r,n;return{c(){e=k("span"),r=N(t),n=N(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){v(s,e,i),S(e,r),S(e,n)},p(s,i){i&4096&&t!==(t=s[12].pending+"")&&Z(r,t)},d(s){s&&b(e)}}}function sA(o){let e,t=o[5].name+"",r,n,s,i,a,l=o[12].running>0&&Yb(o),c=o[12].failed>0&&Xb(o),f=o[12].pending>0&&Zb(o);return{c(){e=k("div"),r=N(t),n=A(),s=k("span"),l&&l.c(),i=A(),c&&c.c(),a=A(),f&&f.c(),h(s,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf")},m(u,d){v(u,e,d),S(e,r),S(e,n),S(e,s),l&&l.m(s,null),S(s,i),c&&c.m(s,null),S(s,a),f&&f.m(s,null)},p(u,d){d&32&&t!==(t=u[5].name+"")&&Z(r,t),u[12].running>0?l?l.p(u,d):(l=Yb(u),l.c(),l.m(s,i)):l&&(l.d(1),l=null),u[12].failed>0?c?c.p(u,d):(c=Xb(u),c.c(),c.m(s,a)):c&&(c.d(1),c=null),u[12].pending>0?f?f.p(u,d):(f=Zb(u),f.c(),f.m(s,null)):f&&(f.d(1),f=null)},d(u){u&&b(e),l&&l.d(),c&&c.d(),f&&f.d()}}}function iA(o){let e,t;return e=new Kr({props:{folder:o[5],$$slots:{default:[sA]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function aA(o){let e,t,r,n,s,i,a=!o[5]&&Hb(o),l=!o[5]&&Vb(o),c=[eA,ZT],f=[];function u(d,m){return d[5]&&d[12]?0:1}return n=u(o,-1),s=f[n]=c[n](o),{c(){e=k("div"),a&&a.c(),t=A(),l&&l.c(),r=A(),s.c(),h(e,"class","setting-item-container")},m(d,m){v(d,e,m),a&&a.m(e,null),S(e,t),l&&l.m(e,null),S(e,r),f[n].m(e,null),i=!0},p(d,[m]){d[5]?a&&(oe(),w(a,1,1,()=>{a=null}),ne()):a?m&32&&y(a,1):(a=Hb(d),a.c(),y(a,1),a.m(e,t)),d[5]?l&&(oe(),w(l,1,1,()=>{l=null}),ne()):l?(l.p(d,m),m&32&&y(l,1)):(l=Vb(d),l.c(),y(l,1),l.m(e,r));let p=n;n=u(d,m),n===p?f[n].p(d,m):(oe(),w(f[p],1,1,()=>{f[p]=null}),ne(),s=f[n],s?s.p(d,m):(s=f[n]=c[n](d),s.c()),y(s,1),s.m(e,null))},i(d){i||(y(a),y(l),y(s),i=!0)},o(d){w(a),w(l),w(s),i=!1},d(d){d&&b(e),a&&a.d(),l&&l.d(),f[n].d()}}}function lA(o,e,t){let r,n,s,i,a,l,c,f,u,d,m,{backgroundSync:p}=e,{sharedFolders:x}=e,{focusedFolderGuid:g}=e,_={},C=0,L=0,F=0,P=0,{activeSync:$,activeDownloads:I}=p;se(o,$,q=>t(21,m=q)),se(o,I,q=>t(20,d=q));function T(q){t(1,_[q]=!_[q],_),t(1,_),t(6,r),t(17,x)}function O(){l?p.resume():p.pause()}let G=q=>T(q.guid),J=(q,E)=>E.key==="Enter"&&T(q.guid);return o.$$set=q=>{"backgroundSync"in q&&t(0,p=q.backgroundSync),"sharedFolders"in q&&t(17,x=q.sharedFolders),"focusedFolderGuid"in q&&t(18,g=q.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=x.items().sort((q,E)=>q.name.localeCompare(E.name)))}if(o.$$.dirty&66){e:r.forEach(q=>{q.guid in _||t(1,_[q.guid]=!0,_)}),t(1,_),t(6,r),t(17,x)}if(o.$$.dirty&393216){e:t(5,n=g?x.items().find(q=>q.guid===g):void 0)}if(o.$$.dirty&3145793){e:t(4,s=new Map(r.map(q=>{var E,H;return[q.guid,{progress:((E=p.getGroupProgress(q))===null||E===void 0?void 0:E.percent)||0,running:[...m.items(),...d.items()].filter(ue=>ue.sharedFolder.guid===q.guid).length,failed:((H=p.syncGroups.get(q))===null||H===void 0?void 0:H.status)==="failed"?1:0,pending:[...p.pendingSyncs,...p.pendingDownloads].filter(ue=>ue.sharedFolder.guid===q.guid).length,completed:(()=>{let ue=p.syncGroups.get(q);return((ue==null?void 0:ue.completedSyncs)||0)+((ue==null?void 0:ue.completedDownloads)||0)})(),sharedFolder:q}]})))}if(o.$$.dirty&48){e:t(12,i=n?s.get(n.guid):void 0)}if(o.$$.dirty&1){e:t(19,a=p.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=a.isPaused)}if(o.$$.dirty&524288){e:c=a.syncsActive>0||a.downloadsActive>0}if(o.$$.dirty&16){e:{let q=0,E=0,H=0,ue=0;for(let ye of s.values())q+=ye.running,E+=ye.failed,H+=ye.pending,ue+=ye.completed;t(2,C=q),t(7,L=E),t(3,F=H),t(8,P=ue)}}if(o.$$.dirty&4){e:t(11,f=C>0)}if(o.$$.dirty&8){e:t(10,u=F>0)}},[p,_,C,F,s,n,r,L,P,l,u,f,i,$,I,T,O,x,g,a,d,m,G,J]}var vp=class extends W{constructor(e){super(),K(this,e,lA,aA,z,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},JT)}},ev=vp;var vi=class extends tv.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new ev({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function wp(o){return o.startsWith("v")?o.slice(1):o}function cA(o,e){return o.map((t,r)=>[t,e[r]])}function fA(o,e){try{let t=wp(o).split(".").map(parseInt),r=wp(e).split(".").map(parseInt);for(let[n,s]of cA(t,r))if(n>s)return!0}catch(t){}return!1}var El=class extends Ge{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new uo("system3-relay/releases"),this.releaseChannels=new uo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await lt("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return Fe().enableNetworkLogging&&this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await lt(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(this.debug("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),n=new Set([...this.githubReleases.keys()]),s=new Set;r.forEach(a=>{this.githubReleases.set(a.tag_name,a),s.add(a.tag_name)}),n.forEach(a=>{s.has(a)||this.githubReleases.delete(a)});let i=await this.fetchLatestRelease();i&&(i.latest=!0,this.githubReleases.set(i.tag_name,i)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let i=await this.fetchLatestTagFromChannel(s);if(!i)return null;let a=n.find(l=>wp(l.tag_name)===i);return a?(this.releaseChannels.set(s,a),this.notifyListeners(),a):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let i=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${i}`);let a=await lt(i);if(!a.ok)throw new Error("unable to fetch manifest");return await a.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(i=>i.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await lt(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return Fe().enableNetworkLogging&&this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&fA(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var bv=require("obsidian");var yv=require("obsidian");function uA(o){we(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function rv(o,e,t){let r=o.slice();return r[66]=e[t],r}function ov(o){let e,t;return e=new ct({props:{name:"Show all releases",$$slots:{default:[dA]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){M(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&128&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function dA(o){let e,t,r,n,s,i;return{c(){e=k("div"),t=k("input"),r=A(),n=k("div"),h(t,"type","checkbox"),t.checked=o[6],h(n,"class","checkbox-toggle"),h(e,"class","checkbox-container svelte-12doke6"),h(e,"role","checkbox"),h(e,"aria-checked",o[6]),h(e,"tabindex","0"),Be(e,"is-enabled",o[6])},m(a,l){v(a,e,l),S(e,t),S(e,r),S(e,n),s||(i=[j(e,"click",o[41]),j(e,"keydown",o[42])],s=!0)},p(a,l){l[0]&64&&(t.checked=a[6]),l[0]&64&&h(e,"aria-checked",a[6]),l[0]&64&&Be(e,"is-enabled",a[6])},d(a){a&&b(e),s=!1,be(i)}}}function pA(o){let e,t,r=!o[1]&&nv(o);function n(a,l){if(a[11])return xA;if(a[16])return yA}let s=n(o,[-1,-1,-1]),i=s&&s(o);return{c(){r&&r.c(),e=A(),i&&i.c(),t=ge()},m(a,l){r&&r.m(a,l),v(a,e,l),i&&i.m(a,l),v(a,t,l)},p(a,l){a[1]?r&&(r.d(1),r=null):r?r.p(a,l):(r=nv(a),r.c(),r.m(e.parentNode,e)),s===(s=n(a,l))&&i?i.p(a,l):(i&&i.d(1),i=s&&s(a),i&&(i.c(),i.m(t.parentNode,t)))},d(a){a&&(b(e),b(t)),r&&r.d(a),i&&i.d(a)}}}function mA(o){let e;return{c(){e=k("div"),e.textContent="No matching releases found with the current filter",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function hA(o){let e;return{c(){e=k("div"),e.textContent="No GitHub releases found",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function gA(o){let e;return{c(){e=k("div"),e.textContent="Loading GitHub releases...",h(e,"class","loading-text svelte-12doke6")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function nv(o){let e,t,r,n=!o[8].some(o[40]),s,i=o[5]&&sv(o),a=o[4]&&iv(o),l=n&&av(o),c=!o[1]&&lv(o);return{c(){e=k("div"),i&&i.c(),t=A(),a&&a.c(),r=A(),l&&l.c(),s=A(),c&&c.c(),h(e,"class","release-tags-container svelte-12doke6")},m(f,u){v(f,e,u),i&&i.m(e,null),S(e,t),a&&a.m(e,null),S(e,r),l&&l.m(e,null),S(e,s),c&&c.m(e,null)},p(f,u){f[5]?i?i.p(f,u):(i=sv(f),i.c(),i.m(e,t)):i&&(i.d(1),i=null),f[4]?a?a.p(f,u):(a=iv(f),a.c(),a.m(e,r)):a&&(a.d(1),a=null),u[0]&256&&(n=!f[8].some(f[40])),n?l?l.p(f,u):(l=av(f),l.c(),l.m(e,s)):l&&(l.d(1),l=null),f[1]?c&&(c.d(1),c=null):c?c.p(f,u):(c=lv(f),c.c(),c.m(e,null))},d(f){f&&b(e),i&&i.d(),a&&a.d(),l&&l.d(),c&&c.d()}}}function sv(o){let e,t,r,n,s;return{c(){e=k("div"),t=k("div"),t.textContent="Stable",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="stable"),h(e,"tabindex","0")},m(i,a){v(i,e,a),S(e,t),n||(s=[j(e,"click",o[43]),j(e,"keydown",o[44])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="stable")&&h(e,"aria-selected",r)},d(i){i&&b(e),n=!1,be(s)}}}function iv(o){let e,t,r,n,s;return{c(){e=k("div"),t=k("div"),t.textContent="Beta",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="beta"),h(e,"tabindex","0")},m(i,a){v(i,e,a),S(e,t),n||(s=[j(e,"click",o[45]),j(e,"keydown",o[46])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="beta")&&h(e,"aria-selected",r)},d(i){i&&b(e),n=!1,be(s)}}}function av(o){let e,t,r,n,s;return{c(){e=k("div"),t=k("div"),t.textContent="Dev",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item development-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[10]===o[0].version),h(e,"tabindex","0")},m(i,a){v(i,e,a),S(e,t),n||(s=[j(e,"click",o[47]),j(e,"keydown",o[48])],n=!0)},p(i,a){a[0]&1025&&r!==(r=i[10]===i[0].version)&&h(e,"aria-selected",r)},d(i){i&&b(e),n=!1,be(s)}}}function lv(o){let e,t=_e(o[8]),r=[];for(let n=0;n<t.length;n+=1)r[n]=cv(rv(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ge()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);v(n,e,s)},p(n,s){if(s[0]&268436736|s[1]&17){t=_e(n[8]);let i;for(i=0;i<t.length;i+=1){let a=rv(n,t,i);r[i]?r[i].p(a,s):(r[i]=cv(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&b(e),qe(r,n)}}}function cv(o){let e,t,r=o[66].tag_name+"",n,s,i,a,l,c;function f(){return o[49](o[66])}function u(...d){return o[50](o[66],...d)}return{c(){e=k("div"),t=k("div"),n=N(r),s=A(),h(t,"class","tag-name svelte-12doke6"),h(e,"class",i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(gv(o[66])?"pre-release":"")+" svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",a=o[10]===o[66].tag_name),h(e,"tabindex","0")},m(d,m){v(d,e,m),S(e,t),S(t,n),S(e,s),l||(c=[j(e,"click",f),j(e,"keydown",u)],l=!0)},p(d,m){o=d,m[0]&256&&r!==(r=o[66].tag_name+"")&&Z(n,r),m[0]&256&&i!==(i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(gv(o[66])?"pre-release":"")+" svelte-12doke6")&&h(e,"class",i),m[0]&1280&&a!==(a=o[10]===o[66].tag_name)&&h(e,"aria-selected",a)},d(d){d&&b(e),l=!1,be(c)}}}function yA(o){let e,t,r,n,s,i,a;return{c(){e=k("div"),t=k("div"),r=N(o[16]),n=A(),s=k("button"),s.textContent="Close",h(t,"class","manifest-error-message svelte-12doke6"),h(s,"class","manifest-close-btn svelte-12doke6"),h(e,"class","manifest-error svelte-12doke6")},m(l,c){v(l,e,c),S(e,t),S(t,r),S(e,n),S(e,s),i||(a=j(s,"click",o[37]),i=!0)},p(l,c){c[0]&65536&&Z(r,l[16])},d(l){l&&b(e),i=!1,a()}}}function xA(o){var q;let e,t,r,n,s,i,a=(q=o[38](o[10]))==null?void 0:q.prerelease,l,c,f,u,d,m,p,x,g,_,C=a&&fv(o),L=o[12][o[10]]==="beta-alias"&&uv(o),F=o[12][o[10]]==="stable-alias"&&dv(o);function P(E,H){if(H[0]&9216&&(d=null),H[0]&1024&&(m=null),d==null&&(d=!!((E[38](E[10])||E[13][E[10]]==="stable-alias"||E[13][E[10]]==="beta-alias")&&!E[28](E[10]))),d)return vA;if(m==null&&(m=!!E[28](E[10])),m)return bA}let $=P(o,[-1,-1,-1]),I=$&&$(o);function T(E,H){return E[13][E[10]]==="stable-alias"||E[13][E[10]]==="beta-alias"||E[9]==="development"?IA:E[10]?kA:SA}let O=T(o,[-1,-1,-1]),G=O(o),J=o[15]&&pv(o);return{c(){e=k("div"),t=k("div"),r=k("h3"),n=N("Release Details: "),s=N(o[10]),i=A(),C&&C.c(),l=A(),L&&L.c(),c=A(),F&&F.c(),f=A(),u=k("div"),I&&I.c(),p=A(),x=k("div"),g=k("div"),G.c(),_=A(),J&&J.c(),h(r,"class","svelte-12doke6"),h(u,"class","manifest-header-actions svelte-12doke6"),h(t,"class","manifest-header svelte-12doke6"),h(g,"class","release-changelog-content svelte-12doke6"),h(x,"class","release-changelog svelte-12doke6"),h(e,"class","manifest-container svelte-12doke6")},m(E,H){v(E,e,H),S(e,t),S(t,r),S(r,n),S(r,s),S(r,i),C&&C.m(r,null),S(r,l),L&&L.m(r,null),S(r,c),F&&F.m(r,null),S(t,f),S(t,u),I&&I.m(u,null),S(e,p),S(e,x),S(x,g),G.m(g,null),S(e,_),J&&J.m(e,null)},p(E,H){var ue;H[0]&1024&&Z(s,E[10]),H[0]&1024&&(a=(ue=E[38](E[10]))==null?void 0:ue.prerelease),a?C||(C=fv(E),C.c(),C.m(r,l)):C&&(C.d(1),C=null),E[12][E[10]]==="beta-alias"?L||(L=uv(E),L.c(),L.m(r,c)):L&&(L.d(1),L=null),E[12][E[10]]==="stable-alias"?F||(F=dv(E),F.c(),F.m(r,null)):F&&(F.d(1),F=null),$===($=P(E,H))&&I?I.p(E,H):(I&&I.d(1),I=$&&$(E),I&&(I.c(),I.m(u,null))),O===(O=T(E,H))&&G?G.p(E,H):(G.d(1),G=O(E),G&&(G.c(),G.m(g,null))),E[15]?J?J.p(E,H):(J=pv(E),J.c(),J.m(e,null)):J&&(J.d(1),J=null)},d(E){E&&b(e),C&&C.d(),L&&L.d(),F&&F.d(),I&&I.d(),G.d(),J&&J.d()}}}function fv(o){let e;return{c(){e=k("span"),e.textContent="Pre-release",h(e,"class","prerelease-badge svelte-12doke6")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function uv(o){let e;return{c(){e=k("span"),e.textContent="Beta",h(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function dv(o){let e;return{c(){e=k("span"),e.textContent="Stable",h(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function bA(o){let e;return{c(){e=k("span"),e.textContent="Installed",h(e,"class","currently-installed svelte-12doke6")},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function vA(o){let e,t,r,n;function s(l,c){return l[14]===l[10]?_A:wA}let i=s(o,[-1,-1,-1]),a=i(o);return{c(){e=k("button"),a.c(),h(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[14]===o[10]||o[2]},m(l,c){v(l,e,c),a.m(e,null),r||(n=j(e,"click",o[51]),r=!0)},p(l,c){i!==(i=s(l,c))&&(a.d(1),a=i(l),a&&(a.c(),a.m(e,null))),c[0]&17412&&t!==(t=l[14]===l[10]||l[2])&&(e.disabled=t)},d(l){l&&b(e),a.d(),r=!1,n()}}}function wA(o){let e;return{c(){e=N("Install")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function _A(o){let e;return{c(){e=N("Installing...")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function SA(o){let e;return{c(){e=N('"No changelog available"')},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function kA(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:TA,then:LA,catch:CA,value:65};return mo(t=o[34](((n=o[38](o[10]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=ge(),r.block.c()},m(s,i){v(s,e,i),r.block.m(s,r.anchor=i),r.mount=()=>e.parentNode,r.anchor=e},p(s,i){var a;o=s,r.ctx=o,i[0]&1024&&t!==(t=o[34](((a=o[38](o[10]))==null?void 0:a.body)||"No changelog available"))&&mo(t,r)||cs(r,o,i)},d(s){s&&b(e),r.block.d(s),r.token=null,r=null}}}function IA(o){let e;function t(s,i){if(s[13][s[10]]==="stable-alias")return FA;if(s[13][s[10]]==="beta-alias")return PA;if(s[10]===s[0].version)return AA}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=ge()},m(s,i){n&&n.m(s,i),v(s,e,i)},p(s,i){r!==(r=t(s,i))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&b(e),n&&n.d(s)}}}function CA(o){return{c:V,m:V,p:V,d:V}}function LA(o){let e,t=o[65]+"",r;return{c(){e=new Ho(!1),r=ge(),e.a=r},m(n,s){e.m(t,n,s),v(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[65]+"")&&e.p(t)},d(n){n&&(b(r),e.d())}}}function TA(o){let e;return{c(){e=N('"loading..."')},m(t,r){v(t,e,r)},p:V,d(t){t&&b(e)}}}function AA(o){let e;return{c(){e=k("p"),e.textContent="Current development version"},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function PA(o){let e;return{c(){e=k("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function FA(o){let e;return{c(){e=k("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function pv(o){let e,t,r,n,s,i=o[11].version+"",a,l,c=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),f,u,d,m,p,x=o[11].name+"",g,_,C,L,F,P,$=o[11].author+"",I,T,O,G,J,q,E=o[11].description+"",H,ue,ye,de,ee,Ie,B=o[11].isDesktopOnly?"Yes":"No",U,me,Y,ke,Re,Oe,xe=o[11].minAppVersion+"",gt,it=c&&mv(o);return{c(){e=k("div"),t=k("div"),r=k("span"),r.textContent="Version:",n=A(),s=k("span"),a=N(i),l=A(),it&&it.c(),f=A(),u=k("div"),d=k("span"),d.textContent="Name:",m=A(),p=k("span"),g=N(x),_=A(),C=k("div"),L=k("span"),L.textContent="Author:",F=A(),P=k("span"),I=N($),T=A(),O=k("div"),G=k("span"),G.textContent="Description:",J=A(),q=k("span"),H=N(E),ue=A(),ye=k("div"),de=k("span"),de.textContent="isDesktopOnly:",ee=A(),Ie=k("span"),U=N(B),me=A(),Y=k("div"),ke=k("span"),ke.textContent="minAppVersion:",Re=A(),Oe=k("span"),gt=N(xe),h(r,"class","manifest-label svelte-12doke6"),h(s,"class","manifest-value svelte-12doke6"),h(t,"class","manifest-field svelte-12doke6"),h(d,"class","manifest-label svelte-12doke6"),h(p,"class","manifest-value svelte-12doke6"),h(u,"class","manifest-field svelte-12doke6"),h(L,"class","manifest-label svelte-12doke6"),h(P,"class","manifest-value svelte-12doke6"),h(C,"class","manifest-field svelte-12doke6"),h(G,"class","manifest-label svelte-12doke6"),h(q,"class","manifest-value svelte-12doke6"),h(O,"class","manifest-field svelte-12doke6"),h(de,"class","manifest-label svelte-12doke6"),h(Ie,"class","manifest-value svelte-12doke6"),h(ye,"class","manifest-field svelte-12doke6"),h(ke,"class","manifest-label svelte-12doke6"),h(Oe,"class","manifest-value svelte-12doke6"),h(Y,"class","manifest-field svelte-12doke6"),h(e,"class","manifest-content svelte-12doke6")},m(rt,xt){v(rt,e,xt),S(e,t),S(t,r),S(t,n),S(t,s),S(s,a),S(t,l),it&&it.m(t,null),S(e,f),S(e,u),S(u,d),S(u,m),S(u,p),S(p,g),S(e,_),S(e,C),S(C,L),S(C,F),S(C,P),S(P,I),S(e,T),S(e,O),S(O,G),S(O,J),S(O,q),S(q,H),S(e,ue),S(e,ye),S(ye,de),S(ye,ee),S(ye,Ie),S(Ie,U),S(e,me),S(e,Y),S(Y,ke),S(Y,Re),S(Y,Oe),S(Oe,gt)},p(rt,xt){xt[0]&2048&&i!==(i=rt[11].version+"")&&Z(a,i),xt[0]&3072&&(c=rt[10]!==rt[11].version&&!rt[10].startsWith("v"+rt[11].version)),c?it||(it=mv(rt),it.c(),it.m(t,null)):it&&(it.d(1),it=null),xt[0]&2048&&x!==(x=rt[11].name+"")&&Z(g,x),xt[0]&2048&&$!==($=rt[11].author+"")&&Z(I,$),xt[0]&2048&&E!==(E=rt[11].description+"")&&Z(H,E),xt[0]&2048&&B!==(B=rt[11].isDesktopOnly?"Yes":"No")&&Z(U,B),xt[0]&2048&&xe!==(xe=rt[11].minAppVersion+"")&&Z(gt,xe)},d(rt){rt&&b(e),it&&it.d()}}}function mv(o){let e;return{c(){e=k("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,h(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){v(t,e,r)},d(t){t&&b(e)}}}function EA(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,i,a,l,c,f,u=!o[1]&&ov(o);function d(x,g){return x[7]?gA:x[3].length===0?hA:x[8].length===0?mA:pA}let m=d(o,[-1,-1,-1]),p=m(o);return{c(){e=k("div"),r=N(t),n=A(),s=k("div"),i=k("div"),a=A(),l=k("div"),u&&u.c(),c=A(),p.c(),h(e,"class","modal-title"),h(i,"class","settings-spacer svelte-12doke6"),h(l,"class","settings-container svelte-12doke6"),h(s,"class","modal-content svelte-12doke6")},m(x,g){v(x,e,g),S(e,r),v(x,n,g),v(x,s,g),S(s,i),S(s,a),S(s,l),u&&u.m(l,null),S(s,c),p.m(s,null),f=!0},p(x,g){(!f||g[0]&2)&&t!==(t=x[1]?"Relay installer":"Relay releases")&&Z(r,t),x[1]?u&&(oe(),w(u,1,1,()=>{u=null}),ne()):u?(u.p(x,g),g[0]&2&&y(u,1)):(u=ov(x),u.c(),y(u,1),u.m(l,null)),m===(m=d(x,g))&&p?p.p(x,g):(p.d(1),p=m(x),p&&(p.c(),p.m(s,null)))},i(x){f||(y(u),f=!0)},o(x){w(u),f=!1},d(x){x&&(b(e),b(n),b(s)),u&&u.d(),p.d()}}}var hv="system3-relay";function vn(o){return o.startsWith("v")?o.substring(1):o}function gv(o){return(o==null?void 0:o.prerelease)===!0}function MA(o,e,t){let r,n,s,i,a,l,c,f,u,d,m,p,x,g,_,C,{plugin:L}=e,{version:F}=e,P=he(L.manifest.version),$=he(!1),I=he(""),T=he(""),O=he(!1);se(o,O,Q=>t(7,c=Q));let G=he(!1);se(o,G,Q=>t(6,l=Q));let J=he(null);se(o,J,Q=>t(11,m=Q));let q=he("");se(o,q,Q=>t(10,d=Q));let E=he(null),H=he(null);se(o,H,Q=>t(16,C=Q));let ue=he(!1);se(o,ue,Q=>t(15,_=Q));let ye=he(null);se(o,ye,Q=>t(5,s=Q));let de=he(null);se(o,de,Q=>t(4,n=Q));let ee=he(null);se(o,ee,Q=>t(53,a=Q));let Ie=he(null);se(o,Ie,Q=>t(52,i=Q));let B=he(!1),U=!1,me=he(null);se(o,me,Q=>t(14,g=Q));let Y=L.app;function ke(Q){let Ce=vn(Q),nt=vn(L.version);return Ce===nt}let Re=he({});se(o,Re,Q=>t(13,x=Q));let Oe=he({});se(o,Oe,Q=>t(12,p=Q));let xe=he(L.releaseSettings.get().channel);se(o,xe,Q=>t(9,u=Q)),$t(()=>{xt(),gt(),!F&&!r.some(Q=>{Q.tag_name,L.version})?xe.set(null):xe.set(L.releaseSettings.get().channel),J.set({version:F||L.version,name:L.manifest.name,author:L.manifest.author,description:L.manifest.description,isDesktopOnly:L.manifest.isDesktopOnly,minAppVersion:L.manifest.minAppVersion}),q.set(F||L.version)});function gt(){return Ne(this,void 0,void 0,function*(){B.set(!0);try{let Q=yield L.updateManager.fetchRepoManifest("manifest.json");Q&&(ye.set(Q),ee.set(Q.version));let Ce=yield L.updateManager.fetchRepoManifest("manifest-beta.json");Ce&&(de.set(Ce),Ie.set(Ce.version))}catch(Q){L.error("Error fetching main branch manifests:",Q)}finally{B.set(!1)}})}let it=Ot(L.updateManager,()=>L.updateManager.releases);se(o,it,Q=>t(3,r=Q));let rt=Ot([it,G],()=>r&&r.length>0?Jo(l).sort():[]);se(o,rt,Q=>t(8,f=Q)),r.forEach(Q=>Ne(void 0,void 0,void 0,function*(){try{let Ce=yield L.updateManager.fetchReleaseManifest(Q);Ce&&Re.update(nt=>Object.assign(Object.assign({},nt),{[Q.tag_name]:Ce.version}))}catch(Ce){}}));function xt(){return Ne(this,void 0,void 0,function*(){O.set(!0);try{yield L.updateManager.getReleases(),Jo(l)}catch(Q){L.error("Error refreshing GitHub releases:",Q)}finally{O.set(!1)}})}function bs(Q){return Ne(this,void 0,void 0,function*(){let Ce=document.createElement("div");return yield yv.MarkdownRenderer.render(L.app,Q,Ce,"",L),Ce.innerHTML})}function Jo(Q){return Q?r:F?r.filter(Ce=>F===vn(Ce.tag_name)):r.filter(Ce=>{let nt=Ce.tag_name;return vs(Ce)})}function vs(Q){if(Q.prerelease||Q.draft)return!1;if(Q.latest||vn(Q.tag_name)===a||vn(Q.tag_name)===i)return!0;let Ce=new Date(Q.created_at),nt=new Date;return nt.setMonth(nt.getMonth()-3),Ce>nt}function ve(Q){return Ne(this,void 0,void 0,function*(){H.set(null),E.set(Q);try{let Ce=ws(Q);if(!Ce){H.set(`Could not find release for ${Q}`);return}let nt=yield L.updateManager.fetchReleaseManifest(Ce);nt?(J.set(nt),q.set(Q),ue.set(!1),Re.update(So=>Object.assign(Object.assign({},So),{[Q]:nt.version}))):H.set(`Could not find manifest for ${Q}`)}catch(Ce){L.error("Error fetching manifest:",Ce),H.set(`Error fetching manifest: ${Ce.message||"Unknown error"}`)}finally{E.set(null)}})}function ot(Q){let Ce=Q==="stable"?s:n;if(Ce){let nt=Ce.version;xe.set(Q);let So=[...r.values()].find(_r=>vn(_r.tag_name)===vn(nt));So?(Q==="stable"?Oe.update(_r=>Object.assign(Object.assign({},_r),{[So.tag_name]:"stable-alias"})):Oe.update(_r=>Object.assign(Object.assign({},_r),{[So.tag_name]:"beta-alias"})),ve(So.tag_name)):(J.set(Ce),q.set(nt),Q==="stable"?Oe.update(_r=>Object.assign(Object.assign({},_r),{[nt]:"stable-alias"})):Oe.update(_r=>Object.assign(Object.assign({},_r),{[nt]:"beta-alias"})),ue.set(!1))}else H.set(`Could not find ${Q} manifest`)}function Ht(){J.set(null),q.set(""),H.set(null)}function ws(Q){return[...r.values()].find(Ce=>Ce.tag_name===Q)}function _s(Q){return Ne(this,void 0,void 0,function*(){try{me.set(Q);let Ce=ws(Q);if(!Ce)throw new Error(`Could not find release for ${Q}`);let nt=yield L.updateManager.fetchReleaseManifest(Ce);if(!nt)throw new Error(`Could not find manifest for ${Q}`);t(2,U=!0),yield Y.plugins.installPlugin(L.repo,Q,nt),yield Y.plugins.disablePlugin(hv),yield Y.plugins.enablePlugin(hv)}catch(Ce){console.error(`Error installing version ${Q}:`,Ce),L&&L.error(`Error installing version ${Q}:`,Ce)}finally{L&&(t(2,U=!1),me.set(null))}})}let Dl=Q=>ke(Q.tag_name),_i=()=>{G.update(Q=>!Q)},Rl=Q=>{(Q.key==="Enter"||Q.key===" ")&&G.update(Ce=>!Ce)},$l=()=>{L.releaseSettings.update(Q=>({...Q,channel:"stable"})),xe.set("stable"),ot("stable")},Ol=Q=>{(Q.key==="Enter"||Q.key===" ")&&(L.releaseSettings.update(Ce=>({...Ce,channel:"stable"})),xe.set("stable"),ot("stable"))},Ul=()=>{L.releaseSettings.update(Q=>({...Q,channel:"beta"})),xe.set("beta"),ot("beta")},Bl=Q=>{(Q.key==="Enter"||Q.key===" ")&&(L.releaseSettings.update(Ce=>({...Ce,channel:"beta"})),xe.set("beta"),ot("beta"))},Nl=()=>{xe.set(null),J.set({version:L.manifest.version,name:L.manifest.name,author:L.manifest.author,description:L.manifest.description,isDesktopOnly:L.manifest.isDesktopOnly,minAppVersion:L.manifest.minAppVersion}),q.set(L.version),ue.set(!1)},Hl=Q=>{(Q.key==="Enter"||Q.key===" ")&&(xe.set(null),J.set({version:L.manifest.version,name:L.manifest.name,author:L.manifest.author,description:L.manifest.description,isDesktopOnly:L.manifest.isDesktopOnly,minAppVersion:L.manifest.minAppVersion}),q.set(L.version),ue.set(!1))},Vl=Q=>{xe.set(null),ve(Q.tag_name)},ql=(Q,Ce)=>{(Ce.key==="Enter"||Ce.key===" ")&&(xe.set(null),ve(Q.tag_name))},zl=async()=>{_s(d)};return o.$$set=Q=>{"plugin"in Q&&t(0,L=Q.plugin),"version"in Q&&t(1,F=Q.version)},[L,F,U,r,n,s,l,c,f,u,d,m,p,x,g,_,C,O,G,J,q,H,ue,ye,de,ee,Ie,me,ke,Re,Oe,xe,it,rt,bs,ve,ot,Ht,ws,_s,Dl,_i,Rl,$l,Ol,Ul,Bl,Nl,Hl,Vl,ql,zl]}var _p=class extends W{constructor(e){super(),K(this,e,MA,EA,z,{plugin:0,version:1},uA,[-1,-1,-1])}},xv=_p;var wi=class extends bv.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new xv({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var DA={debugging:!1},RA={release:{channel:"stable"},sharedFolders:[],...Qs,...DA},Ml=class extends _v.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.5.11";this.repo="No-Instructions/Relay"}enableDebugging(t){la(!0),console.warn("RelayInstances",_t),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){la(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return la(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=tt.moment.now();_t.set(this,"plugin"),this.timeProvider=new es,this.register(()=>{this.timeProvider.destroy()}),Nh(new Al(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new Tl,this.debug=Se("[System 3][Relay]","debug"),this.log=Se("[System 3][Relay]","log"),this.warn=Se("[System 3][Relay]","warn"),this.error=Se("[System 3][Relay]","error"),this.settings=new wa(this,RA),await this.settings.load(),this.featureSettings=new Kt(this.settings,"(enable*)"),this.debugSettings=new Kt(this.settings,"(debugging)"),this.folderSettings=new Kt(this.settings,"sharedFolders"),this.releaseSettings=new Kt(this.settings,"release"),this.loginSettings=new Kt(this.settings,"login"),pt.getInstance().setSettings(this.featureSettings),this.settingsTab=new il(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new El(this,this.timeProvider,this.releaseSettings),this.debugSettings.subscribe(i=>{i.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let a=new Cl(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new Pl(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new Ll(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let a=new wi(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let a=new Fl(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let a=new vi(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))});let n=`async function() {
			const app = window.app;
			await app.plugins.disablePlugin("system3-relay");
			await app.plugins.enablePlugin("system3-relay");
		}`;this.app.reloadRelay=new Function("return "+n),this.addCommand({id:"reload",name:"Reload Relay",callback:this.app.reloadRelay()}),this.updateManager.subscribe(()=>{let i=this.updateManager.getNewRelease();i?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${i.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(i)}}),this.log(`Update available: v${this.version} \u2192 ${i.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new _a(this.appId),this.loginManager=new cl(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this),this.loginSettings),this.relayManager=new kl(this.loginManager),this.sharedFolders=new ka(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new wl(this.loginManager,this.timeProvider,s,3),this.networkStatus=new Wx(this.timeProvider,"https://api.system3.md/health?version=0.5.11"),this.backgroundSync=new Il(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new tt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new qa(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),vv.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(i=>i.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(us,i=>new Ua(i)),this.registerEvent(this.app.workspace.on("file-menu",(i,a)=>{if(a instanceof tt.TFolder){let l=this.sharedFolders.find(c=>c.path===a.path);if(!l)return;l.relayId&&(i.addItem(c=>{c.setTitle("Relay settings").setIcon("gear").onClick(()=>{this.openSettings(`/relays?id=${l.relayId}`)})}),i.addItem(c=>{c.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${l.guid}&relay=${l.relayId}`)})}),i.addItem(c=>{c.setTitle(l.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{l.connected?(l.shouldConnect=!1,l.disconnect()):(l.shouldConnect=!0,l.connect()),this._liveViews.refresh("folder connection toggle")})})),l.relayId&&Fe().enableSyncModal&&i.addItem(c=>{c.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new vi(this.app,this.backgroundSync,this.sharedFolders,l.guid);this.openModals.push(f),f.open()})}),Fe().enableSyncMenu&&l.relayId&&l.connected&&i.addItem(c=>{c.setTitle("Sync").setIcon("folder-sync").onClick(()=>{l.netSync()})})}else if(a instanceof tt.TFile){let l=this.sharedFolders.lookup(a.path),c=l==null?void 0:l.getFile(a);c&&br(c)&&(i.addItem(f=>{f.setTitle("Download").setIcon("cloud-download").onClick(async()=>{await c.pull(),new tt.Notice(`Download complete: ${c.name}`)})}),this.debugSettings.get().debugging&&i.addItem(f=>{f.setTitle("Verify upload").setIcon("search-check").onClick(async()=>{let u=await c.verifyUpload();new tt.Notice(`${c.name} ${u?"on server":"missing from server"}`)})}),i.addItem(f=>{f.setTitle("Upload").setIcon("cloud-upload").onClick(async()=>{await c.push(!0);let u=await c.verifyUpload();new tt.Notice(`${u?"File uploaded:":"File upload failed:"} ${c.name}`)})}))}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=tt.moment.now()-t})}async reload(){this.app.reloadRelay()()}_createSharedFolder(t,r,n,s){let i=new Kt(this.settings,`sharedFolders/[guid=${r}]`),a={guid:r,path:t};return n&&(a.relay=n),i.update(c=>({...c,path:t,guid:r,...n?{relay:n}:{},sync:c.sync?c.sync:Bo.defaultFlags}),!0),new Sa(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.hashStore,this.backgroundSync,i,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let i=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=i==null?void 0:i.instance)!=null&&s.options)||!i.enabled){this.warn("Webviewer plugin not found or not initialized");return}let a=i.instance.options,l=Object.getOwnPropertyDescriptor(a,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(a,"openExternalURLs",{get(){var d;let u=window.event;if((u==null?void 0:u.type)==="open-url"&&((d=u==null?void 0:u.detail)!=null&&d.url)){let m=u.detail.url;for(let p of t.interceptedUrls)if(typeof p=="string"&&m.startsWith(p)||p instanceof RegExp&&p.test(m))return t.log("Intercepted webviewer, opening in default browser",u.detail.url),!1}return l.value},set(u){l.value=u},configurable:!0}),this.register(()=>{Object.defineProperty(a,"openExternalURLs",l)}),this.loginManager.getWebviewIntercepts().forEach(u=>{this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u)});let f=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(i){this.error("Failed to patch webviewer:",i)}}setup(){this.folderNavDecorations=new ja(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Se("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Se("[System 3][Relay][Vault]","log"),n=c=>{},s=c=>n(c);window.addEventListener("unhandledrejection",s,!0),this.register(()=>window.removeEventListener("unhandledrejection",s,!0)),this.registerEvent(this.app.vault.on("create",c=>{let f=this.sharedFolders.lookup(c.path);f&&(f.placeHold([c]).length>0?f.uploadFile(c):f.whenReady().then(d=>{d.getFile(c)}))})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof tt.TFolder){let u=this.sharedFolders.find(d=>d.path===c.path);if(u){this.sharedFolders.delete(u);return}}let f=this.sharedFolders.lookup(c.path);f&&(r("Delete",c.path),f.whenReady().then(u=>{u.proxy.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,f)=>{if(c instanceof tt.TFolder){let p=this.sharedFolders.find(x=>x.path==f);if(p){p.move(c.path),this.sharedFolders.update();return}}let u=this.sharedFolders.lookup(f),d=this.sharedFolders.lookup(c.path),m=u||d;u&&d?(r("Rename",c.path,f),u.renameFile(c,f),d.renameFile(c,f),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):m&&(r("Rename",c,f),m.renameFile(c,f),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",c=>{let f=this.sharedFolders.lookup(c.path);if(f){r("Modify",c.path);let u=f.proxy.getFile(c);u&&br(u)&&u.sync(),this.timeProvider.setTimeout(()=>{this.app.metadataCache.trigger("resolve",u)},10)}}));let i=this,a=go(tt.MarkdownView.prototype,{onUnloadFile(c){return function(f){return i._liveViews.wipe(),c.call(this,f)}}});this.register(a);let l=go(this.app.vault,{process(c){return function(f,u,d){try{let m=i.sharedFolders.lookup(f.path);if(m){let p=m.proxy.getFile(f);f instanceof tt.TFile&&p&&er(p)&&p.process(u)}}catch(m){i.log(m)}return c.call(this,f,u,d)}}});this.register(l),this.patchWebviewer(),Do(lo.enableNewLinkFormat,()=>{let c=go(tt.MetadataCache.prototype,{fileToLinktext(f){return function(u,d,m){if(i.sharedFolders.lookup(u.path)){m===void 0&&(m=!0);let x=u.extension==="md"&&m?u.basename:u.name,g=(0,tt.normalizePath)(u.name),_=i.app.metadataCache.uniqueFileLookup.get(g.toLowerCase());if(_&&_.length===1&&_[0]===u)return x;{let C=u.extension==="md"&&m?u.path.slice(0,u.path.length-3):u.path,L=(0,wv.relative)(d,C);return L==="../"+x?"./"+x:L}}return f.call(this,u,d,m)}}});this.register(c)}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let f=c,u=new URLSearchParams({...f}).toString(),d=`/${f.action.split("/").slice(-1)}?${u}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let f=c,u=new URLSearchParams({...f}).toString(),d=`/${f.action.split("/").slice(-1)}?${u}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/upgrade",async c=>{var d;let u=(d=c.version)==null?void 0:d.trim();this.installVersion(u)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new wi(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,tt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,i,a,l,c,f,u,d,m,p,x;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(us),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(i=this.tokenStore)==null||i.stop(),(a=this.tokenStore)==null||a.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(f=this.networkStatus)==null||f.destroy(),this.networkStatus=null,this.openModals.forEach(g=>{g.close()}),this.openModals.length=0,(u=this.sharedFolders)==null||u.destroy(),this.sharedFolders=null,(d=this.settingsTab)==null||d.destroy(),this.settingsTab=null,(m=this.loginManager)==null||m.destroy(),this.loginManager=null,(p=this.backgroundSync)==null||p.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(x=this.app)==null||x.workspace.updateOptions(),this.app.reloadRelay=void 0,this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.loginSettings.destroy(),this.loginSettings=null,this.interceptedUrls.length=0,pt.destroy(),xr.destroy(),this.notifier=null,qh(),lf()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/check.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/square-pen.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */